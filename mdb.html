<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Modular Debugger Guide</title>
<style>
/*
 * Modern Light/Dark Mode Stylesheet for illumos Documentation
 * Pure CSS solution with automatic theme switching based on system preferences
 * Responsive design for all devices
 */

/* ==================== CSS CUSTOM PROPERTIES (VARIABLES) ==================== */

:root {
  /* Light mode colors (default) */
  --bg-color: #ffffff;
  --bg-secondary: #f8f9fa;
  --bg-tertiary: #e9ecef;
  --text-color: #212529;
  --text-secondary: #6c757d;
  --text-muted: #868e96;
  --border-color: #dee2e6;
  --border-secondary: #e9ecef;
  --link-color: #0d6efd;
  --link-hover: #0a58ca;
  --link-visited: #6f42c1;
  
  /* Code highlighting */
  --code-bg: #f8f9fa;
  --code-border: #e9ecef;
  --code-text: #0033b3;
  --code-block-bg: #fafbfc;
  --code-block-border: #d1d9e0;
  
  /* Admonition colors */
  --note-bg: #cff4fc;
  --note-border: #0dcaf0;
  --warning-bg: #fff3cd;
  --warning-border: #ffc107;
  --important-bg: #f8d7da;
  --important-border: #dc3545;
  --tip-bg: #d1e7dd;
  --tip-border: #198754;
  --caution-bg: #fff3cd;
  --caution-border: #fd7e14;
  
  /* Table colors */
  --table-bg: #ffffff;
  --table-stripe: #f8f9fa;
  --table-border: #dee2e6;
  --table-header-bg: #e9ecef;
  
  /* TOC colors */
  --toc-bg: #f8f9fa;
  --toc-border: #dee2e6;
  --toc-link: #495057;
  --toc-link-hover: #0d6efd;
  
  /* Shadow and focus */
  --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  --focus-ring: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  
  /* Typography */
  --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-family-mono: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --font-size-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
  --line-height-base: 1.6;
  
  /* Spacing */
  --content-max-width: 75rem;
  --toc-width: 16rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-color: #1a1a1a;
    --bg-secondary: #2d2d2d;
    --bg-tertiary: #404040;
    --text-color: #e9ecef;
    --text-secondary: #adb5bd;
    --text-muted: #6c757d;
    --border-color: #495057;
    --border-secondary: #404040;
    --link-color: #6ea8fe;
    --link-hover: #9ec5fe;
    --link-visited: #b8a9ff;
    
    /* Code highlighting for dark mode */
    --code-bg: #2b2b2b;
    --code-border: #4a4a4a;
    --code-text: #569cd6;
    --code-block-bg: #1e1e1e;
    --code-block-border: #3e3e3e;
    
    /* Admonition colors for dark mode */
    --note-bg: #1f4a54;
    --note-border: #0dcaf0;
    --warning-bg: #4a3728;
    --warning-border: #ffc107;
    --important-bg: #4a2628;
    --important-border: #dc3545;
    --tip-bg: #1e3a28;
    --tip-border: #198754;
    --caution-bg: #4a3728;
    --caution-border: #fd7e14;
    
    /* Table colors for dark mode */
    --table-bg: #2d2d2d;
    --table-stripe: #404040;
    --table-border: #495057;
    --table-header-bg: #404040;
    
    /* TOC colors for dark mode */
    --toc-bg: #2d2d2d;
    --toc-border: #495057;
    --toc-link: #adb5bd;
    --toc-link-hover: #6ea8fe;
    
    /* Shadow for dark mode */
    --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.4);
    --focus-ring: 0 0 0 0.25rem rgba(110, 168, 254, 0.25);
  }
}

/* ==================== BASE STYLES ==================== */

* {
  box-sizing: border-box;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  line-height: var(--line-height-base);
  color: var(--text-color);
  background-color: var(--bg-color);
  margin: 0;
  padding: 0;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* ==================== LAYOUT ==================== */

.container {
  max-width: var(--content-max-width);
  margin: 0 auto;
  padding: var(--spacing-md);
}

/* Main content area */
#content {
  max-width: none;
  margin-right: var(--spacing-xl);
  padding-right: var(--spacing-lg);
}

/* Content when TOC is on left side */
body.toc2.toc-left #content {
  margin-right: var(--spacing-xl);
  padding-right: var(--spacing-xl);
}

/* ==================== TYPOGRAPHY ==================== */

h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  line-height: 1.2;
  margin-top: calc(var(--spacing-xl) * 1.5);
  margin-bottom: var(--spacing-lg);
  margin-right: var(--spacing-md);
  color: var(--text-color);
  letter-spacing: -0.02em;
  position: relative;
}

/* Make heading text clickable for easy linking */
h1[id]:hover, h2[id]:hover, h3[id]:hover, h4[id]:hover, h5[id]:hover, h6[id]:hover {
  cursor: pointer;
  text-decoration: underline;
  text-decoration-color: var(--link-color);
  text-decoration-thickness: 2px;
  text-underline-offset: 4px;
}

h1 {
  font-size: clamp(2rem, 2.2rem + 1vw, 2.8rem);
  font-weight: 800;
  border-bottom: 3px solid var(--border-color);
  padding-bottom: var(--spacing-md);
  margin-top: 0;
  margin-bottom: var(--spacing-xl);
}

h2 {
  font-size: clamp(1.6rem, 1.8rem + 0.5vw, 2.2rem);
  font-weight: 700;
  border-bottom: 2px solid var(--border-color);
  padding-bottom: var(--spacing-sm);
  margin-top: calc(var(--spacing-xl) * 2);
}

h3 {
  font-size: clamp(1.4rem, 1.5rem + 0.3vw, 1.8rem);
  font-weight: 650;
  border-left: 4px solid var(--border-color);
  padding-left: var(--spacing-md);
  margin-top: calc(var(--spacing-xl) * 1.5);
}

h4 {
  font-size: clamp(1.2rem, 1.3rem + 0.2vw, 1.5rem);
  font-weight: 650;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px dotted var(--border-color);
  padding-bottom: 0.25rem;
}

h5 {
  font-size: clamp(1.1rem, 1.15rem + 0.1vw, 1.3rem);
  font-weight: 600;
  font-style: italic;
}

h6 {
  font-size: clamp(1rem, 1.05rem + 0.1vw, 1.2rem);
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

p {
  margin-bottom: var(--spacing-md);
  margin-right: var(--spacing-md);
}

/* ==================== LINKS ==================== */

a {
  color: var(--link-color);
  text-decoration: none;
  transition: color 0.2s ease;
}

a:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

a:visited {
  color: var(--link-visited);
}

a:focus {
  outline: none;
  box-shadow: var(--focus-ring);
  border-radius: 0.25rem;
}

/* ==================== CODE BLOCKS ==================== */

code {
  font-family: var(--font-family-mono);
  font-size: 0.9em;
  color: var(--code-text);
  background-color: var(--code-bg);
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  border: 1px solid var(--code-border);
}

pre {
  font-family: var(--font-family-mono);
  font-size: 0.875rem;
  line-height: 1.5;
  background-color: var(--code-block-bg);
  color: var(--text-color);
  border: 1px solid var(--code-block-border);
  border-radius: 0.5rem;
  padding: var(--spacing-md);
  margin: var(--spacing-md) var(--spacing-md) var(--spacing-md) 0;
  overflow-x: auto;
  box-shadow: var(--shadow);
}

pre code {
  background: none;
  border: none;
  padding: 0;
  color: inherit;
  font-size: inherit;
}

/* ==================== SYNTAX HIGHLIGHTING ==================== */

/* Base highlighting for light mode */
.hljs {
  background-color: var(--code-block-bg) !important;
  color: var(--text-color) !important;
}

/* Light mode syntax highlighting */
:root {
  --hl-keyword: #0033b3;          /* Keywords: blue */
  --hl-string: #067d17;           /* Strings: green */
  --hl-comment: #808080;          /* Comments: gray */
  --hl-number: #1750eb;           /* Numbers: blue */
  --hl-type: #800080;             /* Types: purple */
  --hl-function: #000080;         /* Functions: dark blue */
  --hl-variable: #660e7a;         /* Variables: dark purple */
  --hl-preprocessor: #808000;     /* Preprocessor: olive */
  --hl-operator: #000000;         /* Operators: black */
  --hl-literal: #0000ff;          /* Literals: blue */
}

/* Dark mode syntax highlighting */
@media (prefers-color-scheme: dark) {
  :root {
    --hl-keyword: #569cd6;        /* Keywords: light blue */
    --hl-string: #9cdcfe;         /* Strings: light cyan */
    --hl-comment: #6a9955;        /* Comments: green */
    --hl-number: #b5cea8;         /* Numbers: light green */
    --hl-type: #4ec9b0;           /* Types: teal */
    --hl-function: #dcdcaa;       /* Functions: yellow */
    --hl-variable: #9cdcfe;       /* Variables: light cyan */
    --hl-preprocessor: #c586c0;   /* Preprocessor: light purple */
    --hl-operator: #d4d4d4;       /* Operators: light gray */
    --hl-literal: #d69d85;        /* Literals: orange */
  }
}

/* Highlight.js C/C++ syntax highlighting */
.hljs-keyword,
.hljs-selector-tag,
.hljs-built_in {
  color: var(--hl-keyword) !important;
  font-weight: 600;
}

.hljs-string,
.hljs-attribute {
  color: var(--hl-string) !important;
}

.hljs-comment,
.hljs-quote {
  color: var(--hl-comment) !important;
  font-style: italic;
}

.hljs-number,
.hljs-literal {
  color: var(--hl-number) !important;
}

.hljs-type,
.hljs-class .hljs-title {
  color: var(--hl-type) !important;
  font-weight: 600;
}

.hljs-function .hljs-title,
.hljs-title.function_ {
  color: var(--hl-function) !important;
  font-weight: 600;
}

.hljs-variable,
.hljs-name {
  color: var(--hl-variable) !important;
}

.hljs-meta,
.hljs-preprocessor {
  color: var(--hl-preprocessor) !important;
  font-weight: 600;
}

.hljs-operator,
.hljs-punctuation {
  color: var(--hl-operator) !important;
}

/* DTrace-specific highlighting */
.hljs-dtrace-probe,
.hljs-dtrace-builtin {
  color: var(--hl-function) !important;
  font-weight: 600;
}

/* Additional C-specific tokens */
.hljs-params {
  color: var(--text-color) !important;
}

.hljs-title {
  color: var(--hl-function) !important;
  font-weight: 600;
}

/* Ensure good contrast for inline code */
code:not(.hljs) {
  color: var(--hl-keyword) !important;
  background-color: var(--code-bg) !important;
  font-weight: 500;
}

/* Fallback for code blocks without syntax highlighting */
pre:not(.hljs) {
  color: var(--text-color) !important;
  background-color: var(--code-block-bg) !important;
}

/* Improve readability for unstyled code blocks */
pre code:not(.hljs) {
  color: var(--text-color) !important;
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
}

/* ==================== TABLES ==================== */

table {
  width: calc(100% - 2 * var(--spacing-md));
  border-collapse: collapse;
  margin: var(--spacing-md) var(--spacing-md);
  background-color: var(--table-bg);
  border-radius: 0.5rem;
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid var(--table-border);
}

th, td {
  padding: calc(var(--spacing-sm) * 0.75) var(--spacing-sm);
  text-align: left;
  border-bottom: 1px solid var(--table-border);
  border-right: 1px solid var(--table-border);
}

th:last-child,
td:last-child {
  border-right: none;
}

th {
  background-color: var(--table-header-bg);
  font-weight: 600;
  color: var(--text-color);
  border-bottom: 2px solid var(--table-border);
}

tbody tr:nth-child(even) {
  background-color: var(--table-stripe);
}

tbody tr:hover {
  background-color: var(--bg-tertiary);
}

/* Lists inside table cells - reduce spacing */
td ul, td ol, th ul, th ol {
  margin: var(--spacing-sm) 0;
  padding-left: var(--spacing-lg);
}

td li, th li {
  margin: calc(var(--spacing-sm) * 0.25) 0;
}

/* Paragraphs in table cells - reduce spacing */
td p, th p {
  margin-bottom: calc(var(--spacing-sm) * 0.5);
  margin-right: 0;
}

/* ==================== TABLE OF CONTENTS ==================== */

#toc {
  background-color: var(--toc-bg);
  border: 1px solid var(--toc-border);
  border-radius: 0.5rem;
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-xl);
  box-shadow: var(--shadow);
  position: relative;
}

#toc .title {
  font-weight: 600;
  font-size: 0.95rem;
  margin-bottom: calc(var(--spacing-sm) * 0.5);
  color: var(--text-color);
}

#toc ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

#toc ul ul {
  padding-left: calc(var(--spacing-md) * 0.75);
  margin-top: calc(var(--spacing-sm) * 0.25);
}

#toc li {
  margin: calc(var(--spacing-sm) * 0.25) 0;
}

#toc a {
  color: var(--toc-link);
  text-decoration: none;
  display: block;
  padding: 0.125rem 0.375rem;
  border-radius: 0.25rem;
  transition: all 0.2s ease;
  font-size: 0.9rem;
}

#toc a:hover {
  color: var(--toc-link-hover);
  background-color: var(--bg-tertiary);
  text-decoration: none;
}

/* Active/Current section highlighting */
#toc a.active {
  color: var(--link-color);
  background-color: var(--link-color);
  background-color: color-mix(in srgb, var(--link-color) 15%, transparent);
  font-weight: 600;
  border-left: 3px solid var(--link-color);
  padding-left: calc(0.375rem - 3px);
}

@media (prefers-color-scheme: dark) {
  #toc a.active {
    background-color: color-mix(in srgb, var(--link-color) 20%, transparent);
  }
}

/* Target section highlighting */
:target {
  scroll-margin-top: var(--spacing-xl);
  animation: highlight-target 2s ease-out;
}

@keyframes highlight-target {
  0% {
    background-color: color-mix(in srgb, var(--link-color) 20%, transparent);
  }
  100% {
    background-color: transparent;
  }
}

/* Smooth scrolling enhancement */
html {
  scroll-behavior: smooth;
  scroll-padding-top: var(--spacing-xl);
}

/* Progressive enhancement for scroll-spy */
body.js-enabled #toc a {
  transition: all 0.2s ease;
}

body.js-enabled #toc a.active {
  transform: translateX(2px);
}

/* Parent section highlighting for nested TOC */
#toc a.active-parent {
  color: var(--toc-link-hover);
  font-weight: 500;
  background-color: color-mix(in srgb, var(--link-color) 8%, transparent);
}

/* Fallback for browsers without color-mix support */
@supports not (background-color: color-mix(in srgb, blue 15%, transparent)) {
  #toc a.active {
    background-color: var(--link-hover);
    background-color: rgba(13, 110, 253, 0.15);
  }
  
  @media (prefers-color-scheme: dark) {
    #toc a.active {
      background-color: rgba(110, 168, 254, 0.2);
    }
  }
  
  #toc a.active-parent {
    background-color: rgba(13, 110, 253, 0.08);
  }
  
  @media (prefers-color-scheme: dark) {
    #toc a.active-parent {
      background-color: rgba(110, 168, 254, 0.1);
    }
  }
}

/* Left TOC layout for larger screens */
@media (min-width: 1200px) {
  body.toc2.toc-left {
    padding-left: calc(var(--toc-width) + var(--spacing-lg));
  }
  
  #toc.toc2 {
    position: fixed;
    left: 0;
    top: 0;
    width: var(--toc-width);
    height: 100vh;
    overflow-y: auto;
    margin: 0;
    border-radius: 0;
    border-left: none;
    border-top: none;
    border-bottom: none;
    z-index: 1000;
  }
}

/* ==================== ADMONITIONS ==================== */

.admonitionblock {
  margin: var(--spacing-lg) var(--spacing-md);
  border-radius: 0.5rem;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.admonitionblock table {
  margin: 0;
  box-shadow: none;
  width: 100%;
  border: none;
  border-radius: 0;
}

.admonitionblock td.icon {
  display: none;
}

.admonitionblock td.content {
  padding: var(--spacing-md);
  border: none;
  border-bottom: none;
  border-right: none;
}

/* Note */
.admonitionblock.note {
  background-color: var(--note-bg);
  border-left: 4px solid var(--note-border);
}

/* Warning */
.admonitionblock.warning {
  background-color: var(--warning-bg);
  border-left: 4px solid var(--warning-border);
}

/* Important */
.admonitionblock.important {
  background-color: var(--important-bg);
  border-left: 4px solid var(--important-border);
}

/* Tip */
.admonitionblock.tip {
  background-color: var(--tip-bg);
  border-left: 4px solid var(--tip-border);
}

/* Caution */
.admonitionblock.caution {
  background-color: var(--caution-bg);
  border-left: 4px solid var(--caution-border);
}

/* ==================== LISTS ==================== */

ul, ol {
  padding-left: var(--spacing-xl);
  margin: var(--spacing-md) var(--spacing-md) var(--spacing-md) 0;
}

li {
  margin: var(--spacing-sm) 0;
}

dt {
  font-weight: 600;
  margin-top: var(--spacing-md);
  color: var(--text-color);
}

dd {
  margin-left: var(--spacing-xl);
  margin-bottom: var(--spacing-md);
}

/* ==================== BLOCKQUOTES ==================== */

blockquote {
  border-left: 4px solid var(--border-color);
  margin: var(--spacing-lg) var(--spacing-md) var(--spacing-lg) 0;
  padding: var(--spacing-md) var(--spacing-lg);
  background-color: var(--bg-secondary);
  font-style: italic;
  border-radius: 0 0.5rem 0.5rem 0;
}

/* ==================== IMAGES AND FIGURES ==================== */

img {
  max-width: 80%;
  width: auto;
  height: auto;
  border-radius: 0.5rem;
  box-shadow: var(--shadow);
  margin: var(--spacing-md) auto;
  display: block;
}

.imageblock {
  text-align: center;
  margin: var(--spacing-lg) 0;
}

.imageblock .title {
  font-style: italic;
  color: var(--text-secondary);
  margin-top: var(--spacing-sm);
}

/* ==================== RESPONSIVE DESIGN ==================== */

/* Mobile adjustments */
@media (max-width: 768px) {
  .container {
    padding: var(--spacing-sm);
  }
  
  #content {
    margin-right: var(--spacing-md);
    padding-right: var(--spacing-sm);
  }
  
  body.toc2.toc-left #content {
    margin-right: var(--spacing-md);
    padding-right: var(--spacing-sm);
  }
  
  h1 {
    font-size: 1.8rem;
    margin-right: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-sm);
  }
  
  h2 {
    font-size: 1.5rem;
    margin-right: var(--spacing-sm);
    margin-top: var(--spacing-xl);
    padding: var(--spacing-sm);
  }
  
  h3 {
    font-size: 1.3rem;
    margin-top: var(--spacing-lg);
    padding-left: var(--spacing-sm);
  }
  
  h4 {
    font-size: 1.1rem;
  }
  
  h1, h2, h3, h4, h5, h6 {
    margin-right: var(--spacing-sm);
  }
  
  p {
    margin-right: var(--spacing-sm);
  }
  
  pre {
    font-size: 0.8rem;
    padding: var(--spacing-sm);
    margin-right: var(--spacing-sm);
  }
  
  ul, ol {
    margin-right: var(--spacing-sm);
  }
  
  blockquote {
    margin-right: var(--spacing-sm);
  }
  
  table {
    font-size: 0.9rem;
    width: calc(100% - 2 * var(--spacing-sm));
    margin: var(--spacing-md) var(--spacing-sm);
  }
  
  th, td {
    padding: calc(var(--spacing-sm) * 0.5) calc(var(--spacing-sm) * 0.75);
  }
  
  #toc {
    margin-bottom: var(--spacing-md);
  }
  
  .admonitionblock {
    margin: var(--spacing-md) var(--spacing-sm);
  }
  
  .admonitionblock td.icon {
    display: none;
  }
  
  .admonitionblock td.content {
    padding: var(--spacing-sm);
    border: none;
  }
  
  .admonitionblock table {
    margin: 0;
    width: 100%;
  }
  
  /* Even more compact lists in table cells on mobile */
  td ul, td ol, th ul, th ol {
    margin: calc(var(--spacing-sm) * 0.5) 0;
    padding-left: var(--spacing-md);
  }
  
  td li, th li {
    margin: calc(var(--spacing-sm) * 0.125) 0;
  }
  
  td p, th p {
    margin-bottom: calc(var(--spacing-sm) * 0.25);
  }
}

/* Tablet adjustments */
@media (min-width: 769px) and (max-width: 1199px) {
  .container {
    padding: var(--spacing-md) var(--spacing-lg);
  }
}

/* ==================== PRINT STYLES ==================== */

@media print {
  :root {
    --bg-color: white;
    --text-color: black;
    --border-color: #ccc;
  }
  
  body {
    font-size: 12pt;
    line-height: 1.4;
  }
  
  #toc.toc2 {
    position: static;
    width: auto;
    height: auto;
    margin-bottom: var(--spacing-lg);
  }
  
  body.toc2.toc-left {
    padding-left: 0;
  }
  
  .admonitionblock {
    page-break-inside: avoid;
  }
  
  pre {
    page-break-inside: avoid;
  }
  
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
}

/* ==================== UTILITIES ==================== */

.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.mb-0 {
  margin-bottom: 0;
}

.mt-0 {
  margin-top: 0;
}

/* ==================== ACCESSIBILITY ==================== */

/* Focus indicators */
*:focus {
  outline: 2px solid var(--link-color);
  outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --border-color: #000000;
    --border-secondary: #000000;
    --text-secondary: var(--text-color);
  }
}

/* ==================== CUSTOM ENHANCEMENTS ==================== */

/* Note: This CSS includes scroll-spy functionality that works with CSS alone
 * For enhanced scroll-spy with JavaScript, include scroll-spy.js:
 * <script src="scroll-spy.js"></script>
 */

/* Better selection colors */
::selection {
  background-color: var(--link-color);
  color: white;
}

/* Loading state */
body {
  opacity: 0;
  animation: fadeIn 0.3s ease-in-out forwards;
}

@keyframes fadeIn {
  to {
    opacity: 1;
  }
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Modular Debugger Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#whats-new-in-mdb">1.1. What&#8217;s New in MDB</a></li>
<li><a href="#who-should-use-this-book">1.2. Who Should Use This Book</a></li>
<li><a href="#before-you-read-this-book">1.3. Before You Read This Book</a></li>
<li><a href="#how-this-book-is-organized">1.4. How This Book Is Organized</a></li>
<li><a href="#related-books-and-papers">1.5. Related Books and Papers</a></li>
<li><a href="#_typographic_conventions">1.6. Typographic Conventions</a></li>
<li><a href="#shell-prompts-in-command-examples">1.7. Shell Prompts in Command Examples</a></li>
</ul>
</li>
<li><a href="#modular-debugger-overview">2. Modular Debugger Overview</a>
<ul class="sectlevel2">
<li><a href="#introduction">2.1. Introduction</a></li>
<li><a href="#mdb-features">2.2. MDB Features</a></li>
<li><a href="#using-mdb">2.3. Using MDB</a></li>
<li><a href="#future-enhancements">2.4. Future Enhancements</a></li>
</ul>
</li>
<li><a href="#debugger-concepts">3. Debugger Concepts</a>
<ul class="sectlevel2">
<li><a href="#building-blocks">3.1. Building Blocks</a></li>
<li><a href="#modularity">3.2. Modularity</a></li>
</ul>
</li>
<li><a href="#mdb-language-syntax">4. MDB Language Syntax</a>
<ul class="sectlevel2">
<li><a href="#syntax">4.1. Syntax</a></li>
<li><a href="#commands">4.2. Commands</a></li>
<li><a href="#comments">4.3. Comments</a></li>
<li><a href="#arithmetic-expansion">4.4. Arithmetic Expansion</a>
<ul class="sectlevel3">
<li><a href="#unary-operators">4.4.1. Unary Operators</a></li>
<li><a href="#binary-operators">4.4.2. Binary Operators</a></li>
</ul>
</li>
<li><a href="#quoting">4.5. Quoting</a></li>
<li><a href="#shell-escapes">4.6. Shell Escapes</a></li>
<li><a href="#variables">4.7. Variables</a></li>
<li><a href="#symbol-name-resolution">4.8. Symbol Name Resolution</a></li>
<li><a href="#dcmd-and-walker-name-resolution">4.9. Dcmd and Walker Name Resolution</a></li>
<li><a href="#dcmd-pipelines">4.10. Dcmd Pipelines</a></li>
<li><a href="#formatting-dcmds">4.11. Formatting Dcmds</a></li>
</ul>
</li>
<li><a href="#using-mdb-commands-interactively">5. Using MDB Commands Interactively</a>
<ul class="sectlevel2">
<li><a href="#command-reentry">5.1. Command Reentry</a></li>
<li><a href="#inline-editing">5.2. Inline Editing</a></li>
<li><a href="#keyboard-shortcuts">5.3. Keyboard Shortcuts</a></li>
<li><a href="#output-pager">5.4. Output Pager</a></li>
<li><a href="#signal-handling">5.5. Signal Handling</a></li>
</ul>
</li>
<li><a href="#built-in-commands">6. Built-In Commands</a>
<ul class="sectlevel2">
<li><a href="#built-in-dcmds">6.1. Built-In dcmds</a></li>
</ul>
</li>
<li><a href="#execution-control">7. Execution Control</a>
<ul class="sectlevel2">
<li><a href="#execution-control-1">7.1. Execution Control</a></li>
<li><a href="#event-callbacks">7.2. Event Callbacks</a></li>
<li><a href="#thread-support">7.3. Thread Support</a></li>
<li><a href="#built-in-dcmds-1">7.4. Built-in dcmds</a></li>
<li><a href="#interaction-with-exec">7.5. Interaction With <code>exec</code></a></li>
<li><a href="#interaction-with-job-control">7.6. Interaction with Job Control</a></li>
<li><a href="#process-attach-and-release">7.7. Process Attach and Release</a></li>
</ul>
</li>
<li><a href="#kernel-execution-control">8. Kernel Execution Control</a>
<ul class="sectlevel2">
<li><a href="#booting-loading-and-unloading">8.1. Booting, Loading, and Unloading</a></li>
<li><a href="#terminal-handling">8.2. Terminal Handling</a></li>
<li><a href="#debugger-entry">8.3. Debugger Entry</a></li>
<li><a href="#processor-specific-features">8.4. Processor-Specific Features</a></li>
</ul>
</li>
<li><a href="#kernel-debugging-modules">9. Kernel Debugging Modules</a>
<ul class="sectlevel2">
<li><a href="#getting-started-creating-a-sample-crash-dump">9.1. Getting Started: Creating a Sample Crash Dump</a>
<ul class="sectlevel3">
<li><a href="#setting-kmem_flags">9.1.1. Setting <code>kmem_flags</code></a></li>
<li><a href="#forcing-a-crash-dump">9.1.2. Forcing a Crash Dump</a></li>
<li><a href="#starting-mdb">9.1.3. Starting MDB</a></li>
</ul>
</li>
<li><a href="#allocator-basics">9.2. Allocator Basics</a>
<ul class="sectlevel3">
<li><a href="#buffer-states">9.2.1. Buffer States</a></li>
<li><a href="#transactions">9.2.2. Transactions</a></li>
<li><a href="#sleeping-and-non-sleeping-allocations">9.2.3. Sleeping and Non-Sleeping Allocations</a></li>
<li><a href="#kernel-memory-caches">9.2.4. Kernel Memory Caches</a></li>
<li><a href="#uninitialized-data-0xbaddcafe">9.2.5. Uninitialized Data: <code>0xbaddcafe</code></a></li>
<li><a href="#associating-panic-messages-with-failures">9.2.6. Associating Panic Messages With Failures</a></li>
</ul>
</li>
<li><a href="#memory-allocation-logging">9.3. Memory Allocation Logging</a>
<ul class="sectlevel3">
<li><a href="#buftag-data-integrity">9.3.1. Buftag Data Integrity</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#module-programming-api">10. Module Programming API</a>
<ul class="sectlevel2">
<li><a href="#debugger-module-linkage">10.1. Debugger Module Linkage</a>
<ul class="sectlevel3">
<li><a href="#mdbinit">10.1.1. <code>_mdb_init</code></a></li>
<li><a href="#mdbfini">10.1.2. <code>_mdb_fini</code></a></li>
</ul>
</li>
<li><a href="#dcmd-definitions">10.2. Dcmd Definitions</a></li>
<li><a href="#walker-definitions">10.3. Walker Definitions</a></li>
<li><a href="#api-functions">10.4. API Functions</a>
<ul class="sectlevel3">
<li><a href="#mdb_pwalk">10.4.1. <code>mdb_pwalk</code></a></li>
<li><a href="#mdb_walk">10.4.2. <code>mdb_walk</code></a></li>
<li><a href="#mdbpwalkdcmd">10.4.3. <code>mdb_pwalk_dcmd</code></a></li>
<li><a href="#mdbwalkdcmd">10.4.4. <code>mdb_walk_dcmd</code></a></li>
<li><a href="#mdbcalldcmd">10.4.5. <code>mdb_call_dcmd</code></a></li>
<li><a href="#mdblayeredwalk">10.4.6. <code>mdb_layered_walk</code></a></li>
<li><a href="#mdbaddwalker">10.4.7. <code>mdb_add_walker</code></a></li>
<li><a href="#mdbremovewalker">10.4.8. <code>mdb_remove_walker</code></a></li>
<li><a href="#mdbvread-and-mdbvwrite">10.4.9. <code>mdb_vread</code> and <code>mdb_vwrite</code></a></li>
<li><a href="#mdbfread-and-mdbfwrite">10.4.10. <code>mdb_fread</code> and <code>mdb_fwrite</code></a></li>
<li><a href="#mdbpread-and-mdbpwrite">10.4.11. <code>mdb_pread</code> and <code>mdb_pwrite</code></a></li>
<li><a href="#mdb_readstr">10.4.12. <code>mdb_readstr</code></a></li>
<li><a href="#mdb_writestr">10.4.13. <code>mdb_writestr</code></a></li>
<li><a href="#mdb_readsym">10.4.14. <code>mdb_readsym</code></a></li>
<li><a href="#mdb_writesym">10.4.15. <code>mdb_writesym</code></a></li>
<li><a href="#mdbreadvar-and-mdbwritevar">10.4.16. <code>mdb_readvar</code> and <code>mdb_writevar</code></a></li>
<li><a href="#mdblookupbyname-and-mdblookupbyobj">10.4.17. <code>mdb_lookup_by_name</code> and <code>mdb_lookup_by_obj</code></a></li>
<li><a href="#mdblookupby_addr">10.4.18. <code>mdb_lookup_by_addr</code></a></li>
<li><a href="#mdb_getopts">10.4.19. <code>mdb_getopts</code></a></li>
<li><a href="#mdb_strtoull">10.4.20. <code>mdb_strtoull</code></a></li>
<li><a href="#mdballoc-mdbzalloc-and-mdb_free">10.4.21. <code>mdb_alloc</code>, <code>mdb_zalloc</code> and <code>mdb_free</code></a></li>
<li><a href="#mdb_printf">10.4.22. <code>mdb_printf</code></a></li>
<li><a href="#mdb_snprintf">10.4.23. <code>mdb_snprintf</code></a></li>
<li><a href="#mdb_warn">10.4.24. <code>mdb_warn</code></a></li>
<li><a href="#mdb_flush">10.4.25. <code>mdb_flush</code></a></li>
<li><a href="#mdb_nhconvert">10.4.26. <code>mdb_nhconvert</code></a></li>
<li><a href="#mdbdumpptr-and-mdbdump64">10.4.27. <code>mdb_dumpptr</code> and <code>mdb_dump64</code></a></li>
<li><a href="#mdbonebit">10.4.28. <code>mdb_one_bit</code></a></li>
<li><a href="#mdbinvalbits">10.4.29. <code>mdb_inval_bits</code></a></li>
<li><a href="#mdbincindent-and-mdbdecindent">10.4.30. <code>mdb_inc_indent</code> and <code>mdb_dec_indent</code></a></li>
<li><a href="#mdb_eval">10.4.31. <code>mdb_eval</code></a></li>
<li><a href="#mdbsetdot-and-mdbgetdot">10.4.32. <code>mdb_set_dot</code> and <code>mdb_get_dot</code></a></li>
<li><a href="#mdbgetpipe">10.4.33. <code>mdb_get_pipe</code></a></li>
<li><a href="#mdbsetpipe">10.4.34. <code>mdb_set_pipe</code></a></li>
<li><a href="#mdbgetxdata">10.4.35. <code>mdb_get_xdata</code></a></li>
<li><a href="#additional-functions">10.4.36. Additional Functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#options">11. Options</a>
<ul class="sectlevel2">
<li><a href="#summary-of-command-line-options">11.1. Summary of Command-line Options</a></li>
<li><a href="#operands">11.2. Operands</a></li>
<li><a href="#exit-status">11.3. Exit Status</a></li>
<li><a href="#environment-variables">11.4. Environment Variables</a></li>
</ul>
</li>
<li><a href="#notes">12. Notes</a>
<ul class="sectlevel2">
<li><a href="#warnings">12.1. Warnings</a>
<ul class="sectlevel3">
<li><a href="#use-of-the-error-recovery-mechanism">12.1.1. Use of the Error Recovery Mechanism</a></li>
<li><a href="#use-of-the-debugger-to-modify-the-live-operating-system">12.1.2. Use of the Debugger to Modify the Live Operating System</a></li>
<li><a href="#use-of-kmdb-to-stop-the-live-operating-system">12.1.3. Use of <code>kmdb</code> to Stop the Live Operating System</a></li>
</ul>
</li>
<li><a href="#notes-1">12.2. Notes</a>
<ul class="sectlevel3">
<li><a href="#limitations-on-examining-process-core-files">12.2.1. Limitations on Examining Process Core Files</a></li>
<li><a href="#limitations-on-examining-crash-dump-files">12.2.2. Limitations on Examining Crash Dump Files</a></li>
<li><a href="#relationship-between-32-bit-and-64-bit-debugger">12.2.3. Relationship Between 32-bit and 64-bit Debugger</a></li>
<li><a href="#limitations-on-memory-available-to-kmdb">12.2.4. Limitations on Memory Available to <code>kmdb</code></a></li>
<li><a href="#developer-information">12.2.5. Developer Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#transition-from-adb-and-kadb">13. Transition From <code>adb</code> and <code>kadb</code></a>
<ul class="sectlevel2">
<li><a href="#command-line-options">13.1. Command-line Options</a></li>
<li><a href="#syntax-1">13.2. Syntax</a></li>
<li><a href="#watchpoint-length-specifier">13.3. Watchpoint Length Specifier</a></li>
<li><a href="#address-map-modifier">13.4. Address Map Modifier</a></li>
<li><a href="#output">13.5. Output</a></li>
<li><a href="#deferred-breakpoints">13.6. Deferred Breakpoints</a></li>
<li><a href="#io-port-access">13.7. I/O Port Access</a></li>
</ul>
</li>
<li><a href="#transition-from-crash">14. Transition From <code>crash</code></a>
<ul class="sectlevel2">
<li><a href="#command-line-options-1">14.1. Command-line Options</a></li>
<li><a href="#input-in-mdb">14.2. Input in MDB</a></li>
<li><a href="#functions">14.3. Functions</a></li>
</ul>
</li>
<li><a href="#document-license">15. Document License</a>
<ul class="sectlevel2">
<li><a href="#_public_documentation_license_pdl_version_1_01">15.1. Public Documentation License (PDL), Version 1.01</a></li>
<li><a href="#_public_documentation_license_notice">15.2. Public Documentation License Notice</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Modular Debugger (MDB) is a highly extensible, general purpose
debugging tool for the illumos Operating System. The Modular Debugger
Guide describes how to use MDB to debug complex software systems, with a
particular emphasis on the facilities available for debugging the
illumos kernel and associated device drivers and modules. It also
includes a complete reference for and discussion of the MDB language
syntax, debugger features, and MDB Module Programming API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This illumos release supports systems that use the SPARC and x86
families of processor architectures: UltraSPARC, SPARC64, AMD64,
Pentium, and Xeon EM64T. In this document the term “x86” refers to
64-bit and 32-bit systems manufactured using processors compatible with
the AMD64 or Intel Xeon/Pentium product families. For supported systems,
see the <a href="http://illumos.org/hcl/">illumos Hardware Compatibility Lists</a>.
This document cites any implementation differences between the platform
types.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="whats-new-in-mdb"><a class="anchor" href="#whats-new-in-mdb"></a>1.1. What&#8217;s New in MDB</h3>
<div class="paragraph">
<p><strong>Aug 2012</strong> kmdb supports ttyc and ttyd</p>
</div>
<div class="paragraph">
<p><strong>May 2012</strong> Added tab completion support</p>
</div>
<div class="paragraph">
<p><strong>Mar 2012</strong> <code>::printf</code> dcmd added</p>
</div>
<div class="paragraph">
<p><strong>Aug 2011</strong> Added 16-bit disassembler support</p>
</div>
</div>
<div class="sect2">
<h3 id="who-should-use-this-book"><a class="anchor" href="#who-should-use-this-book"></a>1.2. Who Should Use This Book</h3>
<div class="paragraph">
<p>If you were a detective and were investigating at the scene of a crime,
you might interview the witnesses and ask them to describe what happened
and who they saw. However, if there were no witnesses or these
descriptions proved insufficient, you might consider collecting
fingerprints and forensic evidence that could be examined for DNA to
help solve the case. Often, software program failures divide into
analogous categories: problems that can be solved with source-level
debugging tools, and problems that require low-level debugging
facilities, examination of core files, and knowledge of assembly
language to diagnose and correct. MDB facilitates analysis of this
second class of problems.</p>
</div>
<div class="paragraph">
<p>MDB is most useful when you are programming a complex low-level software
system such as an operating system. The MDB debugging framework allows
you to construct your own custom analysis tools to aid in the diagnosis
of these low-level problems. MDB also provides a powerful set of
built-in commands that enable you to analyze the state of your program
at the assembly language level.</p>
</div>
</div>
<div class="sect2">
<h3 id="before-you-read-this-book"><a class="anchor" href="#before-you-read-this-book"></a>1.3. Before You Read This Book</h3>
<div class="paragraph">
<p>If you are not familiar with assembly language programming and
debugging, <a href="#related-books-and-papers">Related Books and Papers</a> provides references
to materials that you might find useful.</p>
</div>
<div class="paragraph">
<p>You should disassemble various functions of interest in the programs you
will be debugging in order to familiarize yourself with the relationship
between your program&#8217;s source code and the corresponding assembly
language code. If you are planning to use MDB for debugging illumos
kernel software, read carefully <a href="#kernel-debugging-modules">Kernel Debugging
Modules</a> and <a href="#debugging-with-the-kernel-memory-allocator">Debugging With the Kernel Memory Allocator</a>.
These chapters provide more detailed information on the MDB commands and
facilities provided for debugging illumos kernel software.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-this-book-is-organized"><a class="anchor" href="#how-this-book-is-organized"></a>1.4. How This Book Is Organized</h3>
<div class="paragraph">
<p><a href="#modular-debugger-overview">Modular Debugger Overview</a> provides an overview of the
debugger.</p>
</div>
<div class="paragraph">
<p><a href="#debugger-concepts">Debugger Concepts</a> describes the MDB architecture and
explains the terminology for the debugger concepts used throughout this
book.</p>
</div>
<div class="paragraph">
<p><a href="#mdb-language-syntax">MDB Language Syntax</a> describes the syntax, operators and
evaluation rules for the MDB language.</p>
</div>
<div class="paragraph">
<p><a href="#using-mdb-commands-interactively">Using MDB Commands Interactively</a> describes the MDB
interactive command-line editing facilities and output pager.</p>
</div>
<div class="paragraph">
<p><a href="#built-in-commands">Built-In Commands</a> describes the set of built-in
debugger commands that are always available.</p>
</div>
<div class="paragraph">
<p><a href="#execution-control">Execution Control</a> describes the MDB facilities for
controlling the execution of live running programs. This chapter is
intended for application developers and device driver developers.
Execution control features might also be useful for system
administrators.</p>
</div>
<div class="paragraph">
<p><a href="#kernel-execution-control">Kernel Execution Control</a> describes the MDB facilities
for controlling the execution of the live operating system kernel that
are specific to <code>kmdb</code>. This chapter is intended for operating system
kernel developers and device driver developers.</p>
</div>
<div class="paragraph">
<p><a href="#kernel-debugging-modules">Kernel Debugging Modules</a> describes the set of loadable
debugger commands that are provided for debugging the illumos kernel.
This chapter is intended for users who intend to examine illumos kernel
crash dumps and for kernel software developers.</p>
</div>
<div class="paragraph">
<p><a href="#debugging-with-the-kernel-memory-allocator">Debugging With the Kernel Memory Allocator</a> describes the
debugging features of the illumos kernel memory allocator and the MDB
commands provided to take advantage of these features. This chapter is
intended for advanced programmers and kernel software developers.</p>
</div>
<div class="paragraph">
<p><a href="#module-programming-api">Module Programming API</a> describes the facilities for writing
loadable debugger modules. This chapter is intended for advanced
programmers and software developers who intend to develop custom
debugging support for MDB.</p>
</div>
<div class="paragraph">
<p><a href="#options">appendix_title</a> provides a reference for MDB
command-line options.</p>
</div>
<div class="paragraph">
<p><a href="#notes">appendix_title</a> provides warnings and notes about
using the debugger.</p>
</div>
<div class="paragraph">
<p><a href="#transition-from-adb-and-kadb">appendix_title</a> provides a reference for <code>adb</code>
commands and their MDB equivalents. The <code>adb</code> command is implemented by
<code>mdb</code>.</p>
</div>
<div class="paragraph">
<p><a href="#transition-from-crash">appendix_title</a> provides a reference for <code>crash</code>
commands and their MDB equivalents. The <code>crash</code> command is no longer
present in illumos.</p>
</div>
</div>
<div class="sect2">
<h3 id="related-books-and-papers"><a class="anchor" href="#related-books-and-papers"></a>1.5. Related Books and Papers</h3>
<div class="paragraph">
<p>The following books and papers are recommended and related to the tasks
that you need to perform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vahalia, Uresh. UNIX Internals: The New Frontiers. Prentice Hall,</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ISBN 0-13-021034-0</p>
</li>
</ol>
</div>
</li>
<li>
<p>Mauro, Jim and McDougall, Richard. Solaris Performance and Tools:
DTrace and MDB Techniques for Solaris 10 and OpenSolaris. Prentice Hall
PTR, 2006. ISBN 0-13-156819-8</p>
</li>
<li>
<p>Mauro, Jim and McDougall, Richard. Solaris Internals: Core Kernel
Architecture. Prentice Hall PTR, 2000. ISBN 0-13-022496-5</p>
</li>
<li>
<p>The SPARC Architecture Manual, Version 9. Prentice Hall, 2000. ISBN
0–13–825001–4</p>
</li>
<li>
<p>AMD64 Architecture Programmer&#8217;s Manual. Advanced Micro Devices, 2006.
Available at <a href="http://developer.amd.com/">AMD Developer Central</a>.</p>
</li>
<li>
<p>Pentium Pro Family Developer&#8217;s Manual, Volumes 1-3. Intel Corporation,</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ISBN 1-55512-259-0 (Volume 1), ISBN 1-55512-260-4 (Volume 2) ,
ISBN 1-55512-261-2 (Volume 3)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Bonwick, Jeff, and Jonathan Adams.
<a href="http://www.usenix.org/publications/library/proceedings/usenix01/full_papers/bonwick/bonwick.pdf">Magazines
and Vmem: Extending the Slab Allocator to Many CPUs and Arbitrary
Resourceso</a>. Proceedings of the 2001 USENIX Annual Technical Conference,</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Available at .</p>
</li>
</ol>
</div>
</li>
<li>
<p>Bonwick, Jeff.
<a href="http://www.usenix.org/publications/library/proceedings/bos94/bonwick.html">The
Slab Allocator: An Object-Caching Kernel Memory Allocator</a>. Proceedings
of the Summer 1994 Usenix Conference, 1994. ISBN 9–99–452010–5.
Available at .</p>
</li>
<li>
<p>SPARC Assembly Language Reference Manual. Sun Microsystems, 2002.</p>
</li>
<li>
<p>x86 Assembly Language Reference Manual. Sun Microsystems, 2005.</p>
</li>
<li>
<p>Writing Device Drivers. Sun Microsystems, 2008.</p>
</li>
<li>
<p>STREAMS Programming Guide. Sun Microsystems, 2000.</p>
</li>
<li>
<p>Solaris 64-bit Developer’s Guide. Sun Microsystems, 2000.</p>
</li>
<li>
<p>Linker and Libraries Guide. Sun Microsystems, 2007.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Third-party URLs are referenced in this document and provide additional,
related information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sun is not responsible for the availability of third-party web sites
mentioned in this document. Sun does not endorse and is not responsible
or liable for any content, advertising, products, or other materials
that are available on or through such sites or resources. Sun will not
be responsible or liable for any actual or alleged damage or loss caused
or alleged to be caused by or in connection with use of or reliance on
any such content, goods, or services that are available on or through
such sites or resources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_typographic_conventions"><a class="anchor" href="#_typographic_conventions"></a>1.6. Typographic Conventions</h3>
<div class="paragraph">
<p>The following table describes the typographic conventions that are used
in this book.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Typographic Conventions</caption>
<colgroup>
<col style="width: 21%;">
<col style="width: 45%;">
<col style="width: 34%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Typeface</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AaBbCc123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The names of commands, files, and directories, and
onscreen computer output</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Edit your <code>.login</code> file.</p>
</div>
<div class="paragraph">
<p>Use <code>ls</code> <code>a</code> to list all files.</p>
</div>
<div class="paragraph">
<p><code>machine_name% you have mail.</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AaBbCc123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What you type, contrasted with onscreen computer output</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>machine_name%</code> <code>su</code></p>
</div>
<div class="paragraph">
<p><code>Password:</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;aabbcc123&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Placeholder: replace with a real name or value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command to remove a file is <code>rm</code> <em>filename</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AaBbCc123</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Book titles, new terms, and terms to be emphasized</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Read Chapter 6 in the User&#8217;s Guide.</p>
</div>
<div class="paragraph">
<p>A <em>cache</em> is a copy that is stored locally.</p>
</div>
<div class="paragraph">
<p>Do <em>not</em> save the file.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Some emphasized items appear bold online.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="shell-prompts-in-command-examples"><a class="anchor" href="#shell-prompts-in-command-examples"></a>1.7. Shell Prompts in Command Examples</h3>
<div class="paragraph">
<p>The following table shows the default UNIX system prompt and superuser
prompt for the C shell, Bourne shell, and Korn shell.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Shell Prompts</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Shell</th>
<th class="tableblock halign-left valign-top">Prompt</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C shell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>machine_name%</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C shell for superuser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>machine_name#</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bourne shell and Korn shell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bourne shell and Korn shell for superuser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modular-debugger-overview"><a class="anchor" href="#modular-debugger-overview"></a>2. Modular Debugger Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Modular Debugger (MDB) is a general purpose debugging tool for the
illumos operating system whose primary feature is its extensibility.
This book describes how to use MDB to debug complex software systems,
with a particular emphasis on the facilities available for debugging the
illumos kernel and associated device drivers and modules. The book also
includes a complete reference for and discussion of the MDB language
syntax, debugger features, and MDB Module Programming API.</p>
</div>
<div class="sect2">
<h3 id="introduction"><a class="anchor" href="#introduction"></a>2.1. Introduction</h3>
<div class="paragraph">
<p>Debugging is the process of analyzing the execution and state of a
software program in order to remove defects. Traditional debugging tools
provide facilities for execution control so that programmers can execute
programs in a controlled environment and display the current state of
program data or evaluate expressions in the source language used to
develop the program. Unfortunately, these techniques are often
inappropriate for debugging complex software systems such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An operating system, where bugs might not be reproducible and program
state is massive and distributed</p>
</li>
<li>
<p>Programs that are highly optimized or have had their debug information
removed</p>
</li>
<li>
<p>Programs that are themselves low-level debugging tools</p>
</li>
<li>
<p>Customer situations where the developer can only access post-mortem</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MDB provides a completely customizable environment for debugging these
programs and scenarios, including a dynamic module facility that you can
use to implement your own debugging commands to perform program-specific
analysis. Each MDB module can be used to examine the program in several
different contexts, including live and post-mortem. The illumos OS
includes a set of MDB modules that help you debug the illumos kernel and
related device drivers and kernel modules. Third-party developers might
want to develop and deliver their own debugging modules for supervisor
or user software.</p>
</div>
</div>
<div class="sect2">
<h3 id="mdb-features"><a class="anchor" href="#mdb-features"></a>2.2. MDB Features</h3>
<div class="paragraph">
<p>MDB provides an extensive collection of features for analyzing the
illumos kernel and other target programs. You can do the following tasks
in MDB:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform post-mortem analysis of illumos kernel crash dumps and user
process core dumps. MDB includes a collection of debugger modules that
facilitate sophisticated analysis of kernel and process state, in
addition to standard data display and formatting capabilities. These
debugger modules enable you to formulate complex queries to investigate
kernel and process state in the following ways:</p>
<div class="ulist">
<ul>
<li>
<p>Locate all the memory allocated by a particular thread</p>
</li>
<li>
<p>Print a visual picture of a kernel STREAM</p>
</li>
<li>
<p>Determine what type of structure a particular address refers to</p>
</li>
<li>
<p>Locate leaked memory blocks in the kernel</p>
</li>
<li>
<p>Analyze memory to locate stack traces</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use a first-class programming API to implement your own debugger
commands and analysis tools without having to recompile or modify MDB.
In MDB, debugging support is implemented as a set of loadable modules
(shared libraries that the debugger can open with the <code>dlopen(3C)</code>
function), each of which provides a set of commands that extends the
capabilities of MDB. MDB provides an API of core services, such as the
ability to read and write memory and access symbol table information.
MDB provides a framework for you to implement debugging support for your
own drivers and modules. Your command and tools can then be made
available for everyone to use.</p>
</li>
<li>
<p>Learn to use MDB if you are already familiar with the legacy debugging
tools <code>adb</code> and <code>crash</code>. MDB provides backward compatibility with these
existing debugging solutions. The MDB language is a superset of the
<code>adb</code> language. All existing <code>adb</code> macros and commands work within MDB.
Thus, developers who use <code>adb</code> can immediately use MDB without knowing
any MDB-specific commands. MDB also provides commands that surpass the
functionality available from the <code>crash</code> utility.</p>
</li>
<li>
<p>Benefit from enhanced usability features. MDB provides many usability
features, including the following:</p>
<div class="ulist">
<ul>
<li>
<p>Command-line editing</p>
</li>
<li>
<p>Command history</p>
</li>
<li>
<p>Built-in output pager</p>
</li>
<li>
<p>Syntax error checking and handling</p>
</li>
<li>
<p>Online help</p>
</li>
<li>
<p>Interactive session logging</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-mdb"><a class="anchor" href="#using-mdb"></a>2.3. Using MDB</h3>
<div class="paragraph">
<p>MDB is available on illumos systems as two commands that share common
features: <code>mdb</code> and <code>kmdb</code>. You can use the <code>mdb</code> command interactively
or in scripts to debug live user processes, user process core files,
kernel crash dumps, the live operating system, object files, and other
files. You can use the <code>kmdb</code> command to debug the live operating system
kernel and device drivers when you also need to control and halt the
execution of the kernel. To start <code>mdb</code>, use the <code>mdb</code> command as
described in the <code>mdb(1)</code> manual page. To start <code>kmdb</code>, boot the system
as described in the <code>kmdb(1)</code> manual page, or execute the <code>mdb</code> command
with the <code>K</code> option.</p>
</div>
</div>
<div class="sect2">
<h3 id="future-enhancements"><a class="anchor" href="#future-enhancements"></a>2.4. Future Enhancements</h3>
<div class="paragraph">
<p>MDB provides a stable foundation for developing advanced post-mortem
analysis tools. Each illumos release includes additional MDB modules
that provide even more sophisticated functionality for debugging the
kernel and other software programs. You can use MDB to debug existing
software programs, and you can develop your own modules to improve your
ability to debug your own illumos drivers and applications.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugger-concepts"><a class="anchor" href="#debugger-concepts"></a>3. Debugger Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter discusses the significant features of MDB and the benefits
derived from this architecture.</p>
</div>
<div class="sect2">
<h3 id="building-blocks"><a class="anchor" href="#building-blocks"></a>3.1. Building Blocks</h3>
<div class="paragraph">
<p>The <strong>target</strong> is the program being inspected by the debugger. MDB
currently provides support for the following types of targets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User processes</p>
</li>
<li>
<p>User process core files</p>
</li>
<li>
<p>Live operating system without kernel execution control (through
<code>/dev/kmem</code> and <code>/dev/ksyms</code>)</p>
</li>
<li>
<p>Live operating system with kernel execution control (through the
<code>kmdb(1)</code> command)</p>
</li>
<li>
<p>Operating system crash dumps</p>
</li>
<li>
<p>User process images recorded inside an operating system crash dump</p>
</li>
<li>
<p>ELF object files</p>
</li>
<li>
<p>Raw data files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each target exports a standard set of properties, including one or more
address spaces, one or more symbol tables, a set of load objects, and a
set of threads. <a href="#chapter-fig-10">MDB architecture</a> shows an overview
of the MDB architecture, including two of the built-in targets and a
pair of sample modules.</p>
</div>
<div class="paragraph">
<p>A debugger command, or <strong>dcmd</strong> (pronounced <em>dee-command</em>)
in MDB terminology, is a routine in the debugger that can access any of
the properties of the current target. MDB parses commands from standard
input, then executes the corresponding dcmds. Each dcmd can also accept
a list of string or numerical arguments, as shown in
<a href="#syntax">Syntax</a>. MDB contains a set of built-in dcmds that are
always available. These built-in dcmds are described in
<a href="#built-in-commands">Built-In Commands</a>. You can also extend the
capabilities of MDB by writing dcmds using a programming API provided
with MDB.</p>
</div>
<div class="paragraph">
<p>A <strong>walker</strong> is a set of routines that describe how to
walk, or iterate, through the elements of a particular program data
structure. A walker encapsulates the data structure&#8217;s implementation
from dcmds and from MDB. You can use walkers interactively, or you can
use walkers as primitives to build other dcmds or walkers. As with
dcmds, you can extend MDB by implementing additional walkers as part of
a debugger module.</p>
</div>
<div class="paragraph">
<p>A debugger module, or <strong>dmod</strong> (pronounced <em>dee-mod</em>), is a
dynamically loaded library that contains a set of dcmds and walkers.
During initialization, MDB attempts to load dmods corresponding to the
load objects present in the target. You can subsequently load or unload
dmods at any time while running MDB. MDB provides a set of standard
dmods for debugging the illumos kernel.</p>
</div>
<div class="paragraph">
<p>A <strong>macro file</strong> is a text file that contains a set of
commands to execute. Macro files are typically used to automate the
process of displaying a simple data structure. MDB provides complete
backward compatibility for the execution of macro files written for
<code>adb</code>. The set of macro files provided with the illumos installation can
therefore be used with either tool.</p>
</div>
<div id="chapter-fig-10" class="imageblock">
<div class="content">
<img src="figures/mdb-arch.png" alt="This graphic describes MDB components: the MDB language and the MDB module API overlying the debugger engine.">
</div>
<div class="title">Figure 1. MDB architecture</div>
</div>
</div>
<div class="sect2">
<h3 id="modularity"><a class="anchor" href="#modularity"></a>3.2. Modularity</h3>
<div class="paragraph">
<p>The benefit of MDB&#8217;s modular architecture extends beyond the ability to
load a module containing additional debugger commands. The MDB
architecture defines clear interface boundaries between each of the
layers shown in <a href="#chapter-fig-10">MDB architecture</a>. Macro files
execute commands written in the MDB or <code>adb</code> language. Dcmds and walkers
in debugger modules are written using the MDB Module API. The MDB Module
API is the basis of an application binary interface that allows the
debugger and its modules to evolve independently.</p>
</div>
<div class="paragraph">
<p>The MDB name space of walkers and dcmds also defines a second set of
layers between debugging code. These layers maximize code sharing and
limit the amount of code that must be modified as the target program
evolves. For example, one of the primary data structures in the illumos
kernel is the list of <code>proc_t</code> structures that represent active
processes in the system. The <code>::ps</code> dcmd must iterate over this list in
order to produce its output. However, the code to iterate over the list
is not in the <code>::ps</code> dcmd. The code to iterate over the list of
<code>proc_t</code> structures is encapsulated in the <code>genunix</code> module&#8217;s <code>proc</code>
walker.</p>
</div>
<div class="paragraph">
<p>MDB provides both <code>::ps</code> and <code>::ptree</code> dcmds, but neither of these dcmds
has any knowledge of how <code>proc_t</code> structures are accessed in the
kernel. Instead, these dcmds invoke the <code>proc</code> walker programmatically
and format the set of returned structures appropriately. If the data
structure used for <code>proc_t</code> structures ever changed, MDB could
provide a new <code>proc</code> walker, and none of the dependent dcmds would need
to change. The <code>proc</code> walker can also be accessed interactively using
the <code>::walk</code> dcmd in order to create novel commands as you work during a
debugging session.</p>
</div>
<div class="paragraph">
<p>In addition to facilitating layering and code sharing, the MDB Module
API provides dcmds and walkers with a single stable interface for
accessing various properties of the underlying target. The same API
functions are used to access information from user process or kernel
targets, simplifying the task of developing new debugging facilities.</p>
</div>
<div class="paragraph">
<p>In addition, you can use a custom MDB module to perform debugging tasks
in a variety of contexts. For example, you might want to develop an MDB
module for a user program you are developing. Once you have done so, you
can use this module when MDB examines a live process executing your
program, a core dump of your program, or even a kernel crash dump taken
on a system where your program was executing.</p>
</div>
<div class="paragraph">
<p>The Module API provides facilities for accessing the following target
properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Address Spaces</dt>
<dd>
<p>The module API provides facilities for reading and writing data from
the target&#8217;s virtual address space. Functions for reading and writing
using physical addresses are also provided for kernel debugging
modules.</p>
</dd>
<dt class="hdlist1">Symbol Tables</dt>
<dd>
<p>The module API provides access to the static and dynamic symbol tables
of the target&#8217;s primary executable file, its runtime link-editor, and
a set of load objects. Load objects are shared libraries in a user
process or loadable modules in the illumos kernel.</p>
</dd>
<dt class="hdlist1">External Data</dt>
<dd>
<p>The module API provides a facility for retrieving a collection of
named external data buffers associated with the target. For example,
MDB provides programmatic access to the <code>proc(5)</code> structures
associated with a user process or user core file target.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition, you can use built-in MDB dcmds to access information about
target memory mappings, load objects, register values, and control the
execution of user process targets.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mdb-language-syntax"><a class="anchor" href="#mdb-language-syntax"></a>4. MDB Language Syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the MDB language syntax, operators, and rules for
command and symbol name resolution.</p>
</div>
<div class="sect2">
<h3 id="syntax"><a class="anchor" href="#syntax"></a>4.1. Syntax</h3>
<div class="paragraph">
<p>MDB processes commands from standard input. If standard input is a
terminal, MDB provides terminal editing capabilities. MDB can also
process commands from macro files and from dcmd pipelines, as described
below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compute the value of an expression. This value
typically is a memory address in the target. The current address
location is referred to as <strong>dot</strong>. Use the dot or period character (<code>.</code>)
to reference the value of the current address.</p>
</li>
<li>
<p>Apply a dcmd to the computed address.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <strong>metacharacter</strong> is a newline, space, or tab character,
or one of the following characters:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[   ]   |   !   /   \   ?   =   &gt;   $   :   ;</pre>
</div>
</div>
<div class="paragraph">
<p>A <strong>blank</strong> is a <code>TAB</code> or a
<code>SPACE</code>. A <strong>word</strong> is a sequence of characters separated by one or more
non-quoted metacharacters. . An <strong>identifier</strong> is a sequence of letters,
digits, underbars, periods, or back quotes beginning with a letter,
underbar, or period. Identifiers are used as the names of symbols,
variables, dcmds, and walkers. Commands are delimited by a <code>NEWLINE</code> or
semicolon ( <code>;</code> ).</p>
</div>
<div class="paragraph">
<p>A dcmd is denoted by one of the following
words or metacharacters:</p>
</div>
<div class="paragraph">
<p><code>/ \ ? = &gt; $character :character ::identifier</code></p>
</div>
<div class="paragraph">
<p>Dcmds named by metacharacters or prefixed by a single dollar sign (<code>$</code>)
or colon character (<code>:</code>) are provided as built-in operators. These dcmds
implement complete compatibility with the command set of the legacy
<code>adb(1)</code> utility. After a dcmd has been parsed, the <code>/</code>, <code>\</code>, <code>?</code>,
<code>=</code>, <code>&gt;</code>, <code>$</code>, and <code>:</code> characters are no longer recognized as
metacharacters until the termination of the argument list.</p>
</div>
<div class="paragraph">
<p>A <strong>simple-command</strong> is a dcmd followed by a sequence of
zero or more blank-separated words. The words are passed as arguments to
the invoked dcmd, except as specified under <a href="#arithmetic-expansion">Arithmetic
Expansion</a> and <a href="#quoting">Quoting</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The dcmd succeeded.</p>
</li>
<li>
<p>The dcmd failed.</p>
</li>
<li>
<p>The dcmd was invoked with invalid arguments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <strong>pipeline</strong> is a sequence of one or more
simple-commands, each separated by the vertical bar or pipe character
(<code>|</code>). After the pipeline has been parsed, each dcmd is invoked in
order from left to right. Each dcmd&#8217;s output is processed and stored as
described in <a href="#dcmd-pipelines">Dcmd Pipelines</a>. After the first dcmd in
the pipeline is complete, its processed output is used as input for the
second dcmd in the pipeline. When the second dcmd is complete, its
output is used as input for the third dcmd in the pipeline, and so on.
If any dcmd does not return a successful exit status, the pipeline is
aborted.</p>
</div>
<div class="paragraph">
<p>An <strong>expression</strong> is a sequence of words that is evaluated
to compute a 64-bit unsigned integer value. The words are evaluated
using the rules described in <a href="#arithmetic-expansion">Arithmetic Expansion</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="commands"><a class="anchor" href="#commands"></a>4.2. Commands</h3>
<div class="paragraph">
<p>A <strong>command</strong> is one of the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;pipeline&gt; [ ! &lt;word&gt; &#8230;&#8203; ] [;]</dt>
<dd>
<p>  A simple-command or pipeline can be optionally followed by the
  exclamation point or bang character (<code>!</code>), indicating that the
  debugger should open a <code>pipe(2)</code>. The standard output of the last dcmd
  in the MDB pipeline is sent to an external process created by
  executing <code>$SHELL</code> <code>c</code> followed by the string formed by concatenating
  the words after the <code>!</code> character. For more details, refer to
  <a href="#shell-escapes">Shell Escapes</a>.
&lt;expression&gt; &lt;pipeline&gt; [ ! &lt;word&gt; &#8230;&#8203; ]</p>
</dd>
<dt class="hdlist1">[;]</dt>
<dd>
<p>  A simple-command or pipeline can be prefixed with an expression.
  Before execution of the pipeline, any occurrence of the dot or period
  character (<code>.</code>) in the pipeline is set to the value of the expression.
&lt;expression1&gt; , &lt;expression2&gt; &lt;pipeline&gt; [ !</p>
</dd>
<dt class="hdlist1">&lt;word&gt; &#8230;&#8203; ] [;]</dt>
<dd>
<p>  A simple-command or pipeline can be prefixed with two expressions. The
  value of the first expression is the new value of dot. The value of
  the second expression is a repeat count for the first dcmd in the
  pipeline. The first dcmd in the pipeline is executed
  &lt;expression2&gt; times before the next dcmd in the pipeline is
  executed. The repeat count applies only to the first dcmd in the
  pipeline.
, &lt;expression&gt; &lt;pipeline&gt; [ ! &lt;word&gt; &#8230;&#8203;</p>
</dd>
<dt class="hdlist1">] [;]</dt>
<dd>
<p>If the first expression is omitted, dot is not modified. The value of
the second expression (the expression after the comma character) is
used exactly the same way as &lt;expression2&gt; above.</p>
</dd>
<dt class="hdlist1">&lt;expression&gt; [ ! &lt;word&gt; &#8230;&#8203; ] [;]</dt>
<dd>
<p>  A command can consist of only an arithmetic expression. The value of
  the expression is the new value of dot. The previous dcmd pipeline is
  re-executed using the new value of dot.
&lt;expression1&gt; , &lt;expression2&gt; [ ! &lt;word&gt; &#8230;&#8203;</p>
</dd>
<dt class="hdlist1">] [;]</dt>
<dd>
<p>A command can consist of only a dot expression and repeat count
expression. The value of &lt;expression1&gt; is the new value of
dot. The previous dcmd pipeline is re-executed &lt;expression2&gt;
times using the new value of dot.</p>
</dd>
<dt class="hdlist1">, &lt;expression&gt; [ ! &lt;word&gt; &#8230;&#8203; ] [;]</dt>
<dd>
<p>If the first expression is omitted, dot is not modified. The value of
the second expression (the expression after the comma character) is
used exactly the same way as &lt;expression2&gt; above.</p>
</dd>
<dt class="hdlist1">! &lt;word&gt; &#8230;&#8203; [;]</dt>
<dd>
<p>If the command begins with the <code>!</code> character, no dcmds are executed.
The debugger executes <code>$SHELL</code> <code>c</code> followed by the string formed by
concatenating the words after the <code>!</code> character.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="comments"><a class="anchor" href="#comments"></a>4.3. Comments</h3>
<div class="paragraph">
<p>A word that begins with two forward slash characters
(<code>//</code>) causes that word and all the subsequent characters up to a
<code>NEWLINE</code> to be ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="arithmetic-expansion"><a class="anchor" href="#arithmetic-expansion"></a>4.4. Arithmetic Expansion</h3>
<div class="paragraph">
<p>arithmetic expansion</p>
</div>
<div class="paragraph">
<p>Arithmetic expansion is performed to determine the value of an
expression. MDB commands can be preceded by expressions that represent a
start address or a repeat count. Arithmetic expansion can also be
performed to compute a numeric argument for a dcmd. An expression can
appear in an argument list enclosed in square brackets preceded by a
dollar sign (<code>$[ expression ]</code>). In this case, the expression is
replaced by its arithmetic value.</p>
</div>
<div class="paragraph">
<p>Expressions can contain any of the following special
words:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;integer&gt;</dt>
<dd>
<p>The specified integer value. Integer values can be prefixed with <code>0i</code>
or <code>0I</code> to indicate binary values, <code>0o</code> or <code>0O</code> to indicate octal
values, <code>0t</code> or <code>0T</code> to indicate decimal values, and <code>0x</code> or <code>0X</code> to
indicate hexadecimal values (the default).</p>
</dd>
<dt class="hdlist1">0[tT][0-9]&#43;.[0-9]&#43;</dt>
<dd>
<p>The specified decimal floating point value, converted to its IEEE
double-precision floating point representation.</p>
</dd>
<dt class="hdlist1">'&lt;cccccccc&gt;'</dt>
<dd>
<p>The integer value computed by converting each character to a byte
equal to its ASCII value. Up to eight characters can be specified in a
character constant. Characters are packed into the integer in reverse
order (right-to-left), beginning at the least significant byte.</p>
</dd>
<dt class="hdlist1">&lt;&lt;identifier&gt;</dt>
<dd>
<p>The value of the variable named by &lt;identifier&gt;.</p>
</dd>
<dt class="hdlist1">&lt;identifier&gt;</dt>
<dd>
<p>The value of the symbol named by &lt;identifier&gt;.</p>
</dd>
<dt class="hdlist1">(&lt;expression&gt;)</dt>
<dd>
<p>The value of &lt;expression&gt;.</p>
</dd>
<dt class="hdlist1">.</dt>
<dd>
<p>The value of dot.</p>
</dd>
<dt class="hdlist1">&amp;</dt>
<dd>
<p>The most recent value of dot used to execute a dcmd.</p>
</dd>
<dt class="hdlist1">&#43;</dt>
<dd>
<p>The value of dot incremented by the current increment.</p>
</dd>
<dt class="hdlist1">^</dt>
<dd>
<p>The value of dot decremented by the current increment.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The increment is a global variable that stores the total bytes read by
the last formatting dcmd. For more information on the increment, refer
to the discussion of <a href="#formatting-dcmds">Formatting Dcmds</a>.</p>
</div>
<div class="sect3">
<h4 id="unary-operators"><a class="anchor" href="#unary-operators"></a>4.4.1. Unary Operators</h4>
<div class="paragraph">
<p>Unary operators are right associative and have higher
precedence than binary operators. The unary operators are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">#&lt;expression&gt;</dt>
<dd>
<p>Logical negation</p>
</dd>
<dt class="hdlist1">~&lt;expression&gt;</dt>
<dd>
<p>Bitwise complement</p>
</dd>
<dt class="hdlist1">-&lt;expression&gt;</dt>
<dd>
<p>Integer negation</p>
</dd>
<dt class="hdlist1">%&lt;expression&gt;</dt>
<dd>
<p>Value of a pointer-sized quantity at the object file location
corresponding to virtual address &lt;expression&gt; in the target&#8217;s
virtual address space</p>
</dd>
<dt class="hdlist1">%/[csil]/&lt;expression&gt;</dt>
<dd>
<p>Value of a char-sized, short-sized, int-sized, or long-sized quantity
at the object file location corresponding to virtual address
&lt;expression&gt; in the target&#8217;s virtual address space</p>
</dd>
<dt class="hdlist1">%/[1248]/&lt;expression&gt;</dt>
<dd>
<p>Value of a one-byte, two-byte, four-byte, or eight-byte quantity at
the object file location corresponding to virtual address
&lt;expression&gt; in the target&#8217;s virtual address space</p>
</dd>
<dt class="hdlist1">*&lt;expression&gt;</dt>
<dd>
<p>Value of a pointer-sized quantity at virtual address
&lt;expression&gt; in the target&#8217;s virtual address space</p>
</dd>
<dt class="hdlist1">*/[csil]/&lt;expression&gt;</dt>
<dd>
<p>Value of a char-sized, short-sized, int-sized, or long-sized quantity
at virtual address &lt;expression&gt; in the target&#8217;s virtual
address space</p>
</dd>
<dt class="hdlist1">*/[1248]/&lt;expression&gt;</dt>
<dd>
<p>Value of a one-byte, two-byte, four-byte, or eight-byte quantity at
virtual address &lt;expression&gt; in the target&#8217;s virtual address</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="binary-operators"><a class="anchor" href="#binary-operators"></a>4.4.2. Binary Operators</h4>
<div class="paragraph">
<p>Binary operators are left associative and have lower
precedence than unary operators. The binary operators, in order of
precedence from highest to lowest, are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>*</code></dt>
<dd>
<p>Integer multiplication</p>
</dd>
<dt class="hdlist1"><code>%</code></dt>
<dd>
<p>Integer division</p>
</dd>
<dt class="hdlist1"><code>#</code></dt>
<dd>
<p>Left-hand side rounded up to next multiple of right-hand side</p>
</dd>
<dt class="hdlist1"><code>&#43;</code></dt>
<dd>
<p>Integer addition</p>
</dd>
<dt class="hdlist1"><code>-</code></dt>
<dd>
<p>Integer subtraction</p>
</dd>
<dt class="hdlist1"><code>&lt;&lt;</code></dt>
<dd>
<p>Bitwise shift left</p>
</dd>
<dt class="hdlist1"><code>&gt;&gt;</code></dt>
<dd>
<p>Bitwise shift right</p>
</dd>
<dt class="hdlist1"><code>==</code></dt>
<dd>
<p>Logical equality</p>
</dd>
<dt class="hdlist1"><code>!=</code></dt>
<dd>
<p>Logical inequality</p>
</dd>
<dt class="hdlist1"><code>&amp;</code></dt>
<dd>
<p>Bitwise AND</p>
</dd>
<dt class="hdlist1">``^</dt>
<dd>
<p>Bitwise exclusive OR</p>
</dd>
<dt class="hdlist1"><code>|</code></dt>
<dd>
<p>Bitwise inclusive OR</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="quoting"><a class="anchor" href="#quoting"></a>4.5. Quoting</h3>
<div class="paragraph">
<p>quoting characters</p>
</div>
<div class="paragraph">
<p>Each metacharacter described in <a href="#syntax">Syntax</a> terminates a
word unless the metacharacter is quoted. Characters can be quoted by
enclosing them in a pair of single quotation marks (<code>'</code>) or double
quotation marks (<code>"</code>).. Quoting characters forces MDB to interpret each
character as itself without any special significance. A single quotation
mark cannot appear inside single quotation marks. Inside double
quotation marks, MDB recognizes the C programming language character
escape sequences.</p>
</div>
</div>
<div class="sect2">
<h3 id="shell-escapes"><a class="anchor" href="#shell-escapes"></a>4.6. Shell Escapes</h3>
<div class="paragraph">
<p>shell escapes</p>
</div>
<div class="paragraph">
<p>shell escapes</p>
</div>
<div class="paragraph">
<p>The <code>!</code> character can be used to create a pipeline between an MDB
command and the user&#8217;s shell. Shell escapes are available only when
using <code>mdb</code> and not when using <code>kmdb</code>. If the <code>$SHELL</code> environment
variable is set, MDB will <code>fork</code> and <code>exec</code> this <code>$SHELL</code> program for
shell escapes. If <code>$SHELL</code> is not set, <code>/bin/sh</code> is used. The shell is
invoked with the <code>c</code> option followed by a string formed by concatenating
the words after the <code>!</code> character.</p>
</div>
<div class="paragraph">
<p>The <code>!</code> character takes precedence over all other metacharacters, except
semicolon (<code>;</code>) and <code>NEWLINE</code>. After a shell escape is detected, the
remaining characters up to the next semicolon or <code>NEWLINE</code> are passed
“as is” to the shell. The output of shell commands cannot be piped to
MDB dcmds. The output of commands executed by a shell escape is sent
directly to the terminal, not to MDB.</p>
</div>
</div>
<div class="sect2">
<h3 id="variables"><a class="anchor" href="#variables"></a>4.7. Variables</h3>
<div class="paragraph">
<p>A <strong>variable</strong> is a variable name, a corresponding integer value, and a
set of attributes. A variable name is a sequence of letters, digits,
underbars, or periods. Use the <code>&gt;</code> dcmd or <code>::typeset</code> dcmd to
assign a value to a variable.. Use the <code>::typeset</code> dcmd to manipulate
the attributes of a variable. Each variable&#8217;s value is represented as a
64-bit unsigned integer. A variable can have one or more of the
following attributes: read-only (cannot be modified by the user),
persistent (cannot be unset by the user), and tagged (user-defined
indicator).</p>
</div>
<div class="paragraph">
<p>The following variables are defined as persistent:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">0</dt>
<dd>
<p>Most recent value printed using the <code>/</code>, <code>\</code>, <code>?</code>, or <code>=</code> dcmd.</p>
</dd>
<dt class="hdlist1">9</dt>
<dd>
<p>Most recent count used with the <code>$&lt;</code> dcmd.</p>
</dd>
<dt class="hdlist1">b</dt>
<dd>
<p>Virtual address of the base of the data section.</p>
</dd>
<dt class="hdlist1">cpuid</dt>
<dd>
<p>The CPU identifier corresponding to the CPU on which <code>kmdb</code> is
currently executing.</p>
</dd>
<dt class="hdlist1">d</dt>
<dd>
<p>Size of the data section in bytes.</p>
</dd>
<dt class="hdlist1">e</dt>
<dd>
<p>Virtual address of the entry point.</p>
</dd>
<dt class="hdlist1">hits</dt>
<dd>
<p>The count of the number of times the matched software event specifier
has been matched. See <a href="#event-callbacks">Event Callbacks</a>.</p>
</dd>
<dt class="hdlist1">m</dt>
<dd>
<p>Initial bytes (magic number) of the target&#8217;s primary object file, or
zero if no object file has been read yet.</p>
</dd>
<dt class="hdlist1">t</dt>
<dd>
<p>Size of the text section in bytes.</p>
</dd>
<dt class="hdlist1">thread</dt>
<dd>
<p>The thread identifier of the current representative thread. The value
of the identifier depends on the threading model used by the current
target. See <a href="#thread-support">Thread Support</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition, the MDB kernel and process targets export the current
values of the representative thread&#8217;s register set as named variables.
The names of these variables depend on the target&#8217;s platform and
instruction set architecture.</p>
</div>
</div>
<div class="sect2">
<h3 id="symbol-name-resolution"><a class="anchor" href="#symbol-name-resolution"></a>4.8. Symbol Name Resolution</h3>
<div class="paragraph">
<p>name resolution</p>
</div>
<div class="paragraph">
<p>As explained in <a href="#syntax">Syntax</a>, a symbol identifier present in
an expression context evaluates to the value of this symbol. The value
typically denotes the virtual address of the storage associated with the
symbol in the target&#8217;s virtual address space. A target can support
multiple symbol tables including, but not limited to, the following
symbol tables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Primary executable symbol table</p>
</li>
<li>
<p>Primary dynamic symbol table</p>
</li>
<li>
<p>Runtime link-editor symbol table</p>
</li>
<li>
<p>Standard and dynamic symbol tables for each of a number of load
objects (such as shared libraries in a user process, or kernel modules
in the illumos kernel)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The target typically searches the symbol tables of the primary
executable first, then one or more of the other symbol tables. Note that
ELF symbol tables contain only entries for external, global, and static
symbols. Automatic symbols do not appear in the symbol tables processed
by MDB.</p>
</div>
<div class="paragraph">
<p>Additionally, MDB provides a private user-defined symbol table that is
searched prior to any of the target symbol tables. The private symbol
table is initially empty. Use the <code>::nmadd</code> and <code>::nmdel</code> dcmds to
manipulate the private symbol table.</p>
</div>
<div class="paragraph">
<p>Use the <code>::nm</code> <code>P</code> dcmd to display the contents of the private symbol
table. The private symbol table enables you to create symbol definitions
for program functions or data that were either missing from the original
program or stripped out. These definitions are then used whenever MDB
converts a symbolic name to an address, or converts an address to the
nearest symbol.</p>
</div>
<div class="paragraph">
<p>Because targets contain multiple symbol tables, and each symbol table
can include symbols from multiple object files, different symbols with
the same name can exist. MDB uses the backquote character (``) as a
symbol-name scoping operator to enable you to obtain the value of the
desired symbol in this situation.</p>
</div>
<div class="paragraph">
<p>You can specify the scope used to resolve a symbol name as either:
<em>object</em><code><em>name</em>, or
&lt;file&gt;</code><em>name</em>, or
<em>object</em><code>&lt;file&gt;</code><em>name</em>. The object
identifier refers to the name of a load object. The file identifier
refers to the basename of a source file that has a symbol of type
<code>STT_FILE</code> in the symbol table of the specified object. The object
identifier&#8217;s interpretation depends on the target type.</p>
</div>
<div class="paragraph">
<p>The MDB kernel target expects <em>object</em> to specify the basename
of a loaded kernel module. For example, the symbol name
<code>specfs`_init</code> evaluates to the value of the <code>_init</code> symbol in
the <code>specfs</code> kernel module.</p>
</div>
<div class="paragraph">
<p>The <code>mdb</code> process target expects <em>object</em> to specify the name of
the executable or of a loaded shared library. The value of
<em>object</em> can take any of the following forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exact match (that is, a full path name): <code>/usr/lib/libc.so.1</code></p>
</li>
<li>
<p>Exact basename match: <code>libc.so.1</code></p>
</li>
<li>
<p>Initial basename match up to a period or dot character (<code>.</code>) suffix:
<code>libc.so</code> or <code>libc</code></p>
</li>
<li>
<p>Literal string <code>a.out</code>, which is accepted as an alias for the</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The process target will also accept any of these four forms preceded by
an optional link-map ID (<code>lmid</code>). The <code>lmid</code> prefix is specified by an
initial <code>LM</code> followed by the link-map id in hexadecimal followed by an
additional backquote character (<code>`). For example, the symbol name
`LM0`libc.so.1`_init</code> evaluates to the value of the <code>_init</code>
symbol in the <code>libc.so.1</code> library that is loaded on link-map 0
(<code>LM_ID_BASE</code>). The link-map specifier might be necessary to
resolve symbol naming conflicts if the same library is loaded on more
than one link map. For more information on link maps, refer to the
Linker and Libraries Guide and the <code>dlopen(3C)</code> manual page. Link-map
identifiers are displayed when symbols are printed according to the
setting of the <code>showlmid</code> option, as described in
<a href="#summary-of-command-line-options">Summary of Command-line Options</a>.</p>
</div>
<div class="paragraph">
<p>In the case of a naming conflict between symbols and hexadecimal integer
values, MDB attempts to evaluate an ambiguous token as a symbol first,
before evaluating it as an integer value. For example, the token <code>f</code> can
refer either to the decimal integer value <code>15</code> specified in hexadecimal
(the default base), or to a global variable named <code>f</code> in the target&#8217;s
symbol table. If a symbol can have an ambiguous name, use an explicit
<code>0x</code> or <code>0X</code> prefix to specify the integer value.</p>
</div>
</div>
<div class="sect2">
<h3 id="dcmd-and-walker-name-resolution"><a class="anchor" href="#dcmd-and-walker-name-resolution"></a>4.9. Dcmd and Walker Name Resolution</h3>
<div class="paragraph">
<p>name resolution</p>
</div>
<div class="paragraph">
<p>name resolution</p>
</div>
<div class="paragraph">
<p>As described earlier, each MDB dmod provides a set of dcmds and walkers.
Dcmds and walkers are tracked in two distinct, global namespaces. MDB
also keeps track of a dcmd and walker namespace associated with each
dmod. Identically named dcmds or walkers within a given dmod are not
allowed. A dmod with this type of naming conflict will fail to load.</p>
</div>
<div class="paragraph">
<p>Name conflicts between dcmds or walkers from different dmods are allowed
in the global namespace. In the case of a conflict, the first dcmd or
walker with that particular name to be loaded is given precedence in the
global namespace. Alternate definitions are kept in a list in load
order.</p>
</div>
<div class="paragraph">
<p>Use the backquote character (<code>`) in a dcmd or
walker name as a scoping operator to select an alternate definition. For
example, if dmods `m1</code> and <code>m2</code> each provide a dcmd <code>d</code>, and <code>m1</code> is
loaded prior to <code>m2</code>, then you can use the scoping operator as shown
below to specify the dcmd you want:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::d</code></dt>
<dd>
<p>Executes <code>m1&#8217;s definition of `d</code></p>
</dd>
<dt class="hdlist1"><code>::m1`d</code></dt>
<dd>
<p>Executes <code>m1&#8217;s definition of `d</code></p>
</dd>
<dt class="hdlist1"><code>::m2`d</code></dt>
<dd>
<p>Executes <code>m2'`s definition of `d</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If module <code>m1</code> is unloaded, the next dcmd
on the global definition list (<code>m2`d</code>) is promoted to global
visibility. Use the <code>::which</code> dcmd to determine the current definition
of a dcmd or walker. Use the <code>::which</code> <code>v</code> dcmd to display the global
definition list.</p>
</div>
</div>
<div class="sect2">
<h3 id="dcmd-pipelines"><a class="anchor" href="#dcmd-pipelines"></a>4.10. Dcmd Pipelines</h3>
<div class="paragraph">
<p>Use the vertical bar (<code>|</code>) operator to pipeline dcmds. The purpose
of a pipeline is to pass values from one dcmd or walker to another. The
values passed usually are virtual addresses. Pipeline stages might be
used to map a pointer from one type of data structure to a pointer to a
corresponding data structure, to sort a list of addresses, or to select
the addresses of structures with certain properties.</p>
</div>
<div class="paragraph">
<p>MDB executes each dcmd in the pipeline in order from left to right. The
left-most dcmd is executed using the current value of dot, or using the
value specified by an explicit expression at the start of the command. A
pipe operator (<code>|</code>) causes MDB to create a shared buffer between the
output of the dcmd to its left and the MDB parser, and an empty list of
values.</p>
</div>
<div class="paragraph">
<p>As the dcmd executes, its standard output is placed in the pipe and then
consumed and evaluated by the parser, as if MDB were reading this data
from standard input. Each line must consist of an arithmetic expression
terminated by a <code>NEWLINE</code> or semicolon (<code>;</code>). The value of the
expression is appended to the list of values associated with the pipe.
If a syntax error is detected, the pipeline is aborted.</p>
</div>
<div class="paragraph">
<p>When the dcmd to the left of a <code>|</code> operator completes, the list of
values associated with the pipe is then used to invoke the dcmd to the
right of the <code>|</code> operator. For each value in the list, dot is set to
this value, and the right-hand dcmd is executed. Only the output of the
right-most dcmd in the pipeline is written to standard output. If any
dcmd in the pipeline produces output to standard error, these messages
are written directly to standard error and are not processed as part of
the pipeline.</p>
</div>
</div>
<div class="sect2">
<h3 id="formatting-dcmds"><a class="anchor" href="#formatting-dcmds"></a>4.11. Formatting Dcmds</h3>
<div class="paragraph">
<p>The <code>/</code>, <code>\</code>, <code>?</code>, and <code>=</code> metacharacters are used to denote the
special output formatting dcmds. Each of these dcmds accepts an argument
list consisting of one or more format characters, repeat counts, or
quoted strings. A format character is one of the ASCII characters
described below.</p>
</div>
<div class="paragraph">
<p>Format characters are used to read and format data from the target. A
repeat count is a positive integer preceding the format character that
is always interpreted in base 10 (decimal). A repeat count can also be
specified as an expression enclosed in square brackets preceded by a
dollar sign (<code>$[ ]</code>). A string argument must be enclosed in
double quotation marks (<code>" "</code>). No blanks are necessary between format
arguments.</p>
</div>
<div class="paragraph">
<p>The formatting dcmds are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/</code></dt>
<dd>
<p>Display data from the target&#8217;s virtual address space starting at the
virtual address specified by dot.</p>
</dd>
<dt class="hdlist1"><code>\</code></dt>
<dd>
<p>Display data from the target&#8217;s physical address space starting at the
physical address specified by dot.</p>
</dd>
<dt class="hdlist1"><code>?</code></dt>
<dd>
<p>Display data from the target&#8217;s primary object file starting at the
object file location corresponding to the virtual address specified by
dot.</p>
</dd>
<dt class="hdlist1"><code>=</code></dt>
<dd>
<p>Display the value of dot in each of the specified data formats. The
<code>=</code> dcmd is useful for converting between bases and performing
arithmetic.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition to dot, MDB keeps track of another global
value called the <strong>increment</strong>. The increment represents the distance
between dot and the address following all the data read by the last
formatting dcmd.</p>
</div>
<div class="paragraph">
<p>For example, let dot equal address &lt;addr&gt;, where &lt;addr&gt;
displays as a 4-byte integer. After a formatting dcmd is executed with
dot equal to &lt;addr&gt;, the increment is set to <code>4</code>. The plus
(<code>&#43;</code>) operator, described in <a href="#arithmetic-expansion">Arithmetic Expansion</a>,
would now evaluate to the value <code>A&#43;4</code>, and could be used to reset
dot to the address of the next data object for a subsequent dcmd.</p>
</div>
<div class="paragraph">
<p>Most format characters
increase the value of the increment by the number of bytes corresponding
to the size of the data format. The number of bytes in various data
formats are shown below. Use the <code>::formats</code> dcmd to display the list of
format characters from within MDB.</p>
</div>
<div class="paragraph">
<p>The format characters are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&#43;</dt>
<dd>
<p>Increment dot by the count (variable size)</p>
</dd>
<dt class="hdlist1">-</dt>
<dd>
<p>Decrement dot by the count (variable size)</p>
</dd>
<dt class="hdlist1">B</dt>
<dd>
<p>Hexadecimal int (1 byte)</p>
</dd>
<dt class="hdlist1">C</dt>
<dd>
<p>Character using C character notation (1 byte)</p>
</dd>
<dt class="hdlist1">D</dt>
<dd>
<p>Decimal signed int (4 bytes)</p>
</dd>
<dt class="hdlist1">E</dt>
<dd>
<p>Decimal unsigned long long (8 bytes)</p>
</dd>
<dt class="hdlist1">F</dt>
<dd>
<p>Double (8 bytes)</p>
</dd>
<dt class="hdlist1">G</dt>
<dd>
<p>Octal unsigned long long (8 bytes)</p>
</dd>
<dt class="hdlist1">H</dt>
<dd>
<p>Swap bytes and shorts (4 bytes)</p>
</dd>
<dt class="hdlist1">I</dt>
<dd>
<p>Address and disassembled instruction (variable size)</p>
</dd>
<dt class="hdlist1">J</dt>
<dd>
<p>Hexadecimal long long (8 bytes)</p>
</dd>
<dt class="hdlist1">K</dt>
<dd>
<p>Hexadecimal uintptr_t (4 or 8 bytes)</p>
</dd>
<dt class="hdlist1">N</dt>
<dt class="hdlist1">O</dt>
<dd>
<p>Octal unsigned int (4 bytes)</p>
</dd>
<dt class="hdlist1">P</dt>
<dd>
<p>Symbol (4 or 8 bytes)</p>
</dd>
<dt class="hdlist1">Q</dt>
<dd>
<p>Octal signed int (4 bytes)</p>
</dd>
<dt class="hdlist1">R</dt>
<dd>
<p>Binary int (8 bytes)</p>
</dd>
<dt class="hdlist1">S</dt>
<dd>
<p>String using C string notation (variable size)</p>
</dd>
<dt class="hdlist1">T</dt>
<dd>
<p>Horizontal tab</p>
</dd>
<dt class="hdlist1">U</dt>
<dd>
<p>Decimal unsigned int (4 bytes)</p>
</dd>
<dt class="hdlist1">V</dt>
<dd>
<p>Decimal unsigned int (1 byte)</p>
</dd>
<dt class="hdlist1">W</dt>
<dd>
<p>Default radix unsigned int (4 bytes)</p>
</dd>
<dt class="hdlist1">X</dt>
<dd>
<p>Hexadecimal int (4 bytes)</p>
</dd>
<dt class="hdlist1">Y</dt>
<dd>
<p>Decoded time32_t (4 bytes)</p>
</dd>
<dt class="hdlist1">Z</dt>
<dd>
<p>Hexadecimal long long (8 bytes)</p>
</dd>
<dt class="hdlist1">^</dt>
<dd>
<p>Decrement dot by increment * count (variable size)</p>
</dd>
<dt class="hdlist1">a</dt>
<dd>
<p>Dot as symbol&#43;offset</p>
</dd>
<dt class="hdlist1">b</dt>
<dd>
<p>Octal unsigned int (1 byte)</p>
</dd>
<dt class="hdlist1">c</dt>
<dd>
<p>Character (1 byte)</p>
</dd>
<dt class="hdlist1">d</dt>
<dd>
<p>Decimal signed short (2 bytes)</p>
</dd>
<dt class="hdlist1">e</dt>
<dd>
<p>Decimal signed long long (8 bytes)</p>
</dd>
<dt class="hdlist1">f</dt>
<dd>
<p>Float (4 bytes)</p>
</dd>
<dt class="hdlist1">g</dt>
<dd>
<p>Octal signed long long (8 bytes)</p>
</dd>
<dt class="hdlist1">h</dt>
<dd>
<p>Swap bytes (2 bytes)</p>
</dd>
<dt class="hdlist1">i</dt>
<dd>
<p>Disassembled instruction (variable size)</p>
</dd>
<dt class="hdlist1">n</dt>
<dt class="hdlist1">o</dt>
<dd>
<p>Octal unsigned short (2 bytes)</p>
</dd>
<dt class="hdlist1">p</dt>
<dd>
<p>Symbol (4 or 8 bytes)</p>
</dd>
<dt class="hdlist1">q</dt>
<dd>
<p>Octal signed short (2 bytes)</p>
</dd>
<dt class="hdlist1">r</dt>
<dt class="hdlist1">s</dt>
<dd>
<p>Raw string (variable size)</p>
</dd>
<dt class="hdlist1">t</dt>
<dd>
<p>Horizontal tab</p>
</dd>
<dt class="hdlist1">u</dt>
<dd>
<p>Decimal unsigned short (2 bytes)</p>
</dd>
<dt class="hdlist1">v</dt>
<dd>
<p>Decimal signed int (1 byte)</p>
</dd>
<dt class="hdlist1">w</dt>
<dd>
<p>Default radix unsigned short (2 bytes)</p>
</dd>
<dt class="hdlist1">x</dt>
<dd>
<p>Hexadecimal short (2 bytes)</p>
</dd>
<dt class="hdlist1">y</dt>
<dd>
<p>Decoded time64_t (8 bytes)</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can also use the <code>/</code>, <code>\</code>, and <code>?</code> formatting
dcmds to write to the target&#8217;s virtual address space, physical address
space, or object file. First specify one of the following modifiers as
the first format character, and then specify a list of words. The words
in the list are either immediate values or expressions enclosed in
square brackets preceded by a dollar sign (<code>$[ ]</code>).</p>
</div>
<div class="paragraph">
<p>The write modifiers are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">v</dt>
<dd>
<p>Write the lowest byte of the value of each expression to the target
beginning at the location specified by dot</p>
</dd>
<dt class="hdlist1">w</dt>
<dd>
<p>Write the lowest 2 bytes of the value of each expression to the target
beginning at the location specified by dot</p>
</dd>
<dt class="hdlist1">W</dt>
<dd>
<p>Write the lowest 4 bytes of the value of each expression to the target
beginning at the location specified by dot</p>
</dd>
<dt class="hdlist1">Z</dt>
<dd>
<p>Write the complete 8 bytes of the value of each expression to the
target beginning at the location specified by dot</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can also use the <code>/</code>, <code>\</code>, and <code>?</code> formatting
dcmds to search for a particular integer value in the target&#8217;s virtual
address space, physical address space, and object file, respectively.
First specify one of the following modifiers as the first format
character, and then specify a value and optional mask. The value and
mask are each either immediate values or expressions enclosed in square
brackets preceded by a dollar sign.</p>
</div>
<div class="paragraph">
<p>If only a value is specified, MDB reads integers of the appropriate size
and stops at the address that contains the matching value. If a value
<code>V</code> and mask <code>M</code> are specified, MDB reads integers of the appropriate
size and stops at the address that contains a value <code>X</code> where
<code>(X &amp; M) == V</code>. At the completion of the dcmd, dot is updated to the
address of the match. If no match is found, dot is left at the last
address that was read.</p>
</div>
<div class="paragraph">
<p>The search modifiers are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">l</dt>
<dd>
<p>Search for the specified 2-byte value</p>
</dd>
<dt class="hdlist1">L</dt>
<dd>
<p>Search for the specified 4-byte value</p>
</dd>
<dt class="hdlist1">M</dt>
<dd>
<p>Search for the specified 8-byte value</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For both user and kernel targets, an address space is typically composed
of a set of discontiguous segments. It is not legal to read from an
address that does not have a corresponding segment. If a search reaches
a segment boundary without finding a match, the search aborts when the
read past the end of the segment boundary fails.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-mdb-commands-interactively"><a class="anchor" href="#using-mdb-commands-interactively"></a>5. Using MDB Commands Interactively</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the MDB interactive command line editing and
history functions, the output pager, and debugger signal handling.</p>
</div>
<div class="sect2">
<h3 id="command-reentry"><a class="anchor" href="#command-reentry"></a>5.1. Command Reentry</h3>
<div class="paragraph">
<p>The text of the last <code>HISTSIZE</code> (default 128) commands
entered from a terminal device is saved in memory. The inline editing
facility provides key mappings for searching and fetching elements from
the history list.</p>
</div>
</div>
<div class="sect2">
<h3 id="inline-editing"><a class="anchor" href="#inline-editing"></a>5.2. Inline Editing</h3>
<div class="paragraph">
<p>If standard input is a terminal device,
MDB provides some simple emacs-style facilities for editing the command
line. The <code>search</code>, <code>previous</code>, and <code>next</code> commands in edit mode provide
access to the history list. Only strings, not patterns, are matched when
searching. In the list below, the notation for control characters is the
caret character (<code>^</code>) followed by a character shown in uppercase. The
notation for escape sequences is M- followed by a character. For
example, M-f (pronounced <em>meta- eff</em>) is entered by pressing the ESC
keyboard key followed by the f key, or by pressing the Meta key followed
by the f key on keyboards that support a Meta key. A command line is
committed and executed using <code>RETURN</code> or <code>NEWLINE</code>. The edit commands
are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">^F</dt>
<dd>
<p>Move cursor forward (right) one character.</p>
</dd>
<dt class="hdlist1">M-f</dt>
<dd>
<p>Move cursor forward one word.</p>
</dd>
<dt class="hdlist1">^B</dt>
<dd>
<p>Move cursor backward (left) one character.</p>
</dd>
<dt class="hdlist1">M-b</dt>
<dd>
<p>Move cursor backward one word.</p>
</dd>
<dt class="hdlist1">^A</dt>
<dd>
<p>Move cursor to start of line.</p>
</dd>
<dt class="hdlist1">^E</dt>
<dd>
<p>Move cursor to end of line.</p>
</dd>
<dt class="hdlist1">^D</dt>
<dd>
<p>Delete current character, if the current line is not empty. If the
current line is empty, ^D denotes EOF and the debugger will exit.</p>
</dd>
<dt class="hdlist1">M-^H</dt>
<dd>
<p>(Meta-backspace) Delete previous word.</p>
</dd>
<dt class="hdlist1">^K</dt>
<dd>
<p>Delete from the cursor to the end of the line.</p>
</dd>
<dt class="hdlist1">^L</dt>
<dd>
<p>Reprint the current line.</p>
</dd>
<dt class="hdlist1">^T</dt>
<dd>
<p>Transpose the current character with the next character.</p>
</dd>
<dt class="hdlist1">^N</dt>
<dd>
<p>Fetch the next command from the history. Each time ^N is entered, the
next command forward in time is retrieved.</p>
</dd>
<dt class="hdlist1">^P</dt>
<dd>
<p>Fetch the previous command from the history. Each time ^P is entered,
the next command backward in time is retrieved.</p>
</dd>
<dt class="hdlist1">^R[&lt;string&gt;]</dt>
<dd>
<p>Search backward in the history for a previous command line containing
<em>string</em>. The string should be terminated by a <code>RETURN</code> or
<code>NEWLINE</code>. If <em>string</em> is omitted, the previous history
element containing the most recent string is retrieved.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The editing mode also interprets the following user-defined sequences as
editing commands. User-defined sequences can be read or modified using
the <code>stty(1)</code> command.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">erase</dt>
<dd>
<p>User-defined erase character (usually ^H or ^?). Delete previous
character.</p>
</dd>
<dt class="hdlist1">intr</dt>
<dd>
<p>User-defined interrupt character (usually ^C). Abort the current
command and print a new prompt.</p>
</dd>
<dt class="hdlist1">kill</dt>
<dd>
<p>User-defined kill character (usually ^U). Kill the entire current
command line.</p>
</dd>
<dt class="hdlist1">quit</dt>
<dd>
<p>User-defined quit character (usually ^\). Quit the debugger.</p>
</dd>
<dt class="hdlist1">suspend</dt>
<dd>
<p>User-defined suspend character (usually ^Z). Suspend the debugger.</p>
</dd>
<dt class="hdlist1">werase</dt>
<dd>
<p>User-defined word erase character (usually ^W). Erase the preceding
word.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>On keyboards that support an extended keypad with arrow
keys, <code>mdb</code> interprets these keystrokes as editing commands:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Up arrow</dt>
<dd>
<p>Fetch the previous command from the history (same as ^P)</p>
</dd>
<dt class="hdlist1">Down arrow</dt>
<dd>
<p>Fetch the next command from the history (same as ^N)</p>
</dd>
<dt class="hdlist1">Left arrow</dt>
<dd>
<p>Move cursor backward one character (same as ^B)</p>
</dd>
<dt class="hdlist1">Right arrow</dt>
<dd>
<p>Move cursor forward one character (same as ^F)</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="keyboard-shortcuts"><a class="anchor" href="#keyboard-shortcuts"></a>5.3. Keyboard Shortcuts</h3>
<div class="paragraph">
<p>keyboard shortcuts</p>
</div>
<div class="paragraph">
<p>step over</p>
</div>
<div class="paragraph">
<p>MDB provides a set of keyboard shortcuts that bind individual keystrokes
to common MDB commands when the keystroke listed in the table below is
typed as the first character following the MDB prompt. The keyboard
shortcuts are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>[</code></dt>
<dd>
<p>Execute the command <code>::step over</code></p>
</dd>
<dt class="hdlist1"><code>]</code></dt>
<dd>
<p>Execute the command <code>::step</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="output-pager"><a class="anchor" href="#output-pager"></a>5.4. Output Pager</h3>
<div class="paragraph">
<p>MDB provides a built-in output pager. The output pager
is enabled if the debugger&#8217;s standard output is a terminal device. Each
time a command is executed, <code>mdb</code> pauses after each screenful of output
is written and displays a pager prompt:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt;&gt; More [&lt;space&gt;, &lt;cr&gt;, q, n, c, a] ?</pre>
</div>
</div>
<div class="paragraph">
<p>The following key sequences are recognized by the pager:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>SPACE</code></dt>
<dd>
<p>Display the next screenful of output</p>
</dd>
<dt class="hdlist1">a, A</dt>
<dd>
<p>Abort the current top-level command and return to the prompt</p>
</dd>
<dt class="hdlist1">c, C</dt>
<dd>
<p>Continue displaying output without pausing at each screenful, until
the current top-level command is complete</p>
</dd>
<dt class="hdlist1">n, N, <code>NEWLINE</code>, <code>RETURN</code></dt>
<dd>
<p>Display the next line of output</p>
</dd>
<dt class="hdlist1">q, Q, ^C, ^\</dt>
<dd>
<p>Quit (abort) the current dcmd only</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="signal-handling"><a class="anchor" href="#signal-handling"></a>5.5. Signal Handling</h3>
<div class="paragraph">
<p>MDB ignores the PIPE and QUIT signals. The INT signal
aborts the command that is currently executing. The debugger intercepts
and provides special handling for the ILL, TRAP, EMT, FPE, BUS, and SEGV
signals. If any of these signals is generated asynchronously (delivered
from another process using the <code>kill(2)</code> call), mdb restores the signal
to its default disposition and dumps core. However, if any of these
signals is generated synchronously by the debugger process itself and a
dcmd from an externally loaded <code>dmod</code> is currently executing, and
standard input is a terminal, <code>mdb</code> will provide a menu of choices
allowing the user to force a core dump, quit without producing a core
dump, stop for attach by a debugger, or attempt to resume. The resume
option will abort all active commands and unload the <code>dmod</code> whose dcmd
was active at the time the fault occurred. It can then be subsequently
re-loaded by the user. The resume option provides limited protection
against buggy dcmds. Refer to <a href="#warnings">Warnings</a>, Use of the Error
Recovery Mechanism, for information about the risks associated with the
resume option.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="built-in-commands"><a class="anchor" href="#built-in-commands"></a>6. Built-In Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MDB provides a set of built-in dcmds that are always defined. Some of
these dcmds are applicable only to certain targets: if a dcmd is not
applicable to the current target, it fails and prints a message
indicating “command is not supported by current target”.</p>
</div>
<div class="paragraph">
<p>In many cases, MDB provides a mnemonic equivalent (<code>::identifier</code>) for
the legacy <code>adb(1)</code> dcmd names. For example, <code>::quit</code> is provided as the
equivalent of <code>$q</code>. Programmers who are experienced with <code>adb(1)</code> or who
appreciate brevity or arcana might prefer the <code>$</code> or <code>:</code> forms of the
built-ins. Programmers who are new to MDB might prefer the more verbose
<code>::</code> form. The built-ins are shown in alphabetical order. If a <code>$</code> or
<code>:</code> form has a <code>::identifier</code> equivalent, it is shown under the
<code>::identifier</code> form.</p>
</div>
<div class="sect2">
<h3 id="built-in-dcmds"><a class="anchor" href="#built-in-dcmds"></a>6.1. Built-In dcmds</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&gt;</code> <em>variable-name</em></dt>
<dt class="hdlist1"><code>&gt;</code> <code>/<em>modifier</em>/</code> <em>variable-name</em></dt>
<dd>
<p>Assign the value of dot to the specified named variable. Some variables are read-only and cannot be modified. If the <code>&gt;</code> is followed by a modifier character surrounded by <code>//</code>, then the value is modified as part of the assignment. The modifier characters are:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>c</code></dt>
<dd>
<p>Unsigned char quantity (1-byte)</p>
</dd>
<dt class="hdlist1"><code>s</code></dt>
<dd>
<p>Unsigned short quantity (2-byte)</p>
</dd>
<dt class="hdlist1"><code>i</code></dt>
<dd>
<p>Unsigned int quantity (4-byte)</p>
</dd>
<dt class="hdlist1"><code>l</code></dt>
<dd>
<p>Unsigned long quantity (4-byte in 32-bit, 8-byte in 64-bit)</p>
<div class="paragraph">
<p>Notice that these operators do not perform a cast; they instead fetch the specified number of low-order bytes (on little-endian architectures) or high-order bytes (big-endian architectures). These modifiers are provided for backward compatibility; the MDB <code>*/<em>modifier</em>/</code> and <code>%/<em>modifier</em>/</code> syntax should be used instead.</p>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>$&lt;</code> <em>macro-name</em></dt>
<dd>
<p> Read and execute commands from the specified macro
file. The file name can be given as an absolute or relative path. If
the file name is a simple name (that is, if it does not contain a
“<code>/</code>”), MDB searches for it in the macro file include path. If another
macro file is currently being processed, this file is closed and
replaced with the new file.</p>
</dd>
<dt class="hdlist1"><code>$&lt;&lt;</code> <em>macro-name</em></dt>
<dd>
<p>   Read and execute commands from the specified macro file
(as with <code>$&lt;</code>), but do not close the current open macro file.</p>
</dd>
<dt class="hdlist1"><code>$?</code></dt>
<dd>
<p> Print the process-ID and current signal of the target
if it is a user process or core file, and then print the general
register set of the representative thread.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>$C</code> [<em>count</em>]</dt>
<dd>
<p>   Print a C stack backtrace, including stack frame
  pointer information. If the dcmd is preceded by an explicit
<em>address</em>, a backtrace beginning at this virtual memory
  address is displayed. Otherwise, the stack of the representative
  thread is displayed. If an optional count value is given as an
  argument, no more than <em>count</em> arguments are displayed for
  each stack frame in the output.
 <br>
  The biased frame pointer value (that is, the virtual address minus
  <code>0x7ff</code>) should be used as the address when requesting a stack trace.</p>
</dd>
<dt class="hdlist1">[<em>base</em>] <code>$d</code></dt>
<dd>
<p> Get or set the default output radix. If the dcmd is
preceded by an explicit expression, the default output radix is set to
the given <em>base</em>; otherwise, the current radix is printed in
base 10 (decimal). The default radix is base 16 (hexadecimal).</p>
</dd>
<dt class="hdlist1"><code>$e</code></dt>
<dd>
<p> Print a list of all known external (global) symbols of
type object or function, the value of the symbol, and the first 4
(32-bit <code>mdb</code>) or 8 (64-bit <code>mdb</code>) bytes stored at this location in
the target&#8217;s virtual address space. The <code>::nm</code> dcmd provides more
flexible options for displaying symbol tables.</p>
</dd>
<dt class="hdlist1"><code>$P</code> <em>prompt-string</em></dt>
<dd>
<p> Set the prompt to the specified
<em>prompt-string</em>. The default prompt is ' <code>&gt;</code> '. The prompt
can also be set using <code>::set</code> <code>P</code> or the <code>P</code> command-line option.</p>
</dd>
<dt class="hdlist1"><code>$M</code></dt>
<dd>
<p>In <code>kmdb</code> only, list the macro files that are cached by <code>kmdb</code> for use
with the <code>$&lt;</code> dcmd.</p>
</dd>
<dt class="hdlist1"><em>distance</em> <code>$s</code></dt>
<dd>
<p> Get or set the symbol matching <em>distance</em> for
address-to-symbol-name conversions. The symbol matching distance modes
are discussed along with the <code>s</code> command-line option in
<a href="#options">appendix_title</a>. The symbol matching distance can
also be modified using the <code>::set</code> <code>s</code> option. If no distance is
specified, the current setting is displayed.</p>
</dd>
<dt class="hdlist1"><code>$v</code></dt>
<dd>
<p> Print a list of the named variables that have non-zero
values. The <code>::vars</code> dcmd provides other options for listing
variables.</p>
</dd>
<dt class="hdlist1"><em>width</em> <code>$w</code></dt>
<dd>
<p> Set the output page <em>width</em> to the specified
value. Typically, this command is not necessary, as MDB queries the
terminal for its width and handles resize events.</p>
</dd>
<dt class="hdlist1"><code>$W</code></dt>
<dd>
<p> Reopen the target for writing, as if MDB had been
executed with the <code>w</code> option on the command line. Write mode can also
be enabled with the <code>::set</code> <code>w</code> option.</p>
</dd>
<dt class="hdlist1"><code>::array</code> <em>type</em> <em>count</em></dt>
<dd>
<p>  Print the address of each element of an array. The type of the array
  elements should be specified as the first argument, <em>type</em>,
  and the number of elements to be computed should be specified as the
  second argument, <em>count</em>. The output of <code>::array</code> can be
  pipelined to the <code>::print</code> dcmd to print the elements of an array data
  structure.
 <br>
  This dcmd may only be used with objects that contain compressed
  symbolic debugging information designed for use with <code>mdb</code>. This
  information is currently only available for certain illumos kernel
  modules. The zlib decompression software must be installed in order to
  process the symbolic debugging information.
[<em>pid</em>] <code>::attach</code> [<em>core</em> |
<em>pid</em>]; [<em>pid</em>] <code>:A</code> [<em>core</em></p>
</dd>
<dt class="hdlist1">| <em>pid</em>]</dt>
<dd>
<p>+
::attach
+
+
:A
+
If the user process target is active, attach to and debug the
specified process-ID or <em>core</em> file. The core file path name
should be specified as a string argument. The process-ID can be
specified as the string argument, or as the value of the expression
preceding the dcmd. Recall that the default base is hexadecimal, so
decimal PIDs obtained using <code>pgrep(1)</code> or <code>ps(1)</code> should be preceded
with “<code>0t</code>” when specified as expressions.</p>
</dd>
<dt class="hdlist1"><code>::branches</code> [<code>v</code>]</dt>
<dd>
<p>Display the most recent branches taken by the current CPU. This dcmd
is currently only available when using <code>kmdb</code> on x86 systems where the
appropriate processor-specific feature is enabled. The number and type
of branches that can be displayed is determined by the processor
architecture. If the <code>v</code> option is present, the instructions prior to
each branch are displayed.</p>
</dd>
<dt class="hdlist1"><code>::cat</code> <em>filename</em> &#8230;&#8203;</dt>
<dd>
<p> Concatenate and display files. Each file name can be
specified as a relative or absolute path name. The file contents will
print to standard output, but will not pass through the output pager.
This dcmd is intended to be used with the <code>|</code> operator; the
programmer can initiate a pipeline using a list of addresses stored in
an external file.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::context</code>; <em>address</em> <code>$p</code></dt>
<dd>
<p>+
::context
+
+
$p
+
Context switch to the specified process. A context switch operation is
valid only when using the kernel target. The process context is
specified using the <em>address</em> of its <code>proc</code> structure in the
kernel&#8217;s virtual address space. The special context address <code>0</code> is
used to denote the context of the kernel itself. MDB can only perform
a context switch when examining a crash dump if the dump contains the
physical memory pages of the specified user process (as opposed to
just kernel pages). The kernel crash dump facility can be configured
to dump all pages or the pages of the current user process using
<code>dumpadm(8)</code>. The <code>::status</code> dcmd can be used to display the contents
of the current crash dump.
+
When the user requests a context switch from the kernel target, MDB
constructs a new target representing the specified user process. After
the switch occurs, the new target interposes its dcmds at the global
level: thus the <code>/</code> dcmd can now format and display data from the
virtual address space of the user process, the <code>::mappings</code> dcmd can
display the mappings in the address space of the user process, and so
on. The kernel target can be restored by executing <code>0::context</code>.</p>
</dd>
<dt class="hdlist1"><code>::cpuregs</code> [<code>c</code> <em>cpuid</em>]</dt>
<dd>
<p>Display the current general-purpose register set for the current CPU
or the specified <em>cpuid</em>. This command is only available when
using <code>kmdb</code>.</p>
</dd>
<dt class="hdlist1"><code>::cpustack</code> [<code>c</code> <em>cpuid</em>]</dt>
<dd>
<p>Display a C stack backtrace for the thread executing on the current
CPU or the specified <em>cpuid</em>. This command is only available
when using <code>kmdb</code>.</p>
</dd>
<dt class="hdlist1"><code>::dcmds</code></dt>
<dd>
<p> <br>
  ::dcmds
 <br>
  List the available dcmds and print a brief description for each one.
[<em>address</em>] <code>::dis</code> [<code>abfw</code>] [<code>n</code></p>
</dd>
<dt class="hdlist1"><em>count</em> ] [<em>address</em>]</dt>
<dd>
<p>+
::dis
+
Disassemble starting at or around the <em>address</em> specified by
the final argument, or the current value of dot. If the address
matches the start of a known function, the entire function is
disassembled. Otherwise, a “window” of instructions before and after
the specified address is printed in order to provide context. By
default, instructions are read from the target&#8217;s virtual address
space; if the <code>f</code> option is present, instructions are read from the
target&#8217;s object file instead. The <code>f</code> option is enabled by default if
the debugger is not currently attached to a live process, core file,
or crash dump. The <code>w</code> option can be used to force window-mode, even
if the address is the start of a known function. The size of the
window defaults to ten instructions. The number of instructions can be
specified explicitly using the <code>n</code> option. If the <code>a</code> option is
present, addresses are printed as numeric values rather than
symbolically. The <code>b</code> option displays both address and symbol names of
the disassembled code.</p>
</dd>
<dt class="hdlist1"><code>::disasms</code></dt>
<dd>
<p> <br>
  ::disasms
 <br>
  List the available disassembler modes. When a target is initialized,
  MDB attempts to select the appropriate disassembler mode. The user can
  change the mode to any of the modes listed using the <code>::dismode</code> dcmd.
<code>::dismode</code> [<em>mode</em>]; <code>$V</code> [ <em>mode</em></p>
</dd>
<dt class="hdlist1">]</dt>
<dd>
<p>+
::dismode
+
+
$V
+
Get or set the disassembler mode. If no argument is specified, print
the current disassembler mode. If a <em>mode</em> argument is
specified, switch the disassembler to the specified mode. The list of
available disassemblers can be displayed using the <code>::disasms</code> dcmd.</p>
</dd>
<dt class="hdlist1"><code>::dmods</code> [<code>l</code>] [<em>module-name</em>]</dt>
<dd>
<p>+
::dmods
+
List the loaded debugger modules. If the <code>l</code> option is specified, the
list of the dcmds and walkers associated with each dmod is printed
below its name. The output can be restricted to a particular dmod by
specifying its name as an additional argument.</p>
</dd>
</dl>
</div>
<div class="dlist address] `::dump` [`eqrstu`] [`f`|`p`">
<dl>
<dt>[<code>g</code> <em>bytes</em>] [<code>w</code> <em>paragraphs</em>]</dt>
<dd>
<p>+
::dump
+
Print a hexadecimal and ASCII memory dump of the 16-byte aligned
region of virtual memory containing the address specified by dot. If a
repeat count is specified for <code>::dump</code>, this is interpreted as a
number of bytes to dump rather than a number of iterations. The
<code>::dump</code> dcmd also recognizes the following options:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>e</code></dt>
<dd>
<p>Adjust for endianness. The <code>e</code> option assumes 4-byte words; the <code>g</code>
option can be used to change the default word size.</p>
</dd>
<dt class="hdlist1"><code>f</code></dt>
<dd>
<p>Read data from the object file location corresponding to the given
virtual address instead of from the target&#8217;s virtual address space.
The <code>f</code> option is enabled by default if the debugger is not
currently attached to a live process, core file, or crash dump.</p>
</dd>
<dt class="hdlist1"><code>g</code> <em>group</em></dt>
<dd>
<p>Display bytes in groups of bytes. The default <em>group</em> size
is 4 bytes. The <em>group</em> size must be a power of two that
divides the line width</p>
</dd>
<dt class="hdlist1"><code>p</code></dt>
<dd>
<p>Interpret <em>address</em> as a physical address location in the
target&#8217;s address space instead of a virtual address.</p>
</dd>
<dt class="hdlist1"><code>q</code></dt>
<dd>
<p>Do not print an ASCII decoding of the data.</p>
</dd>
<dt class="hdlist1"><code>r</code></dt>
<dd>
<p>Number lines relative to the start address instead of with the
explicit address of each line. This option implies the <code>u</code> option.</p>
</dd>
<dt class="hdlist1"><code>s</code></dt>
<dd>
<p>Elide repeated lines.</p>
</dd>
<dt class="hdlist1"><code>t</code></dt>
<dd>
<p>Only read from and display the contents of the specified addresses,
instead of reading and printing entire lines.</p>
</dd>
<dt class="hdlist1"><code>u</code></dt>
<dd>
<p>Unalign output instead of aligning the output at a paragraph
boundary.</p>
</dd>
<dt class="hdlist1"><code>w</code> <em>paragraphs</em></dt>
<dd>
<p>Display paragraphs 16-byte paragraphs per line. The default number
of paragraphs is one. The maximum value accepted for <code>w</code> is 16.</p>
</dd>
</dl>
</div>
</dd>
<dt><code>::echo</code> [<em>string</em> | <em>value</em> &#8230;&#8203;]</dt>
<dd>
<p>+
::echo
+
Print the arguments separated by blanks and terminated by a <code>NEWLINE</code>
to standard output. Expressions enclosed in <code>$[ ]</code> will be
evaluated to a value and printed in the default base.</p>
</dd>
<dt><code>::eval</code> <em>command</em></dt>
<dd>
<p>+
::eval
+
Evaluate and execute the specified string as a command. If the command
contains metacharacters or white space, it should be enclosed in
double or single quotes.</p>
</dd>
<dt><code>::files</code> [&lt;object&gt;]; <code>$f</code></dt>
<dd>
<p> <br>
  ::files
 <br>
 <br>
  $f
 <br>
  Print a list of the known source files (symbols of type <code>STT_FILE</code>
  present in the various target symbol tables). If an <em>object</em>
  name is specified, the output is restricted to file symbols present in
  the corresponding object file.
[address] <code>::findsym</code> [<code>g</code>] [<em>address</em></p>
</dd>
<dt>| <em>symbol</em> &#8230;&#8203;]</dt>
<dd>
<p>Search instruction text for instructions that refer to the specified
symbols or addresses. The search list should consist of one or more
addresses or symbol names specified as an address preceding the dcmd
or one or more symbol names or expressions following the dcmd. If the
<code>g</code> option is specified, the search is restricted to instruction text
that is part of a globally visible function in the target&#8217;s symbol
table.
+
<em>SPARC only</em>. The <code>::findsym</code> dcmd is only available when debugging a
target that uses the SPARC instruction set architecture.</p>
</dd>
<dt><code>::formats</code></dt>
<dd>
<p> <br>
  ::formats
 <br>
  List the available output format characters for use with the <code>/</code>,
  <code>\</code>, <code>?</code>, and <code>=</code> formatting dcmds. The formats and their use is
  described in <a href="#formatting-dcmds">Formatting Dcmds</a>.
[<em>thread</em>] <code>::fpregs</code></p>
</dd>
<dt>[<code>dqs</code>]; <code>[ thread ] $x, $X, $y, $Y</code></dt>
<dd>
<p>+
::fpregs
+
+
$x
+
+
$X
+
+
$y
+
+
$Y
+
Print the floating-point register set of the representative thread. If
a thread is specified, the floating point registers of that thread are
displayed. The thread expression should be one of the thread
identifiers described under <a href="#thread-support">Thread Support</a>.
+
SPARC only. The <code>d</code>, <code>q</code>, and <code>s</code> options can be used to display the
floating point registers as a collection of double-precision (<code>d</code>),
quad-precision (<code>q</code>), or single-precision (<code>s</code>) floating point values.</p>
</dd>
<dt><code>::grep</code> <em>command</em></dt>
<dd>
<p>+
::grep
+
Evaluate the specified command string, then print the old value of dot
if the new value of dot is non-zero. If the <em>command</em> contains
white space or metacharacters, it must be quoted. The <code>::grep</code> dcmd
can be used in pipelines to filter a list of addresses.</p>
</dd>
<dt><code>::help</code> [<em>dcmd-name</em>]</dt>
<dd>
<p> <br>
  ::help
 <br>
  With no arguments, the <code>::help</code> dcmd prints a brief overview of the
  help facilities available in MDB. If a <em>dcmd-name</em> is
  specified, MDB prints a usage summary for that dcmd.
[<em>address</em> [ , <em>len</em> ]] <code>::in</code> [ <code>L</code></p>
</dd>
<dt><em>len</em> ]</dt>
<dd>
<p>  Read and display <em>len</em> bytes from the I/O port specified by
  <em>address</em>. The value of the <code>L</code> option, if present, takes
  precedence over the repeat count specified on the left-hand side. The
  <em>len</em> must be 1, 2, or 4 bytes and the port address must be
  aligned according to the length. This command is only available when
  using <code>kmdb</code> on x86 systems.
[<em>address</em>] <code>::list</code> &lt;type member&gt; [</p>
</dd>
<dt><em>variable-name</em> ]</dt>
<dd>
<p>+
::list
+
Walk through the elements of a linked list data structure and print
the address of each element in the list. The address of the first
element in the list can be specified using an optional
<em>address</em>; otherwise the list is assumed to start at the
current value of dot. The <em>type</em> parameter must name a C
struct or union type and is used to describe the type of the list
elements so that MDB can read in objects of the appropriate size. The
<em>member</em> parameter is used to name the member of
<em>type</em> that contains a pointer to the next list element. The
<code>::list</code> dcmd will continue iterating until a NULL pointer is
encountered, the first element is reached again (a circular list), or
an error occurs while reading an element. If the optional
<em>variable-name</em> is specified, the specified variable will be
assigned the value returned at each step of the walk when MDB invokes
the next stage of a pipeline.
+
This dcmd may only be used with objects that contain compressed
symbolic debugging information designed for use with <code>mdb</code>. This
information is currently only available for certain illumos kernel
modules. The zlib decompression software must be installed in order to
process the symbolic debugging information.</p>
</dd>
<dt><code>::load</code> [<code>s</code>] <em>module-name</em></dt>
<dd>
<p> <br>
  ::load
 <br>
  Load the specified dmod. The module name can be given as an absolute
  or relative path. If <em>module-name</em> is a simple name (that is,
  does not contain a “<code>/</code>”), MDB searches for it in the module library
  path. Modules with conflicting names cannot be loaded; the existing
  module must be unloaded first. If the <code>-s</code> option is present, MDB will
  remain silent and not issue any error messages if the module is not
  found or could not be loaded.
<code>::log</code> [ <code>d</code> | [ <code>e</code> ] <em>filename</em></p>
</dd>
<dt>]; <code>$&gt;</code> [<em>filename</em>]</dt>
<dd>
<p>+
::log
+
+
$&gt;
+
Enable or disable the output log. MDB provides an interactive logging
facility where both the input commands and standard output can be
logged to a file while still interacting with the user. The <code>e</code> option
enables logging to the specified file, or re-enables logging to the
previous log file if no file name is given. The <code>d</code> option disables
logging. If the <code>$&gt;</code> dcmd is used, logging is enabled if a file
name argument is specified; otherwise, logging is disabled. If the
specified log file already exists, MDB appends any new log output to
the file.</p>
</dd>
<dt><code>::map</code> <em>command</em></dt>
<dd>
<p> <br>
  ::map
 <br>
  Map the value of dot to a corresponding value using the
  <em>command</em> specified as a string argument, then print the new
  value of dot. If the command contains white space or metacharacters,
  it must be quoted. The <code>::map</code> dcmd can be used in pipelines to
  transform the list of addresses into a new list of addresses.
[<em>address</em>] <code>::mappings</code> [ <em>name</em></p>
</dd>
<dt>]; [<em>address</em>] <code>$m</code> [<em>name</em>]</dt>
<dd>
<p> <br>
  ::mappings
 <br>
 <br>
  $m
 <br>
  Print a list of each mapping in the target&#8217;s virtual address space,
  including the address, size, and description of each mapping. If the
  dcmd is preceded by an <em>address</em>, MDB shows only the mapping
  that contains the given address. If a string <em>name</em> argument
  is given, MDB shows only the mapping that matched the description.
<code>[address] ::nm</code> [ <code>DPdghnopuvx</code> ] [ <code>t</code>
<em>types</em> ] [ <code>f</code> <em>format</em> ] [</p>
</dd>
<dt><em>object</em> ]</dt>
<dd>
<p>+
::nm
+
Print the symbol tables associated with the current target. If an
optional <em>address</em> preceding the dcmd is specified, only the
symbol table entry for the symbol corresponding to address is
displayed. If an <em>object</em> name is specified, only the symbol
table for this load object is displayed. The <code>::nm</code> dcmd also
recognizes the following options:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>D</code></dt>
<dd>
<p>Prints <code>.dynsym</code> (dynamic symbol table) instead of <code>.symtab</code>.</p>
</dd>
<dt class="hdlist1"><code>P</code></dt>
<dd>
<p>Prints the private symbol table instead of <code>.symtab</code>.</p>
</dd>
<dt class="hdlist1"><code>d</code></dt>
<dd>
<p>Prints value and size fields in decimal.</p>
</dd>
<dt class="hdlist1"><code>f</code> format [,format&#8230;&#8203;]</dt>
<dd>
<p>Print only the specified symbol information. The valid format
argument strings are:
+</p>
</dd>
</dl>
</div>
</dd>
<dt>ndx</dt>
<dd>
<p>symbol table index</p>
</dd>
<dt>val</dt>
<dd>
<p>symbol table</p>
</dd>
<dt>size</dt>
<dd>
<p>size in bytes</p>
</dd>
<dt>type</dt>
<dd>
<p>symbol type</p>
</dd>
<dt>bind</dt>
<dt>oth</dt>
<dt>shndx</dt>
<dd>
<p>section index</p>
</dd>
<dt>name</dt>
<dd>
<p>symbol name</p>
</dd>
<dt>ctype</dt>
<dd>
<p>C type for symbol (if known)</p>
</dd>
<dt>obj</dt>
<dd>
<p>object which defines symbol</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>g</code></dt>
<dd>
<p>Prints only global symbols.</p>
</dd>
<dt class="hdlist1"><code>h</code></dt>
<dd>
<p>Suppresses the header line.</p>
</dd>
<dt class="hdlist1"><code>n</code></dt>
<dd>
<p>Sorts symbols by name.</p>
</dd>
<dt class="hdlist1"><code>o</code></dt>
<dd>
<p>Prints value and size fields in octal.</p>
</dd>
<dt class="hdlist1"><code>p</code></dt>
<dd>
<p>Prints symbols as a series of <code>::nmadd</code> commands. This option can be
used with <code>P</code> to produce a macro file that can be subsequently read
into the debugger with <code>$&lt;</code>.</p>
</dd>
<dt class="hdlist1"><code>t</code> type [,type&#8230;&#8203;]</dt>
<dd>
<p>Prints only symbols of the specified types. The valid type argument
strings are:
+</p>
</dd>
</dl>
</div>
</dd>
<dt>noty</dt>
<dd>
<p>STT_NOTYPE</p>
</dd>
<dt>objt</dt>
<dd>
<p>STT_OBJECT</p>
</dd>
<dt>func</dt>
<dd>
<p>STT_FUNC</p>
</dd>
<dt>sect</dt>
<dd>
<p>STT_SECTION</p>
</dd>
<dt>file</dt>
<dd>
<p>STT_FILE</p>
</dd>
<dt>comm</dt>
<dd>
<p>STT_COMMON</p>
</dd>
<dt>tls</dt>
<dd>
<p>STT_TLS</p>
</dd>
<dt>regi</dt>
<dd>
<p>STT_SPARC_REGISTER</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>u</code></dt>
<dd>
<p>Prints only undefined symbols.</p>
</dd>
<dt class="hdlist1"><code>v</code></dt>
<dd>
<p>Sorts symbols by value.</p>
</dd>
<dt class="hdlist1"><code>x</code></dt>
<dd>
<p>    Prints value and size fields in hexadecimal.
<em>value</em> <code>::nmadd</code> [ <code>fo</code> ] [ <code>e</code> <em>end</em> ]</p>
</dd>
</dl>
</div>
</dd>
<dt>[ <code>s</code> <em>size</em> ] <em>name</em></dt>
<dd>
<p>+
::nmadd
+
Add the specified symbol <em>name</em> to the private symbol table.
MDB provides a private, configurable symbol table that can be used to
interpose on the target&#8217;s symbol table, as described in
<a href="#symbol-name-resolution">Symbol Name Resolution</a>. The <code>::nmadd</code> dcmd also
recognizes the following options:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>e</code></dt>
<dd>
<p>Set the size of the symbol to <em>end</em> - <em>value</em>.</p>
</dd>
<dt class="hdlist1"><code>f</code></dt>
<dd>
<p>Set the type of the symbol to <code>STT_FUNC</code>.</p>
</dd>
<dt class="hdlist1"><code>o</code></dt>
<dd>
<p>Set the type of the symbol to <code>STT_OBJECT</code>.</p>
</dd>
<dt class="hdlist1"><code>s</code></dt>
<dd>
<p>Set the size of the symbol to <em>size</em>.</p>
</dd>
</dl>
</div>
</dd>
<dt><code>::nmdel</code> <em>name</em></dt>
<dd>
<p>+
::nmdel
+
Delete the specified symbol <em>name</em> from the private symbol
table.</p>
</dd>
<dt><code>::objects</code> [ <code>v</code> ]</dt>
<dd>
<p>+
::objects
+
Print a map of the target&#8217;s virtual address space, showing only those
mappings that correspond to the primary mapping (usually the text
section) of each of the known load objects. If the <code>v</code> option is
present, the command displays the version of each object if version
information is know. If no version information is known, a version of
<code>Unknown</code> will be displayed in the output.</p>
</dd>
<dt><code>::offsetof</code> &lt;type member&gt;</dt>
<dd>
<p> <br>
  ::offsetof
 <br>
  Print the offset of the specified member of the specified type. The
  type should be the name of a C structure. The offset is printed in
  bytes, unless the member is a bit-field in which case the offset may
  be printed in bits. The output is always suffixed with the appropriate
  units for clarity. The type name may use the backquote (<code>`)
  scoping operator described in <a href="#symbol-name-resolution">Symbol Name Resolution</a>.
 <br>
  This dcmd may only be used with objects that contain compressed
  symbolic debugging information designed for use with `mdb</code>. This
  information is currently only available for certain illumos kernel
  modules. The zlib decompression software must be installed in order to
  process the symbolic debugging information.
[<em>address</em> [ , <em>len</em> ]] <code>::out</code> [ <code>L</code></p>
</dd>
<dt><em>len</em> ]</dt>
<dd>
<p>  Write the specified <em>value</em> to the I/O port specified by
  <em>address</em>. The value of the <code>L</code> option, if present, takes
  precedence over the repeat count specified on the left-hand side. The
  <em>len</em> must be 1, 2, or 4 bytes and the port address must be
  aligned according to the length. This command is only available when
  using <code>kmdb</code> on x86 systems.
<code>[address] ::print</code> [<code>aCdiLptx</code>] [<code>c</code> &lt;lim&gt;]
[<code>l</code> &lt;lim&gt;] [&lt;type&gt; [&lt;member&gt;|&lt;offset&gt;</p>
</dd>
<dt>&#8230;&#8203; ]]</dt>
<dd>
<p>+
::print
+
Print the data structure at the specified virtual <em>address</em>
using the given <em>type</em> information. The <em>type</em>
parameter may name a C struct, union, enum, fundamental integer type,
or a pointer to any of these types. If the type name contains
whitespace (for example, <code>struct foo</code>), it must be enclosed in single
quotation marks or double quotation marks. The type name may use the
backquote (`) scoping operator described under
<a href="#symbol-name-resolution">Symbol Name Resolution</a>. If the type is a structured
type, the <code>::print</code> dcmd will recursively print each member of the
struct or union. If the <em>type</em> argument is not present and a
static or global STT_OBJECT symbol matches the address, <code>::print</code>
will infer the appropriate type automatically.
+
The type argument can be followed by an optional list of
<em>member</em> or <em>offset</em> expressions, in which case only
those members and submembers of the specified <em>type</em> are
displayed. Members can be specified using C syntax that includes the
array index operator (<code>[]</code>), the structure member operator
(<code>&#8594;</code>), and the structure pointer operator (<code>.</code>). Offsets can be
specified using the MDB arithmetic expansion syntax (<code>$[]</code>). After
displaying the data structure, <code>::print</code> increments dot by the size of
<em>type</em> in bytes.
+
The <code>::print</code> dcmd may only be used with objects that contain
compressed symbolic debugging information designed for use with MDB.
This information is only available at present in certain illumos
kernel modules and user libraries. The <code>zlib</code> decompression software
must be installed in order to process the symbolic debugging
information.
+
If the <code>a</code> option is present, the address of each member is displayed.
If the <code>i</code> option is present, the expression on the left-hand side is
interpreted as an immediate value to be displayed using the specified
type. If the <code>p</code> option is present, <code>::print</code> interprets address as a
physical memory address instead of a virtual memory address. If the
<code>t</code> option is present, the type of each member is displayed. If the
<code>d</code> or <code>x</code> options are present, all integers are displayed in decimal
(<code>d</code>) or hexadecimal (<code>x</code>); by default a heuristic is used to
determine if the value should be displayed in decimal or hexadecimal.
The number of characters in a character array that will be read and
displayed as a string can be limited with the <code>c</code> option. If the <code>C</code>
option is present, no limit is enforced. The number of elements in a
standard array that will be read and displayed can be limited with the
<code>l</code> option. If the <code>L</code> option is present, no limit is enforced and all
array elements are shown. The default values for <code>c</code> and <code>l</code> can be
modified using <code>::set</code> or the <code>o</code> command-line option as described in
<a href="#options">appendix_title</a>.</p>
</dd>
<dt><code>::quit</code> [<code>u</code>]; <code>$q</code> [<code>u</code>]</dt>
<dd>
<p>+
::quit
+
+
$q
+
Quit the debugger. When using <code>kmdb</code> only, the <code>u</code> option causes the
debugger to resume execution of the operating system and unload the
debugger. The <code>u</code> option cannot be used if <code>kmdb</code> was loaded at boot.
If the <code>u</code> option is not present, <code>::quit</code> causes <code>kmdb</code> to exit to
the firmware (on SPARC systems) or causes the system to reboot (on x86
systems).</p>
</dd>
</dl>
</div>
<div class="dlist _thread_] `::regs`; [_thread_">
<dl>
<dt><code>$r</code></dt>
<dd>
<p>+
::regs
+
+
$r
+
Print the general-purpose register set of the representative thread.
If a thread is specified, the general purpose register set of that
thread is displayed. The thread expression should be one of the thread
identifiers described under <a href="#thread-support">Thread Support</a>.</p>
</dd>
<dt><code>::release</code> [<code>a</code>]; <code>:R</code> [<code>a</code>]</dt>
<dd>
<p> <br>
  ::release
 <br>
 <br>
  :R
 <br>
  Release the previously attached process or core file. If the <code>-a</code>
  option is present, the process is released and left stopped and
  abandoned. It can subsequently be continued by <code>prun(1)</code> or it can be
  resumed by applying MDB or another debugger. By default, a released
  process is forcibly terminated if it was created by MDB using <code>::run</code>,
  or it is released and set running if it was attached to by MDB using
  the <code>-p</code> option or using the <code>::attach</code> or <code>:A dcmds</code>.
<code>::set</code> [ <code>wF</code> ] [ &#43;/-<code>o</code> <em>option</em> ] [
<code>s</code> <em>distance</em> ] [ <code>I</code> <em>path</em> ] [ <code>L</code></p>
</dd>
<dt><em>path</em> ] [ <code>P</code> <em>prompt</em> ]</dt>
<dd>
<p>+
::set
+
Get or set miscellaneous debugger properties. If no options are
specified, the current set of debugger properties is displayed. The
<code>::set</code> dcmd recognizes the following options:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>F</code></dt>
<dd>
<p>Forcibly take over the next user process that <code>::attach</code> is applied
to, as if <code>mdb</code> had been executed with the <code>F</code> option on the command
line.</p>
</dd>
<dt class="hdlist1"><code>I</code></dt>
<dd>
<p>Set the default path for locating macro files. The path argument can
contain any of the special tokens described for the <code>I</code> command-line
option in <a href="#options">appendix_title</a>.</p>
</dd>
<dt class="hdlist1"><code>L</code></dt>
<dd>
<p>Set the default path for locating debugger modules. The path
argument can contain any of the special tokens described for the <code>I</code>
command-line option in <a href="#options">appendix_title</a>.</p>
</dd>
<dt class="hdlist1"><code>o</code></dt>
<dd>
<p>Enable the specified debugger option. If the <code>&#43;o</code> form is used,
the option is disabled. The option strings are described along with
the <code>o</code> command-line option in <a href="#options">appendix_title</a>.</p>
</dd>
<dt class="hdlist1"><code>P</code></dt>
<dd>
<p>Set the command prompt to the specified prompt string.</p>
</dd>
<dt class="hdlist1"><code>s</code></dt>
<dd>
<p>Set the symbol matching distance to the specified distance. Refer to
the description of the <code>s</code> command-line option in
<a href="#options">appendix_title</a> for more information.</p>
</dd>
<dt class="hdlist1"><code>w</code></dt>
<dd>
<p>Re-open the target for writing, as if <code>mdb</code> had been executed with
the <code>w</code> option on the command line.</p>
</dd>
</dl>
</div>
</dd>
<dt><code>::showrev</code> [<code>pv</code>]</dt>
<dd>
<p>Display revision information for the hardware and software
corresponding the current target. If no options are specified, general
system information is displayed. If the <code>p</code> option is present,
information for each load object that is part of a patch is displayed.
If the <code>v</code> option is present, information for each load object is
displayed. Load objects without version information will be omitted
from the output for the <code>p</code> option. Load objects without version
information will report <code>Unknown</code> in the output of the <code>v</code> option.</p>
</dd>
<dt><code>::sizeof type</code></dt>
<dd>
<p>  Print the size of the specified type in bytes. The <em>type</em>
  parameter may name a C struct, union, enum, fundamental integer type,
  or a pointer to any of these types. The type name may use the
  backquote (<code>`) scoping operator described in
  <a href="#symbol-name-resolution">Symbol Name Resolution</a>.
 <br>
  This dcmd may only be used with objects that contain compressed
  symbolic debugging information designed for use with `mdb</code>. This
  information is currently only available for certain illumos kernel
  modules. The zlib decompression software must be installed in order to
  process the symbolic debugging information.
[&lt;address&gt;] <code>::stack</code> [&lt;count&gt;]; [&lt;address&gt;]</p>
</dd>
<dt><code>$c</code> [&lt;count&gt;]</dt>
<dd>
<p>+
::stack
+
+
$c
+
Print a C stack back trace. If the dcmd is preceded by an explicit
<em>address</em>, a back trace beginning at this virtual memory
address is displayed. Otherwise, the stack of the representative
thread is displayed. If an optional count value is given as an
argument, no more than <em>count</em> arguments are displayed for
each stack frame in the output.
+
The biased frame pointer value (that is, the virtual
address minus <code>0x7ff</code>) should be used as the address when requesting a
stack trace.
+</p>
</dd>
<dt>[&lt;address&gt;] <code>::stackinfo</code> [<code>h</code>|<code>a</code>]</dt>
<dd>
<p>+
::stackinfo
+
Display <code>kthread_t</code> stack usage.
+
Shows the real utilization of the kernel stack if the <code>/etc/system</code>
<code>kmem_stackinfo</code> tunable (an unsigned integer) is non-zero at
kthread creation time. For example:
+</p>
</dd>
</dl>
</div>
<div class="literalblock">
<div class="content">
<pre>          THREAD            STACK   SIZE  CUR  MAX CMD/LWPID
ffffff014f5f2c20 ffffff0004153000   4f00   4%  43% init/1</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+
The current stack size utilization for this kthread is 4% of its
maximum size. The stack size utilization for this kthread has been up
to 43% of its maximum size. Stack size is 4f00 bytes.
+
* For the very first kthread (sched/1)
* If `kmem_stackinfo` was zero at kthread creation time
* If the kthread has not yet run
+
The `a` option shows TS_FREE kthreads (interrupt kthreads). The
`h` option shows history (dead kthreads that used their kernel stack
the most).
+
If the `/etc/system` `kmem_stackinfo` tunable is non-zero, then
the DTrace probe `sdt:genunix:stkinfo_end:stack-usage` is
activated for dead kthreads as follows:
+
[width="100%",cols="13%,25%,62%",]
|===
|arg0 |`kthread_t ++*++` |A dead kthread</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>|arg1 |`size++_++t` |The kernel stack size of the dead kthread</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  |arg2 |`size++_++t` |A percentage that is the maximum use of the
  kernel stack for this dead kthread
  |===
  +
  If the `/etc/system` `kmem_stackinfo` tunable is non-zero, then
  the performance of creating and deleting kthreads is decreased.
`::status`::
  +
  ::status
  +
  Print a summary of information related to the current target.
_cpuid_ `::switch`; _cpuid_ `:x`::
  When using `kmdb` only, switch to the CPU indicated by the specified
  _cpuid_ and use this CPU's current register state as the
  representative for debugging.
`::term`::
  Print the name of the terminal type that MDB is using to perform any
  terminal-dependent input and output operations, such as command-line
  editing.
_thread_ `::tls` _symbol_::
  Print the address of the storage for the specified thread-local
  storage (TLS) symbol in the context of the specified thread. The
  thread expression should be one of the thread identifiers described
  under link:#thread-support[Thread Support]. The symbol name may use any
  of the scoping operators described under link:#symbol-name-resolution[Symbol Name
  Resolution].
`::typeset` ++[++{plus}/-`t`++]++ _variable-name_ ...::
  +
  ::typeset
  +
  Set attributes for named variables. If one or more variable names are
  specified, they are defined and set to the value of dot. If the `t`
  option is present, the user-defined tag associated with each variable
  is set. If the `t` option is present, the tag is cleared. If no
  variable names are specified, the list of variables and their values
  is printed.
`::unload` _module-name_::
  +
  ::unload
  +
  Unload the specified dmod. The list of active dmods can be printed
  using the `::dmods` dcmd. Built-in modules cannot be unloaded. Modules
  that are busy (that is, provide dcmds that are currently executing)
  cannot be unloaded.
`::unset` _variable-name_ ...::
  +
  ::unset
  +
  Unset (remove) the specified variables from the list of defined
  variables. Some variables are exported by MDB are marked as
  persistent, and cannot be unset by the user.
`::vars` ++[++`npt`++]++::
  +
  ::vars
  +
  Print a listing of named variables. If the `n` option is present, the
  output is restricted to variables that currently have non-zero values.
  If the `p` option is present, the variables are printed in a form
  suitable for re-processing by the debugger using the `$++&lt;++` dcmd.
  This option can be used to record the variables to a macro file, then
  restore these values later. If the `t` option is present, only the
  tagged variables are printed. Variables can be tagged using the `t`
  option of the `::typeset` dcmd.
`::version`::
  +
  ::version
  +
  Print the debugger version number.
`address ::vtop` ++[++`a` ++&lt;++as++&gt;]++::
  +
  ::vtop
  +
  Print the physical address mapping for the specified virtual address,
  if possible. The `::vtop` dcmd is only available when examining a
  kernel target, or when examining a user process inside a kernel crash
  dump (after a `::context` dcmd has been issued).
  +
  When examining a kernel target from the kernel context, the `a` option
  can be used to specify the address (_as_) of an alternate
  address space structure that should be used for the virtual to
  physical translation. By default, the kernel's address space is used
  for translation. This option is available for active address spaces
  even when the dump content only contains kernel pages.
[_address_] `::walk` _walker-name_ ++[++
_variable-name_ ++]++::
  +
  ::walk
  +
  Walk through the elements of a data structure using the specified
  walker. The available walkers can be listed using the `::walkers`
  dcmd. Some walkers operate on a global data structure and do not
  require a starting address. For example, walk the list of `proc`
  structures in the kernel. Other walkers operate on a specific data
  structure whose address must be specified explicitly. For example,
  given a pointer to an address space, walk the list of segments.
  +
  When used interactively, the `::walk` dcmd will print the address of
  each element of the data structure in the default base. The dcmd can
  also be used to provide a list of addresses for a pipeline. The walker
  name can use the backquote “ `` ” scoping operator described in
  link:#dcmd-and-walker-name-resolution[Dcmd and Walker Name Resolution]. If the optional
  _variable-name_ is specified, the specified variable will be
  assigned the value returned at each step of the walk when MDB invokes
  the next stage of the pipeline.
`::walkers`::
  +
  ::walkers
  +
  List the available walkers and print a brief description for each one.
`::whence` [`v`] _name_ ...; `::which` [`v`]
_name_ ...::
  +
  ::whence
  +
  +
  ::which
  +
  Print the dmod that exports the specified dcmds and walkers. These
  dcmds can be used to determine which dmod is currently providing the
  global definition of the given dcmd or walker. Refer to
  link:#dcmd-and-walker-name-resolution[Dcmd and Walker Name Resolution] for more information
  on global name resolution. The `v` option causes the dcmd to print the
  alternate definitions of each dcmd and walker in order of precedence.
`::xdata`::
  +
  ::xdata
  +
  List the external data buffers exported by the current target.
  External data buffers represent information associated with the target
  that cannot be accessed through standard target facilities (that is,
  an address space, symbol table, or register set). These buffers can be
  consumed by dcmds; for more information, refer to link:#mdbgetxdata[].</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-control"><a class="anchor" href="#execution-control"></a>7. Execution Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MDB provides facilities for controlling and tracing the execution of
live running programs, including both user applications and the live
operating system kernel and device drivers. You can use the <code>mdb</code>
command to control user processes that are already running, or create
new processes under the control of the debugger. You can boot or load
<code>kmdb</code> to control the execution of the operating system kernel itself,
or debug a device driver. This chapter describes the built-in dcmds that
can be used to control target execution. These commands can be used in
either <code>mdb</code> or <code>kmdb</code>, except as noted in the descriptions. Additional
topics relating only to execution control in <code>kmdb</code> are discussed in
<a href="#kernel-execution-control">Kernel Execution Control</a>.</p>
</div>
<div class="sect2">
<h3 id="execution-control-1"><a class="anchor" href="#execution-control-1"></a>7.1. Execution Control</h3>
<div class="paragraph">
<p>MDB provides a simple model of execution control: a target process can
be started from within the debugger using <code>::run</code>, or MDB can attach to
an existing process using <code>:A</code>, <code>::attach</code>, or the <code>-p</code> command-line
option (see <a href="#built-in-commands">Built-In Commands</a>). Alternately, the
kernel can be booted using <code>kmdb</code> or <code>kmdb</code> can be loaded afterward. In
either case, a list of traced <em>software events</em> can be specified by the
user. Each time a traced event occurs in the target program, all threads
in the target stop, the thread that triggered the event is chosen as the
representative thread, and control returns to the debugger. Once the
target program is set running, control can be asynchronously returned to
the debugger by typing the user-defined interrupt character (typically
Control-C).</p>
</div>
<div class="paragraph">
<p>A <em>software event</em> is a state transition in the target program that is
observed by the debugger. For example, the debugger may observe the
transition of a program counter register to a value of interest (a
breakpoint) or the delivery of a particular signal.</p>
</div>
<div class="paragraph">
<p>A <em>software event specifier</em> is a description of a class of software
events that is used by the debugger to instrument the target program in
order to observe these events. The <code>::events</code> dcmd is used to list the
software event specifiers. A set of standard properties is associated
with each event specifier, as described under <code>::events</code> in
<a href="#built-in-dcmds">Built-in dcmds</a>.</p>
</div>
<div class="paragraph">
<p>The debugger can observe a variety of different software events,
including breakpoints, watchpoints, signals, machine faults, and system
calls. New specifiers can be created using <code>::bp</code>, <code>::fltbp</code>,
<code>:: sigbp</code>, <code>::sysbp</code>, or <code>::wp</code>. Each specifier has an associated
callback (an MDB command string to execute as if it had been typed at
the command prompt) and a set of properties, as described under
<code>::events</code> in <a href="#built-in-dcmds">Built-in dcmds</a>. Any number of specifiers
for the same event may be created, each with different callbacks and
properties. The current list of traced events and the properties of the
corresponding event specifiers can be displayed using the <code>::events</code>
dcmd. The event specifier properties are defined as part of the
description of the <code>::events</code> and <code>::evset</code> dcmds, in
<a href="#built-in-dcmds">Built-in dcmds</a>.</p>
</div>
<div class="paragraph">
<p>The execution control built-in dcmds, described in
<a href="#built-in-dcmds">Built-in dcmds</a>, are always available, but will issue
an error message indicating they are not supported if applied to a
target that does not support execution control.</p>
</div>
</div>
<div class="sect2">
<h3 id="event-callbacks"><a class="anchor" href="#event-callbacks"></a>7.2. Event Callbacks</h3>
<div class="paragraph">
<p>The <code>::evset</code> dcmd and event tracing dcmds allow you to associate an
event callback (using the <code>-c</code> option) with each event specifier. The
event callbacks are strings that represent MDB commands to execute when
the corresponding event occurs in the target. These commands are
executed as if they had been typed at the command prompt. Prior to
executing each callback, the <em>dot</em> variable is set to the value of the
representative thread&#8217;s program counter and the <em>hits</em> variable is set
to the number of times this specifier has been matched, including the
current match.</p>
</div>
<div class="paragraph">
<p>If the event callbacks themselves contain one or more commands to
continue the target (for example, <code>::cont</code> or <code>::step</code>), these commands
do <em>not</em> immediately continue the target and wait for it to stop again.
Instead, inside of an event callback, the continue dcmds note that a
continue operation is now pending, and then return immediately.
Therefore, if multiple dcmds are included in an event callback, the step
or continue dcmd should be the last command specified. Following the
execution of <em>all</em> event callbacks, the target will immediately resume
execution if <em>all</em> matching event callbacks requested a continue. If
conflicting continue operations are requested, the operation with the
highest precedence determines what type of continue will occur. The
order of precedence from highest to lowest is: step, step-over (next),
step-out, continue.</p>
</div>
</div>
<div class="sect2">
<h3 id="thread-support"><a class="anchor" href="#thread-support"></a>7.3. Thread Support</h3>
<div class="paragraph">
<p>MDB provides facilities to examine the stacks and registers of each
thread associated with the target. The persistent <code>thread</code> variable
contains the current representative thread identifier. The format of the
thread identifier depends on the target. The <code>::regs</code> and <code>::fpregs</code>
dcmds can be used to examine the register set of the representative
thread, or of another thread if its register set is currently available.
In addition, the register set of the representative thread is exported
as a set of named variables. The user can modify the value of one or
more registers by applying the <code>&gt;</code> dcmd to the corresponding named
variable.</p>
</div>
<div class="paragraph">
<p>The MDB kernel target exports the virtual address of the corresponding
internal thread structure as the identifier for a given thread. This
address corresponds to the <code>kthread_t</code> data structure in the
operating system source code. When using <code>kmdb</code>, the CPU identifier for
the CPU running <code>kmdb</code> is stored in the <code>cpuid</code> variable.</p>
</div>
<div class="paragraph">
<p>The MDB process target provides proper support for examination of
multi-threaded user processes that use the native <code>lwp_*</code>
interfaces, <code>/usr/lib/libthread.so</code>, or <code>/usr/lib/libpthread.so</code>. When
debugging a live user process, MDB will detect if a single threaded
process dlopens or closes <code>libthread</code> and will automatically adjust its
view of the threading model on-the-fly. The process target thread
identifiers will correspond to either the <code>lwpid_t</code>, <code>thread_t</code>,
or <code>pthread_t</code> of the representative, depending on the threading
model used by the application.</p>
</div>
<div class="paragraph">
<p>If MDB is debugging a user process target and the target makes use of
compiler-supported thread-local storage, MDB will automatically evaluate
symbol names referring to thread-local storage to the address of the
storage corresponding to the current representative thread. The <code>::tls</code>
built-in dcmd can be used to display the value of the symbol for threads
other than the representative thread.</p>
</div>
</div>
<div class="sect2">
<h3 id="built-in-dcmds-1"><a class="anchor" href="#built-in-dcmds-1"></a>7.4. Built-in dcmds</h3>
<div class="paragraph">
<p>[ &lt;addr&gt; ] <code>::bp</code> [&#43;/-dDestT] [<code>c</code>
&lt;cmd&gt;] [<code>n</code> &lt;count&gt;] &lt;sym&gt;
&#8230;&#8203;; &lt;addr&gt; <code>:b</code> [&lt;cmd&gt; &#8230;&#8203; ]::
  Set a breakpoint at the specified locations. The <code>::bp</code> dcmd sets a
  breakpoint at each address or symbol specified, including an optional
  address specified by an explicit expression preceding the dcmd, and
  each string or immediate value following the dcmd. The arguments may
  either be symbol names or immediate values denoting a particular
  virtual address of interest. If a symbol name is specified, it may
  refer to a symbol that cannot yet be evaluated in the target process:
  that is, it may consist of an object name and function name in a load
  object that has not yet been opened. In this case, the breakpoint is
  deferred and it will not be active in the target until an object
  matching the given name is loaded. The breakpoint will be
  automatically enabled when the load object is opened. Breakpoints on
  symbols defined in a shared library should always be set using a
  symbol name and not using an address expression, as the address may
  refer to the corresponding Procedure Linkage Table (PLT) entry instead
  of the actual symbol definition. Breakpoints set on PLT entries may be
  overwritten by the run-time link-editor when the PLT entry is
  subsequently resolved to the actual symbol definition. The <code>d</code>, <code>D</code>,
  <code>e</code>, <code>s</code>, <code>t</code>, <code>T</code>, <code>c</code>, and <code>n</code> options have the same meaning as they
  do for the <code>::evset</code> dcmd, as described later in this section. If the
  <code>:b</code> form of the dcmd is used, a breakpoint is only set at the virtual
  address specified by the expression preceding the dcmd. The arguments
  following the <code>:b</code> dcmd are concatenated together to form the callback
  string. If this string contains meta-characters, it must be quoted.
<code>function ::call [ arg &#8230;&#8203; ]</code>::
  When using <code>kmdb</code> only, call the specified &lt;function&gt; defined
  in the operating system kernel. The &lt;function&gt; expression must
  match the address of a defined function in a symbol table of one of
  the known kernel modules. If expression arguments are specified, these
  arguments as passed by value. If string arguments are specified, these
  arguments are passed by reference.
 <br>
  The <code>::call</code> command should be used only with extreme caution and
  should never be applied to a production system. The operating system
  kernel will not resume execution in order to execute the specified
  function. Therefore, the function being called must not utilize
  arbitrary kernel services and must not block for any reason. You must
  be fully aware of the side-effects of any function you call using this
  command.
<code>::cont</code> [&lt;SIG&gt;]; <code>:c</code> [&lt;SIG&gt;]::
  Suspend the debugger, continue the target program, and wait for it to
  terminate or stop following a software event of interest. If the
  target is already running because the debugger was attached to a
  running program with the <code>-o nostop</code> option enabled, this dcmd simply
  waits for the target to terminate or stop after an event of interest.
  If an optional signal name or number (see <code>signal(3HEAD)</code>) is
  specified as an argument, the signal is immediately delivered to the
  target as part of resuming its execution. If the SIGINT signal is
  traced, control may be asynchronously returned to the debugger by
  typing the user-defined interrupt character (usually ^C). This SIGINT
  signal will be automatically cleared and will not be observed by the
  target the next time it is continued. If no target program is
  currently running, <code>::cont</code> will start a new program running as if by
  <code>::run</code>.
&lt;addr&gt; <code>::delete</code> [&lt;id&gt; | <code>all</code>]; &lt;addr&gt;
<code>:d</code> [&lt;id&gt; | <code>all</code>]::
  Delete the event specifiers with the given id number. The &lt;id&gt;
  number argument is interpreted in decimal by default. If an optional
  address is specified preceding the dcmd, all event specifiers that are
  associated with the given virtual address are deleted (e.g. all
  breakpoints or watchpoints affecting that address). If the special
  argument <code>all</code> is given, all event specifiers are deleted, except
  those that are marked sticky (T flag). The <code>::events</code> dcmd displays
  the current list of event specifiers.
<code>::events</code> [<code>av</code>]; <code>$b</code> [<code>av</code>]::
  Display the list of software event specifiers. Each event specifier is
  assigned a unique ID number that can be used to delete or modify it at
  a later time. The debugger may also have its own internal events
  enabled for tracing; these will only be displayed if the <code>a</code> option is
  present. If the <code>v</code> option is present, a more verbose display
  including the reason for any specifier inactivity will be shown. The
  following <code>::events</code> dcmd shows example output:
 <br></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::events
   ID S TA HT LM Description                              Action
----- - -- -- -- ---------------------------------------- -------------
[ 1 ] - T   1  0 stop on SIGINT                           -
[ 2 ] - T   0  0 stop on SIGQUIT                          -
[ 3 ] - T   0  0 stop on SIGILL                           -
 ...
[ 11] - T   0  0 stop on SIGXCPU                          -
[ 12] - T   0  0 stop on SIGXFSZ                          -
[ 13] -     2  0 stop at libc`printf                      ::echo printf
&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  +
  The following discussion explains the meaning of each column. A
  summary of this information is available using `::help events`.
  +
  ID;;
    The event specifier identifier. The identifier will be shown in
    square brackets [ ] if the specifier is enabled, in
    parentheses ( ) if the specifier is disabled, or in angle brackets
    ++&lt;++ &gt; if the target program is currently stopped on an event
    that matches the given specifier.
  S;;
    The event specifier state. The state will be one of the following
    symbols:
    +
    -::
      The event specifier is idle. When no target program is running,
      all specifiers are idle. When the target program is running, a
      specifier may be idle if it cannot be evaluated (such as a
      deferred breakpoint in a shared object that is not yet loaded).
    {plus}::
      The event specifier is active. When the target is continued,
      events of this type will be detected by the debugger.
    ++*++::
      The event specifier is armed. This state means that the target is
      currently running with instrumentation for this type of event.
      This state is only visible if the debugger is attached to a
      running program with the `o nostop` option.
    !::
      The event specifier was not armed due to an operating system
      error. The `::events` `-v` option can be used to display more
      information about the reason the instrumentation failed.
  TA;;
    The Temporary, Sticky, and Automatic event specifier properties. One
    or more of the following symbols may be shown:
    +
    t::
      The event specifier is temporary, and will be deleted the next
      time the target stops, regardless of whether it is matched.
    T::
      The event specifier is sticky, and will be not be deleted by
      `::delete` `all` or `:z`. The specifier can be deleted by
      explicitly specifying its id number to`::delete`.
    d::
      The event specifier will be automatically disabled when the hit
      count is equal to the hit limit.
    D::
      The event specifier will be automatically deleted when the hit
      count is equal to the hit limit.
    s::
      The target will automatically stop when the hit count is equal to
      the hit limit.
  HT;;
    The current hit count. This column displays the number of times the
    corresponding software event has occurred in the target since the
    creation of this event specifier.
  LM;;
    The current hit limit. This column displays the limit on the hit
    count at which the auto-disable, auto-delete, or auto-stop behavior
    will take effect. These behaviors can be configured using the
    `::evset` dcmd.
  Description;;
    A description of the type of software event that is matched by the
    given specifier.
  Action;;
    The callback string to execute when the corresponding software event
    occurs. This callback is executed as if it had been typed at the
    command prompt.
++&lt;++id&gt; `::evset` ++[++{plus}/-dDestT++]++ ++[++`c` ++&lt;++cmd++&gt;]++
++[++`n` ++&lt;++count++&gt;]++ ++&lt;++id&gt; ...::
  Modify the properties of one or more software event specifiers. The
  properties are set for each specifier identified by the optional
  expression preceding the dcmd and an optional list of arguments
  following the dcmd. The argument list is interpreted as a list of
  decimal integers, unless an explicit radix is specified. The `::evset`
  dcmd recognizes the following options:
  +
  `d`;;
    Disable the event specifier when the hit count reaches the hit
    limit. If the `{plus}d` form of the option is given, this behavior
    is disabled. Once an event specifier is disabled, the debugger will
    remove any corresponding instrumentation and will ignore the
    corresponding software events until the specifier is subsequently
    re-enabled. If the `n` option is not present, the specifier is
    disabled immediately.
  `D`;;
    Delete the event specifier when the hit count reaches the hit limit.
    If the `{plus}D` form of the option is given, this behavior is
    disabled. The `D` option takes precedence over the `d` option. The
    hit limit can be configured using the `n` option.
  `e`;;
    Enable the event specifier. If the `{plus}e` form of the option is
    given, the specifier is disabled.
  `s`;;
    Stop the target program when the hit count reaches the hit limit. If
    the `{plus}s` form of the option is given, this behavior is
    disabled. The `s` behavior tells the debugger to act as if `::cont`
    were issued following each execution of the specifier's callback,
    except for the Nth execution, where N is the current value of the
    specifier's hit limit. The `s` option takes precedence over both the
    `D` option and the `d` option.
  `-t`;;
    Mark the event specifier as temporary. Temporary specifiers are
    automatically deleted the next time the target stops, regardless of
    whether it stopped as the result of a software event corresponding
    to the given specifier. If the `{plus}t` form of the option is
    given, the temporary marker is removed. The `-t` option takes
    precedence over the `-T` option.
  `T`;;
    Mark the event specifier as sticky. Sticky specifiers will not be
    deleted by `::delete all` or `:z`. They can be deleted by specifying
    the corresponding specifier ID as an explicit argument to
    `::delete`. If the `{plus}T` form of the option is given, the sticky
    property is removed. The default set of event specifiers are all
    initially marked sticky.
  `c`;;
    Execute the specified ++&lt;++cmd&gt; string each time the
    corresponding software event occurs in the target program. The
    current callback string can be displayed using `::events`.
  `n`;;
    Set the current value of the hit limit to _count_. If no hit
    limit is currently set and the `n` option does not accompany `s` or
    `D`, the hit limit will be set to one.
  +
  A summary of this information is available using `::help evset`.
++&lt;++flt&gt; `::fltbp` ++[++{plus}/-dDestT++]++ ++[++`c` ++&lt;++cmd++&gt;]++
++[++`n` ++&lt;++count++&gt;]++ ++&lt;++flt&gt; ...::
  Trace the specified machine faults. The faults are identified using an
  optional fault number preceding the dcmd, or a list of fault names or
  numbers (see `++&lt;++sys/fault.h&gt;`) following the dcmd. The `d`,
  `D`, `e`, `s`, `t`, `T`, `c`, and `n` options have the same meaning as
  they do for the `::evset` dcmd. The `::fltbp` command applies to user
  process debugging only.
++&lt;++signal&gt; `:i`::
  If the target is a live user process, ignore the specified signal and
  allow it to be delivered transparently to the target. All event
  specifiers that are tracing delivery of the specified signal will be
  deleted from the list of traced events. By default, the set of ignored
  signals is initialized to the complement of the set of signals that
  cause a process to dump core by default (see `signal(3HEAD)`), except
  for SIGINT, which is traced by default. The `:i` command applies to
  user process debugging only.
`$i`::
  Display the list of signals that are ignored by the debugger and will
  be handled directly by the target. More information on traced signals
  can be obtained using the `::events` dcmd. The `$i` command applies to
  user process debugging only.
`::kill`; `:k`::
  Forcibly terminate the target if it is a live user process. The target
  will also be forcibly terminated when the debugger exits if it was
  created by the debugger using `::run`. The `::kill` command applies to
  user process debugging only.
`$l`::
  Print the LWPID of the representative thread, if the target is a user
  process.
`$L`::
  Print the LWPIDs of each LWP in the target, if the target is a user
  process.
`::next` ++[&lt;++SIG++&gt;]++; `:e` ++[&lt;++SIG++&gt;]++::
  Step the target program one instruction, but step over subroutine
  calls. If an optional signal name or number (see `signal(3HEAD)`) is
  specified as an argument, the signal is immediately delivered to the
  target as part of resuming its execution. If no target program is
  currently running, `::next` will start a new program running as if by
  `::run` and stop at the first instruction.
`::run` ++[&lt;++args&gt; ... ++]++; `:r` ++[&lt;++args&gt; ... ++]++::
  Start a new target program running with the specified arguments and
  attach to it. The arguments are not interpreted by the shell. If the
  debugger is already examining a live running program, it will first
  detach from this program as if by `::release`.
++[&lt;++signal++&gt;]++ `::sigbp` ++[++{plus}/-dDestT++]++ ++[++`c`
++&lt;++cmd++&gt;]++ ++[++`n` ++&lt;++count++&gt;]++ ++&lt;++SIG&gt;
...; ++[&lt;++signal++&gt;]++ `:t` ++[++{plus}/`dDestT`++]++ ++[++`c`
++&lt;++cmd++&gt;]++ ++[++`n` ++&lt;++count++&gt;]++ ++&lt;++SIG&gt; ...::
  Trace delivery of the specified signals. The signals are identified
  using an optional signal number preceding the dcmd, or a list of
  signal names or numbers (see `signal(3HEAD)`) following the dcmd. The
  `d`, `D`, `e`, `s`, `t`, `T`, `c`, and `n` options have the same
  meaning as they do for the `::evset` dcmd. Initially, the set of
  signals that cause the process to dump core by default (see
  signal(3HEAD)) and SIGINT are traced. The `::sigbp` command applies to
  user process debugging only.
`::step` ++[++`branch` | `over` | `out`++]++
++[&lt;++SIG++&gt;]++; `:s` ++&lt;++SIG&gt;; `:u` ++&lt;++SIG&gt;::
  Step the target program one instruction. If an optional signal name or
  number (see `signal(3HEAD)`) is specified as an argument and the
  target is a user process, the signal is immediately delivered to the
  target as part of resuming its execution. If the optional `branch`
  argument is specified, the target program will continue until the next
  instruction that branches the control flow of the processor. The
  `::step branch` feature is only available when using `kmdb` on x86
  systems with appropriate processor-specific features enabled. If the
  optional `over` argument is specified, `::step` will step over
  subroutine calls. The `::step over` argument is the same as the
  `::next` dcmd. If the optional `out` argument is specified, the target
  program will continue until the representative thread returns from the
  current function. If no target program is currently running,
  `::step over` will start a new program running as if by `::run` and
  stop at the first instruction. The `:s` dcmd is the same as `::step`.
  The `:u` dcmd is the same as `::step out`.
++[&lt;++syscall++&gt;]++ `::sysbp` ++[++{plus}/`dDestT`++]++ ++[++`io`++]++
++[++`c` ++&lt;++cmd++&gt;]++ ++[++`n` ++&lt;++count++&gt;]++ ++&lt;++syscall&gt;
...::
  Trace entry to or exit from the specified system calls. The system
  calls are identified using an optional system call number preceding
  the dcmd, or a list of system call names or numbers (see
  `++&lt;++sys/syscall.h&gt;`) following the dcmd. If the `i` option is
  specified (the default), the event specifiers trigger on entry into
  the kernel for each system call. If the `o` option is specified, the
  event specifiers trigger on exit out from the kernel. The `d`, `D`,
  `e`, `s`, `t`, `T`, `c`, and `n` options have the same meaning as they
  do for the `::evset` dcmd. The `::sysbp` command applies to user
  process debugging only.
++&lt;++addr&gt; ++[++,++&lt;++len++&gt;]++`::wp` ++[++{plus}/`dDestT`++]++
++[++`rwx`++]++ ++[++`ip`++]++ ++[++`c` ++&lt;++cmd++&gt;]++ ++[++`n`
++&lt;++count++&gt;]++; ++&lt;++addr&gt; ++[++,++&lt;++len++&gt;]++`:a`
++[&lt;++cmd&gt;... ++]++; ++&lt;++addr&gt; ++[++,++&lt;++len++&gt;]++`:p`
++[&lt;++cmd&gt;... ++]++; ++&lt;++addr&gt; ++[++,++&lt;++len++&gt;]++`:w`
++[&lt;++cmd&gt;... ++]++; ::
  Set a watchpoint at the specified address. The length in bytes of the
  watched region may be set by specifying an optional repeat count
  preceding the dcmd. If no length is explicitly set, the default is one
  byte. The `::wp` dcmd allows the watchpoint to be configured to
  trigger on any combination of read (`r` option), write (`w` option),
  or execute (`x` option) access. The `d`, `D`, `e`, `s`, `t`, `T`, `c`,
  and `n` options have the same meaning as they do for the `::evset`
  dcmd. When using `kmdb` on x86 systems only, the `i` option can be
  used to indicate that a watchpoint should be set on the address of an
  I/O port. When using `kmdb` only, the `p` option can be used to
  indicate that the specified address should be interpreted as a
  physical address. The `:a` dcmd sets a read access watchpoint at the
  specified address. The `:p` dcmd sets an execute access watchpoint at
  the specified address. The `:w` dcmd sets a write access watchpoint at
  the specified address. The arguments following the `:a`, `:p`, and
  `:w` dcmds are concatenated together to form the callback string. If
  this string contains meta-characters, it must be quoted.
`:z`::
  Delete all event specifiers from the list of traced software events.
  Event specifiers can also be deleted using `::delete`.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="interaction-with-exec"><a class="anchor" href="#interaction-with-exec"></a>7.5. Interaction With <code>exec</code></h3>
<div class="paragraph">
<p>When a controlled user process performs a successful <code>exec</code>(2), the
behavior of the debugger is controlled by the
<code>::set -o follow_exec_mode</code> option, as described in
<a href="#summary-of-command-line-options">Summary of Command-line Options</a>. If the debugger and
victim process have the same data model, then the <code>stop</code> and <code>follow</code>
modes determine whether MDB automatically continues the target or
returns to the debugger prompt following the <code>exec</code>. If the debugger and
victim process have a different data model, then the <code>follow</code> behavior
causes MDB to automatically re-exec the MDB binary with the appropriate
data model and re-attach to the process, still stopped on return from
the <code>exec</code>. Not all debugger state is preserved across this re-exec.</p>
</div>
<div class="paragraph">
<p>If a 32-bit victim process <code>exec`s a 64-bit program, then `stop</code> will
return to the command prompt, but the debugger will no longer be able to
examine the process because it is now using the 64-bit data model. To
resume debugging, execute the <code>::release -a</code> dcmd, quit MDB, and then
execute <code>mdb -p</code> <em>pid</em> to re-attach the 64-bit debugger to the
process.</p>
</div>
<div class="paragraph">
<p>If a 64-bit victim process execs a 32-bit program, then <code>stop</code> will
return to the command prompt, but the debugger will only provide limited
capabilities for examining the new process. All built-in dcmds will work
as advertised, but loadable dcmds will not since they do not perform
data model conversion of structures. The user should release and
reattach the debugger to the process as described above in order to
restore full debugging capabilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="interaction-with-job-control"><a class="anchor" href="#interaction-with-job-control"></a>7.6. Interaction with Job Control</h3>
<div class="paragraph">
<p>If the debugger is attached to a user process that is stopped by job
control (that is, it stopped in response to SIGTSTP, SIGTTIN, or
SIGTTOU), the process may not be able to be set running again when it is
continued by a continue dcmd. If the victim process is a member of the
same session (that is, it shares the same controlling terminal as MDB),
MDB will attempt to bring the associated process group to the foreground
and continue the process with SIGCONT to resume it from job control
stop. When MDB is detached from such a process, it will restore the
process group to the background before exiting. If the victim process is
not a member of the same session, MDB cannot safely bring the process
group to the foreground, so it will continue the process with respect to
the debugger but the process will remain stopped by job control. MDB
will print a warning in this case, and the user must issue a <code>fg</code>
command from the appropriate shell in order to resume the process.</p>
</div>
</div>
<div class="sect2">
<h3 id="process-attach-and-release"><a class="anchor" href="#process-attach-and-release"></a>7.7. Process Attach and Release</h3>
<div class="paragraph">
<p>When MDB attaches to a running user process, the process is stopped and
remains stopped until one of the continue dcmds is applied, or the
debugger quits. If the <code>-o nostop</code> option is enabled prior to attaching
the debugger to a process with <code>-p</code> or prior to issuing an <code>::attach</code> or
<code>:A</code> command, MDB will attach to the process but not stop it. While the
process is still running, it may be inspected as usual (albeit with
inconsistent results) and breakpoints or other tracing flags may be
enabled. If the <code>:c</code> or <code>::cont</code> dcmds are executed while the process is
running, the debugger will wait for the process to stop. If no traced
software events occur, the user can send an interrupt (^C) after <code>:c</code> or
<code>::cont</code> to force the process to stop and return control to the
debugger.</p>
</div>
<div class="paragraph">
<p>MDB releases the current running process (if any) when the <code>:R</code>,
<code>::release</code>, <code>:r</code>, <code>::run</code>, <code>$q</code>, or <code>::quit</code> dcmds are executed, or
when the debugger terminates as the result of an EOF or signal. If the
process was originally created by the debugger using <code>:r</code> or <code>::run</code>, it
will be forcibly terminated as if by SIGKILL when it is released. If the
process was already running prior to attaching MDB to it, it will be set
running again when it is released. A process may be released and left
stopped and abandoned using the <code>::release -a</code> option.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kernel-execution-control"><a class="anchor" href="#kernel-execution-control"></a>8. Kernel Execution Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the MDB features for execution control of the
live operating system kernel available when running <code>kmdb</code>. <code>kmdb</code> is a
version of MDB specifically designed for kernel execution control and
live kernel debugging. Using <code>kmdb</code>, the kernel can be controlled and
observed in much the same way that a user process can be controlled and
observed using <code>mdb</code>. The kernel execution control functionality
includes instruction-level control of kernel threads executing on each
CPU, enabling developers to single-step the kernel and inspect data
structures in real time.</p>
</div>
<div class="paragraph">
<p>Both <code>mdb</code> and <code>kmdb</code> share the same user interface. All of the
execution control functionality described in <a href="#execution-control">Execution
Control</a> is available in <code>kmdb</code>, and is identical to the set of commands
used to control user processes. The commands used to inspect kernel
state, described in <a href="#mdb-language-syntax">MDB Language Syntax</a> and
<a href="#built-in-commands">Built-In Commands</a>, are also available when using
<code>kmdb</code>. Finally, the commands specific to the illumos kernel
implementation, described in <a href="#kernel-debugging-modules">Kernel Debugging Modules</a>,
are available unless otherwise noted. This chapter describes the
remaining features that are specific to <code>kmdb</code>.</p>
</div>
<div class="sect2">
<h3 id="booting-loading-and-unloading"><a class="anchor" href="#booting-loading-and-unloading"></a>8.1. Booting, Loading, and Unloading</h3>
<div class="paragraph">
<p>To facilitate the debugging of kernel startup, <code>kmdb</code> can be loaded
during the earliest stages of the boot process, before control has
passed from the kernel runtime linker (<code>krtld</code>) to the kernel. <code>kmdb</code>
may be loaded at boot using the <code>k</code> boot flag, the <code>kmdb</code> boot file, or
the <code>kadb</code> boot file (for compatibility). If <code>kmdb</code> is loaded at boot,
the debugger cannot be unloaded until the system subsequently reboots.
Some functionality will not be immediately available during the earliest
stages of boot. In particular, debugging modules will not be loaded
until the kernel module subsystem has initialized. Processor-specific
functionality will not be enabled until the kernel has completed the
processor identification process.</p>
</div>
<div class="paragraph">
<p>If you boot your system using the <code>k</code> option, <code>kmdb</code> will automatically
load during the boot process. You can use the <code>d</code> boot option to request
a debugger breakpoint prior to starting the kernel. This feature works
with the default kernel as well as alternate kernels. For example, to
boot a SPARC system with <code>kmdb</code> and request immediate entry to the
debugger, type any of the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ok boot -kd
ok boot kmdb -d
ok boot kadb -d</pre>
</div>
</div>
<div class="paragraph">
<p>To boot an x86 system in the same manner, type any of the following
commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Select (b)oot or (i)nterpreter: b -kd
Select (b)oot or (i)nterpreter: b kmdb -d
Select (b)oot or (i)nterpreter: b kadb -d</pre>
</div>
</div>
<div class="paragraph">
<p>To boot a SPARC system with <code>kmdb</code> and load an alternate 64–bit kernel,
type the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ok boot kernel.test/sparcv9/unix -k</pre>
</div>
</div>
<div class="paragraph">
<p>To boot an x86 system with  <code>kmdb</code> and load an alternate 64–bit kernel,
type the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Select (b)oot or (i)nterpreter: b kernel.test/amd64/unix -k</pre>
</div>
</div>
<div class="paragraph">
<p>If the boot file is set to the string <code>kmdb</code> or <code>kadb</code> and you want to
boot an alternate kernel, use the <code>D</code> option to specify the name of the
kernel to boot. To boot a SPARC system in this manner, type the
following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ok boot kmdb -D kernel.test/sparcv9/unix</pre>
</div>
</div>
<div class="paragraph">
<p>To boot a 32–bit x86 system in this manner, type the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Select (b) or (i)nterpreter: b kmdb -D kernel.test/unix</pre>
</div>
</div>
<div class="paragraph">
<p>To boot a 64–bit x86 system in this manner, type the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Select (b) or (i)nterpreter: b kmdb -D kernel.test/amd64/unix</pre>
</div>
</div>
<div class="paragraph">
<p>To debug a system that has already booted, use the <code>mdb</code> <code>K</code> option to
load <code>kmdb</code> and stop kernel execution. When the debugger is loaded using
this method, it can be subsequently unloaded. You can unload <code>kmdb</code> when
you are done debugging by specifying the <code>u</code> option to the <code>::quit</code>
dcmd. Alternatively, you can resume execution of the operating system
using the command <code>mdb -U</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="terminal-handling"><a class="anchor" href="#terminal-handling"></a>8.2. Terminal Handling</h3>
<div class="paragraph">
<p><code>kmdb</code> always uses the system console for interaction. <code>kmdb</code> will
determine the appropriate terminal type according to the following
rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the system being debugged uses an attached keyboard and monitor for
its console and the debugger is loaded at boot, the terminal type will
be determined automatically based upon the platform architecture and
console terminal settings.</p>
</li>
<li>
<p>If the system begin debugged uses a serial console and the debugger is
loaded at boot, a default terminal type of <code>vt100</code> will be assumed.</p>
</li>
<li>
<p>If the debugger is loaded by running <code>mdb -K</code> on the console, the
value of the <code>$TERM</code> environment variable will be used as the terminal
type.</p>
</li>
<li>
<p>If the debugger is loaded by running <code>mdb -K</code> on a terminal that is
not the console, the debugger will use the terminal type that has been
configured for use with the system console login prompt.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the <code>::term</code> dcmd from within <code>kmdb</code> to display the terminal
type.</p>
</div>
</div>
<div class="sect2">
<h3 id="debugger-entry"><a class="anchor" href="#debugger-entry"></a>8.3. Debugger Entry</h3>
<div class="paragraph">
<p>The operating system kernel will implicitly stop executing and enter
<code>kmdb</code> when a breakpoint is reached or according to the other execution
control settings described in <a href="#execution-control">Execution Control</a>. You can
use the <code>mdb</code> <code>K</code> option or an appropriate keyboard break sequence to
request explicit entry to <code>kmdb</code>. On a SPARC system console, use the
STOP-A key sequence to send a break and enter <code>kmdb</code>. On an x86 system
console, use the F1–A key sequence to send a break and enter <code>kmdb</code>. You
can use the <code>kbd</code> command to customize the escape sequence on your
illumos system. To enter <code>kmdb</code> on a system with a serial console, use
the appropriate serial console command to send a break sequence.</p>
</div>
</div>
<div class="sect2">
<h3 id="processor-specific-features"><a class="anchor" href="#processor-specific-features"></a>8.4. Processor-Specific Features</h3>
<div class="paragraph">
<p>Some <code>kmdb</code> functionality is specific to an individual processor
architecture. For example, various x86 processors support a hardware
branch tracing capability that is not found on some other processor
architectures. Access to processor-specific features is provided through
processor-specific dcmds that are only present on systems that support
them. The availability of processor-specific support will be indicated
in the output of the <code>::status</code> dcmd. The debugger relies upon the
kernel to determine the processor type. Therefore, even though the
debugger may provide features for a given processor architecture, this
support will not be exposed until the kernel has progressed to the point
where processor identification has completed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kernel-debugging-modules"><a class="anchor" href="#kernel-debugging-modules"></a>9. Kernel Debugging Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kernel Debugging Modules</p>
</div>
<div class="paragraph">
<p>This chapter describes the debugger modules, dcmds, and walkers provided
to debug the illumos kernel. Each kernel debugger module is named after
the corresponding illumos kernel module, so that it will be loaded
automatically by MDB. The facilities described here reflect the current
illumos kernel implementation and are subject to change in the future;
writing shell scripts that depend on the output of these commands is not
recommended. In general, the kernel debugging facilities described in
this chapter are meaningful only in the context of the corresponding
kernel subsystem implementation. See <a href="#related-books-and-papers">Related Books and
Papers</a> for a list of references that provide more information about the
illumos kernel implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>MDB exposes kernel implementation details that are subject to change at
any time. This guide reflects the illumos kernel implementation as of
the date of publication of this guide. Information provided in this
guide about modules, dcmds, walkers, and their output formats and
arguments might not be correct or applicable to past or future illumos
releases.</p>
</div>
<div id="generic-kernel-debugging-support-genunix" class="paragraph">
<p>=== Generic Kernel Debugging Support (<code>genunix</code>)</p>
</div>
<div id="kernel-memory-allocator" class="paragraph">
<p>==== Kernel Memory Allocator</p>
</div>
<div class="paragraph">
<p>This section discusses the dcmds and walkers used to debug problems
identified by the illumos kernel memory allocator and to examine memory
and memory usage. The dcmds and walkers described here are discussed in
more detail in <a href="#debugging-with-the-kernel-memory-allocator">Debugging With the Kernel Memory Allocator</a>.</p>
</div>
<div id="dcmds" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>thread</em> <code>::allocdby</code></dt>
<dd>
<p>  Kernel Memory Allocator
 <br>
 <br>
  ::allocdby
 <br>
 <br>
  ::allocdby
 <br>
  Given the address of a kernel thread, print a list of memory
  allocations it has performed in reverse chronological order.
&lt;bufctl&gt; <code>::bufctl</code> [<code>a</code> &lt;address&gt;] [<code>c</code>
&lt;caller&gt;] [<code>e</code> &lt;earliest&gt;] [<code>l</code></p>
</dd>
<dt class="hdlist1">&lt;latest&gt;] [<code>t</code> &lt;thread&gt;]</dt>
<dd>
<p>Kernel Memory Allocator
+
+
::bufctl
+
+
::bufctl
+
Print a summary of the &lt;bufctl&gt; information for the specified
bufctl <em>address</em>. If one or more options are present, the
bufctl information is printed only if it matches the criteria defined
by the option arguments; in this way, the dcmd can be used as a filter
for input from a pipeline. The <code>a</code> option indicates that the bufctl&#8217;s
corresponding buffer address must equal the specified address. The <code>c</code>
option indicates that a program counter value from the specified
caller must be present in the bufctl&#8217;s saved stack trace. The <code>e</code>
option indicates that the bufctl&#8217;s timestamp must be greater than or
equal to the specified earliest timestamp. The <code>l</code> option indicates
that the bufctl&#8217;s timestamp must be less than or equal to the
specified latest timestamp. The <code>t</code> option indicates that the bufctl&#8217;s
thread pointer must be equal to the specified thread address.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::findleaks</code> [<code>v</code>]</dt>
<dd>
<p>Kernel Memory Allocator
+
+
::findleaks
+
+
::findleaks
+
The <code>::findleaks</code> dcmd provides powerful and efficient detection of
memory leaks in kernel crash dumps where the full set of kmem debug
features has been enabled. The first execution of <code>::findleaks</code>
processes the dump for memory leaks (this can take a few minutes),
then coalesces the leaks by the allocation stack trace. The findleaks
report shows a bufctl address and the topmost stack frame for each
memory leak that was identified.
+
If the <code>v</code> option is specified, the dcmd prints more verbose messages
as it executes. If an explicit address is specified prior to the dcmd,
the report is filtered and only leaks whose allocation stack traces
contain the specified function address are displayed.</p>
</dd>
<dt class="hdlist1"><em>thread</em> <code>::freedby</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::freedby
+
+
::freedby
+
Given the address of a kernel thread, print a list of memory frees it
has performed, in reverse chronological order.</p>
</dd>
<dt class="hdlist1"><em>value</em> <code>::kgrep</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kgrep
+
+
::kgrep
+
Search the kernel address space for pointer-aligned addresses that
contain the specified pointer-sized value. The list of addresses that
contain matching values is then printed. Unlike MDB&#8217;s built-in search
operators, <code>::kgrep</code> searches every segment of the kernel&#8217;s address
space and searches across discontiguous segment boundaries. On large
kernels, <code>::kgrep</code> can take a considerable amount of time to execute.</p>
</dd>
<dt class="hdlist1"><code>::kmalog</code> [ <code>slab</code> | <code>fail</code> ]</dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kmalog
+
+
::kmalog
+
Display events in a kernel memory allocator transaction log. Events
are displayed in time-reverse order, with the most recent event
displayed first. For each event, <code>::kmalog</code> displays the time relative
to the most recent event in T-minus notation (for example,
T-0.000151879), the bufctl, the buffer address, the kmem cache name,
and the stack trace at the time of the event. Without arguments,
<code>::kmalog</code> displays the kmem transaction log, which is present only if
<code>KMF_AUDIT</code> is set in <code>kmem_flags</code>. <code>::kmalog</code> <code>fail</code> displays
the allocation failure log, which is always present; this can be
useful in debugging drivers that don&#8217;t cope with allocation failure
correctly. <code>::kmalog</code> <code>slab</code> displays the slab create log, which is
always present. <code>::kmalog</code> <code>slab</code> can be useful when searching for
memory leaks.</p>
</dd>
<dt class="hdlist1"><code>::kmastat</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kmastat
+
+
::kmastat
+
Display the list of kernel memory allocator caches and virtual memory
arenas, along with corresponding statistics.</p>
</dd>
<dt class="hdlist1"><code>::kmausers</code> [<code>ef</code>] [&lt;cache&gt; &#8230;&#8203;]</dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kmausers
+
+
::kmausers
+
Print information about the medium and large users of the kernel
memory allocator that have current memory allocations. The output
consists of one entry for each unique stack trace specifying the total
amount of memory and number of allocations that was made with that
stack trace. This dcmd requires that the <code>KMF_AUDIT</code> flag is set
in <code>kmem_flags</code>.
+
If one or more cache names (for example, <code>kmem_alloc_256</code>) are
specified, the scan of memory usage is restricted to those caches. By
default all caches are included. If the <code>e</code> option is used, the small
users of the allocator are included. The small users are allocations
that total less than 1024 bytes of memory or for which there are less
than 10 allocations with the same stack trace. If the <code>f</code> option is
used, the stack traces are printed for each individual allocation.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::kmem_cache</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kmem_cache
+
+
::kmem_cache
+
Format and display the <code>kmem_cache</code> structure stored at the
specified address, or the complete set of active <code>kmem_cache</code>
structures.</p>
</dd>
<dt class="hdlist1"><code>::kmem_log</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kmem_log
+
+
::kmem_log
+
Display the complete set of kmem transaction logs, sorted in reverse
chronological order. This dcmd uses a more concise tabular output
format than <code>::kmalog</code>.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::kmem_verify</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::kmem_verify
+
+
::kmem_verify
+
Verify the integrity of the <code>kmem_cache</code> structure stored at the
specified address, or the complete set of active <code>kmem_cache</code>
structures. If an explicit cache address is specified, the dcmd
displays more verbose information regarding errors; otherwise, a
summary report is displayed. The <code>::kmem_verify</code> dcmd is discussed
in more detail in <a href="#kernel-memory-caches">Kernel Memory Caches</a>.</p>
</dd>
<dt class="hdlist1">[ &lt;address&gt;] <code>::vmem</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::vmem
+
+
::vmem
+
Format and display the <code>vmem</code> structure stored at the specified
address, or the complete set of active <code>vmem</code> structures. This
structure is defined in <code>&lt;sys/vmem_impl.h&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::vmem_seg</code></dt>
<dd>
<p>Kernel Memory Allocator
+
+
::vmem_seg
+
+
::vmem_seg
+
Format and display the <code>vmem_seg</code> structure stored at the
specified address. This structure is defined in
<code>&lt;sys/vmem_impl.h&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::whatis</code> [<code>abv</code>]</dt>
<dd>
<p>Kernel Memory Allocator
+
+
::whatis
+
+
::whatis
+
Report information about the specified address. In particular,
<code>::whatis</code> will attempt to determine if the address is a pointer to a
kmem-managed buffer or another type of special memory region, such as
a thread stack, and report its findings. If the <code>a</code> option is present,
the dcmd reports all matches instead of just the first match to its
queries. If the <code>b</code> option is present, the dcmd also attempts to
determine if the address is referred to by a known kmem <code>bufctl</code>. If
the <code>v</code> option is present, the dcmd reports its progress as it
searches various kernel data structures.</p>
</dd>
</dl>
</div>
<div id="walkers" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">allocdby</dt>
<dd>
<p>Kernel Memory Allocator
+
+
+
+
+
Given the address of a <code>kthread_t</code> structure as a starting point,
iterate over the set of <code>bufctl</code> structures corresponding to memory
allocations performed by this kernel thread.</p>
</dd>
<dt class="hdlist1">bufctl</dt>
<dd>
<p>Kernel Memory Allocator
+
+
+
+
+
Given the address of a <code>kmem_cache_t</code> structure as a starting
point, iterate over the set of allocated `bufctl`s associated with
this cache.</p>
</dd>
<dt class="hdlist1">freectl</dt>
<dd>
<p>Kernel Memory Allocator
+
+
+
+
+
Given the address of a <code>kmem_cache_t</code> structure as a starting
point, iterate over the set of free `bufctl`s associated with this
cache.</p>
</dd>
<dt class="hdlist1">freedby</dt>
<dd>
<p>Kernel Memory Allocator
+
+
+
+
+
Given the address of a <code>kthread_t</code> structure as a starting point,
iterate over the set of <code>bufctl</code> structures corresponding to memory
deallocations performed by this kernel thread.</p>
</dd>
<dt class="hdlist1">freemem</dt>
<dd>
<p>Kernel Memory Allocator
+
+
+
+
+
Given the address of a <code>kmem_cache_t</code> structure as a starting
point, iterate over the set of free buffers associated with this
cache.</p>
</dd>
<dt class="hdlist1">kmem</dt>
<dd>
<p>Kernel Memory Allocator
+
+
+
+
+
Given the address of a <code>kmem_cache_t</code> structure as a starting
point, iterate over the set of allocated buffers associated with this
cache.</p>
</dd>
<dt class="hdlist1">kmem_cache</dt>
<dd>
<p>Kernel Memory Allocator
+
+
kmem_cache
+
+
kmem_cache
+
Iterate over the active set of <code>kmem_cache_t</code> structures. This
structure is defined in <code>&lt;sys/kmem_impl.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">kmem_cpu_cache</dt>
<dd>
<p>Kernel Memory Allocator
+
+
kmem_cpu_cache
+
+
kmem_cpu_cache
+
Given the address of a <code>kmem_cache_t</code> structure as a starting
point, iterate over the per-CPU <code>kmem_cpu_cache_t</code>
structures associated with this cache. This structure is defined in
<code>&lt;sys/kmem_impl.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">kmem_slab</dt>
<dd>
<p>Kernel Memory Allocator
+
+
kmem_slab
+
+
kmem_slab
+
Given the address of a <code>kmem_cache_t</code> structure as a starting
point, iterate over the set of associated <code>kmem_slab_t</code>
structures. This structure is defined in
<code>&lt;sys/kmem_impl.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">kmem_log</dt>
<dd>
<p>Kernel Memory Allocator
+
+
kmem_log
+
+
kmem_log
+
Iterate over the set of `bufctl`s stored in the kmem allocator
transaction log.</p>
</dd>
<dt class="hdlist1">leak</dt>
<dd>
<p>Given the address of a <code>bufctl</code> structure, iterate over the set of
<code>bufctl</code> structures corresponding to leaked memory buffers with
similar allocation stack traces. The <code>::findleaks</code> dcmd must be
applied to locate memory leaks before the leak walker can be used.</p>
</dd>
<dt class="hdlist1">leakbuf</dt>
<dd>
<p>Given the address of a <code>bufctl</code> structure, iterate over the set of
buffer addresses corresponding to leaked memory buffers with similar
allocation stack traces. The <code>::findleaks</code> dcmd must be applied to
locate memory leaks before the leakbuf walker can be used.</p>
</dd>
</dl>
</div>
<div id="file-systems" class="paragraph">
<p>==== File Systems</p>
</div>
<div class="paragraph">
<p>The MDB file systems debugging support includes a
built-in facility to convert vnode pointers to the corresponding file
system path name. This conversion is performed using the Directory Name
Lookup Cache (DNLC); because the cache does not hold all active vnodes,
some vnodes might not be able to be converted to path names and “<code>??</code>”
is displayed instead of a name.</p>
</div>
<div id="dcmds-1" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::fsinfo</code></dt>
<dd>
<p>File Systems
+
+
::fsinfo
+
+
::fsinfo
+
Display a table of mounted file systems, including the <code>vfs_t</code>
address, <code>ops</code> vector, and mount point of each file system.</p>
</dd>
<dt class="hdlist1"><code>::lminfo</code></dt>
<dd>
<p>File Systems
+
+
::lminfo
+
+
::lminfo
+
Display a table of vnodes with active network locks registered with
the lock manager. The pathname corresponding to each vnode is shown.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::vnode2path</code> [<code>v</code>]</dt>
<dd>
<p>File Systems
+
+
::vnode2path
+
+
::vnode2path
+
Display the pathname corresponding to the given vnode address. If the
<code>v</code> option is specified, the dcmd prints a more verbose display,
including the vnode pointer of each intermediate path component.</p>
</dd>
</dl>
</div>
<div id="walkers-1" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">buf</dt>
<dd>
<p>File Systems
+
+
+
+
+
Iterate over the set of active block I/O transfer structures
(<code>buf_t</code> structures). The <code>buf</code> structure is defined in
<code>&lt;sys/buf.h&gt;</code> and is described in more detail in <code>buf(9S)</code>.</p>
</dd>
</dl>
</div>
<div id="virtual-memory" class="paragraph">
<p>==== Virtual Memory</p>
</div>
<div class="paragraph">
<p>This section describes the debugging support for the kernel virtual
memory subsystem.</p>
</div>
<div id="dcmds-2" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>address</em> <code>::addr2smap</code> [&lt;offset&gt;]</dt>
<dd>
<p>Virtual Memory
+
+
::addr2smap
+
+
::addr2smap
+
Print the <code>smap</code> structure address that corresponds to the given
address in the kernel&#8217;s segmap address space segment.</p>
</dd>
<dt class="hdlist1"><em>as</em> <code>::as2proc</code></dt>
<dd>
<p>Virtual Memory
+
+
::as2proc
+
+
::as2proc
+
Display the <code>proc_t</code> address for the process corresponding to the
<code>as_t</code> address <em>as</em>.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::memlist</code> [<code>aiv</code>]</dt>
<dd>
<p>Virtual Memory
+
+
::memlist
+
+
::memlist
+
Display the specified <code>memlist</code> structure or one of the well-known
<code>memlist</code> structures. If no <code>memlist</code> address and options are present
or if the <code>i</code> option is present, the <code>memlist</code> representing physically
installed memory is displayed. If the <code>a</code> option is present, the
<code>memlist</code> representing available physical memory is displayed. If the
<code>v</code> option is present, the memlist representing available virtual
memory is displayed.</p>
</dd>
<dt class="hdlist1"><code>::memstat</code></dt>
<dd>
<p>Virtual Memory
+
+
::memstat
+
+
::memstat
+
Display a system-wide memory usage summary. The amount and percentage
of system memory consumed by different classes of pages (kernel,
anonymous memory, executables and libraries, page cache, and free
lists) are displayed, along with the total amount of system memory.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::page</code></dt>
<dd>
<p>Virtual Memory
+
+
::page
+
+
::page
+
Display the properties of the specified <code>page_t</code>. If no
<code>page_t</code> address is specified, the dcmd displays the properties of
all system pages.</p>
</dd>
<dt class="hdlist1">&lt;seg&gt; <code>::seg</code></dt>
<dd>
<p>Virtual Memory
+
+
::seg
+
+
::seg
+
Format and display the specified address space segment (<code>seg_t</code>
address).</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::swapinfo</code></dt>
<dd>
<p>Virtual Memory
+
+
::swapinfo
+
+
::swapinfo
+
Display information on all active <code>swapinfo</code> structures or about the
specified struct <code>swapinfo</code>. The vnode, filename, and statistics for
each structure are displayed.</p>
</dd>
<dt class="hdlist1">&lt;vnode&gt; <code>::vnode2smap</code>[&lt;offset&gt;]</dt>
<dd>
<p>Virtual Memory
+
+
::vnode2smap
+
+
::vnode2smap
+
Print the <code>smap</code> structure address that corresponds to the given
<code>vnode_t</code> address and offset.</p>
</dd>
</dl>
</div>
<div id="walkers-2" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">anon</dt>
<dd>
<p>Virtual Memory
+
+
+
+
+
Given the address of an <code>anon_map</code> structure as a starting point,
iterate over the set of related anon structures. The anon map
implementation is defined in <code>&lt;vm/anon.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">memlist</dt>
<dd>
<p>Virtual Memory
+
+
+
+
+
Iterate over the spans of the specified <code>memlist</code> structure. This
walker can be used in conjunction with the <code>::memlist</code> dcmd to display
each span.</p>
</dd>
<dt class="hdlist1">page</dt>
<dd>
<p>Virtual Memory
+
+
+
+
+
Iterate over all system <code>page</code> structures. If an explicit address is
specified for the walk, this is taken to be the address of a vnode and
the walker iterates over only those pages associated with the vnode.</p>
</dd>
<dt class="hdlist1">seg</dt>
<dd>
<p>Virtual Memory
+
+
+
+
+
Given the address of an <code>as_t</code> structure as a starting point,
iterate over the set of address space segments (<code>seg</code> structures)
associated with the specified address space. The <code>seg</code> structure is
defined in <code>&lt;vm/seg.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">swapinfo</dt>
<dd>
<p>Virtual Memory
+
+
+
+
+
Iterate over the list of active <code>swapinfo</code> structures. This walker may
be used in conjunction with the <code>::swapinfo</code> dcmd.</p>
</dd>
</dl>
</div>
<div id="cpus-and-the-dispatcher" class="paragraph">
<p>==== CPUs and the Dispatcher</p>
</div>
<div class="paragraph">
<p>This section describes the facilities for examining the state of the CPU
structures and the kernel dispatcher.</p>
</div>
<div id="dcmds-3" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::callout</code></dt>
<dd>
<p>CPUs and the Dispatcher
+
+
::callout
+
+
::callout
+
Display the callout table. The function, argument, and expiration time
for each callout is displayed.</p>
</dd>
<dt class="hdlist1"><code>::class</code></dt>
<dd>
<p>CPUs and the Dispatcher
+
+
::class
+
+
::class
+
Display the scheduling class table.</p>
</dd>
<dt class="hdlist1">[<em>cpuid</em>] <code>::cpuinfo</code> [<code>v</code>]</dt>
<dd>
<p>CPUs and the Dispatcher
+
+
::cpuinfo
+
+
::cpuinfo
+
Display a table of the threads currently executing on each CPU. If an
optional CPU ID number or CPU structure address is specified prior to
the dcmd name, only the information for the specified CPU is
displayed. If the <code>v</code> option is present, <code>::cpuinfo</code> also displays the
runnable threads waiting to execute on each CPU as well as the active
interrupt threads.</p>
</dd>
</dl>
</div>
<div id="walkers-3" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">cpu</dt>
<dd>
<p>CPUs and the Dispatcher
+
+
+
+
+
Iterate over the set of kernel CPU structures. The <code>cpu_t</code>
structure is defined in <code>&lt;sys/cpuvar.h&gt;</code>.</p>
</dd>
</dl>
</div>
<div id="device-drivers-and-ddi-framework" class="paragraph">
<p>==== Device Drivers and DDI Framework</p>
</div>
<div class="paragraph">
<p>This section describes dcmds and walkers that are useful for kernel
developers as well as third-party device driver developers.</p>
</div>
<div id="dcmds-4" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>address</em> <code>::binding_hash_entry</code></dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::binding_hash_entry
+
+
::binding_hash_entry
+
Given the address of a kernel name-to-major number binding hash table
entry (struct <code>bind</code>), display the node binding name, major number,
and pointer to the next element.</p>
</dd>
<dt class="hdlist1"><code>::devbindings</code> &lt;device-name&gt;</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::devbindings
+
+
::devbindings
+
Display the list of all instances of the named driver. The output
consists of an entry for each instance, beginning with the pointer to
the struct <code>dev_info</code> (viewable with <code>$&lt;devinfo</code> or
<code>::devinfo</code>), the driver name, the instance number, and the driver and
system properties associated with that instance.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::devinfo</code> [ <code>q</code> ]</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::devinfo
+
+
::devinfo
+
Print the system and driver properties associated with a devinfo node.
If the <code>q</code> option is specified, only a quick summary of the device
node is shown.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::devinfo2driver</code></dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::devinfo2driver
+
+
::devinfo2driver
+
Print the name of the driver (if any) associated with the <code>devinfo</code>
node.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::devnames</code> [ <code>v</code> ]</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::devnames
+
+
::devnames
+
Display the kernel&#8217;s <code>devnames</code> table along with the <code>dn_head</code>
pointer, which points at the driver instance list. If the <code>v</code> flag is
specified, additional information stored at each entry in the
<code>devnames</code> table is displayed.</p>
</dd>
<dt class="hdlist1">[ &lt;devinfo&gt; ] <code>::prtconf</code> [ <code>cpv</code> ]</dt>
<dd>
<p>  Device Drivers and DDI Framework
 <br>
 <br>
  ::prtconf
 <br>
 <br>
  ::prtconf
 <br>
  Display the kernel device tree starting at the device node specified
  by &lt;devinfo&gt;. If &lt;devinfo&gt; is not provided, the root
  of the device tree is assumed by default. If the <code>c</code> option is
  specified, only children of the given device node are displayed. If
  the <code>p</code> option is specified, only ancestors of the given device node
  are displayed. If <code>v</code> is specified, the properties associated with
  each node are displayed.
[ &lt;major-num&gt; ] <code>::major2name</code> [ &lt;major-num&gt;</p>
</dd>
<dt class="hdlist1">]</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::major2name
+
+
::major2name
+
Display the driver name corresponding to the specified major number.
The major number can be specified as an expression preceding the dcmd
or as a command-line argument.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::modctl2devinfo</code></dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::modctl2devinfo
+
+
::modctl2devinfo
+
Print all of the device nodes that correspond to the specified
<code>modctl</code> address.</p>
</dd>
<dt class="hdlist1"><code>::name2major</code> &lt;driver-name&gt;</dt>
<dd>
<p>  Device Drivers and DDI Framework
 <br>
 <br>
  ::name2major
 <br>
 <br>
  ::name2major
 <br>
  Given a device driver name, display its major number.
[<em>address</em>] <code>::softstate</code> [</p>
</dd>
<dt class="hdlist1">&lt;instance-number&gt; ]</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
::softstate
+
+
::softstate
+
Given a softstate state pointer (see
<code>ddi_soft_state_init(9F)</code>) and a device instance number,
display the soft state for that instance.</p>
</dd>
</dl>
</div>
<div id="walkers-4" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">binding_hash</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
binding_hash
+
+
binding_hash
+
Given the address of an array of kernel binding hash table entries
(struct <code>bind</code> **), walk all entries in the hash table and
returnthe address of each struct <code>bind</code>.</p>
</dd>
<dt class="hdlist1">devinfo</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
+
+
+
First, iterate over the parents of the given devinfo and return them
in order of seniority from most to least senior. Second, return the
given devinfo itself. Third, iterate over the children of the given
devinfo in order of seniority from most to least senior. The
<code>dev_info</code> struct is defined in
<code>&lt;sys/ddi_impldefs.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">devinfo_children</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
devinfo_children
+
+
devinfo_children
+
First, return the given devinfo, then iterate over the children of the
given devinfo in order of seniority from most to least senior. The
<code>dev_info</code> struct is defined in
<code>&lt;sys/ddi_impldefs.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">devinfo_parents</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
devinfo_parents
+
+
devinfo_parents
+
Iterate over the parents of the given devinfo in order of seniority
from most to least senior, and then return the given devinfo. The
<code>dev_info</code> struct is defined in
<code>&lt;sys/ddi_impldefs.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">devi_next</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
devi_next
+
+
devi_next
+
Iterate over the siblings of the given devinfo. The <code>dev_info</code>
struct is defined in <code>&lt;sys/ddi_impldefs.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">devnames</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
+
+
+
Iterate over the entries in the devnames array. This structure is
defined in <code>&lt;sys/autoconf.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">softstate</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
+
+
+
Given a softstate pointer (see <code>ddi_soft_state_init(9F)</code>)
display all non-NULL pointers to driver state structures.</p>
</dd>
<dt class="hdlist1">softstate_all</dt>
<dd>
<p>Device Drivers and DDI Framework
+
+
softstate_all
+
+
softstate_all
+
Given a softstate pointer (see <code>ddi_soft_state_init</code>(9F))
display all pointers to driver state structures. Note that the
pointers for unused instances will be NULL.</p>
</dd>
</dl>
</div>
<div id="streams" class="paragraph">
<p>==== STREAMS</p>
</div>
<div class="paragraph">
<p>This section describes dcmds and walkers that are useful for kernel
developers as well as developers of third-party STREAMS modules and
drivers.</p>
</div>
<div id="dcmds-5" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>address</em> <code>::mblk2dblk</code></dt>
<dd>
<p>Given the address of an <code>mblk_t</code>, print the address of the
corresponding <code>dblk_t</code>.</p>
</dd>
<dt class="hdlist1">[&lt;address&gt;] <code>::mblk_verify</code></dt>
<dd>
<p>  Verify the integrity of one or more message blocks. If an explicit
  message block address is specified, the integrity of this message
  block is checked. If no address is specified, the integrity of all
  active message blocks are checked. This dcmd produces output for any
  invalid message block state that is detected.
<em>address</em> <code>::queue</code> [<code>v</code>] [<code>f</code> &lt;flag&gt;]</p>
</dd>
<dt class="hdlist1">[<code>F</code> &lt;flag&gt;] [<code>s</code> &lt;syncq&gt;]</dt>
<dd>
<p>+
+
::queue
+
+
::queue
+
Filter and display the specified <code>queue_t</code> data structure. With no
options, various properties of the <code>queue_t</code> are shown. If the <code>v</code>
option is present, the queue flags are decoded in greater detail. If
the <code>f</code>, <code>F</code>, or <code>m</code> options are present, the queue is displayed only
if it matches the criteria defined by the arguments to these options;
in this way, the dcmd can be used as a filter for input from a
pipeline. The <code>f</code> option indicates that the specified flag (one of the
Q flag names from <code>&lt;sys/stream.h&gt;</code>) must be present in the
queue flags. The <code>F</code> option indicates that the specified flag must be
absent from the queue flags. The <code>m</code> option indicates that the module
name associated with the queue must match the specified modname. The
<code>s</code> option indicates that the <code>syncq_t</code> associated with the queue
must match the specified <code>syncq_t</code> address.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::q2syncq</code></dt>
<dd>
<p>+
+
::q2syncq
+
+
::q2syncq
+
Given the address of a <code>queue_t</code>, print the address of the
corresponding <code>syncq_t</code> data structure.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::q2otherq</code></dt>
<dd>
<p>+
+
::q2otherq
+
+
::q2otherq
+
Given the address of a <code>queue_t</code>, print the address of the peer
read or write queue structure.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::q2rdq</code></dt>
<dd>
<p>+
+
::q2rdq
+
+
::q2rdq
+
Given the address of a <code>queue_t</code>, print the address of the
corresponding read queue.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::q2wrq</code></dt>
<dd>
<p>+
+
::q2wrq
+
+
::q2wrq
+
Given the address of a <code>queue_t</code>, print the address of the
corresponding write queue.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::stream</code></dt>
<dd>
<p> <br>
 <br>
  ::stream
 <br>
 <br>
  ::stream
 <br>
  Display a visual picture of a kernel STREAM data structure, given the
  address of the <code>stdata_t</code> structure representing the STREAM head.
  The read and write queue pointers, byte count, and flags for each
  module are shown, and in some cases additional information for the
  specific queue is shown in the margin.
<em>address</em> <code>::syncq</code> [<code>v</code>] [<code>f</code> &lt;flag&gt;]
[<code>F</code> &lt;flag&gt;] [<code>t</code> &lt;type&gt;] [<code>T</code></p>
</dd>
<dt class="hdlist1">&lt;type&gt;]</dt>
<dd>
<p>+
+
::syncq
+
+
::syncq
+
Filter and display the specified <code>syncq_t</code> data structure. With no
options, various properties of the <code>syncq_t</code> are shown. If the <code>v</code>
option is present, the syncq flags are decoded in greater detail. If
the <code>f</code>, <code>F</code>, <code>t</code>, or <code>T</code> options are present, the syncq is displayed
only if it matches the criteria defined by the arguments to these
options; in this way, the dcmd can be used as a filter for input from
a pipeline. The <code>f</code> option indicates that the specified flag (one of
the <code>SQ_</code> flag names from <code>&lt;sys/strsubr.h&gt;</code>) must be
present in the syncq flags. The <code>F</code> option indicates that the
specified flag must be absent from the syncq flags. The <code>t</code> option
indicates that the specified type (one of the <code>SQ_CI</code> or
<code>SQ_CO</code> type names from <code>&lt;sys/strsubr.h&gt;</code>) must be present
in the syncq type bits. The <code>T</code> option indicates that the specified
type must be absent from the syncq type bits.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::syncq2q</code></dt>
<dd>
<p>+
+
::syncq2q
+
+
::syncq2q
+
Given the address of a <code>syncq_t</code>, print the address of the
corresponding <code>queue_t</code> data structure.</p>
</dd>
</dl>
</div>
<div id="walkers-5" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">b_cont</dt>
<dd>
<p>Given the address of an <code>mblk_t</code>, iterate over the set of
associated message structures by following the <code>b_cont</code> pointer.
The <code>b_cont</code> pointer is used to link a given message block to the
next associated message block that is the continuation of the same
message. The message block is described in more detail in <code>msgb(9S)</code>.</p>
</dd>
<dt class="hdlist1">b_next</dt>
<dd>
<p>Given the address of an <code>mblk_t</code>, iterate over the set of
associated message structures by following the <code>b_next</code> pointer.
The <code>b_next</code> pointer is used to link a given message block to the
next associated message block on a given queue. The message block is
described in more detail in <code>msgb(9S)</code>.</p>
</dd>
<dt class="hdlist1">qlink</dt>
<dd>
<p>+
+
+
+
+
Given the address of a <code>queue_t</code> structure, walk the list of
related queues using the <code>q_link</code> pointer. This structure is
defined in <code>&lt;sys/stream.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">qnext</dt>
<dd>
<p>+
+
+
+
+
Given the address of a <code>queue_t</code> structure, walk the list of
related queues using the <code>q_next</code> pointer. This structure is
defined in <code>&lt;sys/stream.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">readq</dt>
<dd>
<p>+
+
+
+
+
Given the address of an <code>stdata_t</code> structure, walk the list of
read-side queue structures.</p>
</dd>
<dt class="hdlist1">writeq</dt>
<dd>
<p>+
+
+
+
+
Given the address of an <code>stdata_t</code> structure, walk the list of
write-side queue structures.</p>
</dd>
</dl>
</div>
<div id="networking" class="paragraph">
<p>==== Networking</p>
</div>
<div class="paragraph">
<p>The following dcmds and walkers are provided to help debug the core
kernel networking stack protocols.</p>
</div>
<div id="dcmds-6" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>address</em> <code>::mi</code> [<code>p</code>] [<code>d</code> | <code>m</code>]</dt>
<dd>
<p> <br>
 <br>
  ::mi
 <br>
 <br>
  ::mi
 <br>
  Given the address of a kernel MI_O, filter and display the
  MI_O or its payload. If the <code>p</code> option is specified, then the
  address of the corresponding payload of the MI_O is displayed,
  otherwise the MI_O itself is displayed. Specifying filter <code>d</code> or
  <code>m</code> enables the dcmd to filter device or module MI_O objects
  respectively.
<code>::netstat</code> [<code>av</code>] [<code>f</code> <code>inet</code> | <code>inet6</code> |</p>
</dd>
<dt class="hdlist1"><code>unix</code>] [<code>P</code> <code>tcp</code> | <code>udp</code>]</dt>
<dd>
<p> <br>
 <br>
  ::netstat
 <br>
 <br>
  ::netstat
 <br>
  Show network statistics and active connections. If the <code>a</code> option is
  present, the state of all sockets is displayed. If the <code>v</code> option is
  present, more verbose output is displayed. If the <code>f</code> option is
  present, only connections associated with the specified address family
  are displayed. If the <code>P</code> option is present, only connections
  associated with the specified protocols are displayed.
[<em>address</em>] <code>::sonode</code> [<code>f</code> <code>inet</code> | <code>inet6</code>
| <code>unix</code> | &lt;id&gt;] [<code>t</code> <code>stream</code> | <code>dgram</code> |</p>
</dd>
<dt class="hdlist1"><code>raw</code> | &lt;id&gt;] [<code>p</code> &lt;id&gt;]</dt>
<dd>
<p> <br>
 <br>
  ::sonode
 <br>
 <br>
  ::sonode
 <br>
  Filters and displays sonode objects. If no address is given, then the
  list of AF_UNIX sockets is displayed, otherwise only the specified
  sonode is displayed. If the <code>f</code> option is present, then only sockets
  of the given family will be output. If the <code>t</code> option is present, then
  only sonodes of the given type will be output. If the <code>p</code> option is
  present, then only sockets of the given protocol will be displayed.
[<em>address</em>] <code>::tcpb</code> [<code>av</code>] [<code>P</code> <code>v4</code></p>
</dd>
<dt class="hdlist1">| <code>v6</code>]</dt>
<dd>
<p>+
+
::tcpb
+
+
::tcpb
+
Filters and displays tcpb objects. If no address is specified, all
connections are walked, otherwise only the specified tcpb is
filtered/displayed. Specifying <code>a</code> filters for only active connections
and <code>P</code> can be used to filter for TCP IPv4 or IPv6 connections. The
<code>tcpb</code> dcmd is intelligent about filtering TCP connections, and if a
IPv6 TCP connection is in a state that would still facilitate a IPv4
connection, the <code>P</code> filter considers the connection as both IPv4 and
IPv6 in much the same way that <code>::netstat</code> does. If the dcmd is not
being used as a filter and the <code>v</code> option is specified, then the
output of the dcmd will be verbose.</p>
</dd>
</dl>
</div>
<div id="walkers-6" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ar</dt>
<dd>
<p>+
+
+
+
+
Given the address of an ar, this walker walks all ar objects from the
given ar to the final ar. If no address is specified, all ar objects
are walked.</p>
</dd>
<dt class="hdlist1">icmp</dt>
<dd>
<p>+
+
+
+
+
Given the address of an icmp, this walker walks all icmp objects from
the given icmp to the final icmp. If no address is specified, all icmp
objects are walked.</p>
</dd>
<dt class="hdlist1">ill</dt>
<dd>
<p>+
+
+
+
+
Given the address of an interface link layer structure (ill), this
walker walks all ill objects from the given ill to the final. If no
address is specified, all ill objects are walked.</p>
</dd>
<dt class="hdlist1">ipc</dt>
<dd>
<p>+
+
+
+
+
Given the address of an ipc, this walker walks all ipc objects from
the given ipc to the final ipc. If no address is specified, all ipc
objects are walked.</p>
</dd>
<dt class="hdlist1">mi</dt>
<dd>
<p>+
+
+
+
+
Given the address of a MI_O, walk all the MI_O&#8217;s in this MI.</p>
</dd>
<dt class="hdlist1">sonode</dt>
<dd>
<p>+
+
+
+
+
Given the address of a AF_UNIX sonode, walk the associated list of
AF_UNIX sonodes beginning with the given sonode. If no address is
specified, this walker walks the list of all AF_UNIX sockets.</p>
</dd>
<dt class="hdlist1">tcpb</dt>
<dd>
<p>+
+
+
+
+
Given the address of a tcpb, this walker walks all TCP connections
from the given tcpb to the final TCP connection. If no address is
specified, all tcpb objects are walked.</p>
</dd>
<dt class="hdlist1">udp</dt>
<dd>
<p>+
+
+
+
+
Given the address of a udp, this walker walks all udp objects from the
given udp to the final udp. If no address is specified, all udp
objects are walked.</p>
</dd>
</dl>
</div>
<div id="files-processes-and-threads" class="paragraph">
<p>==== Files, Processes, and Threads</p>
</div>
<div class="paragraph">
<p>This section describes dcmds and walkers used to format and examine
various fundamental file, process, and thread structures in the illumos
kernel.</p>
</div>
<div id="dcmds-7" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;process&gt; <code>::fd</code> &lt;fd-num&gt;</dt>
<dd>
<p>Files, Processes, and Threads
+
+
::fd
+
+
::fd
+
Print the <code>file_t</code> address corresponding to the file descriptor
&lt;fd-num&gt; associated with the specified process. The process is
specified using the virtual address of its <code>proc_t</code> structure.</p>
</dd>
<dt class="hdlist1"><em>thread</em> <code>::findstack</code> [<em>command</em>]</dt>
<dd>
<p>Files, Processes, and Threads
+
+
::findstack
+
+
::findstack
+
Print the stack trace associated with the given kernel thread,
identified by the virtual address of its <code>kthread_t</code> structure.
The dcmd employs several different algorithms to locate the
appropriate stack backtrace. If an optional command string is
specified, the dot variable is reset to the frame pointer address of
the topmost stack frame, and the specified command is evaluated as if
it had been typed at the command line. The default command string is
“<code>&lt;.$C0</code>”; that is, print a stack trace including frame pointers
but no arguments.</p>
</dd>
<dt class="hdlist1"><code>::pgrep</code> [<code>x</code>] [<code>n</code>|<code>o</code>] &lt;regexp&gt;</dt>
<dd>
<p>Files, Processes, and Threads
+
+
::pgrep
+
+
::pgrep
+
Display process information for processes whose name matches the
&lt;regexp&gt; regular expression pattern. The <code>::pgrep</code> dcmd is
similar to the <code>pgrep(1)</code> command. The <code>::pgrep</code> dcmd is used to
pattern match against all processes. When the <code>n</code> option is used,
display only the newest process that matches the pattern. When the <code>o</code>
option is used, display only the oldest process that matches the
pattern. When the <code>x</code> option is used, display only those processes
whose names are exactly the same as the search pattern.
+
In <code>kmdb(1)</code>, the &lt;regexp&gt; used with <code>::pgrep</code> must be a plain
alpha-numeric text string.</p>
</dd>
<dt class="hdlist1"><em>pid</em> <code>::pid2proc</code></dt>
<dd>
<p>Files, Processes, and Threads
+
+
::pid2proc
+
+
::pid2proc
+
Print the <code>proc_t</code> address corresponding to the specified PID.
Recall that MDB&#8217;s default base is hexadecimal, so decimal PIDs
obtained using <code>pgrep(1)</code> or <code>ps(1)</code> should be prefixed with <code>0t</code>.</p>
</dd>
<dt class="hdlist1">&lt;process&gt; <code>::pmap</code> [<code>q</code>]</dt>
<dd>
<p>Files, Processes, and Threads
+
+
::pmap
+
+
::pmap
+
Print the memory map of the process indicated by the given process
address. The dcmd displays output using a format similar to <code>pmap(1)</code>.
If the <code>q</code> option is present, the dcmd displays an abbreviated form of
its output that requires less processing time.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::ps</code> [<code>fltTP</code>]</dt>
<dd>
<p>Files, Processes, and Threads
+
+
::ps
+
+
::ps
+
Print a summary of the information related to the specified process,
or all active system processes, similar to <code>ps(1)</code>. If the <code>f</code> option
is specified, the full command name and initial arguments are printed.
If the <code>l</code> option is specified, the LWPs associated with each process
are printed. If the <code>t</code> option is specified, the kernel threads
associated with each process LWP are printed. If the <code>T</code> option is
specified, the task ID associated with each process is displayed. If
the <code>P</code> option is specified, the project ID associated with each
process is displayed.</p>
</dd>
<dt class="hdlist1"><code>::ptree</code></dt>
<dd>
<p>Files, Processes, and Threads
+
+
::ptree
+
+
::ptree
+
Print a process tree, with child processes indented from their
respective parent processes. The dcmd displays output using a format
similar to <code>ptree(1)</code>.</p>
</dd>
<dt class="hdlist1"><code>address ::task</code></dt>
<dd>
<p>Files, Processes, and Threads
+
+
::task
+
+
::task
+
Print a list of the active kernel task structures and their associated
ID numbers and attributes. The process task ID is described in more
detail in <code>settaskid</code>(2).</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::thread</code> [<code>bdfimps</code>]</dt>
<dd>
<p>Files, Processes, and Threads
+
+
::thread
+
+
::thread
+
Display properties of the specified kernel <code>kthread_t</code> structure.
If no <code>kthread_t</code> address is specified, the properties of all
kernel threads are displayed. The dcmd options are used to control
which output columns are shown. If no options are present, the <code>i</code>
option is enabled by default. If the <code>b</code> option is present,
information relating to the thread&#8217;s turnstile and blocking
synchronization object is shown. If the <code>d</code> option is present, the
thread&#8217;s dispatcher priority, binding, and last dispatch time is
shown. If the <code>f</code> option is present, threads whose state is
TS_FREE are elided from the output. If the <code>i</code> option is present
(the default), thread state, flags, priority, and interrupt
information is shown. If the <code>m</code> option is present, all of the other
output options are merged together on to a single output line. If the
<code>p</code> option is present, the thread&#8217;s process, LWP, and credential
pointers are displayed. If the <code>s</code> option is present, the thread&#8217;s
signal queue and masks of pending and held signals are shown.</p>
</dd>
<dt class="hdlist1">&lt;vnode&gt; <code>::whereopen</code></dt>
<dd>
<p>Files, Processes, and Threads
+
+
::whereopen
+
+
::whereopen
+
Given a <code>vnode_t</code> address, print the <code>proc_t</code> addresses of all
processes that have this vnode currently open in their file table.</p>
</dd>
</dl>
</div>
<div id="walkers-7" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">file</dt>
<dd>
<p>Files, Processes, and Threads
+
+
+
+
+
Given the address of a <code>proc_t</code> structure as a starting point,
iterate over the set of open files (<code>file_t</code> structures)
associated with the specified process. The <code>file_t</code> structure is
defined in <code>&lt;sys/file.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">proc</dt>
<dd>
<p>Files, Processes, and Threads
+
+
+
+
+
Iterate over the active process (<code>proc_t</code>) structures. This
structure is defined in <code>&lt;sys/proc.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">task</dt>
<dd>
<p>Files, Processes, and Threads
+
+
+
+
+
Given a task pointer, iterate over the list of <code>proc_t</code> structures
for processes that are members of the given task.</p>
</dd>
<dt class="hdlist1">thread</dt>
<dd>
<p>Files, Processes, and Threads
+
+
+
+
+
Iterate over a set of kernel thread (<code>kthread_t</code>) structures. If
the global walk is invoked, all kernel threads are returned by the
walker. If a local walk is invoked using a <code>proc_t</code> address as the
starting point, the set of threads associated with the specified
process is returned. The <code>kthread_t</code> structure is defined in
<code>&lt;sys/thread.h&gt;</code>.</p>
</dd>
</dl>
</div>
<div id="synchronization-primitives" class="paragraph">
<p>==== Synchronization Primitives</p>
</div>
<div class="paragraph">
<p>This section describes dcmds and walkers used to examine particular
kernel synchronization primitives. The semantics of each primitive are
discussed in the corresponding (9F) section of the manual pages.</p>
</div>
<div id="dcmds-8" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;rwlock&gt; <code>::rwlock</code></dt>
<dd>
<p>Synchronization Primitives
+
+
::rwlock
+
+
::rwlock
+
Given the address of a readers-writers lock (see <code>rwlock(9F)</code>),
display the current state of the lock and the list of waiting threads.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::sobj2ts</code></dt>
<dd>
<p>Synchronization Primitives
+
+
::sobj2ts
+
+
::sobj2ts
+
Convert the address of a synchronization object to the address of the
corresponding turnstile and print the turnstile address.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::turnstile</code></dt>
<dd>
<p>Synchronization Primitives
+
+
::turnstile
+
+
::turnstile
+
Display the properties of the specified <code>turnstile_t</code>. If no
<code>turnstile_t</code> address is specified, the dcmd displays the
properties of all turnstiles.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::wchaninfo</code> [<code>v</code>]</dt>
<dd>
<p>Synchronization Primitives
+
+
::wchaninfo
+
+
::wchaninfo
+
Given the address of a condition variable (see <code>condvar(9F)</code>) or
semaphore (see <code>semaphore(9F)</code>), display the current number of waiters
on this object. If no explicit address is specified, display all such
objects that have waiting threads. If the <code>v</code> option is specified,
display the list of threads that are blocked on each object.</p>
</dd>
</dl>
</div>
<div id="walkers-8" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">blocked</dt>
<dd>
<p>Synchronization Primitives
+
+
+
+
+
Given the address of a synchronization object (such as a <code>mutex(9F)</code>
or <code>rwlock(9F)</code>), iterate over the list of blocked kernel threads.</p>
</dd>
<dt class="hdlist1">wchan</dt>
<dd>
<p>Synchronization Primitives
+
+
+
+
+
Given the address of a condition variable (see <code>condvar(9F)</code>) or
semaphore (see <code>semaphore(9F)</code>), iterate over the list of blocked
kernel threads.</p>
</dd>
</dl>
</div>
<div id="cyclics" class="paragraph">
<p>==== Cyclics</p>
</div>
<div class="paragraph">
<p>The cyclic subsystem is a low-level kernel subsystem that provides high
resolution, per-CPU interval timer facilities to other kernel services
and programming interfaces.</p>
</div>
<div id="dcmds-9" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::cycinfo</code> [<code>vV</code>]</dt>
<dd>
<p>+
+
::cycinfo
+
+
::cycinfo
+
Display the cyclic subsystem per-CPU state for each CPU. If the <code>v</code>
option is present, a more verbose display is shown. If the <code>V</code> option
is present, an even more verbose display than <code>v</code> is shown.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::cyclic</code></dt>
<dd>
<p>+
+
::cyclic
+
+
::cyclic
+
Format and display the <code>cyclic_t</code> at the specified address.</p>
</dd>
<dt class="hdlist1"><code>::cyccover</code></dt>
<dd>
<p>+
+
::cyccover
+
+
::cyccover
+
Display cyclic subsystem code coverage information. This information
is available only in a DEBUG kernel.</p>
</dd>
<dt class="hdlist1"><code>::cyctrace</code></dt>
<dd>
<p>+
+
::cyctrace
+
+
::cyctrace
+
Display cyclic subsystem trace information. This information is
available only in a DEBUG kernel.</p>
</dd>
</dl>
</div>
<div id="walkers-9" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">cyccpu</dt>
<dd>
<p>+
+
+
+
+
Iterate over the per-CPU <code>cyc_cpu_t</code> structures. This
structure is defined in <code>&lt;sys/cyclic_impl.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">cyctrace</dt>
<dd>
<p>+
+
+
+
+
Iterate over the cyclic trace buffer structures. This information is
only available in a DEBUG kernel.</p>
</dd>
</dl>
</div>
<div id="task-queues" class="paragraph">
<p>==== Task Queues</p>
</div>
<div class="paragraph">
<p>The task queue subsystem provides general-purpose asynchronous task
scheduling for a variety of clients in the kernel.</p>
</div>
<div id="dcmds-10" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>address</em> <code>::taskq_entry</code></dt>
<dd>
<p>Task Queues
+
+
::taskq_entry
+
+
::taskq_entry
+
Print the contents of the specified struct <code>taskq_entry</code>.</p>
</dd>
</dl>
</div>
<div id="walkers-10" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">taskq_entry</dt>
<dd>
<p>Task Queues
+
+
taskq_entry
+
+
taskq_entry
+
Given the addresss of a <code>taskq</code> structure, iterate over the list of
<code>taskq_entry</code> structures.</p>
</dd>
</dl>
</div>
<div id="error-queues" class="paragraph">
<p>==== Error Queues</p>
</div>
<div class="paragraph">
<p>The error queue subsystem provides general-purpose asynchronous error
event processing for platform-specific error handling code.</p>
</div>
<div id="dcmds-11" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[<em>address</em>] <code>::errorq</code></dt>
<dd>
<p>Error Queues
+
+
::errorq
+
+
::errorq
+
Display a summary of information relating to the specified error
queue. If no address is given, display information relating to all
system error queues. The address, name, queue length, and data element
size for each queue are displayed, along with various queue
statistics.</p>
</dd>
</dl>
</div>
<div id="walkers-11" class="paragraph">
<p>===== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">errorq</dt>
<dd>
<p>Error Queues
+
+
+
+
+
Walk the list of system error queues and return the address of each
individual error queue.</p>
</dd>
<dt class="hdlist1">errorq_data</dt>
<dd>
<p>Error Queues
+
+
errorq_data
+
+
errorq_data
+
Given the address of an error queue, return the address of each
pending error event data buffer.</p>
</dd>
</dl>
</div>
<div id="configuration" class="paragraph">
<p>==== Configuration</p>
</div>
<div class="paragraph">
<p>This section describes dcmds that can be used to examine system
configuration data.</p>
</div>
<div id="dcmds-12" class="paragraph">
<p>===== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::system</code></dt>
<dd>
<p>+
+
::system
+
+
::system
+
Display the contents of the <code>system</code>(4) configuration file at the time
the kernel parsed the file during system initialization.</p>
</dd>
</dl>
</div>
<div id="interprocess-communication-debugging-support-ipc" class="paragraph">
<p>=== Interprocess Communication Debugging Support (<code>ipc</code>)</p>
</div>
<div class="paragraph">
<p>The <code>ipc</code> module provides debugging support for the implementation of
the message queue, semaphore, and shared memory interprocess
communication primitives.</p>
</div>
<div id="dcmds-13" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::ipcs</code> [<code>l</code>]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::ipcs
+
+
::ipcs
+
Display a listing of system-wide IPC identifiers, corresponding to
known message queues, semaphores, and shared memory segments. If the
<code>l</code> option is specified, a longer listing of information is shown.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::msg</code> [<code>l</code>] [<code>t</code> &lt;type&gt;]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::msg
+
+
::msg
+
Display the properties of the specified message queue element (struct
<code>msg</code>). If the <code>l</code> option is present, the raw contents of the message
are displayed in hexadecimal and ASCII. If the <code>t</code> option is present,
it can be used to filter the output and only display messages of the
specified type. This can be useful when piping the output of the
<code>msgqueue</code> walker to <code>::msg</code>.</p>
</dd>
<dt class="hdlist1">&lt;id&gt; <code>::msqid</code> [<code>k</code>]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::msqid
+
+
::msqid
+
Convert the specified message queue IPC identifier to a pointer to the
corresponding kernel implementation structure and print the address of
this kernel structure. If the <code>k</code> option is present, the &lt;id&gt;
is instead interpreted as a message queue key to match (see
<code>msgget</code>(2)).</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::msqid_ds</code> [<code>l</code>]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::msqid_ds
+
+
::msqid_ds
+
Print the specified <code>msqid_ds</code> structure or a table of the active
<code>msqid_ds</code> structures (message queue identifiers). If the <code>l</code>
option is specified, a longer listing of information is displayed.</p>
</dd>
<dt class="hdlist1">&lt;id&gt; <code>::semid</code> [<code>k</code>]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::semid
+
+
::semid
+
Convert the specified semaphore IPC identifier to a pointer to the
corresponding kernel implementation structure and print the address of
this kernel structure. If the <code>k</code> option is present, the &lt;id&gt;
is instead interpreted as a semaphore key to match (see <code>semget</code>(2)).</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::semid_ds</code> [<code>l</code>]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::semid_ds
+
+
::semid_ds
+
Print the specified <code>semid_ds</code> structure or a table of the active
<code>semid_ds</code> structures (semaphore identifiers). If the <code>l</code> option
is specified, a longer listing of information is displayed.</p>
</dd>
<dt class="hdlist1">&lt;id&gt; <code>::shmid</code> [<code>k</code>]</dt>
<dd>
<p>Interprocess Communication Debugging Support (
+
+
)
+
+
::shmid
+
+
::shmid
+
Convert the specified shared memory IPC identifier to a pointer to the
corresponding kernel implementation structure and print the address of
this kernel structure. If the <code>k</code> option is present, the &lt;id&gt;
is instead interpreted as a shared memory key to match (see
<code>shmget</code>(2)).</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::shmid_ds</code> [<code>l</code>]</dt>
<dd>
<p>+
::shmid_ds
+
Interprocess Communication Debugging Support (
+
+
)
+
+
::shmid_ds
+
Print the specified <code>shmid_ds</code> structure or a table of the active
<code>shmid_ds</code> structures (shared memory segment identifiers). If the
<code>l</code> option is specified, a longer listing of information is displayed.</p>
</dd>
</dl>
</div>
<div id="walkers-12" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">msg</dt>
<dd>
<p>+
+
Interprocess Communication Debugging Support (
+
+
)
+
+
+
Walk the active <code>msqid_ds</code> structures corresponding to message
queue identifiers. This structure is defined in <code>&lt;sys/msg.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">msgqueue</dt>
<dd>
<p>+
+
Interprocess Communication Debugging Support (
+
+
)
+
+
+
Iterate over the <code>message</code> structures that are currently enqueued on
the specified message queue.</p>
</dd>
<dt class="hdlist1">sem</dt>
<dd>
<p>+
+
Interprocess Communication Debugging Support (
+
+
)
+
+
+
Walk the active <code>semid_ds</code> structures corresponding to semaphore
identifiers. This structure is defined in <code>&lt;sys/sem.h&gt;</code>.</p>
</dd>
<dt class="hdlist1">shm</dt>
<dd>
<p>+
+
Interprocess Communication Debugging Support (
+
+
)
+
+
+
Walk the active <code>shmid_ds</code> structures corresponding to shared
memory segment identifiers. This structure is defined in
<code>&lt;sys/shm.h&gt;</code>.</p>
</dd>
</dl>
</div>
<div id="loopback-file-system-debugging-support-lofs" class="paragraph">
<p>=== Loopback File System Debugging Support (<code>lofs</code>)</p>
</div>
<div class="paragraph">
<p>The <code>lofs</code> module provides debugging support for the <code>lofs(4FS)</code> file
system.</p>
</div>
<div id="dcmds-14" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[<em>address</em>] <code>::lnode</code></dt>
<dd>
<p>+
::lnode
+
Loopback File System Debugging Support
+
+
::lnode
+
Print the specified <code>lnode_t</code>, or a table of the active
<code>lnode_t</code> structures in the kernel.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::lnode2dev</code></dt>
<dd>
<p>+
::lnode2dev
+
Loopback File System Debugging Support (
+
+
)
+
+
::lnode2dev
+
Print the <code>dev_t</code> (<code>vfs_dev</code>) for the underlying loopback
mounted filesystem corresponding to the given <code>lnode_t</code> address.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::lnode2rdev</code></dt>
<dd>
<p>+
::lnode2rdev
+
Loopback File System Debugging Support (
+
+
)
+
+
::lnode2rdev
+
Print the <code>dev_t</code> (<code>li_rdev</code>) for the underlying loopback
mounted file system corresponding to the given <code>lnode_t</code> address.</p>
</dd>
</dl>
</div>
<div id="walkers-13" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">lnode</dt>
<dd>
<p>+
+
Loopback File System Debugging Support (
+
+
)
+
+
+
Walk the active <code>lnode_t</code> structures in the kernel. This structure
is defined in <code>&lt;sys/fs/lofs_node.h&gt;</code>.</p>
</dd>
</dl>
</div>
<div id="internet-protocol-module-debugging-support-ip" class="paragraph">
<p>=== Internet Protocol Module Debugging Support (<code>ip</code>)</p>
</div>
<div class="paragraph">
<p>The <code>ip</code> module provides debugging support for the <code>ip(4P)</code> driver</p>
</div>
<div id="dcmds-15" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[<em>address</em>] <code>::ire</code> [<code>q</code>]</dt>
<dd>
<p>+
::ire
+
Internet Protocol Module Debugging Support (
+
+
)
+
+
::ire
+
Print the specified <code>ire_t</code>, or a table of the active <code>ire_t</code>
structures in the kernel. If the <code>q</code> flag is specified, the send and
receive queue pointers are printed instead of the source and
destination addresses.</p>
</dd>
</dl>
</div>
<div id="walkers-14" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ire</dt>
<dd>
<p>+
+
Internet Protocol Module Debugging Support (
+
+
)
+
+
+
Walk the active <code>ire</code> (Internet Route Entry) structures in the kernel.
This structure is defined in <code>&lt;inet/ip.h&gt;</code>.</p>
</dd>
</dl>
</div>
<div id="kernel-runtime-link-editor-debugging-support-krtld" class="paragraph">
<p>=== Kernel Runtime Link Editor Debugging Support (<code>krtld</code>)</p>
</div>
<div class="paragraph">
<p>This section describes the debugging support for the kernel runtime link
editor, which is responsible for loading kernel modules and drivers.</p>
</div>
<div id="dcmds-16" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[<em>address</em>] <code>::modctl</code></dt>
<dd>
<p>+
::modctl
+
Kernel Runtime Link Editor Debugging Support
+
+
::modctl
+
Print the specified <code>modctl</code>, or a table of the active <code>modctl</code>
structures in the kernel.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::modhdrs</code></dt>
<dd>
<p>+
::modhdrs
+
Kernel Runtime Link Editor Debugging Support (
+
+
)
+
+
::modhdrs
+
Given the address of a <code>modctl</code> structure, print the module&#8217;s ELF
executable header and section headers.</p>
</dd>
<dt class="hdlist1"><code>::modinfo</code></dt>
<dd>
<p>+
::modinfo
+
Kernel Runtime Link Editor Debugging Support (
+
+
)
+
+
::modinfo
+
Print information about the active kernel modules, similar to the
output of the <code>/usr/sbin/modinfo</code> command.</p>
</dd>
</dl>
</div>
<div id="walkers-15" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">modctl</dt>
<dd>
<p>+
+
Kernel Runtime Link Editor Debugging Support (
+
+
)
+
+
+
Walk the list of active modctl structures in the kernel. This
structure is defined in <code>&lt;sys/modctl.h&gt;</code>.</p>
</dd>
</dl>
</div>
<div id="usb-framework-debugging-support-uhci" class="paragraph">
<p>=== USB Framework Debugging Support (<code>uhci</code>)</p>
</div>
<div class="paragraph">
<p>The <code>uchi</code> module provides debugging support for the host controller
interface portion of the Universal Serial Bus (USB) framework.</p>
</div>
<div id="dcmds-17" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>address</em> <code>::uhci_qh</code> [<code>bd</code>]</dt>
<dd>
<p>+
::uhci_qh
+
USB Framework Debugging Support (
+
+
)
+
+
::uhci_qh
+
Given the address of a USB UHCI controller Queue Head (QH) structure,
print the contents of the structure. If the <code>b</code> option is present
iterate over the <code>link_ptr</code> chain, printing all QHs found. If the
<code>d</code> option is present, iterate over the <code>element_ptr</code> chain,
printing all TDs found.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::uhci_td</code> [<code>d</code>]</dt>
<dd>
<p>+
::uhci_td
+
USB Framework Debugging Support (
+
+
)
+
+
::uhci_td
+
Given the address of a USB UHCI controller Transaction Descriptor (TD)
structure, print the contents of the structure. Note this only works
for Control and Interrupt TDs. If the <code>d</code> option is present, iterate
over the <code>element_ptr</code> chain, printing all TDs found.</p>
</dd>
</dl>
</div>
<div id="walkers-16" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">uhci_qh</dt>
<dd>
<p>+
uhci_qh
+
USB Framework Debugging Support (
+
+
)
+
+
uhci_qh
+
Given the address of a USB UHCI controller Queue Head (QH) structure,
iterate over the list of such structures.</p>
</dd>
<dt class="hdlist1">uhci_td</dt>
<dd>
<p>+
uhci_td
+
USB Framework Debugging Support (
+
+
)
+
+
uhci_td
+
Given the address of a USB UHCI controller Queue Head Descriptor (TD)
structure, iterate over the list of such structures.</p>
</dd>
</dl>
</div>
<div id="usb-framework-debugging-support-usba" class="paragraph">
<p>=== USB Framework Debugging Support (<code>usba</code>)</p>
</div>
<div class="paragraph">
<p>The <code>usba</code> module provides debugging support for the
platform-independent Universal Serial Bus (USB) framework.</p>
</div>
<div id="dcmds-18" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>::usba_debug_buf</code></dt>
<dd>
<p>+
::usba_debug_buf
+
USB Framework Debugging Support (
+
+
)
+
+
::usba_debug_buf
+
Print the USB debugging information buffer.</p>
</dd>
<dt class="hdlist1"><code>::usba_clear_debug_buf</code></dt>
<dd>
<p>+
::usba_clear_debug_buf
+
USB Framework Debugging Support (
+
+
)
+
+
::usba_clear_debug_buf
+
Empty the USB debugging information buffer.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::usba_device</code> [<code>pv</code>]</dt>
<dd>
<p>+
::usba_device
+
USB Framework Debugging Support (
+
+
)
+
+
::usba_device
+
Given the address of a <code>usba_device</code> structure, print summary
information. If no address is supplied, this dcmd walks the global
list of <code>usba_device</code> structures. If the <code>p</code> option is present,
also list information for all open pipes on this device. If the <code>v</code>
option is present, list verbose information for each device.</p>
</dd>
<dt class="hdlist1"><em>address</em> <code>::usb_pipe_handle</code></dt>
<dd>
<p>+
::usb_pipe_handle
+
USB Framework Debugging Support (
+
+
)
+
+
::usb_pipe_handle
+
Given the address of a USB pipe handle structure (struct
<code>usba_ph_impl</code>), print summary information for this handle.</p>
</dd>
</dl>
</div>
<div id="walkers-17" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">usba_list_entry</dt>
<dd>
<p>+
usba_list_entry
+
USB Framework Debugging Support (
+
+
)
+
+
usba_list_entry
+
Given the address of a <code>usba_list_entry</code> structure, iterate
over the chain of such structures.</p>
</dd>
<dt class="hdlist1">usba_device</dt>
<dd>
<p>+
usba_device
+
USB Framework Debugging Support (
+
+
)
+
+
usba_device
+
Walk the global list of <code>usba_device_t</code> structures.</p>
</dd>
<dt class="hdlist1">usb_pipe_handle</dt>
<dd>
<p>+
usb_pipe_handle
+
USB Framework Debugging Support (
+
+
)
+
+
usb_pipe_handle
+
Given a <code>usba_device_t</code> address, walk USB pipe handles.</p>
</dd>
</dl>
</div>
<div id="x86-platform-debugging-support-unix" class="paragraph">
<p>=== x86 Platform Debugging Support (<code>unix</code>)</p>
</div>
<div class="paragraph">
<p>These dcmds and walkers are specific to x86 platforms.</p>
</div>
<div id="dcmds-19" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="paragraph">
<p>[<em>cpuid</em> | <em>address</em>] <code>::ttrace</code>
[<code>x</code>]::
 <br>
  ::ttrace
 <br>
  Platform Debugging Support
 <br>
 <br>
  ::ttrace
 <br>
  Display trap trace records in reverse chronological order. The trap
  trace facility is available only in DEBUG kernels. If an explicit dot
  value is specified, this is interpreted as either a CPU ID number or a
  trap trace record address, depending on the precise value. If a CPU ID
  is specified, the output is restricted to the buffer from that CPU. If
  a record address is specified, only that record is formatted. If the
  <code>x</code> option is specified, the complete raw record is displayed.</p>
</div>
<div id="walkers-18" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ttrace</dt>
<dd>
<p>+
+
Platform Debugging Support
+
+
+
Walk the list of trap trace record addresses in reverse chronological
order. The trap trace facility is available only in DEBUG kernels.</p>
</dd>
</dl>
</div>
<div id="sun4u-platform-debugging-support-unix" class="paragraph">
<p>=== sun4u Platform Debugging Support (<code>unix</code>)</p>
</div>
<div class="paragraph">
<p>These dcmds and walkers are specific to the SPARC sun4u platform.</p>
</div>
<div id="dcmds-20" class="paragraph">
<p>==== dcmds</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[<em>address</em>] <code>::softint</code></dt>
<dd>
<p>+
::softint
+
Platform Debugging Support
+
+
::softint
+
Display the soft interrupt vector structure at the specified address,
or display all the active soft interrupt vectors. The pending count,
PIL, argument, and handler function for each structure is displayed.</p>
</dd>
<dt class="hdlist1"><code>::ttctl</code></dt>
<dd>
<p>+
::ttctl
+
Platform Debugging Support
+
+
::ttctl
+
Display trap trace control records. The trap trace facility is
available only in DEBUG kernels.</p>
</dd>
<dt class="hdlist1">[<em>cpuid</em>] <code>::ttrace</code> [<code>x</code>]</dt>
<dd>
<p>+
::ttrace
+
Platform Debugging Support
+
+
::ttrace
+
Display trap trace records in reverse chronological order. The trap
trace facility is available only in DEBUG kernels. If an explicit dot
value is specified, this is interpreted as a CPU ID number, and the
output is restricted to the buffer from that CPU. If the <code>x</code> option is
specified, the complete raw record is displayed.</p>
</dd>
<dt class="hdlist1">[<em>address</em>] <code>::xc_mbox</code></dt>
<dd>
<p>+
::xc_mbox
+
Platform Debugging Support
+
+
::xc_mbox
+
Display the cross-call mailbox at the specified address, or format all
the cross-call mailboxes that have pending requests.</p>
</dd>
<dt class="hdlist1"><code>::xctrace</code></dt>
<dd>
<p>+
::xctrace
+
Platform Debugging Support
+
+
::xctrace
+
Format and display cross-call trace records in reverse chronological
order that are related to CPU cross-call activity. The cross-call
trace facility is available only in DEBUG kernels.</p>
</dd>
</dl>
</div>
<div id="walkers-19" class="paragraph">
<p>==== Walkers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">softint</dt>
<dd>
<p>+
+
Platform Debugging Support
+
+
+
Iterate over the soft interrupt vector table entries.</p>
</dd>
<dt class="hdlist1">ttrace</dt>
<dd>
<p>+
+
Platform Debugging Support
+
+
+
Iterate over the trap trace record addresses in reverse chronological
order. The trap trace facility is only available in DEBUG kernels.</p>
</dd>
<dt class="hdlist1">xc_mbox</dt>
<dd>
<p>+
xc_mbox
+
Platform Debugging Support
+
+
xc_mbox
+
Iterate over the mailboxes used for CPU handshake and cross-call
(x-call) requests.</p>
</dd>
</dl>
</div>
<div id="debugging-with-the-kernel-memory-allocator" class="paragraph">
<p>== Debugging With the Kernel Memory Allocator</p>
</div>
<div class="paragraph">
<p>The illumos kernel memory (kmem) allocator provides a powerful set of
debugging features that can facilitate analysis of a kernel crash dump.
This chapter discusses these debugging features, and the MDB dcmds and
walkers designed specifically for the allocator. Bonwick (see
<a href="#related-books-and-papers">Related Books and Papers</a>) provides an overview of the
principles of the allocator itself. Refer to the header file
<code>&lt;sys/kmem_impl.h&gt;</code> for the definitions of allocator data
structures. The kmem debugging features can be enabled on a production
system to enhance problem analysis, or on development systems to aid in
debugging kernel software and device drivers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MDB exposes kernel implementation details that are subject to change at
any time. This guide reflects the illumos kernel implementation as of
the date of publication of this guide. Information provided in this
guide about the kernel memory allocator might not be correct or
applicable to past or future illumos releases.</p>
</div>
<div class="sect2">
<h3 id="getting-started-creating-a-sample-crash-dump"><a class="anchor" href="#getting-started-creating-a-sample-crash-dump"></a>9.1. Getting Started: Creating a Sample Crash Dump</h3>
<div class="paragraph">
<p>This section shows you how to obtain a sample crash dump, and how to
invoke MDB in order to examine it.</p>
</div>
<div class="sect3">
<h4 id="setting-kmem_flags"><a class="anchor" href="#setting-kmem_flags"></a>9.1.1. Setting <code>kmem_flags</code></h4>
<div class="paragraph">
<p>The kernel memory allocator contains many advanced
debugging features, but these are not enabled by default because they
can cause performance degradation. In order to follow the examples in
this guide, you should turn on these features. You should enable these
features only on a test system, as they can cause performance
degradation or expose latent problems.</p>
</div>
<div class="paragraph">
<p>The allocator&#8217;s debugging functionality is controlled by the
<code>kmem_flags</code> tunable. To get started, make sure <code>kmem_flags</code> is
set properly:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mdb -k
&gt; kmem_flags/X
kmem_flags:
kmem_flags:     f</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>kmem_flags</code> is not set to “<code>f</code>”, you should add the line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>set kmem_flags=0xf</pre>
</div>
</div>
<div class="paragraph">
<p>to <code>/etc/system</code> and reboot the system. When the system reboots, confirm
that <code>kmem_flags</code> is set to “<code>f</code>”. Remember to remove your
<code>/etc/system</code> modifications before returning this system to production
use.</p>
</div>
</div>
<div class="sect3">
<h4 id="forcing-a-crash-dump"><a class="anchor" href="#forcing-a-crash-dump"></a>9.1.2. Forcing a Crash Dump</h4>
<div class="paragraph">
<p>The next step is to make sure crash dumps are properly
configured. First, confirm that <code>dumpadm</code> is configured to save kernel
crash dumps and that <code>savecore</code> is enabled. See <code>dumpadm(8)</code> for more
information on crash dump parameters.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># dumpadm
              Dump content: kernel pages
               Dump device: /dev/dsk/c0t0d0s1 (swap)
        Savecore directory: /var/crash/testsystem
          Savecore enabled: yes</pre>
</div>
</div>
<div class="paragraph">
<p>Next, reboot the system using the <code>d</code> flag to
<code>reboot(8)</code>, which forces the kernel to panic and save a crash dump.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># reboot -d
Sep 28 17:51:18 testsystem reboot: rebooted by root

panic[cpu0]/thread=70aacde0: forced crash dump initiated at user request

401fbb10 genunix:uadmin+55c (1, 1, 0, 6d700000, 5, 0)
  %l0-7: 00000000 00000000 00000000 00000000 00000000 00000000 00000000
...</pre>
</div>
</div>
<div class="paragraph">
<p>When the system reboots, make sure the crash dump succeeded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cd /var/crash/testsystem
$ ls
bounds    unix.0    unix.1    vmcore.0  vmcore.1</pre>
</div>
</div>
<div class="paragraph">
<p>If the dump is missing from your dump directory, it
could be that the partition is out of space. You can free up space and
run <code>savecore(8)</code> manually as root to subsequently save the dump. If
your dump directory contains multiple crash dumps, the one you just
created will be the <code>unix.[n]</code> and <code>vmcore.[n]</code> pair
with the most recent modification time.</p>
</div>
</div>
<div class="sect3">
<h4 id="starting-mdb"><a class="anchor" href="#starting-mdb"></a>9.1.3. Starting MDB</h4>
<div class="paragraph">
<p>Now, run <code>mdb</code> on the crash dump you created, and check its status:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mdb unix.1 vmcore.1
Loading modules: [ unix krtld genunix ip nfs ipc ]
&gt; ::status
debugging crash dump vmcore.1 (32-bit) from testsystem
operating system: 5.10 Generic (sun4u)
panic message: forced crash dump initiated at user request</pre>
</div>
</div>
<div class="paragraph">
<p>In the examples presented in this guide, a crash dump from a 32-bit
kernel is used. All of the techniques presented here are applicable to a
64-bit kernel, and care has been taken to distinguish pointers (sized
differently on 32- and 64-bit systems) from fixed-sized quantities,
which are invariant with respect to the kernel data model.</p>
</div>
<div class="paragraph">
<p>An UltraSPARC workstation was used to generate the example presented.
Your results can vary depending on the architecture and model of system
you use.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="allocator-basics"><a class="anchor" href="#allocator-basics"></a>9.2. Allocator Basics</h3>
<div class="paragraph">
<p>The kernel memory allocator&#8217;s job is to parcel out regions of virtual
memory to other kernel subsystems (these are commonly called <em>clients</em>).
This section explains the basics of the allocator&#8217;s operation and
introduces some terms used later in this guide.</p>
</div>
<div class="sect3">
<h4 id="buffer-states"><a class="anchor" href="#buffer-states"></a>9.2.1. Buffer States</h4>
<div class="paragraph">
<p>The functional domain of the kernel memory allocator is the set of
<em>buffers</em> of virtual memory that make up the kernel heap. These buffers
are grouped together into sets of uniform size and purpose, known as
<em>caches</em>. Each cache contains a set of buffers. Some of these buffers
are currently <em>free</em>, which means that they have not yet been allocated
to any client of the allocator. The remaining buffers are <em>allocated</em>,
which means that a pointer to that buffer has been provided to a client
of the allocator. If no client of the allocator holds a pointer to an
allocated buffer, this buffer is said to be <em>leaked</em>, because it cannot
be freed. Leaked buffers indicate incorrect code that is wasting kernel
resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="transactions"><a class="anchor" href="#transactions"></a>9.2.2. Transactions</h4>
<div class="paragraph">
<p>A kmem <em>transaction</em> is a transition on a buffer between the allocated
and free states. The allocator can verify that the state of a buffer is
valid as part of each transaction. Additionally, the allocator has
facilities for logging transactions for post-mortem examination.</p>
</div>
</div>
<div class="sect3">
<h4 id="sleeping-and-non-sleeping-allocations"><a class="anchor" href="#sleeping-and-non-sleeping-allocations"></a>9.2.3. Sleeping and Non-Sleeping Allocations</h4>
<div class="paragraph">
<p>Unlike the Standard C Library&#8217;s <code>malloc(3C)</code> function,
the kernel memory allocator can block (or <em>sleep</em>), waiting until enough
virtual memory is available to satisfy the client&#8217;s request. This is
controlled by the <code>flag</code> parameter to <code>kmem_alloc(9F)</code>. A call to
<code>kmem_alloc(9F)</code> which has the <code>KM_SLEEP</code> flag set can never
fail; it will block forever waiting for resources to become available.</p>
</div>
</div>
<div class="sect3">
<h4 id="kernel-memory-caches"><a class="anchor" href="#kernel-memory-caches"></a>9.2.4. Kernel Memory Caches</h4>
<div class="paragraph">
<p>The kernel memory allocator divides the memory it manages
into a set of <em>caches</em>. All allocations are supplied from these caches,
which are represented by the <code>kmem_cache_t</code> data structure. Each
cache has a fixed <em>buffer size</em>, which represents the maximum allocation
size satisfied by that cache. Each cache has a string name indicating
the type of data it manages.</p>
</div>
<div class="paragraph">
<p>Some kernel memory caches are special
purpose and are initialized to allocate only a particular kind of data
structure. An example of this is the “thread_cache,” which allocates
only structures of type <code>kthread_t</code>. Memory from these caches is
allocated to clients by the <code>kmem_cache_alloc</code> function and
freed by the <code>kmem_cache_free</code> function.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>kmem_cache_alloc</code> and <code>kmem_cache_free</code> are not public
DDI interfaces. Do NOT write code that relies on them, because they are
subject to change or removal in future releases of illumos.</p>
</div>
<div class="paragraph">
<p>Caches whose name begins with “<code>kmem_alloc_</code>”
implement the kernel&#8217;s general memory allocation scheme. These caches
provide memory to clients of <code>kmem_alloc(9F)</code> and
<code>kmem_zalloc(9F)</code>. Each of these caches satisfies requests whose
size is between the buffer size of that cache and the buffer size of the
next smallest cache. For example, the kernel has <code>kmem_alloc_8</code>
and <code>kmem_alloc_16</code> caches. In this case, the
<code>kmem_alloc_16</code> cache handles all client requests for 9-16 bytes
of memory. Remember that the size of each buffer in the
<code>kmem_alloc_16</code> cache is 16 bytes, regardless of the size of the
client request. In a 14 byte request, two bytes of the resulting buffer
are unused, since the request is satisfied from the
<code>kmem_alloc_16</code> cache.</p>
</div>
<div class="paragraph">
<p>The last set of caches are those used internally by the kernel memory
allocator for its own bookkeeping. These include those caches whose
names start with “<code>kmem_magazine_</code>” or “<code>kmem_va_</code>”, the
<code>kmem_slab_cache</code>, the <code>kmem_bufctl_cache</code> and others.</p>
</div>
<div id="kernel-memory-caches-1" class="paragraph">
<p>=== Kernel Memory Caches</p>
</div>
<div class="paragraph">
<p>This section explains how to find and examine kernel
memory caches. You can learn about the various kmem caches on the system
by issuing the <code>::kmastat</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::kmastat
cache                        buf    buf    buf    memory     alloc alloc
name                        size in use  total    in use   succeed  fail
------------------------- ------ ------ ------ --------- --------- -----
kmem_magazine_1                8     24   1020      8192        24     0
kmem_magazine_3               16    141    510      8192       141     0
kmem_magazine_7               32     96    255      8192        96     0
...
kmem_alloc_8                   8   3614   3751     90112   9834113     0
kmem_alloc_16                 16   2781   3072     98304   8278603     0
kmem_alloc_24                 24    517    612     24576    680537     0
kmem_alloc_32                 32    398    510     24576    903214     0
kmem_alloc_40                 40    482    584     32768    672089     0
...
thread_cache                 368    107    126     49152    669881     0
lwp_cache                    576    107    117     73728       182     0
turnstile_cache               36    149    292     16384    670506     0
cred_cache                    96      6     73      8192   2677787     0
...</pre>
</div>
</div>
<div class="paragraph">
<p>If you run <code>::kmastat</code> you get a feel for what a “normal” system looks
like. This will help you to spot excessively large caches on systems
that are leaking memory. The results of <code>::kmastat</code> will vary depending
on the system you are running on, how many processes are running, and so
forth.</p>
</div>
<div class="paragraph">
<p>Another way to list the various kmem caches is with the
<code>::kmem_cache</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::kmem_cache
ADDR     NAME                      FLAG  CFLAG  BUFSIZE  BUFTOTL
70036028 kmem_magazine_1           0020 0e0000        8     1020
700362a8 kmem_magazine_3           0020 0e0000       16      510
70036528 kmem_magazine_7           0020 0e0000       32      255
...
70039428 kmem_alloc_8              020f 000000        8     3751
700396a8 kmem_alloc_16             020f 000000       16     3072
70039928 kmem_alloc_24             020f 000000       24      612
70039ba8 kmem_alloc_32             020f 000000       32      510
7003a028 kmem_alloc_40             020f 000000       40      584
...</pre>
</div>
</div>
<div class="paragraph">
<p>This command is useful because it maps cache names to addresses, and
provides the debugging flags for each cache in the FLAG column. It is
important to understand that the allocator&#8217;s selection of debugging
features is derived on a per-cache basis from this set of flags. These
are set in conjunction with the global <code>kmem_flags</code> variable at
cache creation time. Setting <code>kmem_flags</code> while the system is
running has no effect on the debugging behavior, except for subsequently
created caches (which is rare after boot-up).</p>
</div>
<div class="paragraph">
<p>Next, walk the list of kmem caches directly using MDB&#8217;s
<code>kmem_cache</code> walker:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::walk kmem_cache
...</pre>
</div>
</div>
<div class="paragraph">
<p>This produces a list of pointers that correspond to each
kmem cache in the kernel. To find out about a specific cache, apply the
<code>kmem_cache</code> macro:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x70039928$&lt;kmem_cache
0x70039928:     lock
0x70039928:     owner/waiters
0x70039930:     flags           freelist        offset
                20f             707c86a0        24
0x7003993c:     global_alloc    global_free     alloc_fail
                523             0               0
0x70039948:     hash_shift      hash_mask       hash_table
                5               1ff             70444858
0x70039954:     nullslab
0x70039954:     cache           base            next
                70039928        0               702d5de0
0x70039960:     prev            head            tail
                707c86a0        0               0
0x7003996c:     refcnt          chunks
                -1              0
0x70039974:     constructor     destructor      reclaim
                0               0               0
0x70039980:     private         arena           cflags
                0               104444f8        0
0x70039994:     bufsize         align           chunksize
                24              8               40
0x700399a0:     slabsize        color           maxcolor
                8192            24              32
0x700399ac:     slab_create     slab_destroy    buftotal
                3               0               612
0x700399b8:     bufmax          rescale         lookup_depth
                612             1               0
0x700399c4:     kstat           next            prev
                702c8608        70039ba8        700396a8
0x700399d0:     name    kmem_alloc_24
0x700399f0:     bufctl_cache    magazine_cache  magazine_size
                70037ba8        700367a8        15
...</pre>
</div>
</div>
<div class="paragraph">
<p>Several important fields for debugging include <code>bufsize</code>, <code>flags</code> and
<code>name</code>. The name of the <code>kmem_cache</code> (in this case
“<code>kmem_alloc_24</code>”) indicates its purpose in the system. The
field <code>bufsize</code> indicates the size of each buffer in this cache; in this
case, the cache is used for allocations of size 24 and smaller. <code>flags</code>
indicates what debugging features are turned on for this cache. You can
find the debugging flags listed in <code>&lt;sys/kmem_impl.h&gt;</code>. In
this case <code>flags</code> is <code>0x20f</code>, which is
<code>KMF_AUDIT | KMF_DEADBEEF | KMF_REDZONE | KMF_CONTENTS | KMF_HASH</code>.
This document explains each of the debugging features in subsequent
sections.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  When you are interested in looking at
buffers in a particular cache, you can walk the allocated and freed
buffers in that cache directly:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x70039928::walk kmem
...

&gt; 0x70039928::walk freemem
...</pre>
</div>
</div>
<div class="paragraph">
<p>MDB provides a shortcut to supplying the cache address to the kmem
walker: a specific walker is provided for each kmem cache, and its name
is the same as the name of the cache. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::walk kmem_alloc_24
...

&gt; ::walk thread_cache
...</pre>
</div>
</div>
<div class="paragraph">
<p>Now you know how to iterate over the kernel memory allocator&#8217;s internal
data structures and examine the most important members of the
<code>kmem_cache</code> data structure.</p>
</div>
<div id="detecting-memory-corruption" class="paragraph">
<p>=== Detecting Memory Corruption</p>
</div>
<div class="paragraph">
<p>One of the primary debugging facilities of the allocator
is that it includes algorithms to recognize data corruption quickly.
When corruption is detected, the allocator immediately panics the
system. This section describes how the allocator recognizes data
corruption. You must understand this to be able to debug these problems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Writing past the end of a buffer</p>
</li>
<li>
<p>Accessing uninitialized data</p>
</li>
<li>
<p>Continuing to use a freed buffer</p>
</li>
<li>
<p>Corrupting kernel memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keep these problems in mind as you read the next three sections. They
will help you to understand the allocator&#8217;s design, and enable you to
diagnose problems more efficiently.</p>
</div>
<div id="freed-buffer-checking-0xdeadbeef" class="paragraph">
<p>==== Freed Buffer Checking: <code>0xdeadbeef</code></p>
</div>
<div class="paragraph">
<p>When the <code>KMF_DEADBEEF</code> (<code>0x2</code>) bit is set in the
flags field of a <code>kmem_cache</code>, the allocator tries to make memory
corruption easy to detect by writing a special pattern into all freed
buffers. This pattern is <code>0xdeadbeef</code>. Since a typical region of memory
contains both allocated and freed memory, sections of each kind of block
will be interspersed. The following example is from the
<code>kmem_alloc_24</code> cache:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0x70a9add8:     deadbeef        deadbeef
0x70a9ade0:     deadbeef        deadbeef
0x70a9ade8:     deadbeef        deadbeef
0x70a9adf0:     feedface        feedface
0x70a9adf8:     70ae3260        8440c68e
0x70a9ae00:     5               4ef83
0x70a9ae08:     0               0
0x70a9ae10:     1               bbddcafe
0x70a9ae18:     feedface        139d
0x70a9ae20:     70ae3200        d1befaed
0x70a9ae28:     deadbeef        deadbeef
0x70a9ae30:     deadbeef        deadbeef
0x70a9ae38:     deadbeef        deadbeef
0x70a9ae40:     feedface        feedface
0x70a9ae48:     70ae31a0        8440c54e</pre>
</div>
</div>
<div class="paragraph">
<p>The buffers at <code>0x70a9add8</code> and <code>0x70a9ae28</code> are filled with
<code>0xdeadbeefdeadbeef</code>, which shows that these buffers are free. The
buffer <em>redzones</em> are filled with <code>0xfeedfacefeedface</code>, which indicates
they are untouched (no buffer overrun has occurred). See the following
section for an explanation of redzones. At <code>0x70a9ae00</code> an allocated
buffer is located between the two free buffers.</p>
</div>
<div id="redzone-0xfeedface" class="paragraph">
<p>==== Redzone: <code>0xfeedface</code></p>
</div>
<div class="paragraph">
<p>Note the pattern
<code>0xfeedface</code> in the buffer shown in the previous section. This pattern
is known as the <em>redzone</em> indicator. This pattern enables the allocator
(and a programmer debugging a problem) to determine whether the
boundaries of a buffer have been violated. Following the redzone is some
additional information. The content of that data depends on other
factors (see <a href="#memory-allocation-logging">Memory Allocation Logging</a>). The redzone
and its suffix are collectively called the <em>buftag</em> region.
<a href="#casestudy-fig-39">The Redzone</a> summarizes this information.</p>
</div>
<div id="casestudy-fig-39" class="imageblock">
<div class="content">
<img src="figures/redzone-fig1.png" alt="Graphic described by context.">
</div>
<div class="title">Figure 2. The Redzone</div>
</div>
<div class="paragraph">
<p>The buftag is appended to each buffer in a cache when any of the
<code>KMF_AUDIT</code>, <code>KMF_DEADBEEF</code>, or <code>KMF_REDZONE</code> flags is set
in that buffer&#8217;s cache. The content of the buftag depends on whether
<code>KMF_AUDIT</code> is set.</p>
</div>
<div class="paragraph">
<p>Decomposing the memory region presented above into distinct buffers is
now simple:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0x70a9add8:     deadbeef        deadbeef  \
0x70a9ade0:     deadbeef        deadbeef   +- User Data (free)
0x70a9ade8:     deadbeef        deadbeef  /
0x70a9adf0:     feedface        feedface  -- REDZONE
0x70a9adf8:     70ae3260        8440c68e  -- Debugging Data

0x70a9ae00:     5               4ef83     \
0x70a9ae08:     0               0          +- User Data (allocated)
0x70a9ae10:     1               bbddcafe  /
0x70a9ae18:     feedface        139d    -- REDZONE
0x70a9ae20:     70ae3200        d1befaed  -- Debugging Data

0x70a9ae28:     deadbeef        deadbeef  \
0x70a9ae30:     deadbeef        deadbeef   +- User Data (free)
0x70a9ae38:     deadbeef        deadbeef  /
0x70a9ae40:     feedface        feedface  -- REDZONE
0x70a9ae48:     70ae31a0        8440c54e  -- Debugging Data</pre>
</div>
</div>
<div class="paragraph">
<p>The buffers at <code>0x70a9add8</code> and <code>0x70a9ae28</code> are filled with
<code>0xdeadbeefdeadbeef</code>, which shows that these buffers are free. The
buffer redzones are filled with <code>0xfeedfacefeedface</code>, which indicates
they are untouched (no buffer overrun has occurred).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>0xbaddcafe</code></dt>
<dd>
<p>Buffer is allocated but uninitialized (see
<a href="#uninitialized-data-0xbaddcafe">Uninitialized Data: </a>).</p>
</dd>
<dt class="hdlist1"><code>0xdeadbeef</code></dt>
<dd>
<p>Buffer is free.</p>
</dd>
<dt class="hdlist1"><code>0xfeedface</code></dt>
<dd>
<p>Buffer limits were respected (no overflow).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the allocated buffer beginning at <code>0x70a9ae00</code>, the situation is
different. Recall from <a href="#allocator-basics">Allocator Basics</a> that there
are two allocation types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client requested memory using
<code>kmem_cache_alloc(9F)</code>, in which case the size of the requested
buffer is equal to the bufsize of the cache.</p>
</li>
<li>
<p>The client requested memory using
<code>kmem_alloc(9F)</code>, in which case the size of the requested buffer is
less than or equal to the bufsize of the cache. For example, a request
for 20 bytes will be fulfilled from the <code>kmem_alloc_24</code> cache.
The allocator enforces the buffer boundary by placing a marker, the
<em>redzone byte</em>, immediately following the client data:</p>
<div class="literalblock">
<div class="content">
<pre>0x70a9ae00:     5               4ef83     \
0x70a9ae08:     0               0          +- User Data (allocated)
0x70a9ae10:     1               bbddcafe  /
0x70a9ae18:     feedface        139d    -- REDZONE
0x70a9ae20:     70ae3200        d1befaed  -- Debugging Data</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>0xfeedface</code> value at <code>0x70a9ae18</code> is followed by a 32-bit word
containing what seems to be a random value. This number is actually an
encoded representation of the size of the buffer. To decode this number
and find the size of the allocated buffer, use the formula:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>size = redzone_value / 251</pre>
</div>
</div>
<div class="paragraph">
<p>So, in this example,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>size = 0x139d / 251 = 20 bytes.</pre>
</div>
</div>
<div class="paragraph">
<p>This indicates that the buffer requested was of size 20 bytes. The
allocator performs this decoding operation and finds that the redzone
byte should be at offset 20. The redzone byte is the hex pattern <code>0xbb</code>,
which is present at <code>0x729084e4 (0x729084d0 &#43; 0t20)</code> as expected.</p>
</div>
<div id="casestudy-fig-41" class="paragraph">
<div class="title">Sample <code>kmem_alloc(9F)</code> Buffer</div>
<p>image::figures/redzone-fig2.png[This graphic depicts a sample kmem_alloc buffer. The redzone byte, uninitialized data, and debugging data are
marked.]</p>
</div>
<div class="paragraph">
<p><a href="#casestudy-fig-43">Redzone Byte</a> shows the general form of this
memory layout.</p>
</div>
<div id="casestudy-fig-43" class="paragraph">
<div class="title">Redzone Byte</div>
<p>image::figures/redzone-fig3.png[This graphic shows the redzone byte being written after the end of the user data region. The redzone byte is
determined by decoding the index.]</p>
</div>
<div class="paragraph">
<p>If the allocation size is the same as the bufsize of the cache, the
redzone byte overwrites the first byte of the redzone itself, as shown
in <a href="#casestudy-fig-45">Redzone Byte at the Beginning of the Redzone</a>.</p>
</div>
<div id="casestudy-fig-45" class="imageblock">
<div class="content">
<img src="figures/redzone-fig4.png" alt="Graphic described by context.">
</div>
<div class="title">Figure 3. Redzone Byte at the Beginning of the Redzone</div>
</div>
<div class="paragraph">
<p>This overwriting results in the first 32-bit word of the redzone being
<code>0xbbedface</code>, or <code>0xfeedfabb</code> depending on the endianness of the
hardware on which the system is running.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Why is the allocation size encoded this way? To encode the size, the
allocator uses the formula (251 * size &#43; 1). When the size
decode occurs, the integer division discards the remainder of '&#43;1'.
However, the addition of 1 is valuable because the allocator can check
whether the size is valid by testing whether (size % 251 == 1). In this
way, the allocator defends against corruption of the redzone byte index.</p>
</div>
</div>
<div class="sect3">
<h4 id="uninitialized-data-0xbaddcafe"><a class="anchor" href="#uninitialized-data-0xbaddcafe"></a>9.2.5. Uninitialized Data: <code>0xbaddcafe</code></h4>
<div class="paragraph">
<p>You might be wondering what the suspicious
<code>0xbbddcafe</code> at address <code>0x729084d4</code> was <em>before</em> the redzone byte got
placed over the first byte in the word. It was <code>0xbaddcaf`e. When the
`KMF_DEADBEEF</code> flag is set in the cache, allocated but
<em>uninitialized</em> memory is filled with the <code>0xbaddcafe</code> pattern. When the
allocator performs an allocation, it loops across the words of the
buffer and verifies that each word contains <code>0xdeadbeef</code>, then fills
that word with <code>0xbaddcafe</code>.</p>
</div>
<div class="paragraph">
<p>A system can panic with a message such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>panic[cpu1]/thread=e1979420: BAD TRAP: type=e (Page Fault)
rp=ef641e88 addr=baddcafe occurred in module "unix" due to an
illegal access to a user address</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the address that caused the fault was <code>0xbaddcafe</code>: the
panicking thread has accessed some data that was never initialized.</p>
</div>
</div>
<div class="sect3">
<h4 id="associating-panic-messages-with-failures"><a class="anchor" href="#associating-panic-messages-with-failures"></a>9.2.6. Associating Panic Messages With Failures</h4>
<div class="paragraph">
<p>The kernel memory allocator emits panic messages corresponding to the
failure modes described earlier. For example, a system can panic with a
message such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kernel memory allocator: buffer modified after being freed
modification occurred at offset 0x30</pre>
</div>
</div>
<div class="paragraph">
<p>The allocator was able to detect this case because it tried to validate
that the buffer in question was filled with <code>0xdeadbeef</code>. At offset
<code>0x30,</code> this condition was not met. Since this condition indicates
memory corruption, the allocator panicked the system.</p>
</div>
<div class="paragraph">
<p>Another example failure message is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kernel memory allocator: redzone violation: write past end of buffer</pre>
</div>
</div>
<div class="paragraph">
<p>The allocator was able to detect this case because it tried to validate
that the redzone byte (<code>0xbb</code>) was in the location it determined from
the redzone size encoding. It failed to find the signature byte in the
correct location. Since this indicates memory corruption, the allocator
panicked the system. Other allocator panic messages are discussed later.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memory-allocation-logging"><a class="anchor" href="#memory-allocation-logging"></a>9.3. Memory Allocation Logging</h3>
<div class="paragraph">
<p>This section explains the logging features of the kernel memory
allocator and how you can employ them to debug system crashes.</p>
</div>
<div class="sect3">
<h4 id="buftag-data-integrity"><a class="anchor" href="#buftag-data-integrity"></a>9.3.1. Buftag Data Integrity</h4>
<div class="paragraph">
<p>As explained earlier, the second half of each buftag
contains extra information about the corresponding buffer. Some of this
data is debugging information, and some is data private to the
allocator. While this auxiliary data can take several different forms,
it is collectively known as “Buffer Control” or <em>bufctl</em> data.</p>
</div>
<div class="paragraph">
<p>However, the allocator needs to know whether a buffer&#8217;s bufctl pointer
is valid, since this pointer might also have been corrupted by
malfunctioning code. The allocator confirms the integrity of its
auxiliary pointer by storing the pointer <em>and</em> an encoded version of
that pointer, and then cross-checking the two versions.</p>
</div>
<div class="paragraph">
<p>As shown in <a href="#casestudy-fig-47">Extra
Debugging Data in the Buftag</a>, these pointers are the <em>bcp</em> (buffer
control pointer) and <em>bxstat</em> (buffer control XOR status). The allocator
arranges bcp and bxstat so that the expression <code>bcp XOR bxstat</code> equals a
well-known value.</p>
</div>
<div id="casestudy-fig-47" class="imageblock">
<div class="content">
<img src="figures/redzone-fig5.png" alt="Graphic is described by context.">
</div>
<div class="title">Figure 4. Extra Debugging Data in the Buftag</div>
</div>
<div class="paragraph">
<p>In the event that one or both of these pointers becomes corrupted, the
allocator can easily detect such corruption and panic the system. When a
buffer is <em>allocated</em>, <code>bcp XOR bxstat = 0xa110c8ed</code> (“allocated”). When
a buffer is free, <code>bcp XOR bxstat = 0xf4eef4ee</code> (“freefree”).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might find it helpful to re-examine the example provided in
<a href="#freed-buffer-checking-0xdeadbeef">Freed Buffer Checking: </a>, in order to confirm that
the buftag pointers shown there are consistent.</p>
</div>
<div class="paragraph">
<p>In the event that the allocator finds a corrupt buftag, it panics the
system and produces a message similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kernel memory allocator: boundary tag corrupted
    bcp ^ bxstat = 0xffeef4ee, should be f4eef4ee</pre>
</div>
</div>
<div class="paragraph">
<p>Remember, if bcp is corrupt, it is still possible to retrieve its value
by taking the value of <code>bxstat XOR 0xf4eef4ee</code> or
<code>bxstat XOR 0xa110c8ed</code>, depending on whether the buffer is allocated or
free.</p>
</div>
<div id="the-bufctl-pointer" class="paragraph">
<p>==== The <code>bufctl</code> Pointer</p>
</div>
<div class="paragraph">
<p>The buffer control (bufctl)
pointer contained in the buftag region can have different meanings,
depending on the cache&#8217;s <code>kmem_flags</code>. The behavior toggled by the
<code>KMF_AUDIT</code> flag is of particular interest: when the KMF_AUDIT
flag is <em>not</em> set, the kernel memory allocator allocates a
<code>kmem_bufctl_t</code> structure for each buffer. This structure
contains some minimal accounting information about each buffer. When the
<code>KMF_AUDIT</code> flag <em>is</em> set, the allocator instead allocates a
<code>kmem_bufctl_audit_t</code>, an extended version of the
<code>kmem_bufctl_t</code>.</p>
</div>
<div class="paragraph">
<p>This section presumes the <code>KMF_AUDIT</code> flag is set. For caches that
do not have this bit set, the amount of available debugging information
is reduced.</p>
</div>
<div class="paragraph">
<p>The <code>kmem_bufctl_audit_t</code> (<code>bufctl_audit</code> for short)
contains additional information about the last transaction that occurred
on this buffer. The following example shows how to apply the
<code>bufctl_audit</code> macro to examine an audit record. The buffer shown is
the example buffer used in <a href="#detecting-memory-corruption">Detecting Memory
Corruption</a>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x70a9ae00,5/KKn
0x70a9ae00:     5               4ef83
                0               0
                1               bbddcafe
                feedface        139d
                70ae3200        d1befaed</pre>
</div>
</div>
<div class="paragraph">
<p>Using the techniques presented above, it is easy to see
that <code>0x70ae3200</code> points to the <code>bufctl_audit</code> record: it is the
first pointer following the redzone. To examine the <code>bufctl_audit</code>
record it points to, apply the <code>bufctl_audit</code> macro:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x70ae3200$&lt;bufctl_audit
0x70ae3200:     next            addr            slab
                70378000        70a9ae00        707c86a0
0x70ae320c:     cache           timestamp       thread
                70039928        e1bd0e26afe     70aac4e0
0x70ae321c:     lastlog         contents        stackdepth
                7011c7c0        7018a0b0        4
0x70ae3228:
                kmem_zalloc+0x30
                pid_assign+8
                getproc+0x68
                cfork+0x60</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>addr</code> field is the address of the buffer corresponding to this
bufctl_audit record. This is the original address: <code>0x70a9ae00</code>. The
<code>cache</code> field points at the kmem_cache that allocated this buffer.
You can use the <code>::kmem_cache</code> dcmd to examine it as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x70039928::kmem_cache
ADDR     NAME                      FLAG  CFLAG  BUFSIZE  BUFTOTL
70039928 kmem_alloc_24             020f 000000       24      612</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>timestamp</code> field represents the time this transaction occurred.
This time is expressed in the same manner as <code>gethrtime(3C)</code>.</p>
</div>
<div class="paragraph">
<p><code>thread</code> is a pointer to the thread that performed the last transaction
on this buffer. The <code>lastlog</code> and <code>contents</code> pointers point to locations
in the allocator&#8217;s <em>transaction logs</em>. These logs are discussed in
detail in <a href="#allocator-logging-facility">Allocator Logging Facility</a>.</p>
</div>
<div class="paragraph">
<p>Typically, the most useful piece of information provided by
<code>bufctl_audit</code> is the stack trace recorded at the point at which the
transaction took place. In this case, the transaction was an allocation
called as part of executing <code>fork(2)</code>.</p>
</div>
<div id="advanced-memory-analysis" class="paragraph">
<p>=== Advanced Memory Analysis</p>
</div>
<div class="paragraph">
<p>This section describes facilities for performing advanced memory
analysis, including locating memory leaks and sources of data
corruption.</p>
</div>
<div id="finding-memory-leaks" class="paragraph">
<p>==== Finding Memory Leaks</p>
</div>
<div class="paragraph">
<p>The <code>::findleaks</code> dcmd provides powerful and efficient
detection of memory leaks in kernel crash dumps where the full set of
kmem debug features has been enabled. The first execution of
<code>::findleaks</code> processes the dump for memory leaks (this can take a few
minutes), and then coalesces the leaks by the allocation stack trace.
The findleaks report shows a bufctl address and the topmost stack frame
for each memory leak that was identified:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::findleaks
CACHE     LEAKED   BUFCTL CALLER
70039ba8       1 703746c0 pm_autoconfig+0x708
70039ba8       1 703748a0 pm_autoconfig+0x708
7003a028       1 70d3b1a0 sigaddq+0x108
7003c7a8       1 70515200 pm_ioctl+0x187c
------------------------------------------------------
   Total       4 buffers, 376 bytes</pre>
</div>
</div>
<div class="paragraph">
<p>Using the bufctl pointers, you can obtain the complete
stack backtrace of the allocation by applying the <code>bufctl_audit</code>
macro:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 70d3b1a0$&lt;bufctl_audit
0x70d3b1a0:     next            addr            slab
                70a049c0        70d03b28        70bb7480
0x70d3b1ac:     cache           timestamp       thread
                7003a028        13f7cf63b3      70b38380
0x70d3b1bc:     lastlog         contents        stackdepth
                700d6e60        0               5
0x70d3b1c8:
                kmem_alloc+0x30
                sigaddq+0x108
                sigsendproc+0x210
                sigqkill+0x90
                kill+0x28</pre>
</div>
</div>
<div class="paragraph">
<p>The programmer can usually use the <code>bufctl_audit</code> information and
the allocation stack trace to quickly track down the code path that
leaks the given buffer.</p>
</div>
<div id="finding-references-to-data" class="paragraph">
<p>==== Finding References to Data</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  When trying to diagnose a memory
corruption problem, you should know what other kernel entities hold a
copy of a particular pointer. This is important because it can reveal
which thread accessed a data structure after it was freed. It can also
make it easier to understand what kernel entities are sharing knowledge
of a particular (valid) data item. The `::whatis` and `::kgrep` dcmds
can be used to answer these questions. You can apply `::whatis` to a
value of interest:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x705d8640::whatis
705d8640 is 705d8640+0, allocated from streams_mblk</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>0x705d8640</code> is revealed to be a pointer to a STREAMS
<code>mblk</code> structure. To see the entire allocation tree, use <code>::whatis</code> <code>a</code>
instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x705d8640::whatis -a
705d8640 is 705d8640+0, allocated from streams_mblk
705d8640 is 705d8000+640, allocated from kmem_va_8192
705d8640 is 705d8000+640 from kmem_default vmem arena
705d8640 is 705d2000+2640 from kmem_va vmem arena
705d8640 is 705d2000+2640 from heap vmem arena</pre>
</div>
</div>
<div class="paragraph">
<p>This reveals that the allocation also appears in the
<code>kmem_va_8192</code> cache. The <code>kmem_va_8192</code> cache is a kmem
cache that is fronting the <code>kmem_va</code> vmem arena. It also shows the
full stack of vmem allocations.</p>
</div>
<div class="paragraph">
<p>The complete list of kmem caches and vmem arenas is displayed by the
<code>::kmastat</code> dcmd. You can use <code>::kgrep</code> to locate other kernel addresses
that contain a pointer to this <code>mblk</code>. This illustrates the hierarchical
nature of memory allocations in the system; in general, you can
determine the type of object referred to by the given address from the
name of the most specific kmem cache.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x705d8640::kgrep</pre>
</div>
</div>
<div class="paragraph">
<p>and investigate them by applying <code>::whatis</code> again:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 400a3720::whatis
400a3720 is in thread 7095b240's stack

&gt; 706add34::whatis
706add34 is 706add20+14, allocated from streams_dblk_120</pre>
</div>
</div>
<div class="paragraph">
<p>Here one pointer is located on the stack of a known kernel thread, and
another is the <code>mblk</code> pointer inside of the corresponding STREAMS <code>dblk</code>
structure.</p>
</div>
<div id="finding-corrupt-buffers-with-kmem_verify" class="paragraph">
<p>==== Finding Corrupt Buffers With <code>::kmem_verify</code></p>
</div>
<div class="paragraph">
<p>MDB&#8217;s <code>::kmem_verify</code> dcmd implements most of the
same checks that the kmem allocator does at runtime. <code>::kmem_verify</code>
can be invoked in order to scan every kmem cache with appropriate
<code>kmem_flags</code>, or to examine a particular cache.</p>
</div>
<div class="paragraph">
<p>Here is an example of using <code>::kmem_verify</code> to isolate a problem:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::kmem_verify
Cache Name                      Addr     Cache Integrity
kmem_alloc_8                    70039428 clean
kmem_alloc_16                   700396a8 clean
kmem_alloc_24                   70039928 1 corrupt buffer
kmem_alloc_32                   70039ba8 clean
kmem_alloc_40                   7003a028 clean
kmem_alloc_48                   7003a2a8 clean
...</pre>
</div>
</div>
<div class="paragraph">
<p>It is easy to see here that the <code>kmem_alloc_24</code> cache contains
what <code>::kmem_verify</code> believes to be a problem. With an explicit
cache argument, the <code>::kmem_verify</code> dcmd provides more detailed
information about the problem:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 70039928::kmem_verify
Summary for cache 'kmem_alloc_24'
  buffer 702babc0 (free) seems corrupted, at 702babc0</pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to examine the buffer which <code>::kmem_verify</code>
believes to be corrupt:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x702babc0,5/KKn
0x702babc0:     0               deadbeef
                deadbeef        deadbeef
                deadbeef        deadbeef
                feedface        feedface
                703785a0        84d9714e</pre>
</div>
</div>
<div class="paragraph">
<p>The reason that <code>::kmem_verify</code> flagged this buffer is now clear:
The first word in the buffer (at <code>0x702babc0</code>) should probably be filled
with the <code>0xdeadbeef</code> pattern, not with a <code>0</code>. At this point, examining
the <code>bufctl_audit</code> for this buffer might yield clues about what code
recently wrote to the buffer, indicating where and when it was freed.</p>
</div>
<div class="paragraph">
<p>Another useful technique in this situation is to use <code>::kgrep</code> to search
the address space for references to address <code>0x702babc0</code>, in order to
discover what threads or data structures are still holding references to
this freed data.</p>
</div>
<div id="allocator-logging-facility" class="paragraph">
<p>==== Allocator Logging Facility</p>
</div>
<div class="paragraph">
<p>When <code>KMF_AUDIT</code> is set for a cache,
the kernel memory allocator maintains a log that records the recent
history of its activity. This <em>transaction log</em> records
<code>bufctl_audit</code> records. If the <code>KMF_AUDIT</code> and the
<code>KMF_CONTENTS</code> flags are both set, the allocator generates a
<em>contents log</em> that records portions of the actual contents of allocated
and freed buffers. The structure and use of the contents log is outside
the scope of this document. The transaction log is discussed in this
section.</p>
</div>
<div class="paragraph">
<p>MDB provides several facilities for displaying the
transaction log. The simplest is <code>::walk kmem_log</code>, which prints out
the transaction in the log as a series of <code>bufctl_audit_t</code>
pointers:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::walk kmem_log
...
&gt; 70128340$&lt;bufctl_audit
0x70128340:     next            addr            slab
                70ac1d40        70bc4ea8        70bb7c00
0x7012834c:     cache           timestamp       thread
                70039428        e1bd7abe721     70aacde0
0x7012835c:     lastlog         contents        stackdepth
                701282e0        7018f340        4
0x70128368:
                kmem_cache_free+0x24
                nfs3_sync+0x3c
                vfs_sync+0x84
                syssync+4</pre>
</div>
</div>
<div class="paragraph">
<p>A more elegant way to view the entire transaction log is
by using the <code>::kmem_log</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::kmem_log
CPU ADDR     BUFADDR         TIMESTAMP THREAD
  0 70128340 70bc4ea8      e1bd7abe721 70aacde0
  0 701282e0 70bc4ea8      e1bd7aa86fa 70aacde0
  0 70128280 70bc4ea8      e1bd7aa27dd 70aacde0
  0 70128220 70bc4ea8      e1bd7a98a6e 70aacde0
  0 701281c0 70d03738      e1bd7a8e3e0 70aacde0
  ...
  0 70127140 70cf78a0      e1bd78035ad 70aacde0
  0 701270e0 709cf6c0      e1bd6d2573a 40033e60
  0 70127080 70cedf20      e1bd6d1e984 40033e60
  0 70127020 70b09578      e1bd5fc1791 40033e60
  0 70126fc0 70cf78a0      e1bd5fb6b5a 40033e60
  0 70126f60 705ed388      e1bd5fb080d 40033e60
  0 70126f00 705ed388      e1bd551ff73 70aacde0
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>The output of <code>::kmem_log</code> is sorted in descending order by
timestamp. The <code>ADDR</code> column is the <code>bufctl_audit</code> structure
corresponding to that transaction; <code>BUFADDR</code> points to the actual
buffer.</p>
</div>
<div class="paragraph">
<p>These figures represent <em>transactions</em> on buffers (both allocations and
frees). When a particular buffer is corrupted, it can be helpful to
locate that buffer in the transaction log, then determine in which other
transactions the transacting thread was involved. This can help to
assemble a picture of the sequence of events that occurred prior to and
after the allocation (or free) of a buffer.</p>
</div>
<div class="paragraph">
<p>You can employ the <code>::bufctl</code> command to filter the
output of walking the transaction log. The <code>::bufctl -a</code> command filters
the buffers in the transaction log by buffer address. This example
filters on buffer <code>0x70b09578</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; ::walk kmem_log | ::bufctl -a 0x70b09578
ADDR     BUFADDR   TIMESTAMP   THREAD   CALLER
70127020 70b09578  e1bd5fc1791 40033e60 biodone+0x108
70126e40 70b09578  e1bd55062da 70aacde0 pageio_setup+0x268
70126de0 70b09578  e1bd52b2317 40033e60 biodone+0x108
70126c00 70b09578  e1bd497ee8e 70aacde0 pageio_setup+0x268
70120480 70b09578  e1bd21c5e2a 70aacde0 elfexec+0x9f0
70120060 70b09578  e1bd20f5ab5 70aacde0 getelfhead+0x100
7011ef20 70b09578  e1bd1e9a1dd 70aacde0 ufs_getpage_miss+0x354
7011d720 70b09578  e1bd1170dc4 70aacde0 pageio_setup+0x268
70117d80 70b09578  e1bcff6ff27 70bc2480 elfexec+0x9f0
70117960 70b09578  e1bcfea4a9f 70bc2480 getelfhead+0x100
...</pre>
</div>
</div>
<div class="paragraph">
<p>This example illustrates that a particular buffer can be used in
numerous transactions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Remember that the kmem transaction log is an incomplete record of the
transactions made by the kernel memory allocator. Older entries in the
log are evicted as needed in order to keep the size of the log constant.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  The `::allocdby` and `::freedby` dcmds
provide a convenient way to summarize transactions associated with a
particular thread. Here is an example of listing the recent allocations
performed by thread `0x70aacde0`:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; 0x70aacde0::allocdby
BUFCTL      TIMESTAMP CALLER
70d4d8c0  e1edb14511a allocb+0x88
70d4e8a0  e1edb142472 dblk_constructor+0xc
70d4a240  e1edb13dd4f allocb+0x88
70d4e840  e1edb13aeec dblk_constructor+0xc
70d4d860  e1ed8344071 allocb+0x88
70d4e7e0  e1ed8342536 dblk_constructor+0xc
70d4a1e0  e1ed82b3a3c allocb+0x88
70a53f80  e1ed82b0b91 dblk_constructor+0xc
70d4d800  e1e9b663b92 allocb+0x88</pre>
</div>
</div>
<div class="paragraph">
<p>By examining <code>bufctl_audit</code> records, you can understand the recent
activities of a particular thread.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-programming-api"><a class="anchor" href="#module-programming-api"></a>10. Module Programming API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the structures and functions contained in the MDB
debugger module API. The header file <code>&lt;sys/mdb_modapi.h&gt;</code>
contains prototypes for these functions, and the SUNWmdbdm package
provides source code for an example module in the directory
<code>/usr/demo/mdb</code>.</p>
</div>
<div class="sect2">
<h3 id="debugger-module-linkage"><a class="anchor" href="#debugger-module-linkage"></a>10.1. Debugger Module Linkage</h3>
<div class="sect3">
<h4 id="mdbinit"><a class="anchor" href="#mdbinit"></a>10.1.1. <code>_mdb_init</code></h4>
<div class="literalblock">
<div class="content">
<pre>const mdb_modinfo_t *_mdb_init(void);</pre>
</div>
</div>
<div class="paragraph">
<p>Each debugger module is required to
provide, for linkage and identification purposes, a function named
<code>_mdb_init</code>. This function returns a pointer to a persistent
(that is, not declared as an automatic variable) <code>mdb_modinfo_t</code>
structure, as defined in <code>&lt;sys/mdb_modapi.h&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct mdb_modinfo {
        ushort_t mi_dvers;               /* Debugger API version number */
        const mdb_dcmd_t *mi_dcmds;      /* NULL-terminated list of dcmds */
        const mdb_walker_t *mi_walkers;  /* NULL-terminated list of walks */
} mdb_modinfo_t;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;mi_dvers&gt; member is used to identify
the API version number, and should always be set to
<code>MDB_API_VERSION</code>. The current version number is therefore
compiled into each debugger module, allowing the debugger to identify
and verify the application binary interface used by the module. The
debugger does not load modules that are compiled for an API version that
is more recent than the debugger itself.</p>
</div>
<div class="paragraph">
<p>The &lt;mi_dcmds&gt; and &lt;mi_walkers&gt; members, if not
NULL, point to arrays of dcmd and walker definition structures,
respectively. Each array must be terminated by a NULL element. These
dcmds and walkers are installed and registered with the debugger as part
of the module loading process. The debugger will refuse to load the
module if one or more dcmds or walkers are defined improperly or if they
have conflicting or invalid names. Dcmd and walker names are prohibited
from containing characters that have special meaning to the debugger,
such as quotation marks and parentheses.</p>
</div>
<div class="paragraph">
<p>The module can also execute code in <code>_mdb_init</code> using the module
API to determine if it is appropriate to load. For example, a module can
only be appropriate for a particular target if certain symbols are
present. If these symbols are not found, the module can return NULL from
the <code>_mdb_init</code> function. In this case, the debugger will refuse
to load the module and an appropriate error message is printed.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbfini"><a class="anchor" href="#mdbfini"></a>10.1.2. <code>_mdb_fini</code></h4>
<div class="literalblock">
<div class="content">
<pre>void _mdb_fini(void);</pre>
</div>
</div>
<div class="paragraph">
<p>If the module performs certain tasks prior to unloading,
such as freeing persistent memory previously allocated with
<code>mdb_alloc</code>, it can declare a function named <code>_mdb_fini</code> for
this purpose. This function is not required by the debugger. If
declared, it is called once prior to unloading the module. Modules are
unloaded when the user requests that the debugger terminate or when the
user explicitly unloads a module using the <code>::unload</code> built-in dcmd.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dcmd-definitions"><a class="anchor" href="#dcmd-definitions"></a>10.2. Dcmd Definitions</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int dcmd(uintptr_t addr, uint_t flags, int argc, const mdb_arg_t *argv);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A dcmd is implemented with a function similar to the <code>dcmd</code> declaration.
This function receives four arguments and returns an integer status. The
function arguments are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;addr&gt;</dt>
<dd>
<p>Current address, also called dot. At the start of the dcmd, this
address corresponds to the value of the dot “<code>.</code>” variable in the
debugger.</p>
</dd>
<dt class="hdlist1">&lt;flags&gt;</dt>
<dd>
<p>Integer containing the logical OR of one or more of the following
flags:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DCMD_ADDRSPEC</code></dt>
<dd>
<p>An explicit address was specified to the left of
<code>::dcmd</code>.</p>
</dd>
<dt class="hdlist1"><code>DCMD_LOOP</code></dt>
<dd>
<p>The dcmd was invoked in a loop using the <code>,count</code>
syntax, or the dcmd was invoked in a loop by a pipeline.</p>
</dd>
<dt class="hdlist1"><code>DCMD_LOOPFIRST</code></dt>
<dd>
<p>This invocation of the dcmd function corresponds to
the first loop or pipeline invocation.</p>
</dd>
<dt class="hdlist1"><code>DCMD_PIPE</code></dt>
<dd>
<p>The dcmd was invoked with input from a pipeline.</p>
</dd>
<dt class="hdlist1"><code>DCMD_PIPE_OUT</code></dt>
<dd>
<p>  The dcmd was invoked with output set to a pipeline.
+
As a convenience, the <code>DCMD_HDRSPEC</code> macro is provided to allow a
dcmd to test its flags to determine if it should print a header line
(that is, it was not invoked as part of a loop, or it was invoked as
the first iteration of a loop or pipeline).</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">&lt;argc&gt;</dt>
<dd>
<p>Number of arguments in the &lt;argv&gt; array.</p>
</dd>
<dt class="hdlist1">&lt;argv&gt;</dt>
<dd>
<p>Array of arguments specified to the right of <code>::dcmd</code> on the command
line. These arguments can be either strings or integer values.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The dcmd function is expected to return one of the following integer
values, defined in <code>&lt;sys/mdb_modapi.h&gt;</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DCMD_OK</code></dt>
<dd>
<p>The dcmd completed successfully.</p>
</dd>
<dt class="hdlist1"><code>DCMD_ERR</code></dt>
<dd>
<p>The dcmd failed for some reason.</p>
</dd>
<dt class="hdlist1"><code>DCMD_USAGE</code></dt>
<dd>
<p>The dcmd failed because invalid arguments were
specified. When this value is returned, the dcmd usage message
(described below) prints automatically.</p>
</dd>
<dt class="hdlist1"><code>DCMD_NEXT</code></dt>
<dd>
<p>The next dcmd definition (if one is present) is
automatically invoked with the same arguments.</p>
</dd>
<dt class="hdlist1"><code>DCMD_ABORT</code></dt>
<dd>
<p>The dcmd failed, and the current loop or pipeline
should be aborted. This is like <code>DCMD_ERR</code>, but indicates that no
further progress is possible in the current loop or pipe.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each dcmd consists of a function defined according to the
example <code>dcmd</code> prototype, and a corresponding <code>mdb_dcmd_t</code>
structure, as defined in <code>&lt;sys/mdb_modapi.h&gt;</code>. This
structure consists of the following fields:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const char *dc_name</code></dt>
<dd>
<p>The string name of the dcmd, without the leading “<code>::</code>”. The name
cannot contain any of the MDB meta-characters, such as $<code> or </code>.</p>
</dd>
<dt class="hdlist1"><code>const char *dc_usage</code></dt>
<dd>
<p>An optional usage string for the dcmd, to be printed when the dcmd
returns <code>DCMD_USAGE</code>. For example, if the dcmd accepts options <code>a</code>
and <code>b</code>, <code>dc_usage</code> might be specified as “<code>[<code>ab</code>]</code>”. If
the dcmd accepts no arguments, <code>dc_usage</code> can be set to NULL. If
the usage string begins with “<code>:</code>”, this is shorthand for indicating
that the dcmd requires an explicit address (that is, it requires
<code>DCMD_ADDRSPEC</code> to be set in its flags parameter). If the usage
string begins with “<code>?</code>”, this indicates that the dcmd optionally
accepts an address. These hints modify the usage message accordingly.</p>
</dd>
<dt class="hdlist1"><code>const char *dc_descr</code></dt>
<dd>
<p>A mandatory description string, briefly explaining the purpose of the
dcmd. This string should consist of only a single line of text.</p>
</dd>
<dt class="hdlist1"><code>mdb_dcmd_f *dc_funcp</code></dt>
<dd>
<p>A pointer to the function that will be called to execute the dcmd.</p>
</dd>
<dt class="hdlist1"><code>void (*dc_help)(void)</code></dt>
<dd>
<p>An optional function pointer to a help function for the dcmd. If this
pointer is not NULL, this function will be called when the user
executes <code>::help</code> &lt;dcmd&gt;. This function can use
<code>mdb_printf</code> to display further information or examples.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="walker-definitions"><a class="anchor" href="#walker-definitions"></a>10.3. Walker Definitions</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int walk_init(mdb_walk_state_t *wsp);
int walk_step(mdb_walk_state_t *wsp);
void walk_fini(mdb_walk_state_t *wsp);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A walker is composed of three functions, <code>init</code>, <code>step</code>, and <code>fini</code>,
which are defined according to the example prototypes above. A walker is
invoked by the debugger when one of the walk functions (such as
<code>mdb_walk</code>) is called, or when the user executes the <code>::walk</code>
built-in dcmd. When the walk begins, MDB calls the walker&#8217;s init
function, passing it the address of a new <code>mdb_walk_state_t</code>
structure, as defined in <code>&lt;sys/mdb_modapi.h&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct mdb_walk_state {
    mdb_walk_cb_t walk_callback;    /* Callback to issue */
    void *walk_cbdata;              /* Callback private data */
    uintptr_t walk_addr;            /* Current address */
    void *walk_data;                /* Walk private data */
    void *walk_arg;                 /* Walk private argument */
    void *walk_layer;               /* Data from underlying layer */
} mdb_walk_state_t;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A separate <code>mdb_walk_state_t</code> is created for
each walk, so that multiple instances of the same walker can be active
simultaneously. The state structure contains the callback the walker
should invoke at each step (&lt;walk_callback&gt;), and the
private data for the callback (&lt;walk_cbdata&gt;), as specified
to <code>mdb_walk</code>, for example. The &lt;walk_cbdata&gt; pointer is
opaque to the walker: it must not modify or dereference this value, nor
can it assume it is a pointer to valid memory.</p>
</div>
<div class="paragraph">
<p>The starting address for the walk is stored in &lt;walk_addr&gt;.
This is either NULL if <code>mdb_walk</code> was called, or the address
parameter specified to <code>mdb_pwalk</code>. If the <code>::walk</code> built-in was
used, &lt;walk_addr&gt; will be non-NULL if an explicit address
was specified on the left-hand side of <code>::walk</code>. A walk with a starting
address of NULL is referred to as <em>global</em>. A walk with an explicit
non-NULL starting address is referred to as <em>local</em>.</p>
</div>
<div class="paragraph">
<p>The &lt;walk_data&gt; and &lt;walk_arg&gt; fields are
provided for use as private storage for the walker. Complex walkers
might need to allocate an auxiliary state structure and set
&lt;walk_data&gt; to point to this structure. Each time a walk is
initiated, &lt;walk_arg&gt; is initialized to the value of the
<code>walk_init_arg</code> member of the corresponding walker&#8217;s
<code>mdb_walker_t</code> structure.</p>
</div>
<div class="paragraph">
<p>In some cases, it is useful to have several walkers share the same init,
step, and fini routines. For example, the MDB <code>genunix</code> module provides
walkers for each kernel memory cache. These share the same init, step,
and fini functions, and use the <code>walk_init_arg</code> member of the
<code>mdb_walker_t</code> to specify the address of the appropriate cache
as the &lt;walk_arg&gt;.</p>
</div>
<div class="paragraph">
<p>If the walker calls <code>mdb_layered_walk</code> to instantiate an
underlying layer, then the underlying layer will reset
&lt;walk_addr&gt; and &lt;walk_layer&gt; prior to each call
to the walker&#8217;s step function. The underlying layer sets
&lt;walk_addr&gt; to the target virtual address of the underlying
object, and set &lt;walk_layer&gt; to point to the walker&#8217;s local
copy of the underlying object. For more information on layered walks,
refer to the discussion of <code>mdb_layered_walk</code> below.</p>
</div>
<div class="paragraph">
<p>The walker init and step functions are expected to return one of the
following status values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>WALK_NEXT</code></dt>
<dd>
<p> Proceed to the next step. When the walk init function
returns <code>WALK_NEXT</code>, MDB invokes the walk step function. When the
walk step function returns <code>WALK_NEXT</code>, this indicates that MDB
should call the step function again.</p>
</dd>
<dt class="hdlist1"><code>WALK_DONE</code></dt>
<dd>
<p> The walk has completed successfully. <code>WALK_DONE</code>
can be returned by either the step function to indicate that the walk
is complete, or by the init function to indicate that no steps are
needed (for example, if the given data structure is empty).</p>
</dd>
<dt class="hdlist1"><code>WALK_ERR</code></dt>
<dd>
<p> The walk has terminated due to an error. If
<code>WALK_ERR</code> is returned by the init function, <code>mdb_walk</code> (or
any of its counterparts) returns –1 to indicate that the walker failed
to initialize. If <code>WALK_ERR</code> is returned by the step function, the
walk terminates but <code>mdb_walk</code> returns success.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The &lt;walk_callback&gt; is also expected to return one of the
values above. Therefore, the walk step function&#8217;s job is to determine
the address of the next object, read in a local copy of this object,
call the &lt;walk_callback&gt; function, then return its status.
The step function can also return <code>WALK_DONE</code> or <code>WALK_ERR</code>
without invoking the callback if the walk is complete or if an error
occurred.</p>
</div>
<div class="paragraph">
<p>The walker itself is defined using the <code>mdb_walker_t</code> structure,
defined in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct mdb_walker {
        const char *walk_name;                 /* Walk type name */
        const char *walk_descr;                /* Walk description */
        int (*walk_init)(mdb_walk_state_t *);  /* Walk constructor */
        int (*walk_step)(mdb_walk_state_t *);  /* Walk iterator */
        void (*walk_fini)(mdb_walk_state_t *); /* Walk destructor */
        void *walk_init_arg;                   /* Constructor argument */
} mdb_walker_t;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>walk_name</code> and <code>walk_descr</code> fields should be
initialized to point to strings containing the name and a brief
description of the walker, respectively. A walker is required to have a
non-NULL name and description, and the name cannot contain any of the
MDB meta-characters. The description string is printed by the
<code>::walkers</code> and <code>::dmods</code> built-in dcmds.</p>
</div>
<div class="paragraph">
<p>The <code>walk_init</code>, <code>walk_step</code>, and <code>walk_fini</code> members refer
to the walk functions themselves, as described earlier. The
<code>walk_init</code> and <code>walk_fini</code> members can be set to NULL to
indicate that no special initialization or cleanup actions need to be
taken. The <code>walk_step</code> member cannot be set to NULL. The
<code>walk_init_arg</code> member is used to initialize the <code>walk_arg</code>
member of each new <code>mdb_walk_state_t</code> created for the given
walker, as described earlier. <a href="#api-fig-54">Sample Walker</a> shows a
flowchart for the algorithm of a typical walker.</p>
</div>
<div id="api-fig-54" class="imageblock">
<div class="content">
<img src="figures/proc-t.png" alt="Graphic is described by context.">
</div>
<div class="title">Figure 5. Sample Walker</div>
</div>
<div class="paragraph">
<p>The walker is designed to iterate over the list of <code>proc_t</code>
structures in the kernel. The head of the list is stored in the global
<code>practive</code> variable, and each element&#8217;s <code>p_next</code> pointer points to
the next <code>proc_t</code> in the list. The list is terminated with a NULL
pointer. In the walker&#8217;s <code>init</code> routine, the <code>practive</code> symbol is
located using <code>mdb_lookup_by_name</code> step (1), and its value
is copied into the <code>mdb_walk_state_t</code> pointed to by
&lt;wsp&gt;.</p>
</div>
<div class="paragraph">
<p>In the walker&#8217;s step function, the next <code>proc_t</code> structure in the
list is copied into the debugger&#8217;s address space using <code>mdb_vread</code>
step (2), the callback function is invoked with a pointer to this local
copy, step (3), and then the <code>mdb_walk_state_t</code> is updated
with the address of the <code>proc_t</code> structure for the next iteration.
This update corresponds to following the pointer, step (4), to the next
element in the list.</p>
</div>
<div class="paragraph">
<p>These steps demonstrate the structure of a typical walker: the init
routine locates the global information for a particular data structure,
the step function reads in a local copy of the next data item and passes
it to the callback function, and the address of the next element is
read. Finally, when the walk terminates, the fini function frees any
private storage.</p>
</div>
</div>
<div class="sect2">
<h3 id="api-functions"><a class="anchor" href="#api-functions"></a>10.4. API Functions</h3>
<div class="sect3">
<h4 id="mdb_pwalk"><a class="anchor" href="#mdb_pwalk"></a>10.4.1. <code>mdb_pwalk</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_pwalk(const char *name, mdb_walk_cb_t func, void *data,
              uintptr_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initiate a local walk starting at &lt;addr&gt; using
the walker specified by <em>name</em>, and invoke the callback function
&lt;func&gt; at each step. If &lt;addr&gt; is NULL, a global walk is
performed (that is, the <code>mdb_pwalk</code> invocation is equivalent to the
identical call to <code>mdb_walk</code> without the trailing &lt;addr&gt;
parameter). This function returns 0 for success, or -1 for error. The
<code>mdb_pwalk</code> function fails if the walker itself returns a fatal
error, or if the specified walker name is not known to the debugger. The
walker name may be scoped using the backquote (``) operator if
there are naming conflicts. The &lt;data&gt; parameter is an opaque
argument that has meaning only to the caller; it is passed back to
&lt;func&gt; at each step of the walk.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_walk"><a class="anchor" href="#mdb_walk"></a>10.4.2. <code>mdb_walk</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_walk(const char *name, mdb_walk_cb_t func, void *data);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initiate a global walk using the walker specified by
<em>name</em>, and invoke the callback function &lt;func&gt; at each
step. This function returns 0 for success, or -1 for error. The
<code>mdb_walk</code> function fails if the walker itself returns a fatal
error, or if the specified walker name is not known to the debugger. The
walker name can be scoped using the backquote (``) operator if
there are naming conflicts. The data parameter is an opaque argument
that has meaning only to the caller; it is passed back to &lt;func&gt;
at each step of the walk.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbpwalkdcmd"><a class="anchor" href="#mdbpwalkdcmd"></a>10.4.3. <code>mdb_pwalk_dcmd</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_pwalk_dcmd(const char *wname, const char *dcname, int argc,
                   const mdb_arg_t *argv, uintptr_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initiate a local walk starting at &lt;addr&gt; using
the walker specified by &lt;wname&gt;, and invoke the dcmd specified
by &lt;dcname&gt; with the specified &lt;argc&gt; and &lt;argv&gt;
at each step. This function returns 0 for success, or -1 for error. The
function fails if the walker itself returns a fatal error, if the
specified walker name or dcmd name is not known to the debugger, or if
the dcmd itself returns <code>DCMD_ABORT</code> or <code>DCMD_USAGE</code> to the
walker. The walker name and dcmd name can each be scoped using the
backquote (<code>`) operator if there are naming conflicts. When invoked
from `mdb_pwalk_dcmd</code>, the dcmd will have the <code>DCMD_LOOP</code>
and <code>DCMD_ADDRSPEC</code> bits set in its flags parameter, and the first
call will have <code>DCMD_LOOPFIRST</code> set.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbwalkdcmd"><a class="anchor" href="#mdbwalkdcmd"></a>10.4.4. <code>mdb_walk_dcmd</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_walk_dcmd(const char *wname, const char *dcname, int argc,
                  const mdb_arg_t *argv);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initiate a global walk using the walker specified by
&lt;wname&gt;, and invoke the dcmd specified by &lt;dcname&gt; with
the specified &lt;argc&gt; and &lt;argv&gt; at each step. This
function returns 0 for success, or -1 for error. The function fails if
the walker itself returns a fatal error, if the specified walker name or
dcmd name is not known to the debugger, or if the dcmd itself returns
<code>DCMD_ABORT</code> or <code>DCMD_USAGE</code> to the walker. The walker name and
dcmd name can each be scoped using the backquote (<code>`) operator if
there are naming conflicts. When invoked from `mdb_walk_dcmd</code>,
the dcmd will have the <code>DCMD_LOOP</code> and <code>DCMD_ADDRSPEC</code> bits set
in its flags parameter, and the first call will have
<code>DCMD_LOOPFIRST</code> set.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbcalldcmd"><a class="anchor" href="#mdbcalldcmd"></a>10.4.5. <code>mdb_call_dcmd</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_call_dcmd(const char *name, uintptr_t addr, uint_t flags,
                  int argc, const mdb_arg_t *argv);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Invoke the specified dcmd name with the given parameters.
The dot variable is reset to &lt;addr&gt;, and &lt;addr&gt;,
&lt;flags&gt;, &lt;argc&gt;, and &lt;argv&gt; are passed to the
dcmd. The function returns 0 for success, or -1 for error. The function
fails if the dcmd returns <code>DCMD_ERR</code>, <code>DCMD_ABORT</code>, or
<code>DCMD_USAGE</code>, or if the specified dcmd name is not known to the
debugger. The dcmd name can be scoped using the backquote (``)
operator if there are naming conflicts.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdblayeredwalk"><a class="anchor" href="#mdblayeredwalk"></a>10.4.6. <code>mdb_layered_walk</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_layered_walk(const char *name, mdb_walk_state_t *wsp);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Layer the walk denoted by &lt;wsp&gt; on top of a walk
initiated using the specified walker <em>name</em>. The name can be
scoped using the backquote (``) operator if there are naming
conflicts. Layered walks can be used, for example, to facilitate
constructing walkers for data structures that are embedded in other data
structures.</p>
</div>
<div class="paragraph">
<p>For example, suppose that each CPU structure in the kernel contains a
pointer to an embedded structure. To write a walker for the embedded
structure type, you could replicate the code to iterate over CPU
structures and dereference the appropriate member of each CPU structure,
or you could layer the embedded structure&#8217;s walker on top of the
existing CPU walker.</p>
</div>
<div class="paragraph">
<p>The <code>mdb_layered_walk</code> function is used from within a walker&#8217;s
init routine to add a new layer to the current walk. The underlying
layer is initialized as part of the call to <code>mdb_layered_walk</code>.
The calling walk routine passes in a pointer to its current walk state;
this state is used to construct the layered walk. Each layered walk is
cleaned up after the caller&#8217;s walk fini function is called. If more than
one layer is added to a walk, the caller&#8217;s walk step function will step
through each element returned by the first layer, then the second layer,
and so forth.</p>
</div>
<div class="paragraph">
<p>The <code>mdb_layered_walk</code> function returns 0 for success, or -1 for
error. The function fails if the specified walker name is not known to
the debugger, if the &lt;wsp&gt; pointer is not a valid, active walk
state pointer, if the layered walker itself fails to initialize, or if
the caller attempts to layer the walker on top of itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbaddwalker"><a class="anchor" href="#mdbaddwalker"></a>10.4.7. <code>mdb_add_walker</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_add_walker(const mdb_walker_t *w);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register a new walker with the debugger. The walker is
added to the module&#8217;s namespace, and to the debugger&#8217;s global namespace
according to the name resolution rules described in <a href="#dcmd-and-walker-name-resolution">Dcmd
and Walker Name Resolution</a>. This function returns 0 for success, or -1
for error if the given walker name is already registered by this module,
or if the walker structure &lt;w&gt; is improperly constructed. The
information in the <code>mdb_walker_t</code> &lt;w&gt; is copied to
internal debugger structures, so the caller can reuse or free this
structure after the call to <code>mdb_add_walker</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbremovewalker"><a class="anchor" href="#mdbremovewalker"></a>10.4.8. <code>mdb_remove_walker</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_remove_walker(const char *name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remove the walker with the specified <em>name</em>. This
function returns 0 for success, or -1 for error. The walker is removed
from the current module&#8217;s namespace. The function fails if the walker
name is unknown, or is registered only in another module&#8217;s namespace.
The <code>mdb_remove_walker</code> function can be used to remove walkers
that were added dynamically using <code>mdb_add_walker</code>, or walkers
that were added statically as part of the module&#8217;s linkage structure.
The scoping operator cannot be used in the walker name; it is not legal
for the caller of <code>mdb_remove_walker</code> to attempt to remove a
walker exported by a different module.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbvread-and-mdbvwrite"><a class="anchor" href="#mdbvread-and-mdbvwrite"></a>10.4.9. <code>mdb_vread</code> and <code>mdb_vwrite</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_vread(void *buf, size_t nbytes, uintptr_t addr);
ssize_t mdb_vwrite(const void *buf, size_t nbytes, uintptr_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions provide the ability to
read and write data from a given target virtual address, specified by
the &lt;addr&gt; parameter. The <code>mdb_vread</code> function returns
&lt;nbytes&gt; for success, or -1 for error; if a read is truncated
because only a portion of the data can be read from the specified
address, -1 is returned. The <code>mdb_vwrite</code> function returns the
number of bytes actually written upon success; -1 is returned upon
error.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbfread-and-mdbfwrite"><a class="anchor" href="#mdbfread-and-mdbfwrite"></a>10.4.10. <code>mdb_fread</code> and <code>mdb_fwrite</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_fread(void *buf, size_t nbytes, uintptr_t addr);
ssize_t mdb_fwrite(const void *buf, size_t nbytes, uintptr_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions provide the ability to
read and write data from the object file location corresponding to the
given target virtual address, specified by the <code>addr</code> parameter. The
<code>mdb_fread</code> function returns <code>nbytes</code> for success, or -1 for error;
if a read is truncated because only a portion of the data can be read
from the specified address, -1 is returned. The <code>mdb_fwrite</code>
function returns the number of bytes actually written upon success; -1
is returned upon error.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbpread-and-mdbpwrite"><a class="anchor" href="#mdbpread-and-mdbpwrite"></a>10.4.11. <code>mdb_pread</code> and <code>mdb_pwrite</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_pread(void *buf, size_t nbytes, uint64_t addr);
ssize_t mdb_pwrite(const void *buf, size_t nbytes, uint64_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions provide the ability to
read and write data from a given target physical address, specified by
the &lt;addr&gt; parameter. The <code>mdb_pread</code> function returns
&lt;nbytes&gt; for success, or -1 for error; if a read is truncated
because only a portion of the data can be read from the specified
address, -1 is returned. The <code>mdb_pwrite</code> function returns the
number of bytes actually written upon success; -1 is returned upon
error.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_readstr"><a class="anchor" href="#mdb_readstr"></a>10.4.12. <code>mdb_readstr</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_readstr(char *s, size_t nbytes, uintptr_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mdb_readstr</code> function reads a null-terminated C
string beginning at the target virtual address &lt;addr&gt; into the
buffer addressed by &lt;s&gt;. The size of the buffer is specified by
&lt;nbytes&gt;. If the string is longer than can fit in the buffer,
the string is truncated to the buffer size and a null byte is stored at
<code>s[nbytes - 1]</code>. The length of the string stored in &lt;s&gt;
(not including the terminating null byte) is returned upon success;
otherwise -1 is returned to indicate an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_writestr"><a class="anchor" href="#mdb_writestr"></a>10.4.13. <code>mdb_writestr</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_writestr(const char *s, uintptr_t addr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mdb_writestr</code> function writes a null-terminated
C string from &lt;s&gt; (including the trailing null byte) to the
target&#8217;s virtual address space at the address specified by
&lt;addr&gt;. The number of bytes written (not including the
terminating null byte) is returned upon success; otherwise, -1 is
returned to indicate an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_readsym"><a class="anchor" href="#mdb_readsym"></a>10.4.14. <code>mdb_readsym</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_readsym(void *buf, size_t nbytes, const char *name);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mdb_readsym</code> is similar to <code>mdb_vread</code>, except
that the virtual address at which reading begins is obtained from the
value of the symbol specified by <em>name</em>. If no symbol by that
name is found or a read error occurs, -1 is returned; otherwise
&lt;nbytes&gt; is returned for success.</p>
</div>
<div class="paragraph">
<p>The caller can first look up the symbol separately if it is necessary to
distinguish between symbol lookup failure and read failure. The primary
executable&#8217;s symbol table is used for the symbol lookup; if the symbol
resides in another symbol table, you must first apply
<code>mdb_lookup_by_obj</code>, then <code>mdb_vread</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_writesym"><a class="anchor" href="#mdb_writesym"></a>10.4.15. <code>mdb_writesym</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_writesym(const void *buf, size_t nbytes, const char *name);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mdb_writesym</code> is identical to <code>mdb_vwrite</code>,
except that the virtual address at which writing begins is obtained from
the value of the symbol specified by name. If no symbol by that name is
found, -1 is returned. Otherwise, the number of bytes successfully
written is returned on success, and -1 is returned on error. The primary
executable&#8217;s symbol table is used for the symbol lookup; if the symbol
resides in another symbol table, you must first apply
<code>mdb_lookup_by_obj</code>, then <code>mdb_vwrite</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbreadvar-and-mdbwritevar"><a class="anchor" href="#mdbreadvar-and-mdbwritevar"></a>10.4.16. <code>mdb_readvar</code> and <code>mdb_writevar</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_readvar(void *buf, const char *name);
ssize_t mdb_writevar(const void *buf, const char *name);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mdb_readvar</code> is similar to
<code>mdb_vread</code>, except that the virtual address at which reading begins
and the number of bytes to read are obtained from the value and size of
the symbol specified by <em>name</em>. If no symbol by that name is
found, -1 is returned. The symbol size (the number of bytes read) is
returned on success; -1 is returned on error. This is useful for reading
well-known variables whose sizes are fixed. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>int hz;     /* system clock rate */
mdb_readvar(&amp;hz, "hz");</pre>
</div>
</div>
<div class="paragraph">
<p>The caller can first look up the symbol separately if it is necessary to
distinguish between symbol lookup failure and read failure. The caller
must also carefully check the definition of the symbol of interest in
order to make sure that the local declaration is the exact same type as
the target&#8217;s definition. For example, if the caller declares an <code>int</code>,
and the symbol of interest is actually a <code>long</code>, and the debugger is
examining a 64-bit kernel target, <code>mdb_readvar</code> copies back 8 bytes
to the caller&#8217;s buffer, corrupting the 4 bytes following the storage for
the <code>int</code>.</p>
</div>
<div class="paragraph">
<p><code>mdb_writevar</code> is identical to <code>mdb_vwrite</code>, except that the
virtual address at which writing begins and the number of bytes to write
are obtained from the value and size of the symbol specified by name. If
no symbol by that name is found, -1 is returned. Otherwise, the number
of bytes successfully written is returned on success, and -1 is returned
on error.</p>
</div>
<div class="paragraph">
<p>For both functions, the primary executable&#8217;s symbol table is used for
the symbol lookup; if the symbol resides in another symbol table, you
must first apply <code>mdb_lookup_by_obj</code>, then <code>mdb_vread</code>
or <code>mdb_vwrite</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdblookupbyname-and-mdblookupbyobj"><a class="anchor" href="#mdblookupbyname-and-mdblookupbyobj"></a>10.4.17. <code>mdb_lookup_by_name</code> and <code>mdb_lookup_by_obj</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_lookup_by_name(const char *name, GElf_Sym *sym);
int mdb_lookup_by_obj(const char *object, const char *name, GElf_Sym *sym);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look up the specified symbol name and copy
the ELF symbol information into the <code>GElf_Sym</code> pointed to by
&lt;sym&gt;. If the symbol is found, the function returns 0;
otherwise, -1 is returned. The <em>name</em> parameter specifies the
symbol name. The <em>object</em> parameter tells the debugger where to
look for the symbol. For the <code>mdb_lookup_by_name</code> function,
the object file defaults to <code>MDB_OBJ_EXEC</code>. For
<code>mdb_lookup_by_obj</code>, the object name should be one of the
following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MDB_OBJ_EXEC</code></dt>
<dd>
<p>Look in the executable&#8217;s symbol table (<code>.symtab</code>
section). For kernel crash dumps, this corresponds to the symbol table
from the <code>unix.X</code> file or from <code>/dev/ksyms</code>.</p>
</dd>
<dt class="hdlist1"><code>MDB_OBJ_RTLD</code></dt>
<dd>
<p>Look in the runtime link-editor&#8217;s symbol table. For
kernel crash dumps, this corresponds to the symbol table for the
<code>krtld</code> module.</p>
</dd>
<dt class="hdlist1"><code>MDB_OBJ_EVERY</code></dt>
<dd>
<p>Look in all known symbol tables. For kernel crash
dumps, this includes the <code>.symtab</code> and <code>.dynsym</code> sections from the
<code>unix.X</code> file or <code>/dev/ksyms</code>, as well as per-module symbol tables if
these have been processed.</p>
</dd>
<dt class="hdlist1"><code>object</code></dt>
<dd>
<p>If the name of a particular load object is explicitly specified, the
search is restricted to the symbol table of this object. The object
can be named according to the naming convention for load objects
described in <a href="#symbol-name-resolution">Symbol Name Resolution</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="mdblookupby_addr"><a class="anchor" href="#mdblookupby_addr"></a>10.4.18. <code>mdb_lookup_by_addr</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_lookup_by_addr(uintptr_t addr, uint_t flag, char *buf,
                       size_t len, GElf_Sym *sym);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Locate the symbol corresponding to the specified address
and copy the ELF symbol information into the <code>GElf_Sym</code> pointed to
by &lt;sym&gt; and the symbol name into the character array addressed
by &lt;buf&gt;. If a corresponding symbol is found, the function
returns 0; otherwise -1 is returned.</p>
</div>
<div class="paragraph">
<p>The flag parameter specifies the lookup mode and should be one of the
following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MDB_SYM_FUZZY</code></dt>
<dd>
<p>Allow fuzzy matching to take place, based on the
current symbol distance setting. The symbol distance can be controlled
using the <code>::set</code> <code>s</code> built-in. If an explicit symbol distance has
been set (absolute mode), the address can match a symbol if the
distance from the symbol&#8217;s value to the address does not exceed the
absolute symbol distance. If smart mode is enabled (symbol distance =
0), then the address can match the symbol if it is in the range
[symbol value, symbol value &#43; symbol size).</p>
</dd>
<dt class="hdlist1"><code>MDB_SYM_EXACT</code></dt>
<dd>
<p>Disallow fuzzy matching. The symbol can match only the
address if the symbol value exactly equals the specified address.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a symbol match occurs, the name of the symbol is copied into the
&lt;buf&gt; supplied by the caller. The <em>len</em> parameter
specifies the length of this buffer in bytes. The caller&#8217;s &lt;buf&gt;
should be at least of size <code>MDB_SYM_NAMLEN</code> bytes. The debugger
copies the name to this buffer and appends a trailing null byte. If the
name length exceeds the length of the buffer, the name is truncated but
always includes a trailing null byte.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_getopts"><a class="anchor" href="#mdb_getopts"></a>10.4.19. <code>mdb_getopts</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_getopts(int argc, const mdb_arg_t *argv, ...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parse and process options and option arguments from the
specified argument array (&lt;argv&gt;). The &lt;argc&gt; parameter
denotes the length of the argument array. This function processes each
argument in order, and stops and returns the array index of the first
argument that could not be processed. If all arguments are processed
successfully, &lt;argc&gt; is returned.</p>
</div>
<div class="paragraph">
<p>Following the &lt;argc&gt; and &lt;argv&gt; parameters, the
<code>mdb_getopts</code> function accepts a variable list of arguments
describing the options that are expected to appear in the &lt;argv&gt;
array. Each option is described by an option letter (<code>char</code> argument),
an option type (<code>uint_t</code> argument), and one or two additional
arguments, as shown in the table below. The list of option arguments is
terminated with a NULL argument. The type should be one of one of the
following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MDB_OPT_SETBITS</code></dt>
<dd>
<p>The option will <code>OR</code> the specified bits into a flag word. The option
is described by these parameters:
+
<code>char c, uint_t type, uint_t bits, uint_t *p</code>
+
If type is <code>MDB_OPT_SETBITS</code> and option
&lt;c&gt; is detected in the &lt;argv&gt; list, the debugger will
<code>OR</code> bits into the integer referenced by pointer &lt;p&gt;.</p>
</dd>
<dt class="hdlist1"><code>MDB_OPT_CLRBITS</code></dt>
<dd>
<p>The option clears the specified bits from a flag word. The option is
described by these parameters:
+
<code>char c, uint_t type, uint_t bits, uint_t *p</code>
+
If type is <code>MDB_OPT_CLRBITS</code> and option
&lt;c&gt; is detected in the &lt;argv&gt; list, the debugger
clears bits from the integer referenced by pointer &lt;p&gt;.</p>
</dd>
<dt class="hdlist1"><code>MDB_OPT_STR</code></dt>
<dd>
<p>The option accepts a string argument. The option is described by these
parameters:
+
<code>char c, uint_t type, const char **p</code>
+
If type is <code>MDB_OPT_STR</code> and option
&lt;c&gt; is detected in the &lt;argv&gt; list, the debugger
stores a pointer to the string argument following &lt;c&gt; in the
pointer referenced by &lt;p&gt;.</p>
</dd>
<dt class="hdlist1"><code>MDB_OPT_UINTPTR</code></dt>
<dd>
<p>The option accepts a <code>uintptr_t</code> argument. The option is described
by these parameters:
+
<code>char c, uint_t type, uintptr_t *p</code>
+
If type is <code>MDB_OPT_UINTPTR</code> and option c is
detected in the &lt;argv&gt; list, the debugger stores the integer
argument following &lt;c&gt; in the <code>uintptr_t</code> referenced by
&lt;p&gt;.</p>
</dd>
<dt class="hdlist1"><code>MDB_OPT_UINTPTR_SET</code></dt>
<dd>
<p>The option accepts a <code>uintptr_t</code> argument. The option is described
by these parameters:
+
<code>char c, uint_t type, boolean_t *flag, uintptr_t *p</code>
+
If type is <code>MDB_OPT_UINTPTR_SET</code> and option &lt;c&gt; is
detected in the &lt;argv&gt; list, the debugger stores the value “1”
(TRUE) into the <code>boolean_t</code> referenced by &lt;flag&gt;, and the
integer argument following &lt;c&gt; in the <code>uintptr_t</code>
referenced by &lt;p&gt;.</p>
</dd>
<dt class="hdlist1"><code>MDB_OPT_UINT64</code></dt>
<dd>
<p>The option accepts a <code>uint64_t</code> argument. The option is described
by these parameters:
+
<code>char c, uint_t type, uint64_t *p</code>
+
If type is <code>MDB_OPT_UINT64</code> and option
&lt;c&gt; is detected in the &lt;argv&gt; list, the debugger
stores the integer argument following &lt;c&gt; in the
<code>uint64_t</code> referenced by &lt;p&gt;.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the following source code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">dcmd(uintptr_t addr, uint_t flags, int argc, const mdb_arg_t *argv)
{
        uint_t opt_v = FALSE;
        const char *opt_s = NULL;

        if (mdb_getopts(argc, argv,
            'v', MDB_OPT_SETBITS, TRUE, &amp;opt_v,
            's', MDB_OPT_STR, &amp;opt_s, NULL) != argc)
                return (DCMD_USAGE);

        /* ... */
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>demonstrates how <code>mdb_getopts</code> might be used in a dcmd to accept a
boolean option “<code>v</code>” that sets the &lt;opt_v&gt; variable to TRUE,
and an option “<code>s</code>” that accepts a string argument that is stored in the
&lt;opt_s&gt; variable. The <code>mdb_getopts</code> function also
automatically issues warning messages if it detects an invalid option
letter or missing option argument before returning to the caller. The
storage for argument strings and the &lt;argv&gt; array is
automatically garbage-collected by the debugger upon completion of the
dcmd.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_strtoull"><a class="anchor" href="#mdb_strtoull"></a>10.4.20. <code>mdb_strtoull</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">u_longlong_t mdb_strtoull(const char *s);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Convert the specified string &lt;s&gt; to an
<code>unsigned long long</code> representation. This function is intended for use
in processing and converting string arguments in situations where
<code>mdb_getopts</code> is not appropriate. If the string argument cannot be
converted to a valid integer representation, the function fails by
printing an appropriate error message and aborting the dcmd. Therefore,
error checking code is not required. The string can be prefixed with any
of the valid base specifiers (0i, 0I, 0o, 0O, 0t, 0T, 0x, or 0X);
otherwise, it is interpreted using the default base. The function will
fail and abort the dcmd if any of the characters in &lt;s&gt; are not
appropriate for the base, or if integer overflow occurs.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdballoc-mdbzalloc-and-mdb_free"><a class="anchor" href="#mdballoc-mdbzalloc-and-mdb_free"></a>10.4.21. <code>mdb_alloc</code>, <code>mdb_zalloc</code> and <code>mdb_free</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void *mdb_alloc(size_t size, uint_t flags);
void *mdb_zalloc(size_t size, uint_t flags);
void mdb_free(void *buf, size_t size);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mdb_alloc</code> allocates
<em>size</em> bytes of debugger memory and returns a pointer to the
allocated memory. The allocated memory is at least double-word aligned,
so it can hold any C data structure. No greater alignment can be
assumed. The &lt;flags&gt; parameter should be the bitwise <code>OR</code> of one
or more of the following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>UM_NOSLEEP</code></dt>
<dd>
<p>If sufficient memory to fulfill the request is not
immediately available, return NULL to indicate failure. The caller
must check for NULL and handle this case appropriately.</p>
</dd>
<dt class="hdlist1"><code>UM_SLEEP</code></dt>
<dd>
<p>If sufficient memory to fulfill the request is not
immediately available, sleep until such time as the request can be
fulfilled. As a result, <code>UM_SLEEP</code> allocations are guaranteed to
succeed. The caller need not check for a NULL return value.</p>
</dd>
<dt class="hdlist1"><code>UM_GC</code></dt>
<dd>
<p>Garbage-collect allocation automatically at the end of
this debugger command. The caller should not subsequently call
<code>mdb_free</code> on this block, as the debugger will take care of
deallocation automatically. All memory allocation from within a dcmd
must use <code>UM_GC</code> so that if the dcmd is interrupted by the user,
the debugger can garbage-collect the memory.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>mdb_zalloc</code> is like <code>mdb_alloc</code>, but the allocated memory is
filled with zeroes before returning it to the caller. No guarantees are
made about the initial contents of memory returned by <code>mdb_alloc</code>.
<code>mdb_free</code> is used to free previously allocated memory (unless it
was allocated <code>UM_GC</code>). The buffer address and size must exactly
match the original allocation. It is not legal to free only a portion of
an allocation with <code>mdb_free</code>. It is not legal to free an allocation
more than once. An allocation of zero bytes always returns NULL; freeing
a NULL pointer with size zero always succeeds.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_printf"><a class="anchor" href="#mdb_printf"></a>10.4.22. <code>mdb_printf</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void mdb_printf(const char *format, ...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Print formatted output using the specified format string
and arguments. Module writers should use <code>mdb_printf</code> for all
output, except for warning and error messages. This function
automatically triggers the built-in output pager when appropriate. The
<code>mdb_printf</code> function is similar to <code>printf(3C)</code>, with certain
exceptions: the <code>%C</code>, <code>%S</code>, and <code>%ws</code> specifiers for wide character
strings are not supported, the <code>%f</code> floating-point format is not
supported, the <code>%e</code>, <code>%E</code>, <code>%g</code>, and <code>%G</code> specifiers for alternative
double formats produce only a single style of output, and precision
specifications of the form <code>%.n</code> are not supported. The list of
specifiers that are supported follows:</p>
</div>
<div class="sect4">
<h5 id="flag-specifiers"><a class="anchor" href="#flag-specifiers"></a>Flag Specifiers</h5>
<div class="paragraph">
<p>flag specifiers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%#</code></dt>
<dd>
<p>If the <code>#</code> sign is found in the format string, this selects the
alternate form of the given format. Not all formats have an alternate
form; the alternate form is different depending on the format. Refer
to the format descriptions below for details on the alternate format.</p>
</dd>
<dt class="hdlist1"><code>%&#43;</code></dt>
<dd>
<p>When printing signed values, always display the sign (prefix with
either '&#43;' or '-'). Without <code>%&#43;</code>, positive values have no
sign prefix, and negative values have a '-' prefix prepended to them.</p>
</dd>
<dt class="hdlist1"><code>%-</code></dt>
<dd>
<p>Left-justify the output within the specified field width. If the width
of the output is less than the specified field width, the output will
be padded with blanks on the right-hand side. Without <code>%-</code>, values are
right-justified by default.</p>
</dd>
<dt class="hdlist1"><code>%0</code></dt>
<dd>
<p>Zero-fill the output field if the output is right-justified and the
width of the output is less than the specified field width. Without
<code>%0</code>, right-justified values are prepended with blanks in order to
fill the field.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="field-width-specifiers"><a class="anchor" href="#field-width-specifiers"></a>Field Width Specifiers</h5>
<div class="paragraph">
<p>field width specifiers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%n</code></dt>
<dd>
<p>Field width is set to the specified decimal value.</p>
</dd>
<dt class="hdlist1"><code>%?</code></dt>
<dd>
<p>Field width is set to the maximum width of a hexadecimal pointer
value. This is 8 in an ILP32 environment, and 16 in an LP64
environment.</p>
</dd>
<dt class="hdlist1"><code>%*</code></dt>
<dd>
<p>Field width is set to the value specified at the current position in
the argument list. This value is assumed to be an <code>int</code>. Note that in
the 64-bit compilation environment, it may be necessary to cast <code>long</code>
values to <code>int</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="integer-specifiers"><a class="anchor" href="#integer-specifiers"></a>Integer Specifiers</h5>
<div class="paragraph">
<p>integer specifiers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%h</code></dt>
<dd>
<p>Integer value to be printed is a <code>short</code>.</p>
</dd>
<dt class="hdlist1"><code>%l</code></dt>
<dd>
<p>Integer value to be printed is a <code>long</code>.</p>
</dd>
<dt class="hdlist1"><code>%ll</code></dt>
<dd>
<p>Integer value to be printed is a <code>long long</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="terminal-attribute-specifiers"><a class="anchor" href="#terminal-attribute-specifiers"></a>Terminal Attribute Specifiers</h5>
<div class="paragraph">
<p>terminal attribute specifiers</p>
</div>
<div class="paragraph">
<p>If standard output for the debugger is a terminal, and terminal
attributes can be obtained by the terminfo database, the following
terminal escape constructs can be used:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%&lt;n&gt;</code></dt>
<dd>
<p>Enable the terminal attribute corresponding to &lt;n&gt;. Only a
single attribute can be enabled with each instance of <code>%&lt;&gt;</code>.</p>
</dd>
<dt class="hdlist1"><code>%&lt;/n&gt;</code></dt>
<dd>
<p>Disable the terminal attribute corresponding to &lt;n&gt;. Note that
in the case of reverse video, dim text, and bold text, the terminal
codes to disable these attributes might be identical. Therefore, it
might not be possible to disable these attributes independently of one
another.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If no terminal information is available, each terminal attribute
construct is ignored by <code>mdb_printf</code>. For more information on
terminal attributes, see <code>terminfo(5)</code>. The available terminfo
attributes are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>a</code></dt>
<dd>
<p>Alternate character set</p>
</dd>
<dt class="hdlist1"><code>b</code></dt>
<dd>
<p>Bold text</p>
</dd>
<dt class="hdlist1"><code>d</code></dt>
<dd>
<p>Dim text</p>
</dd>
<dt class="hdlist1"><code>r</code></dt>
<dd>
<p>Reverse video</p>
</dd>
<dt class="hdlist1"><code>s</code></dt>
<dd>
<p>Best standout capability</p>
</dd>
<dt class="hdlist1"><code>u</code></dt>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="format-specifiers"><a class="anchor" href="#format-specifiers"></a>Format Specifiers</h5>
<div class="paragraph">
<p>format specifiers</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%%</code></dt>
<dd>
<p>The “<code>%</code>” symbol is printed.</p>
</dd>
<dt class="hdlist1"><code>%a</code></dt>
<dd>
<p>Prints an address in symbolic form. The minimum size of the value
associated with <code>%a</code> is a <code>uintptr_t</code>; specifying <code>%la</code> is not
necessary. If address-to-symbol conversion is on, the debugger will
attempt to convert the address to a symbol name followed by an offset
in the current output radix and print this string; otherwise, the
value is printed in the default output radix. If <code>%#a</code> is used, the
alternate format adds a “<code>:</code>” suffix to the output.</p>
</dd>
<dt class="hdlist1"><code>%A</code></dt>
<dd>
<p>This format is identical to <code>%a</code>, except when an address cannot be
converted to a symbol name plus an offset, nothing is printed. If
<code>%#A</code> is used, the alternate format prints a “<code>?</code>” when address
conversion fails.</p>
</dd>
<dt class="hdlist1"><code>%b</code></dt>
<dd>
<p> Decode and print a bit field in symbolic form. This
specifier expects two consecutive arguments: the bit field value
(<code>int</code> for <code>%b</code>, <code>long</code> for <code>%lb</code>, and so forth), and a pointer to an
array of <code>mdb_bitmask_t</code> structures:
+</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct mdb_bitmask {
    const char *bm_name;       /* String name to print */
    u_longlong_t bm_mask;      /* Mask for bits */
    u_longlong_t bm_bits;      /* Result for value &amp; mask */
} mdb_bitmask_t;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+
The array should be terminated by a structure whose `bm++_++name`
field is set to NULL. When `%b` is used, the debugger reads the value
argument, then iterates through each `mdb++_++bitmask` structure
checking to see if:
+
`(value &amp; bitmask-&gt;bm++_++mask) == bitmask-&gt;bm++_++bits`
+
If this expression is true, the `bm++_++name` string is printed. Each
string printed is separated by a comma. The following example shows
how `%b` can be used to decode the `t++_++flag` field in a
`kthread_t`:
+</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">const mdb_bitmask_t t_flag_bits[] = {
    { "T_INTR_THREAD", T_INTR_THREAD, T_INTR_THREAD },
    { "T_WAKEABLE", T_WAKEABLE, T_WAKEABLE },
    { "T_TOMASK", T_TOMASK, T_TOMASK },
    { "T_TALLOCSTK", T_TALLOCSTK, T_TALLOCSTK },
    ...
    { NULL, 0, 0 }
};

thr_dump(kthread_t *t)
{
    mdb_printf("t_flag = &lt;%hb&gt;\n", t-&gt;t_flag, t_flag_bits);

    ...
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+
If `t++_++flag` was set to 0x000a, the function would print:
+</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>t_flag = &lt;T_WAKEABLE,T_TALLOCSTK&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  +
  If `%#b` is specified, the union of all bits that were not matched by
  an element in the bitmask array is printed as a hexadecimal value
  following the decoded names.
`%c`::
  Print the specified integer as an ASCII character.
`%d`::
  Print the specified integer as a signed decimal value. Same as `%i`.
  If `%#d` is specified, the alternate format prefixes the value with
  “`0t`”.
`%e`::
  Print the specified double in the floating-point format
  `++[++{plus}/-++]++d.ddddddde++[++{plus}/-++]++dd`, where there is one
  digit before the radix character, seven digits of precision, and at
  least two digits following the exponent.
`%E`::
  Print the specified double using the same rules as `%e`, except that
  the exponent character will be “`E`” instead of “`e`”.
`%g`::
  Print the specified double in the same floating-point format as `%e`,
  but with sixteen digits of precision. If `%llg` is specified, the
  argument is expected to be of type `long double` (quad-precision
  floating-point value).
`%G`::
  Print the specified double using the same rules as `%g`, except that
  the exponent character will be “`E`” instead of “`e`”.
`%i`::
  Print the specified integer as a signed decimal value. Same as `%d`.
  If `%#i` is specified, the alternate format prefixes the value with
  “`0t`”.
`%I`::
  Print the specified 32-bit unsigned integer as an Internet IPv4
  address in dotted-decimal format (for example, the hexadecimal value
  `0xffffffff` would print as `255.255.255.255`).
`%m`::
  Print a margin of whitespace. If no field is specified, the default
  output margin width is used; otherwise, the field width determines the
  number of characters of white space that are printed.
`%N`::
  Print the specified `in6++_++addr++_++t` as an Internet IPv6 addresss
  in colon delineated form.
`%o`::
  Print the specified integer as an unsigned octal value. If `%#o` is
  used, the alternate format prefixes the output with “`0`”.
`%p`::
  Print the specified pointer (`void ++*++`) as a hexadecimal value.
`%q`::
  Print the specified integer as a signed octal value. If `%#q` is used,
  the alternate format prefixes the output with “`0`”.
`%r`::
  Print the specified integer as an unsigned value in the current output
  radix. The user can change the output radix using the `$d` dcmd. If
  `%#r` is specified, the alternate format prefixes the value with the
  appropriate base prefix: “`0i`” for binary, “`0o`” for octal, “`0t`”
  for decimal, or “`0x`” for hexadecimal.
`%R`::
  Print the specified integer as a signed value in the current output
  radix. If `%#R` is specified, the alternate format prefixes the value
  with the appropriate base prefix.
`%s`::
  Print the specified string (`char ++*++`). If the string pointer is
  NULL, the string “`++&lt;++NULL&gt;`” is printed.
`%t`::
  Advance one or more tab stops. If no width is specified, output
  advances to the next tab stop; otherwise the field width determines
  how many tab stops are advanced.
`%T`::
  Advance the output column to the next multiple of the field width. If
  no field width is specified, no action is taken. If the current output
  column is not a multiple of the field width, white space is added to
  advance the output column.
`%u`::
  Print the specified integer as an unsigned decimal value. If `%#u` is
  specified, the alternate format prefixes the value with “`0t`”.
`%x`::
  Print the specified integer as a hexadecimal value. The characters a-f
  are used as the digits for the values 10-15. If `%#x` is specified,
  the alternate format prefixes the value with “`0x`”.
`%X`::
  Print the specified integer as a hexadecimal value. The characters A-F
  are used as the digits for the values 10-15. If `%#X` is specified,
  the alternate format prefixes the value with “`0X`”.
`%Y`::
  The specified `time++_++t` is printed as the string
  “`year month day HH:MM:SS`”.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mdb_snprintf"><a class="anchor" href="#mdb_snprintf"></a>10.4.23. <code>mdb_snprintf</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">size_t mdb_snprintf(char *buf, size_t len, const char *format, ...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Construct a formatted string based on the specified
format string and arguments, and store the resulting string into the
specified &lt;buf&gt;. The <code>mdb_snprintf</code> function accepts the
same format specifiers and arguments as the <code>mdb_printf</code> function.
The <em>len</em> parameter specifies the size of &lt;buf&gt; in
bytes. No more than <em>len</em> - 1 formatted bytes are placed in
&lt;buf&gt;; <code>mdb_snprintf</code> always terminates &lt;buf&gt; with a
null byte. The function returns the number of bytes required for the
complete formatted string, not including the terminating null byte. If
the &lt;buf&gt; parameter is NULL and <em>len</em> is set to zero,
the function will not store any characters to &lt;buf&gt; and returns
the number of bytes required for the complete formatted string; this
technique can be used to determine the appropriate size of a buffer for
dynamic memory allocation.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_warn"><a class="anchor" href="#mdb_warn"></a>10.4.24. <code>mdb_warn</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void mdb_warn(const char *format, ...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Print an error or warning message to standard error. The
<code>mdb_warn</code> function accepts a format string and variable argument
list that can contain any of the specifiers documented for
<code>mdb_printf</code>. However, the output of <code>mdb_warn</code> is sent to
standard error, which is not buffered and is not sent through the output
pager or processed as part of a dcmd pipeline. All error messages are
automatically prefixed with the string “<code>mdb:</code>”.</p>
</div>
<div class="paragraph">
<p>In addition, if the <em>format</em> parameter does not contain a
newline (<code>\n</code>) character, the format string is implicitly suffixed
with the string “<code>: %s\n</code>”, where <code>%s</code> is replaced by the error
message string corresponding to the last error recorded by a module API
function. For example, the following source code:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>if (mdb_lookup_by_name("no_such_symbol", &amp;sym) == -1)
    mdb_warn("lookup_by_name failed");</pre>
</div>
</div>
<div class="paragraph">
<p>produces this output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mdb: lookup_by_name failed: unknown symbol name</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mdb_flush"><a class="anchor" href="#mdb_flush"></a>10.4.25. <code>mdb_flush</code></h4>
<div class="literalblock">
<div class="content">
<pre>void mdb_flush(void);</pre>
</div>
</div>
<div class="paragraph">
<p>Flush all currently buffered output. Normally, <code>mdb&#8217;s
standard output is line-buffered; output generated using
`mdb_printf</code> is not flushed to the terminal (or other standard
output destination) until a newline is encountered, or at the end of the
current dcmd. However, in some situations you might want to explicitly
flush standard output prior to printing a newline; <code>mdb_flush</code> can
be used for this purpose.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdb_nhconvert"><a class="anchor" href="#mdb_nhconvert"></a>10.4.26. <code>mdb_nhconvert</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void mdb_nhconvert(void *dst, const void *src, size_t nbytes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Convert a sequence of <code>nbytes</code> bytes stored at the
address specified by <code>src</code> from network byte order to host byte order
and store the result at the address specified by <code>dst</code>. The <code>src</code> and
<code>dst</code> parameters may be the same, in which case the object is converted
in place. This function may be used to convert from host order to
network order or from network order to host order, since the conversion
is the same in either case.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbdumpptr-and-mdbdump64"><a class="anchor" href="#mdbdumpptr-and-mdbdump64"></a>10.4.27. <code>mdb_dumpptr</code> and <code>mdb_dump64</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_dumpptr(uintptr_t addr, size_t nbytes, uint_t flags,
                mdb_dumpptr_cb_t func, void *data);
int mdb_dump64(uint64_t addr, uint64_t nbytes, uint_t flags,
mdb_dump64_cb_t func, void *data);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions can be used to generate
formatted hexadecimal and ASCII data dumps that are printed to standard
output. Each function accepts an <code>addr</code> parameter specifying the
starting location, a <code>nbytes</code> parameter specifying the number of bytes
to display, a set of flags described below, a func callback function to
use to read the data to display, and a data parameter that is passed to
each invocation of the callback func as its last argument. The functions
are identical in every regard except that <code>mdb_dumpptr</code> uses
<code>uintptr_t</code> for its address parameters and <code>mdb_dump64</code> uses
<code>uint64_t</code>. This distinction is useful when combining
<code>mdb_dump64</code> with <code>mdb_pread</code>, for example. The built-in
<code>::dump</code> dcmd uses these functions to perform its data display.</p>
</div>
<div class="paragraph">
<p>The flags parameter should be the bitwise OR of one or more of the
following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MDB_DUMP_RELATIVE</code></dt>
<dd>
<p> Number lines relative to the start address instead of
with the explicit address of each line.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_ALIGN</code></dt>
<dd>
<p>Align the output at a paragraph boundary.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_PEDANT</code></dt>
<dd>
<p> Display full-width addresses instead of truncating the
address to fit the output in 80 columns.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_ASCII</code></dt>
<dd>
<p>Display ASCII values next to the hexadecimal data.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_HEADER</code></dt>
<dd>
<p>Display a header line about the data.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_TRIM</code></dt>
<dd>
<p> Only read from and display the contents of the
specified addresses, instead of reading and printing entire lines.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_SQUISH</code></dt>
<dd>
<p> Elide repeated lines by placing a “*” on a line
that is a repeat of the previous line.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_NEWDOT</code></dt>
<dd>
<p> Update the value of dot to the address beyond the last
address read by the function.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_ENDIAN</code></dt>
<dd>
<p> Adjust for endianness. This option assumes that the
word size is equal to the current group size, specified by
<code>MDB_DUMP_GROUP</code>. This option will always turn off alignment,
headers, and ASCII display to avoid confusing output. If
<code>MDB_DUMP_TRIM</code> is set with <code>MDB_DUMP_ENDIAN</code>, the
number of bytes dumped will be rounded down to the nearest word size
bytes.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_WIDTH(`<em>width</em></code>)`</dt>
<dd>
<p> Increase the number of 16-byte paragraphs per line that
are displayed. The default value of <em>width</em> is one, and the
maximum value is 16.</p>
</dd>
<dt class="hdlist1"><code>MDB_DUMP_GROUP(`<em>group</em></code>)`</dt>
<dd>
<p> Set the byte group size to <em>group</em>. The default
<em>group</em> size is four bytes. The <em>group</em> size must be a
power of two that divides the line width.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="mdbonebit"><a class="anchor" href="#mdbonebit"></a>10.4.28. <code>mdb_one_bit</code></h4>
<div class="literalblock">
<div class="content">
<pre>const char *mdb_one_bit(int width, int bit, int on);</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mdb_one_bit</code> function can be used to print a
graphical representation of a bit field in which a single bit of
interest is turned on or off. This function is useful for creating
verbose displays of bit fields similar to the output from
<code>snoop(1M) -v</code>. For example, the following source code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#define FLAG_BUSY       0x1

uint_t flags;

/* ... */

mdb_printf("%s = BUSY\n", mdb_one_bit(8, 0, flags &amp; FLAG_BUSY));</code></pre>
</div>
</div>
<div class="paragraph">
<p>produces this output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.... ...1 = BUSY</pre>
</div>
</div>
<div class="paragraph">
<p>Each bit in the bit field is printed as a period (<code>.</code>), with each 4-bit
sequence separated by a white space. The bit of interest is printed as 1
or 0, depending on the setting of the &lt;on&gt; parameter. The total
<em>width</em> of the bit field in bits is specified by the width
parameter, and the bit position of the bit of interest is specified by
the &lt;bit&gt; parameter. Bits are numbered starting from zero. The
function returns a pointer to an appropriately sized, null-terminated
string containing the formatted bit representation. The string is
automatically garbage-collected upon completion of the current dcmd.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbinvalbits"><a class="anchor" href="#mdbinvalbits"></a>10.4.29. <code>mdb_inval_bits</code></h4>
<div class="literalblock">
<div class="content">
<pre>const char *mdb_inval_bits(int width, int start, int stop);</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mdb_inval_bits</code> function is used, along with
<code>mdb_one_bit</code>, to print a graphical representation of a bit
field. This function marks a sequence of bits as invalid or reserved by
displaying an “<code>x</code>” at the appropriate bit location. Each bit in the bit
field is represented as a period (<code>.</code>), except for those bits in the
range of bit positions specified by the start and stop parameters. Bits
are numbered starting from zero. For example, the following source code:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mdb_printf("%s = reserved\n", mdb_inval_bits(8, 7, 7));</pre>
</div>
</div>
<div class="paragraph">
<p>produces this output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>x... .... = reserved</pre>
</div>
</div>
<div class="paragraph">
<p>The function returns a pointer to an appropriately sized,
null-terminated string containing the formatted bit representation. The
string is automatically garbage-collected upon completion of the current
dcmd.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbincindent-and-mdbdecindent"><a class="anchor" href="#mdbincindent-and-mdbdecindent"></a>10.4.30. <code>mdb_inc_indent</code> and <code>mdb_dec_indent</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ulong_t mdb_inc_indent(ulong_t n);
ulong_t mdb_dec_indent(ulong_t n);</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  These functions increment and decrement
the numbers of columns that MDB will auto-indent with white space before
printing a line of output. The size of the delta is specified by
++&lt;++n&gt;, a number of columns. Each function returns the previous
absolute value of the indent. Attempts to decrement the indent below
zero have no effect. Following a call to either function, subsequent
calls to `mdb++_++printf` are indented appropriately. If the dcmd
completes or is forcibly terminated by the user, the indent is restored
automatically to its default setting by the debugger.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mdb_eval"><a class="anchor" href="#mdb_eval"></a>10.4.31. <code>mdb_eval</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int mdb_eval(const char *s);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Evaluate and execute the specified command string
&lt;s&gt;, as if it had been read from standard input by the debugger.
This function returns 0 for success, or -1 for error. <code>mdb_eval</code>
fails if the command string contains a syntax error, or if the command
string executed by <code>mdb_eval</code> is forcibly aborted by the user using
the pager or by issuing an interrupt.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbsetdot-and-mdbgetdot"><a class="anchor" href="#mdbsetdot-and-mdbgetdot"></a>10.4.32. <code>mdb_set_dot</code> and <code>mdb_get_dot</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void mdb_set_dot(uintmax_t dot);
uintmax_t mdb_get_dot(void);</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  Set or get the current value of dot (the
“`.`” variable). Module developers might want to reposition dot so that,
for example, it refers to the address following the last address read by
the dcmd.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mdbgetpipe"><a class="anchor" href="#mdbgetpipe"></a>10.4.33. <code>mdb_get_pipe</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void mdb_get_pipe(mdb_pipe_t *p);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Retrieve the contents of the pipeline input buffer for
the current dcmd. The <code>mdb_get_pipe</code> function is intended to be
used by dcmds that want to consume the complete set of pipe input and
execute only once, instead of being invoked repeatedly by the debugger
for each pipe input element. Once <code>mdb_get_pipe</code> is invoked, the
dcmd will not be invoked again by the debugger as part of the current
command. This can be used, for example, to construct a dcmd that sorts a
set of input values.</p>
</div>
<div class="paragraph">
<p>The pipe contents are placed in an array that is garbage-collected upon
termination of the dcmd, and the array pointer is stored in
<code>p&#8594;pipe_data</code>. The length of the array is placed in
<code>p&#8594;pipe_len</code>. If the dcmd was not executed on the right-hand
side of a pipeline (that is, the <code>DCMD_PIPE</code> flag was not set in its
<code>flags</code> parameter), <code>p&#8594;pipe_data</code> is set to NULL and
<code>p&#8594;pipe_len</code> is set to zero.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbsetpipe"><a class="anchor" href="#mdbsetpipe"></a>10.4.34. <code>mdb_set_pipe</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void mdb_set_pipe(const mdb_pipe_t *p);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set the pipeline output buffer to the contents described by the pipe
structure &lt;p&gt;. The pipe values are placed in the array
<code>p&#8594;pipe_data</code>, and the length of the array is stored in
<code>p&#8594;pipe_len</code>. The debugger makes its own copy of this
information, so the caller must remember to free <code>p&#8594;pipe_data</code>
if necessary. If the pipeline output buffer was previously non-empty,
its contents are replaced by the new array. If the dcmd was not executed
on the left side of a pipeline (that is, the <code>DCMD_PIPE_OUT</code>
flag was not set in its flags parameter), this function has no effect.</p>
</div>
</div>
<div class="sect3">
<h4 id="mdbgetxdata"><a class="anchor" href="#mdbgetxdata"></a>10.4.35. <code>mdb_get_xdata</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">ssize_t mdb_get_xdata(const char *name, void *buf, size_t nbytes);</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  Read the contents of the target external
data buffer specified by name into the buffer specified by
++&lt;++buf&gt;. The size of ++&lt;++buf&gt; is specified by the
++&lt;++nbytes&gt; parameter; no more than ++&lt;++nbytes&gt; will be copied
to the caller's buffer. The total number of bytes read will be returned
upon success; -1 will be returned upon error. If the caller wants to
determine the size of a particular named buffer, ++&lt;++buf&gt; should be
specified as NULL and ++&lt;++nbytes&gt; should be specified as zero. In
this case, `mdb++_++get++_++xdata` will return the total size of the
buffer in bytes but no data will be read. External data buffers provide
module writers access to target data that is not otherwise accessible
through the module API. The set of named buffers exported by the current
target can be viewed using the `::xdata` built-in dcmd.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="additional-functions"><a class="anchor" href="#additional-functions"></a>10.4.36. Additional Functions</h4>
<div class="paragraph">
<p>Additionally, module writers can use the following
<code>string(3C)</code> and <code>bstring(3C)</code> functions. They are guaranteed to have
the same semantics as the functions described in the corresponding
illumos manual page.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strcat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strcpy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strncpy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strchr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strrchr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strcmp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strncmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strcasecmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strncasecmp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strlen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bcmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bcopy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bzero</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bsearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qsort</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="options"><a class="anchor" href="#options"></a>11. Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix provides a reference for MDB command-line options.</p>
</div>
<div class="sect2">
<h3 id="summary-of-command-line-options"><a class="anchor" href="#summary-of-command-line-options"></a>11.1. Summary of Command-line Options</h3>
<div class="literalblock">
<div class="content">
<pre>mdb [ -fkmuwyAFMS ]  [ +o option ]  [ -p pid ]  [ -s distance]
    [ -I path ]  [ -L path ]  [ -P prompt ]  [ -R root ]
    [ -V dis-version ]  [ object  [ core ]  | core  | suffix ]</pre>
</div>
</div>
<div class="paragraph">
<p>The following options are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>A</code></dt>
<dd>
<p>Disables automatic loading of <code>mdb</code> modules. By default, <code>mdb</code>
attempts to load debugger modules corresponding to the active shared
libraries in a user process or core file, or to the loaded kernel
modules in the live operating system or an operating system crash
dump.</p>
</dd>
<dt class="hdlist1"><code>F</code></dt>
<dd>
<p>Forcibly takes over the specified user process, if necessary. By
default, <code>mdb</code> refuses to attach to a user process that is already
under the control of another debugging tool, such as <code>truss(1)</code>. With
the <code>F</code> option, <code>mdb</code> attaches to these processes anyway. This can
produce unexpected interactions between <code>mdb</code> and the other tools
attempting to control the process.</p>
</dd>
<dt class="hdlist1"><code>f</code></dt>
<dd>
<p>Force raw file debugging mode. By default, <code>mdb</code> attempts to infer
whether the object and core file operands refer to a user executable
and core dump or to a pair of operating system crash dump files. If
the file type cannot be inferred, the debugger will default to
examining the files as plain binary data. The <code>f`option forces `mdb</code>
to interpret the arguments as a set of raw files to examine</p>
</dd>
<dt class="hdlist1"><code>I</code></dt>
<dd>
<p>Sets default path for locating macro files. Macro files are read using
the <code>$&lt;</code> or <code>$&lt;&lt;</code> dcmds. The path is a sequence of directory
names delimited by colon ( <code>:</code>) characters. The <code>I</code> <code>include</code> path and
<code>L</code> <code>library</code> path (see below) can also contain any of the following
tokens:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1">%i</dt>
<dd>
<p>Expands to the current instruction set architecture (ISA) name:
<code>sparc</code>, <code>sparcv9</code>, <code>i386</code>, or <code>amd64</code>.</p>
</dd>
<dt class="hdlist1">%o</dt>
<dd>
<p>Expands to the old value of the path being modified. This is useful
for appending or prepending directories to an existing path.</p>
</dd>
<dt class="hdlist1">%p</dt>
<dd>
<p>Expands to the current platform string (either <code>uname</code> <code>i</code> or the
platform string stored in the process core file or crash dump).</p>
</dd>
<dt class="hdlist1">%r</dt>
<dd>
<p>Expands to the path name of the root directory. An alternate root
directory can be specified using the <code>R</code> option. If no <code>R</code> option is
present, the root directory is derived dynamically from the path to
the <code>mdb</code> executable itself. For example, if <code>/bin/mdb</code> is executed,
the root directory is <code>/</code>. If <code>/net/hostname/bin/mdb</code> were executed,
the root directory would be derived as <code>/net/hostname</code>.</p>
</dd>
<dt class="hdlist1">%t</dt>
<dd>
<p>  Expands to the name of the current target. This is either the
  literal string “<code>proc</code>” (a user process or user process core file),
  or “<code>kvm</code>” (a kernel crash dump or the live operating system).
+
The default include path for 32-bit <code>mdb</code>
is:`%r/usr/platform/%p/lib/adb:%r/usr/lib/adb`
+
The default include path for 64-bit <code>mdb</code>
is:`%r/usr/platform/%p/lib/adb/%i:%r/usr/lib/adb/%i`</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>k</code></dt>
<dd>
<p>Forces kernel debugging mode. By
default, <code>mdb</code> attempts to infer whether the object and core file
operands refer to a user executable and core dump, or to a pair of
operating system crash dump files. The <code>k</code> option forces <code>mdb</code> to
assume these files are operating system crash dump files. If no object
or core operand is specified, but the <code>k</code> option is specified, <code>mdb</code>
defaults to an object file of <code>/dev/ksyms</code> and a core file of
<code>/dev/kmem</code>. Access to <code>/dev/kmem</code> is restricted to group sys.</p>
</dd>
<dt class="hdlist1"><code>K</code></dt>
<dd>
<p>Load <code>kmdb</code>, stop the live running operating system kernel, and
proceed to the <code>kmdb</code> debugger prompt. This option should only be used
on the system console, as the subsequent <code>kmdb</code> prompt will appear on
the system console.</p>
</dd>
<dt class="hdlist1"><code>L</code></dt>
<dd>
<p>Sets default path for locating debugger modules. Modules are loaded
automatically on startup or by using the <code>::load</code> dcmd. The path is a
sequence of directory names delimited by colon (<code>:</code>) characters. The
<code>L</code> library path can also contain any of the tokens shown for <code>I</code>
above.</p>
</dd>
<dt class="hdlist1"><code>m</code></dt>
<dd>
<p>Disables demand-loading of kernel module symbols. By default, <code>mdb</code>
processes the list of loaded kernel modules and performs demand
loading of per-module symbol tables. If the <code>m</code> option is specified,
<code>mdb</code> does not attempt to process the kernel module list or provide
per-module symbol tables. As a result, <code>mdb</code> modules corresponding to
active kernel modules are not loaded on startup.</p>
</dd>
<dt class="hdlist1"><code>M</code></dt>
<dd>
<p>Preloads all kernel module symbols. By default, <code>mdb</code> performs
demand-loading for kernel module symbols: the complete symbol table
for a module is read when an address is that module&#8217;s text or data
section is referenced. With the <code>M</code> option, <code>mdb</code> loads the complete
symbol table of all kernel modules during startup.</p>
</dd>
<dt class="hdlist1"><code>o</code> <em>option</em></dt>
<dd>
<p>Enables the specified debugger option. If the <code>o</code> form of the option
is used, the specified option is disabled. Unless noted below, each
option is off by default. <code>mdb</code> recognizes the following option
arguments:
+</p>
<div class="dlist">
<dl>
<dt class="hdlist1">adb</dt>
<dd>
<p>Enable stricter <code>adb(1)</code> compatibility. The prompt is set to the
empty string and many <code>mdb</code> features, such as the output pager, are
disabled.</p>
</dd>
<dt class="hdlist1">array_mem_limit=&lt;limit&gt;</dt>
<dd>
<p>Set the default limit on the number of array members that <code>::print</code>
will display. If &lt;limit&gt; is the special token none, all
array members will be displayed by default.</p>
</dd>
<dt class="hdlist1">array_str_limit=&lt;limit&gt;</dt>
<dd>
<p>Set the default limit on the number of characters that <code>::print</code>
will attempt to display as an ASCII string when printing a <code>char</code>
array. If &lt;limit&gt; is the special token none, the entire
<code>char</code> array will be displayed as a <code>string</code> by default.</p>
</dd>
<dt class="hdlist1">follow_exec_mode=mode</dt>
<dd>
<p>Set the debugger behavior for following an exec(2) system call. The
mode should be one of the following named constants:
+</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">ask</dt>
<dd>
<p>If <code>stdout</code> is a terminal device, the debugger will stop after the
exec(2) system call has returned and then prompt the user to
decide whether to follow the exec or stop. If <code>stdout</code> is not a
terminal device, the ask mode will default to stop.</p>
</dd>
<dt class="hdlist1">follow</dt>
<dd>
<p>The debugger will follow the exec by automatically continuing the
target process and resetting all of its mappings and symbol tables
based on the new executable. The follow behavior is discussed in
more detail under <a href="#interaction-with-exec">Interaction With </a>.</p>
</dd>
<dt class="hdlist1">stop</dt>
<dd>
<p>The debugger will stop following return from the exec system call.
The stop behavior is discussed in more detail under
<a href="#interaction-with-exec">Interaction With </a>.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">follow_fork_mode=mode</dt>
<dd>
<p>Set the debugger behavior for following a fork(2), fork1(2), or
vfork(2) system call. The mode should be one of the following named
constants:
+</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">ask</dt>
<dd>
<p>If <code>stdout</code> is a terminal device, the debugger will stop after the
fork system call has returned and then prompt the user to decide
whether to follow the parent or child. If stdout is not a terminal
device, the ask mode will default to parent.</p>
</dd>
<dt class="hdlist1">parent</dt>
<dd>
<p>The debugger will follow the parent process, and will detach from
the child process and set it running.</p>
</dd>
<dt class="hdlist1">child</dt>
<dd>
<p>The debugger will follow the child process, and will detach from
the parent process and set it running.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">ignoreeof</dt>
<dd>
<p>The debugger does not exit when an <code>EOF</code> sequence (<code>^D</code>) is entered
at the terminal. The <code>::quit</code> dcmd must be used to quit.</p>
</dd>
<dt class="hdlist1">nostop</dt>
<dd>
<p>Do not stop a user process when attaching to it when the <code>-p</code> option
is specified or when the <code>::attach</code> or <code>:A</code> dcmds are applied. The
nostop behavior is described in more detail under
<a href="#process-attach-and-release">Process Attach and Release</a>.</p>
</dd>
<dt class="hdlist1">pager</dt>
<dd>
<p>The output pager is enabled (default).</p>
</dd>
<dt class="hdlist1">repeatlast</dt>
<dd>
<p>If a <code>NEWLINE</code> is entered as the complete command at the terminal,
<code>mdb</code> repeats the previous command with the current value of dot.
This option is implied by <code>o</code> <code>adb</code>.</p>
</dd>
<dt class="hdlist1">showlmid</dt>
<dd>
<p>MDB provides support for symbol naming and identification in user
applications that make use of link maps other than
LM_ID_BASE and LM_ID_LDSO, as described in
<a href="#symbol-name-resolution">Symbol Name Resolution</a>. Symbols on link maps other
than LM_ID_BASE or LM_ID_LDSO will be shown as
<code>LMlmid`library`symbol</code>, where <code>lmid</code> is the link-map ID in
the default output radix (16). The user may optionally configure MDB
to show the link-map ID scope of all symbols and objects, including
those associated with LM_ID_BASE and LM_ID_LDSO, by
enabling the <code>showlmid</code> option. Built-in dcmds that deal with object
file names will display link-map IDs according to the value of
showlmid above, including <code>::nm</code>, <code>::mappings</code>, <code>$m</code>, and
<code>::objects</code>.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>p</code> <em>pid</em></dt>
<dd>
<p>Attaches to and stops the specified process id. <code>mdb</code> uses the
<code>/proc/pid/object/a.out</code> file as the executable file path name.</p>
</dd>
<dt class="hdlist1"><code>P</code></dt>
<dd>
<p>Sets the command prompt. The default prompt is “<code>&gt;</code> ”.</p>
</dd>
<dt class="hdlist1"><code>R</code></dt>
<dd>
<p>Sets root directory for path name expansion. By default, the root
directory is derived from the path name of the <code>mdb</code> executable
itself. The root directory is substituted in place of the <code>%r</code> token
during path name expansion.</p>
</dd>
<dt class="hdlist1"><code>s</code> <em>distance</em></dt>
<dd>
<p>Sets the symbol matching distance for address-to-symbol-name
conversions to the specified <em>distance</em>. By default, <code>mdb</code>
sets the distance to zero, which enables a smart-matching mode. Each
ELF symbol table entry includes a value V and size S, representing the
size of the function or data object in bytes. In smart mode, <code>mdb</code>
matches an address A with the given symbol if A is in the range [
V, V &#43; S ). If any non-zero distance is specified, the same
algorithm is used, but S in the given expression is always the
specified absolute distance and the symbol size is ignored.</p>
</dd>
<dt class="hdlist1"><code>S</code></dt>
<dd>
<p>Suppresses processing of the user&#8217;s <code>~/.mdbrc</code> file.
By default, <code>mdb</code> reads and processes the macro file <code>.mdbrc</code> if one
is present in the user&#8217;s home directory, as defined by $<code>HOME</code>. If the
<code>S</code> option is present, this file is not read.</p>
</dd>
<dt class="hdlist1"><code>u</code></dt>
<dd>
<p>Forces user debugging mode. By default, <code>mdb</code> attempts to infer
whether the object and core file operands refer to a user executable
and core dump, or to a pair of operating system crash dump files. The
<code>u</code> option forces <code>mdb</code> to assume these files are not operating system
crash dump files.</p>
</dd>
<dt class="hdlist1"><code>U</code></dt>
<dd>
<p>Unload <code>kmdb</code> if it is loaded. You should unload <code>kmdb</code> when it is not
in use to release the memory used by the kernel debugger back to the
free memory available to the operating system.</p>
</dd>
<dt class="hdlist1"><code>V</code></dt>
<dd>
<p>Sets disassembler version. By default, <code>mdb</code> attempts to infer the
appropriate disassembler version for the debug target. The
disassembler can be set explicitly using the <code>V</code> option. The
<code>::disasms</code> dcmd lists the available disassembler versions.</p>
</dd>
<dt class="hdlist1"><code>w</code></dt>
<dd>
<p>Opens the specified object and core files for writing.</p>
</dd>
<dt class="hdlist1"><code>y</code></dt>
<dd>
<p>Sends explicit terminal initialization sequences for tty mode. Some
terminals require explicit initialization sequences to switch into a
tty mode. Without this initialization sequence, terminal features such
as standout mode might not be available to <code>mdb</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="operands"><a class="anchor" href="#operands"></a>11.2. Operands</h3>
<div class="paragraph">
<p>The following operands are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">object</dt>
<dd>
<p>Specifies an ELF format object file to examine. <code>mdb</code> provides the
ability to examine and edit ELF format executables (<code>ET_EXEC</code>),
ELF dynamic library files (<code>ET_DYN</code>), ELF relocatable object files
(<code>ET_REL</code>), and operating system <code>unix.X</code> symbol table files.</p>
</dd>
<dt class="hdlist1">core</dt>
<dd>
<p>Specifies an ELF process core file (<code>ET_CORE</code>), or an operating
system crash dump <code>vmcore.X</code> file. If an ELF core file operand is
provided without a corresponding object file, <code>mdb</code> will attempt to
infer the name of the executable file that produced the core using
several different algorithms. If no executable is found, <code>mdb</code> will
still execute, but some symbol information may be unavailable.</p>
</dd>
<dt class="hdlist1">suffix</dt>
<dd>
<p>Specifies the numerical suffix representing a pair of operating system
crash dump files. For example, if the suffix is “<code>3</code>”, <code>mdb</code> infers
that it should examine the files “<code>unix.3</code>” and “<code>vmcore.3</code>”. The
string of digits will not be interpreted as a suffix if an actual file
of the same name is present in the current directory.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="exit-status"><a class="anchor" href="#exit-status"></a>11.3. Exit Status</h3>
<div class="paragraph">
<p>The following exit values are returned:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">0</dt>
<dd>
<p>Debugger completed execution successfully.</p>
</dd>
<dt class="hdlist1">1</dt>
<dd>
<p>A fatal error occurred.</p>
</dd>
<dt class="hdlist1">2</dt>
<dd>
<p>Invalid command line options were specified.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="environment-variables"><a class="anchor" href="#environment-variables"></a>11.4. Environment Variables</h3>
<div class="paragraph">
<p>The following environment variables are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">HISTSIZE</dt>
<dd>
<p>This variable is used to determine the maximum length of the command
history list. If this variable is not present, the default length is
128.</p>
</dd>
<dt class="hdlist1">HOME</dt>
<dd>
<p>This variable is used to determine the pathname of the user&#8217;s home
directory, where a <code>.mdbrc</code> file may reside. If this variable is not
present, no <code>.mdbrc</code> processing will occur.</p>
</dd>
<dt class="hdlist1">SHELL</dt>
<dd>
<p>This variable is used to determine the pathname of the shell used to
process shell escapes requested using the <code>!</code> meta-character. If this
variable is not present, <code>/bin/sh</code> is used.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="notes"><a class="anchor" href="#notes"></a>12. Notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="warnings"><a class="anchor" href="#warnings"></a>12.1. Warnings</h3>
<div class="paragraph">
<p>The following warning information applies to the use of MDB.</p>
</div>
<div class="sect3">
<h4 id="use-of-the-error-recovery-mechanism"><a class="anchor" href="#use-of-the-error-recovery-mechanism"></a>12.1.1. Use of the Error Recovery Mechanism</h4>
<div class="paragraph">
<p>The debugger and its dmods execute in the same address space, and thus
it is quite possible that a buggy dmod can cause MDB to dump core or
otherwise misbehave. The MDB <code>resume</code> capability, described in
<a href="#signal-handling">Signal Handling</a>, provides a limited recovery
mechanism for these situations. However, it is not possible for MDB to
know definitively whether the dmod in question has corrupted only its
own state, or the debugger&#8217;s global state. Therefore a <code>resume</code>
operation cannot be guaranteed to be safe, or to prevent a subsequent
crash of the debugger. The safest course of action following a <code>resume</code>
is to save any important debug information, and then quit and restart
the debugger.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-of-the-debugger-to-modify-the-live-operating-system"><a class="anchor" href="#use-of-the-debugger-to-modify-the-live-operating-system"></a>12.1.2. Use of the Debugger to Modify the Live Operating System</h4>
<div class="paragraph">
<p>The use of the debugger to modify (that is, write to) the address space
of a live, running operating system is extremely dangerous, and may
result in a system panic in the event the user damages a kernel data
structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-of-kmdb-to-stop-the-live-operating-system"><a class="anchor" href="#use-of-kmdb-to-stop-the-live-operating-system"></a>12.1.3. Use of <code>kmdb</code> to Stop the Live Operating System</h4>
<div class="paragraph">
<p>The use of <code>kmdb</code> to stop the live operating system using <code>mdb -K</code> or by
setting a breakpoint in the live operating system is intended for use by
developers and not on production systems. When the operating system
kernel is stopped by <code>kmdb</code>, operating system services and networking
are not executing, and other systems on the network that depend upon the
target system will not be able to contact the target system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="notes-1"><a class="anchor" href="#notes-1"></a>12.2. Notes</h3>
<div class="sect3">
<h4 id="limitations-on-examining-process-core-files"><a class="anchor" href="#limitations-on-examining-process-core-files"></a>12.2.1. Limitations on Examining Process Core Files</h4>
<div class="paragraph">
<p>MDB does not provide support for examining process core files that were
generated by a release of the Solaris operating system preceding Solaris
2.6. If a core file from one operating system release is examined on a
different operating system release, the run-time link-editor debugging
interface (<code>librtld_db)</code> may not be able to initialize. In this
case, symbol information for shared libraries will not be available.
Furthermore, since shared mappings are not present in user core files,
the text section and read-only data of shared libraries may not match
the data that was present in the process at the time it dumped core.
Core files from illumos x86 systems may not be examined on illumos SPARC
systems, and vice-versa.</p>
</div>
</div>
<div class="sect3">
<h4 id="limitations-on-examining-crash-dump-files"><a class="anchor" href="#limitations-on-examining-crash-dump-files"></a>12.2.2. Limitations on Examining Crash Dump Files</h4>
<div class="paragraph">
<p>Crash dumps from Solaris 7 and earlier releases may only be examined
with the aid of the <code>libkvm</code> from the corresponding operating system
release. If a crash dump from one operating system release is examined
using the dmods from a different operating system release, changes in
the kernel implementation may prevent some dcmds or walkers from working
properly. MDB will issue a warning message if it detects this condition.
Crash dumps from illumos x86 systems may not be examined on illumos
SPARC systems, and vice-versa.</p>
</div>
</div>
<div class="sect3">
<h4 id="relationship-between-32-bit-and-64-bit-debugger"><a class="anchor" href="#relationship-between-32-bit-and-64-bit-debugger"></a>12.2.3. Relationship Between 32-bit and 64-bit Debugger</h4>
<div class="paragraph">
<p>MDB provides support for debugging both 32-bit and 64-bit programs. Once
it has examined the target and determined its data model, MDB will
automatically re-execute the mdb binary that has the same data model as
the target, if necessary. This approach simplifies the task of writing
debugger modules, because the modules that are loaded will use the same
data model as the primary target. Only the 64-bit debugger may be used
to debug 64-bit target programs. The 64-bit debugger can only be used on
a system that is running the 64-bit operating environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="limitations-on-memory-available-to-kmdb"><a class="anchor" href="#limitations-on-memory-available-to-kmdb"></a>12.2.4. Limitations on Memory Available to <code>kmdb</code></h4>
<div class="paragraph">
<p>The memory available to <code>kmdb</code> is allocated when the debugger is loaded,
and cannot be expanded after that point in time. If debugger commands
attempt to allocate more memory than is available, they will not be able
to execute. The debugger will attempt to gracefully recover from low
memory situations, but may be forced to terminate the system under dire
circumstances. System memory constraints are especially acute on x86
platforms that use the 32–bit operating system kernel.</p>
</div>
</div>
<div class="sect3">
<h4 id="developer-information"><a class="anchor" href="#developer-information"></a>12.2.5. Developer Information</h4>
<div class="paragraph">
<p>The <code>mdb(1)</code> manual page provides a detailed description of built-in
<code>mdb</code> features for easy developer reference. The header file
&lt;<code>sys/mdb_modapi.h</code>&gt; contains prototypes for the functions
in the MDB Module API, and the <code>SUNWmdbdm</code> package provides source code
for an example module in the directory <code>/usr/demo/mdb</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transition-from-adb-and-kadb"><a class="anchor" href="#transition-from-adb-and-kadb"></a>13. Transition From <code>adb</code> and <code>kadb</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The transition from using the legacy <code>adb(1)</code> utility to using <code>mdb(1)</code>
is relatively simple: MDB provides evolutionary compatibility for the
<code>adb</code> syntax, built-in commands, and command-line options. MDB attempts
to provide compatibility for all existing <code>adb(1)</code> features, but it is
not bug-for-bug compatible with <code>adb(1)</code>. This appendix briefly
discusses several features of <code>adb(1)</code> that are not precisely emulated
by <code>mdb(1)</code> in order to guide users to the new functionality</p>
</div>
<div class="sect2">
<h3 id="command-line-options"><a class="anchor" href="#command-line-options"></a>13.1. Command-line Options</h3>
<div class="paragraph">
<p>MDB provides a superset of the command-line options recognized by
<code>adb(1)</code>. All the <code>adb(1)</code> options are supported and have the same
meaning as before. The <code>/usr/bin/adb</code> pathname is delivered as a link
that invokes <code>mdb(1)</code>, and automatically enables enhanced <code>adb(1)</code>
compatibility mode. Executing the <code>/usr/bin/adb</code> link is equivalent to
executing mdb with the <code>o</code> <code>adb</code> option, or executing <code>::set -o adb</code>
once the debugger has started.</p>
</div>
</div>
<div class="sect2">
<h3 id="syntax-1"><a class="anchor" href="#syntax-1"></a>13.2. Syntax</h3>
<div class="paragraph">
<p>The MDB language adheres to the same syntax as the <code>adb(1)</code> language, in
order to provide compatibility for legacy macros and script files. New
MDB dcmds use the extended form <code>::name</code>, in order to distinguish them
from legacy commands that are prefixed with either <code>:</code> or <code>$</code>.
Expressions can also be evaluated on the right-hand side of a dcmd name
by enclosing them in square brackets preceded by a dollar sign
(<code>$[ ]</code>). Similar to <code>adb(1)</code>, an input line that begins with an
exclamation mark (<code>!</code>) indicates that the command line should be
executed by the user&#8217;s shell. In MDB, a debugger command may also be
suffixed with an exclamation mark to indicate that its output should be
piped to the shell command following the exclamation mark.</p>
</div>
<div class="paragraph">
<p>In <code>adb(1)</code>, binary operators are left associative and have lower
precedence than unary operators. Binary operators are evaluated in
strict left-to-right order on the input line. In MDB, binary operators
are left associative and have lower precedence than unary operators, but
the binary operators operate in order of precedence according to the
table in <a href="#binary-operators">Binary Operators</a>. The operators conform to the
order of precedence in ANSI C. Legacy <code>adb(1)</code> macro files that do not
explicitly parenthesize ambiguous expressions may need to be updated to
work with MDB. For example, in <code>adb</code> the following command evaluates to
the integer value nine:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ echo "4-1*3=X" | adb</pre>
</div>
</div>
<div class="paragraph">
<p>In MDB, as in ANSI C, operator <code>*</code> has higher precedence than <code>-</code>
and therefore the result is the integer value one:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ echo "4-1*3=X" | mdb</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="watchpoint-length-specifier"><a class="anchor" href="#watchpoint-length-specifier"></a>13.3. Watchpoint Length Specifier</h3>
<div class="paragraph">
<p>The watchpoint length specifier syntax recognized by MDB is different
from the syntax described in <code>adb(1)</code>. In particular, the <code>adb</code>
watchpoint commands <code>:w</code>, <code>:a</code>, and <code>:p</code> allow an integer length in
bytes to be inserted between the colon and the command character. In
MDB, the count should be specified following the initial address as a
repeat count. Stated simply, these <code>adb(1)</code> commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>123:456w
123:456a
123:456p</pre>
</div>
</div>
<div class="paragraph">
<p>are specified in MDB as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>123,456:w
123,456:a
123,456:p</pre>
</div>
</div>
<div class="paragraph">
<p>The MDB <code>::wp</code> dcmd provides more complete facilities for creating user
process watchpoints. Similarly, the legacy <code>kadb</code> length modifier
command <code>$l</code> is not supported. Therefore, the watchpoint size should be
specified to each <code>::wp</code> command used in <code>kmdb</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="address-map-modifier"><a class="anchor" href="#address-map-modifier"></a>13.4. Address Map Modifier</h3>
<div class="paragraph">
<p>The <code>adb(1)</code> commands to modify segments of the virtual address map and
object file map are not present in MDB. Specifically, the <code>/m</code>,
<code>/*m</code>, <code>?m</code>, and <code>?*m</code> format specifiers are not recognized or
supported by MDB. These specifiers were used to manually modify the
valid addressable range of the current object and core files. MDB
properly recognizes the addressable range of such files automatically,
and updates the ranges when a live process is being debugged, so these
commands are no longer necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="output"><a class="anchor" href="#output"></a>13.5. Output</h3>
<div class="paragraph">
<p>The precise text output form of some commands is different in MDB. Macro
files are formatted using the same basic rules, but shell scripts that
depend on the precise character-by-character output of certain commands
may need to change. Users who have shell scripts that parse the output
of <code>adb</code> commands will need to revalidate and update such scripts as
part of the transition to MDB.</p>
</div>
</div>
<div class="sect2">
<h3 id="deferred-breakpoints"><a class="anchor" href="#deferred-breakpoints"></a>13.6. Deferred Breakpoints</h3>
<div class="paragraph">
<p>The legacy <code>kadb</code> utility supported a syntax for deferred breakpoints
that was incompatible with the existing <code>adb</code> syntax. These deferred
breakpoints were specified using the syntax
<code>`&lt;module&gt;</code>#<code><em>symbol</em></code>:b` in <code>kadb</code>. To set a deferred
breakpoint in <code>kmdb</code>, use the MDB <code>::bp</code> dcmd as described in
<a href="#execution-control">Execution Control</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="io-port-access"><a class="anchor" href="#io-port-access"></a>13.7. I/O Port Access</h3>
<div class="paragraph">
<p>The legacy <code>kadb</code> utility provided access to I/O ports on x86 systems
using the <code>:i</code> and <code>:o</code> commands. These commands are not supported in
<code>mdb</code> or <code>kmdb</code>. Access to I/O ports on x86 systems is provided by the
<code>::in</code> and <code>::out</code> commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transition-from-crash"><a class="anchor" href="#transition-from-crash"></a>14. Transition From <code>crash</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The transition from using the legacy <code>crash</code> utility to
using <code>mdb(1)</code> is relatively simple: MDB provides most of the “canned”
crash commands. The additional extensibility and interactive features of
MDB allow the programmer to explore aspects of the system not examined
by the current set of commands. This appendix briefly discusses several
features of <code>crash</code> and provides pointers to equivalent MDB
functionality.</p>
</div>
<div class="sect2">
<h3 id="command-line-options-1"><a class="anchor" href="#command-line-options-1"></a>14.1. Command-line Options</h3>
<div class="paragraph">
<p>The <code>crash</code> <code>d</code>, <code>n</code>, and <code>w</code> command-line options are not supported by
<code>mdb</code>. The <code>crash</code> dump file and name list (symbol table file) are
specified as arguments to <code>mdb</code> in the order of name list, crash dump
file. To examine the live kernel, the <code>mdb</code> <code>k</code> option should be
specified with no additional arguments. Users who want to redirect the
output of <code>mdb</code> to a file or other output destination, should either
employ the appropriate shell redirection operator following the <code>mdb</code>
invocation on the command line, or use the <code>::log</code> built-in dcmd.</p>
</div>
</div>
<div class="sect2">
<h3 id="input-in-mdb"><a class="anchor" href="#input-in-mdb"></a>14.2. Input in MDB</h3>
<div class="paragraph">
<p>In general, input in MDB is similar to <code>crash</code>, except that function
names (in MDB, dcmd names) are prefixed with “<code>::</code>”. Some MDB dcmds
accept a leading expression argument that precedes the dcmd name. Like
<code>crash</code>, string options can follow the dcmd name. If a ! character
follows a function invocation, MDB will also create a pipeline to the
specified shell pipeline. All immediate values specified in MDB are
interpreted in hexadecimal by default. The radix specifiers for
immediate values are different in <code>crash</code> and MDB as shown in
<a href="#crash-tbl-3">Radix Specifiers</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Radix Specifiers</caption>
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">crash</th>
<th class="tableblock halign-left valign-top">mdb</th>
<th class="tableblock halign-left valign-top">Radix</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hexadecimal (base 16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decimal (base 10)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary (base 2)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Many <code>crash</code> commands accepted slot numbers or slot ranges as input
arguments. The illumos operating system is no longer structured in terms
of slots, so MDB dcmds do not provide support for slot-number
processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions"><a class="anchor" href="#functions"></a>14.3. Functions</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">crash function</th>
<th class="tableblock halign-left valign-top">mdb dcmd</th>
<th class="tableblock halign-left valign-top">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::dcmds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List available functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">!command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escape to the shell and execute command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In mdb, the = format character can be used to convert the
left-hand expression value to any of the known formats. Formats for
octal, decimal, and hexadecimal are provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::callout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print the callout table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print scheduling classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::cpuinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print information about the threads dispatched on the
system CPUs. If the contents of a particular CPU structure are needed,
the user should apply the <code>$&lt;cpu</code> macro to the CPU address in mdb.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print a description of the named dcmd, or general help
information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kfp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::regs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mdb ::regs dcmd displays the complete kernel register
set, including the current stack frame pointer. The $C dcmd can be used
to display a stack backtrace including frame pointers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kmalog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::kmalog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display events in kernel memory allocator transaction
log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kmastat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::kmastat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print kernel memory allocator transaction log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kmausers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::kmausers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print information about the medium and large
users of the kernel memory allocator that have current memory
allocations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::fsinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print information about mounted file systems.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::nm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print symbol type and value information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">od</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::dump</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print a formatted memory dump of a given region. In mdb,
::dump displays a mixed ascii and hexadecimal display of the region.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::ps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print a table of the active processes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::quit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quit the debugger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::dump</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print a formatted memory dump of a given region. In mdb,
::dump displays a mixed ascii and hexadecimal display of the region.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In mdb, output for input and output can be globally
redirected to a log file using ::log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::kgrep</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In mdb, the ::kgrep dcmd can be used to search the
kernel&#8217;s address space for a particular value. The pattern match
built-in dcmds can also be used to search the physical, virtual, or
object files address spaces for patterns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current stack trace can be obtained using ::stack.
The stack trace of a particular kernel thread can be determined using
the ::findstack dcmd. A memory dump of the current stack can be obtained
using the / or ::dump dcmds and the current stack pointer. The
<code>$&lt;stackregs</code> macro can be applied to a stack pointer to obtain the
per-frame saved register values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display status information about the system or dump
being examined by the debugger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mdb ::stream dcmd can be used to format and
display the structure of a particular kernel STREAM. If the list of
active STREAM structures is needed, the user should execute ::walk
stream_head_cache in mdb and pipe the resulting addresses to an
appropriate formatting dcmd or macro.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::kmastat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ::kmastat dcmd displays a superset of the
information reported by the <code>strstat</code> function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current stack trace can be obtained using ::stack.
The stack trace of a particular kernel thread can be determined using
the ::findstack dcmd. A memory dump of the current stack can be obtained
using the / or ::dump dcmds and the current stack pointer. The
<code>$&lt;stackregs</code> macro can be applied to a stack pointer to obtain the
per-frame saved register values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">var</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$&lt;v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print the tunable system parameters in the global <code>var</code>
structure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vfs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::fsinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print information about mounted file systems.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vtop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::vtop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print the physical address translation of the given
virtual address.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-license"><a class="anchor" href="#document-license"></a>15. Document License</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_public_documentation_license_pdl_version_1_01"><a class="anchor" href="#_public_documentation_license_pdl_version_1_01"></a>15.1. Public Documentation License (PDL), Version 1.01</h3>
<div class="paragraph">
<p><span class="first-word">1.0  DEFINITIONS.</span></p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>1.1.  “Commercial Use” means distribution or otherwise making the
Documentation available to a third party.</p>
</div>
<div class="paragraph">
<p>1.2.  “Contributor” means a person or entity who creates or contributes
to the creation of Modifications.</p>
</div>
<div class="paragraph">
<p>1.3.  “Documentation” means the Original Documentation or Modifications
or the combination of the Original Documentation and Modifications, in
each case including portions thereof.</p>
</div>
<div class="paragraph">
<p>1.4.  “Editable Form” means the preferred form of Documentation for
making Modifications to such documentation. The Documentation can be in
an electronic, compressed or archival form, provided the appropriate
decompression or de-archiving software is widely available for no
charge.</p>
</div>
<div class="paragraph">
<p>1.5.  “Electronic Distribution Mechanism” means a mechanism generally
accepted for the electronic transfer of data.</p>
</div>
<div class="paragraph">
<p>1.6.  “Initial Writer” means the individual or entity identified as the
Initial Writer in the notice required by the Appendix.</p>
</div>
<div class="paragraph">
<p>1.7.  “Larger Work” means a work which combines Documentation or
portions thereof with documentation or other writings not governed by
the terms of this License.</p>
</div>
<div class="paragraph">
<p>1.8.  “License” means this document.</p>
</div>
<div class="paragraph">
<p>1.9.  “Modifications” means any addition to or deletion from the
substance or structure of either the Original Documentation or any
previous Modifications, such as a translation, abridgment, condensation,
or any other form in which the Original Documentation or previous
Modifications may be recast, transformed or adapted. A work consisting
of editorial revisions, annotations, elaborations, and other
modifications which, as a whole represent an original work of
authorship, is a Modification. For example, when Documentation is
released as a series of documents, a Modification is:</p>
</div>
<div class="paragraph">
<p>A.  Any addition to or deletion from the contents of the Original
Documentation or previous Modifications.</p>
</div>
<div class="paragraph">
<p>B.  Any new documentation that contains any part of the Original
Documentation or previous Modifications.</p>
</div>
<div class="paragraph">
<p>1.10.  “Original Documentation” means documentation described as
Original Documentation in the notice required by the Appendix, and
which, at the time of its release under this License is not already
Documentation governed by this License.</p>
</div>
<div class="paragraph">
<p>1.11.  “You” (or “Your”) means an individual or a legal entity
exercising rights under, and complying with all of the terms of, this
License or a future version of this License issued under Section 5.0
(“Versions of the License”). For legal entities, “You” includes any
entity which controls, is controlled by, or is under common control with
You. For purposes of this definition, “control” means (a) the power,
direct or indirect, to cause the direction or management of such entity,
whether by contract or otherwise, or (b) ownership of more than fifty
percent (50%) of the outstanding shares or beneficial ownership of such
entity.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><span class="first-word">2.0  LICENSE GRANTS.</span></p>
</div>
<div class="paragraph">
<p><span class="first-word">2.1  Initial Writer Grant.</span></p>
</div>
<div class="paragraph">
<p>The Initial Writer hereby grants You a world-wide, royalty-free,
non-exclusive license to use, reproduce, prepare Modifications of,
compile, publicly perform, publicly display, demonstrate, market,
disclose and distribute the Documentation in any form, on any media or
via any Electronic Distribution Mechanism or other method now known or
later discovered, and to sublicense the foregoing rights to third
parties through multiple tiers of sublicensees in accordance with the
terms of this License.</p>
</div>
<div class="paragraph">
<p>The license rights granted in this Section 2.1 (“Initial Writer Grant”)
are effective on the date Initial Writer first distributes Original
Documentation under the terms of this License.</p>
</div>
<div class="paragraph">
<p><span class="first-word">2.2.  Contributor Grant.</span></p>
</div>
<div class="paragraph">
<p>Each Contributor hereby grants You a world-wide, royalty-free,
non-exclusive license to use, reproduce, prepare Modifications of,
compile, publicly perform, publicly display, demonstrate, market,
disclose and distribute the Documentation in any form, on any media or
via any Electronic Distribution Mechanism or other method now known or
later discovered, and to sublicense the foregoing rights to third
parties through multiple tiers of sublicensees in accordance with the
terms of this License.</p>
</div>
<div class="paragraph">
<p>The license rights granted in this Section 2.2 (“Contributor Grant”) are
effective on the date Contributor first makes Commercial Use of the
Documentation.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.0  DISTRIBUTION OBLIGATIONS.</span></p>
</div>
<div class="paragraph">
<p><span class="first-word">3.1.  Application of License.</span></p>
</div>
<div class="paragraph">
<p>The Modifications which You create or to which You contribute are
governed by the terms of this License, including without limitation
Section 2.2 (“Contributor Grant”). The Documentation may be distributed
only under the terms of this License or a future version of this License
released in accordance with Section 5.0 (“Versions of the License”), and
You must include a copy of this License with every copy of the
Documentation You distribute. You may not offer or impose any terms that
alter or restrict the applicable version of this License or the
recipients' rights hereunder. However, You may include an additional
document offering the additional rights described in Section 3.5
(“Required Notices”).</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.2.  Availability of Documentation.</span></p>
</div>
<div class="paragraph">
<p>Any Modification which You create or to which You contribute must be
made available publicly in Editable Form under the terms of this License
via a fixed medium or an accepted Electronic Distribution Mechanism.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.3.  Description of Modifications.</span></p>
</div>
<div class="paragraph">
<p>All Documentation to which You contribute must identify the changes You
made to create that Documentation and the date of any change. You must
include a prominent statement that the Modification is derived, directly
or indirectly, from Original Documentation provided by the Initial
Writer and include the name of the Initial Writer in the Documentation
or via an electronic link that describes the origin or ownership of the
Documentation. The foregoing change documentation may be created by
using an electronic program that automatically tracks changes to the
Documentation. You must make all such changes and required information
publicly available for at least five years following release of the
changed Documentation.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.4.  Intellectual Property Matters.</span></p>
</div>
<div class="paragraph">
<p>Contributor represents that Contributor believes that Contributor&#8217;s
Modifications are Contributor&#8217;s original creation(s), Contributor has
sufficient rights to grant the rights conveyed by this License, or both
of these statements are true.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.5.  Required Notices.</span></p>
</div>
<div class="paragraph">
<p>You must duplicate the notice in the Appendix in each file of the
Documentation. If it is not possible to put such notice in a particular
Documentation file due to its structure, then You must include such
notice in a location (such as a relevant directory) where a reader would
be likely to look for such a notice, for example, via a hyperlink in
each file of the Documentation that takes the reader to a page that
describes the origin and ownership of the Documentation. If You created
one or more Modification(s) You may add your name as a Contributor to
the notice described in the Appendix.</p>
</div>
<div class="paragraph">
<p>You must also duplicate this License in any Documentation file (or with
a hyperlink in each file of the Documentation) where You describe
recipients' rights or ownership rights.</p>
</div>
<div class="paragraph">
<p>You may choose to offer, and to charge a fee for, warranty, support,
indemnity or liability obligations to one or more recipients of
Documentation. However, You may do so only on Your own behalf, and not
on behalf of the Initial Writer or any Contributor. You must make it
absolutely clear than any such warranty, support, indemnity or liability
obligation is offered by You alone, and You hereby agree to indemnify
the Initial Writer and every Contributor for any liability incurred by
the Initial Writer or such Contributor as a result of warranty, support,
indemnity or liability terms You offer.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.6.  Larger Works.</span></p>
</div>
<div class="paragraph">
<p>You may create a Larger Work by combining Documentation with other
documents not governed by the terms of this License and distribute the
Larger Work as a single product. In such a case, You must make sure the
requirements of this License are fulfilled for the Documentation.</p>
</div>
<div class="paragraph">
<p><span class="first-word">4.0  APPLICATION OF THIS LICENSE.</span></p>
</div>
<div class="paragraph">
<p>This License applies to Documentation to which the Initial Writer has
attached this License and the notice in the Appendix.</p>
</div>
<div class="paragraph">
<p><span class="first-word">5.0  TRADEMARKS.</span></p>
</div>
<div class="paragraph">
<p>This license does not grant permission to use the trade names,
trademarks, service marks, logos, or product names of the Initial Writer
or any Contributor, except as required for reasonable and customary use
in describing the Origin of the Documentation and reproducing the
content of any of the notices described in the Appendix.</p>
</div>
<div class="paragraph">
<p><span class="first-word">6.0  VERSIONS OF THE LICENSE.</span></p>
</div>
<div class="paragraph">
<p><span class="first-word">6.1.  New Versions.</span></p>
</div>
<div class="paragraph">
<p>Initial Writer may publish revised or new versions of the License from
time to time. Each version will be given a distinguishing version
number.</p>
</div>
<div class="paragraph">
<p><span class="first-word">6.2.  Effect of New Versions.</span></p>
</div>
<div class="paragraph">
<p>Once Documentation has been published under a particular version of the
License, You may always continue to use it under the terms of that
version. You may also choose to use such Documentation under the terms
of any subsequent version of the License published by
__________________[Insert name of the foundation, company, Initial
Writer, or whoever may modify this License]. No one other than
_________________ [Insert name of the foundation, company,
Initial Writer, or whoever may modify this License] has the right to
modify the terms of this License. Filling in the name of the Initial
Writer, Original Documentation or Contributor in the notice described in
the Appendix shall not be deemed to be Modifications of this License.</p>
</div>
<div class="paragraph">
<p><span class="first-word">7.0  DISCLAIMER OF WARRANTY.</span></p>
</div>
<div class="paragraph">
<p>DOCUMENTATION IS PROVIDED UNDER THIS LICENSE ON AN “AS IS” BASIS,
WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
WITHOUT LIMITATION, WARRANTIES THAT THE DOCUMENTATION IS FREE OF
DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING.
THE ENTIRE RISK AS TO THE QUALITY, ACCURACY, AND PERFORMANCE OF THE
DOCUMENTATION IS WITH YOU. SHOULD ANY DOCUMENTATION PROVE DEFECTIVE IN
ANY RESPECT, YOU (NOT THE INITIAL WRITER OR ANY OTHER CONTRIBUTOR)
ASSUME THE COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. THIS
DISCLAIMER OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO
USE OF ANY DOCUMENTATION IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS
DISCLAIMER.</p>
</div>
<div class="paragraph">
<p><span class="first-word">8.0  TERMINATION.</span></p>
</div>
<div class="paragraph">
<p>This License and the rights granted hereunder will terminate
automatically if You fail to comply with terms herein and fail to cure
such breach within 30 days of becoming aware of the breach. All
sublicenses to the Documentation which are properly granted shall
survive any termination of this License. Provisions which, by their
nature, must remain in effect beyond the termination of this License
shall survive.</p>
</div>
<div class="paragraph">
<p><span class="first-word">9.0  LIMITATION OF LIABILITY.</span></p>
</div>
<div class="paragraph">
<p>UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER IN TORT
(INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL THE INITIAL
WRITER, ANY OTHER CONTRIBUTOR, OR ANY DISTRIBUTOR OF DOCUMENTATION, OR
ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY PERSON FOR ANY
DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY
CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL,
WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER
DAMAGES OR LOSSES ARISING OUT OF OR RELATING TO THE USE OF THE
DOCUMENTATION, EVEN IF SUCH PARTY SHALL HAVE BEEN INFORMED OF THE
POSSIBILITY OF SUCH DAMAGES.</p>
</div>
<div class="paragraph">
<p><span class="first-word">10.0  U.S. GOVERNMENT END USERS.</span></p>
</div>
<div class="paragraph">
<p>If Documentation is being acquired by or on behalf of the U.S.
Government or by a U.S. Government prime contractor or subcontractor (at
any tier), then the Government&#8217;s rights in Documentation will be only as
set forth in this Agreement; this is in accordance with 48 CFR 227.7201
through 227.7202-4 (for Department of Defense (DOD) acquisitions) and
with 48 CFR 2.101 and 12.212 (for non-DOD acquisitions).</p>
</div>
<div class="paragraph">
<p><span class="first-word">11.0  MISCELLANEOUS.</span></p>
</div>
<div class="paragraph">
<p>This License represents the complete agreement concerning the subject
matter hereof. If any provision of this License is held to be
unenforceable, such provision shall be reformed only to the extent
necessary to make it enforceable. This License shall be governed by
California law, excluding its conflict-of-law provisions. With respect
to disputes or any litigation relating to this License, the losing party
is responsible for costs, including without limitation, court costs and
reasonable attorneys' fees and expenses. The application of the United
Nations Convention on Contracts for the International Sale of Goods is
expressly excluded. Any law or regulation which provides that the
language of a contract shall be construed against the drafter shall not
apply to this License.</p>
</div>
</div>
<div class="sect2">
<h3 id="_public_documentation_license_notice"><a class="anchor" href="#_public_documentation_license_notice"></a>15.2. Public Documentation License Notice</h3>
<div class="paragraph">
<p>The contents of this Documentation are subject to the Public
Documentation License Version 1.01 (the “License”); you may only use
this Documentation if you comply with the terms of this License. A copy
of the License is available at <a href="http://illumos.org/license/PDL" class="bare">http://illumos.org/license/PDL</a></p>
</div>
<div class="paragraph">
<p>The Original Documentation is the Solaris Modular Debugger Guide. The
Initial Writer of the Original Documentation is Sun Microsystems
Copyright &#169; 2003-2009. All Rights Reserved. (Initial Writer
contact(s): <a href="http://sun.com" class="bare">http://sun.com</a>).</p>
</div>
<div class="paragraph">
<p>Contributor(s): Joyent, Inc. Portions created by Joyent, Inc. are
Copyright &#169; 2016. All Rights Reserved. (Contributor contact(s):
<a href="http://joyent.com" class="bare">http://joyent.com</a>).</p>
</div>
<div class="paragraph">
<p>This documentation was derived from the source at
<a href="https://github.com/rmustacc/illumos-docbooks">illumos docbooks</a>. For full
changes as required by the PDL, please see the above URL.</p>
</div>
<script src="scroll-spy.js"></script>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-07-15 04:25:05 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>