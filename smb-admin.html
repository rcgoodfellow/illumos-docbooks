<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="[[preface-1]]">
<title>SMB Administration Guide</title>
<style>
/*
 * Modern Light/Dark Mode Stylesheet for illumos Documentation
 * Pure CSS solution with automatic theme switching based on system preferences
 * Responsive design for all devices
 */

/* ==================== CSS CUSTOM PROPERTIES (VARIABLES) ==================== */

:root {
  /* Light mode colors (default) */
  --bg-color: #ffffff;
  --bg-secondary: #f8f9fa;
  --bg-tertiary: #e9ecef;
  --text-color: #212529;
  --text-secondary: #6c757d;
  --text-muted: #868e96;
  --border-color: #dee2e6;
  --border-secondary: #e9ecef;
  --link-color: #0d6efd;
  --link-hover: #0a58ca;
  --link-visited: #6f42c1;
  
  /* Code highlighting */
  --code-bg: #f8f9fa;
  --code-border: #e9ecef;
  --code-text: #0033b3;
  --code-block-bg: #fafbfc;
  --code-block-border: #d1d9e0;
  
  /* Admonition colors */
  --note-bg: #cff4fc;
  --note-border: #0dcaf0;
  --warning-bg: #fff3cd;
  --warning-border: #ffc107;
  --important-bg: #f8d7da;
  --important-border: #dc3545;
  --tip-bg: #d1e7dd;
  --tip-border: #198754;
  --caution-bg: #fff3cd;
  --caution-border: #fd7e14;
  
  /* Table colors */
  --table-bg: #ffffff;
  --table-stripe: #f8f9fa;
  --table-border: #dee2e6;
  --table-header-bg: #e9ecef;
  
  /* TOC colors */
  --toc-bg: #f8f9fa;
  --toc-border: #dee2e6;
  --toc-link: #495057;
  --toc-link-hover: #0d6efd;
  
  /* Shadow and focus */
  --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  --focus-ring: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  
  /* Typography */
  --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-family-mono: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --font-size-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
  --line-height-base: 1.6;
  
  /* Spacing */
  --content-max-width: 75rem;
  --toc-width: 16rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-color: #1a1a1a;
    --bg-secondary: #2d2d2d;
    --bg-tertiary: #404040;
    --text-color: #e9ecef;
    --text-secondary: #adb5bd;
    --text-muted: #6c757d;
    --border-color: #495057;
    --border-secondary: #404040;
    --link-color: #6ea8fe;
    --link-hover: #9ec5fe;
    --link-visited: #b8a9ff;
    
    /* Code highlighting for dark mode */
    --code-bg: #2b2b2b;
    --code-border: #4a4a4a;
    --code-text: #569cd6;
    --code-block-bg: #1e1e1e;
    --code-block-border: #3e3e3e;
    
    /* Admonition colors for dark mode */
    --note-bg: #1f4a54;
    --note-border: #0dcaf0;
    --warning-bg: #4a3728;
    --warning-border: #ffc107;
    --important-bg: #4a2628;
    --important-border: #dc3545;
    --tip-bg: #1e3a28;
    --tip-border: #198754;
    --caution-bg: #4a3728;
    --caution-border: #fd7e14;
    
    /* Table colors for dark mode */
    --table-bg: #2d2d2d;
    --table-stripe: #404040;
    --table-border: #495057;
    --table-header-bg: #404040;
    
    /* TOC colors for dark mode */
    --toc-bg: #2d2d2d;
    --toc-border: #495057;
    --toc-link: #adb5bd;
    --toc-link-hover: #6ea8fe;
    
    /* Shadow for dark mode */
    --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.4);
    --focus-ring: 0 0 0 0.25rem rgba(110, 168, 254, 0.25);
  }
}

/* ==================== BASE STYLES ==================== */

* {
  box-sizing: border-box;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  line-height: var(--line-height-base);
  color: var(--text-color);
  background-color: var(--bg-color);
  margin: 0;
  padding: 0;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* ==================== LAYOUT ==================== */

.container {
  max-width: var(--content-max-width);
  margin: 0 auto;
  padding: var(--spacing-md);
}

/* Main content area */
#content {
  max-width: none;
  margin-right: var(--spacing-xl);
  padding-right: var(--spacing-lg);
}

/* Content when TOC is on left side */
body.toc2.toc-left #content {
  margin-right: var(--spacing-xl);
  padding-right: var(--spacing-xl);
}

/* ==================== TYPOGRAPHY ==================== */

h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  line-height: 1.2;
  margin-top: calc(var(--spacing-xl) * 1.5);
  margin-bottom: var(--spacing-lg);
  margin-right: var(--spacing-md);
  color: var(--text-color);
  letter-spacing: -0.02em;
  position: relative;
}

/* Make heading text clickable for easy linking */
h1[id]:hover, h2[id]:hover, h3[id]:hover, h4[id]:hover, h5[id]:hover, h6[id]:hover {
  cursor: pointer;
  text-decoration: underline;
  text-decoration-color: var(--link-color);
  text-decoration-thickness: 2px;
  text-underline-offset: 4px;
}

h1 {
  font-size: clamp(2rem, 2.2rem + 1vw, 2.8rem);
  font-weight: 800;
  border-bottom: 3px solid var(--border-color);
  padding-bottom: var(--spacing-md);
  margin-top: 0;
  margin-bottom: var(--spacing-xl);
}

h2 {
  font-size: clamp(1.6rem, 1.8rem + 0.5vw, 2.2rem);
  font-weight: 700;
  border-bottom: 2px solid var(--border-color);
  padding-bottom: var(--spacing-sm);
  margin-top: calc(var(--spacing-xl) * 2);
}

h3 {
  font-size: clamp(1.4rem, 1.5rem + 0.3vw, 1.8rem);
  font-weight: 650;
  border-left: 4px solid var(--border-color);
  padding-left: var(--spacing-md);
  margin-top: calc(var(--spacing-xl) * 1.5);
}

h4 {
  font-size: clamp(1.2rem, 1.3rem + 0.2vw, 1.5rem);
  font-weight: 650;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px dotted var(--border-color);
  padding-bottom: 0.25rem;
}

h5 {
  font-size: clamp(1.1rem, 1.15rem + 0.1vw, 1.3rem);
  font-weight: 600;
  font-style: italic;
}

h6 {
  font-size: clamp(1rem, 1.05rem + 0.1vw, 1.2rem);
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

p {
  margin-bottom: var(--spacing-md);
  margin-right: var(--spacing-md);
}

/* ==================== LINKS ==================== */

a {
  color: var(--link-color);
  text-decoration: none;
  transition: color 0.2s ease;
}

a:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

a:visited {
  color: var(--link-visited);
}

a:focus {
  outline: none;
  box-shadow: var(--focus-ring);
  border-radius: 0.25rem;
}

/* ==================== CODE BLOCKS ==================== */

code {
  font-family: var(--font-family-mono);
  font-size: 0.9em;
  color: var(--code-text);
  background-color: var(--code-bg);
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  border: 1px solid var(--code-border);
}

pre {
  font-family: var(--font-family-mono);
  font-size: 0.875rem;
  line-height: 1.5;
  background-color: var(--code-block-bg);
  color: var(--text-color);
  border: 1px solid var(--code-block-border);
  border-radius: 0.5rem;
  padding: var(--spacing-md);
  margin: var(--spacing-md) var(--spacing-md) var(--spacing-md) 0;
  overflow-x: auto;
  box-shadow: var(--shadow);
}

pre code {
  background: none;
  border: none;
  padding: 0;
  color: inherit;
  font-size: inherit;
}

/* ==================== SYNTAX HIGHLIGHTING ==================== */

/* Base highlighting for light mode */
.hljs {
  background-color: var(--code-block-bg) !important;
  color: var(--text-color) !important;
}

/* Light mode syntax highlighting */
:root {
  --hl-keyword: #0033b3;          /* Keywords: blue */
  --hl-string: #067d17;           /* Strings: green */
  --hl-comment: #808080;          /* Comments: gray */
  --hl-number: #1750eb;           /* Numbers: blue */
  --hl-type: #800080;             /* Types: purple */
  --hl-function: #000080;         /* Functions: dark blue */
  --hl-variable: #660e7a;         /* Variables: dark purple */
  --hl-preprocessor: #808000;     /* Preprocessor: olive */
  --hl-operator: #000000;         /* Operators: black */
  --hl-literal: #0000ff;          /* Literals: blue */
}

/* Dark mode syntax highlighting */
@media (prefers-color-scheme: dark) {
  :root {
    --hl-keyword: #569cd6;        /* Keywords: light blue */
    --hl-string: #9cdcfe;         /* Strings: light cyan */
    --hl-comment: #6a9955;        /* Comments: green */
    --hl-number: #b5cea8;         /* Numbers: light green */
    --hl-type: #4ec9b0;           /* Types: teal */
    --hl-function: #dcdcaa;       /* Functions: yellow */
    --hl-variable: #9cdcfe;       /* Variables: light cyan */
    --hl-preprocessor: #c586c0;   /* Preprocessor: light purple */
    --hl-operator: #d4d4d4;       /* Operators: light gray */
    --hl-literal: #d69d85;        /* Literals: orange */
  }
}

/* Highlight.js C/C++ syntax highlighting */
.hljs-keyword,
.hljs-selector-tag,
.hljs-built_in {
  color: var(--hl-keyword) !important;
  font-weight: 600;
}

.hljs-string,
.hljs-attribute {
  color: var(--hl-string) !important;
}

.hljs-comment,
.hljs-quote {
  color: var(--hl-comment) !important;
  font-style: italic;
}

.hljs-number,
.hljs-literal {
  color: var(--hl-number) !important;
}

.hljs-type,
.hljs-class .hljs-title {
  color: var(--hl-type) !important;
  font-weight: 600;
}

.hljs-function .hljs-title,
.hljs-title.function_ {
  color: var(--hl-function) !important;
  font-weight: 600;
}

.hljs-variable,
.hljs-name {
  color: var(--hl-variable) !important;
}

.hljs-meta,
.hljs-preprocessor {
  color: var(--hl-preprocessor) !important;
  font-weight: 600;
}

.hljs-operator,
.hljs-punctuation {
  color: var(--hl-operator) !important;
}

/* DTrace-specific highlighting */
.hljs-dtrace-probe,
.hljs-dtrace-builtin {
  color: var(--hl-function) !important;
  font-weight: 600;
}

/* Additional C-specific tokens */
.hljs-params {
  color: var(--text-color) !important;
}

.hljs-title {
  color: var(--hl-function) !important;
  font-weight: 600;
}

/* Ensure good contrast for inline code */
code:not(.hljs) {
  color: var(--hl-keyword) !important;
  background-color: var(--code-bg) !important;
  font-weight: 500;
}

/* Fallback for code blocks without syntax highlighting */
pre:not(.hljs) {
  color: var(--text-color) !important;
  background-color: var(--code-block-bg) !important;
}

/* Improve readability for unstyled code blocks */
pre code:not(.hljs) {
  color: var(--text-color) !important;
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
}

/* ==================== TABLES ==================== */

table {
  width: calc(100% - 2 * var(--spacing-md));
  border-collapse: collapse;
  margin: var(--spacing-md) var(--spacing-md);
  background-color: var(--table-bg);
  border-radius: 0.5rem;
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid var(--table-border);
}

th, td {
  padding: calc(var(--spacing-sm) * 0.75) var(--spacing-sm);
  text-align: left;
  border-bottom: 1px solid var(--table-border);
  border-right: 1px solid var(--table-border);
}

th:last-child,
td:last-child {
  border-right: none;
}

th {
  background-color: var(--table-header-bg);
  font-weight: 600;
  color: var(--text-color);
  border-bottom: 2px solid var(--table-border);
}

tbody tr:nth-child(even) {
  background-color: var(--table-stripe);
}

tbody tr:hover {
  background-color: var(--bg-tertiary);
}

/* Lists inside table cells - reduce spacing */
td ul, td ol, th ul, th ol {
  margin: var(--spacing-sm) 0;
  padding-left: var(--spacing-lg);
}

td li, th li {
  margin: calc(var(--spacing-sm) * 0.25) 0;
}

/* Paragraphs in table cells - reduce spacing */
td p, th p {
  margin-bottom: calc(var(--spacing-sm) * 0.5);
  margin-right: 0;
}

/* ==================== TABLE OF CONTENTS ==================== */

#toc {
  background-color: var(--toc-bg);
  border: 1px solid var(--toc-border);
  border-radius: 0.5rem;
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-xl);
  box-shadow: var(--shadow);
  position: relative;
}

#toc .title {
  font-weight: 600;
  font-size: 0.95rem;
  margin-bottom: calc(var(--spacing-sm) * 0.5);
  color: var(--text-color);
}

#toc ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

#toc ul ul {
  padding-left: calc(var(--spacing-md) * 0.75);
  margin-top: calc(var(--spacing-sm) * 0.25);
}

#toc li {
  margin: calc(var(--spacing-sm) * 0.25) 0;
}

#toc a {
  color: var(--toc-link);
  text-decoration: none;
  display: block;
  padding: 0.125rem 0.375rem;
  border-radius: 0.25rem;
  transition: all 0.2s ease;
  font-size: 0.9rem;
}

#toc a:hover {
  color: var(--toc-link-hover);
  background-color: var(--bg-tertiary);
  text-decoration: none;
}

/* Active/Current section highlighting */
#toc a.active {
  color: var(--link-color);
  background-color: var(--link-color);
  background-color: color-mix(in srgb, var(--link-color) 15%, transparent);
  font-weight: 600;
  border-left: 3px solid var(--link-color);
  padding-left: calc(0.375rem - 3px);
}

@media (prefers-color-scheme: dark) {
  #toc a.active {
    background-color: color-mix(in srgb, var(--link-color) 20%, transparent);
  }
}

/* Target section highlighting */
:target {
  scroll-margin-top: var(--spacing-xl);
  animation: highlight-target 2s ease-out;
}

@keyframes highlight-target {
  0% {
    background-color: color-mix(in srgb, var(--link-color) 20%, transparent);
  }
  100% {
    background-color: transparent;
  }
}

/* Smooth scrolling enhancement */
html {
  scroll-behavior: smooth;
  scroll-padding-top: var(--spacing-xl);
}

/* Progressive enhancement for scroll-spy */
body.js-enabled #toc a {
  transition: all 0.2s ease;
}

body.js-enabled #toc a.active {
  transform: translateX(2px);
}

/* Parent section highlighting for nested TOC */
#toc a.active-parent {
  color: var(--toc-link-hover);
  font-weight: 500;
  background-color: color-mix(in srgb, var(--link-color) 8%, transparent);
}

/* Fallback for browsers without color-mix support */
@supports not (background-color: color-mix(in srgb, blue 15%, transparent)) {
  #toc a.active {
    background-color: var(--link-hover);
    background-color: rgba(13, 110, 253, 0.15);
  }
  
  @media (prefers-color-scheme: dark) {
    #toc a.active {
      background-color: rgba(110, 168, 254, 0.2);
    }
  }
  
  #toc a.active-parent {
    background-color: rgba(13, 110, 253, 0.08);
  }
  
  @media (prefers-color-scheme: dark) {
    #toc a.active-parent {
      background-color: rgba(110, 168, 254, 0.1);
    }
  }
}

/* Left TOC layout for larger screens */
@media (min-width: 1200px) {
  body.toc2.toc-left {
    padding-left: calc(var(--toc-width) + var(--spacing-lg));
  }
  
  #toc.toc2 {
    position: fixed;
    left: 0;
    top: 0;
    width: var(--toc-width);
    height: 100vh;
    overflow-y: auto;
    margin: 0;
    border-radius: 0;
    border-left: none;
    border-top: none;
    border-bottom: none;
    z-index: 1000;
  }
}

/* ==================== ADMONITIONS ==================== */

.admonitionblock {
  margin: var(--spacing-lg) var(--spacing-md);
  border-radius: 0.5rem;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.admonitionblock table {
  margin: 0;
  box-shadow: none;
  width: 100%;
  border: none;
  border-radius: 0;
}

.admonitionblock td.icon {
  display: none;
}

.admonitionblock td.content {
  padding: var(--spacing-md);
  border: none;
  border-bottom: none;
  border-right: none;
}

/* Note */
.admonitionblock.note {
  background-color: var(--note-bg);
  border-left: 4px solid var(--note-border);
}

/* Warning */
.admonitionblock.warning {
  background-color: var(--warning-bg);
  border-left: 4px solid var(--warning-border);
}

/* Important */
.admonitionblock.important {
  background-color: var(--important-bg);
  border-left: 4px solid var(--important-border);
}

/* Tip */
.admonitionblock.tip {
  background-color: var(--tip-bg);
  border-left: 4px solid var(--tip-border);
}

/* Caution */
.admonitionblock.caution {
  background-color: var(--caution-bg);
  border-left: 4px solid var(--caution-border);
}

/* ==================== LISTS ==================== */

ul, ol {
  padding-left: var(--spacing-xl);
  margin: var(--spacing-md) var(--spacing-md) var(--spacing-md) 0;
}

li {
  margin: var(--spacing-sm) 0;
}

dt {
  font-weight: 600;
  margin-top: var(--spacing-md);
  color: var(--text-color);
}

dd {
  margin-left: var(--spacing-xl);
  margin-bottom: var(--spacing-md);
}

/* ==================== BLOCKQUOTES ==================== */

blockquote {
  border-left: 4px solid var(--border-color);
  margin: var(--spacing-lg) var(--spacing-md) var(--spacing-lg) 0;
  padding: var(--spacing-md) var(--spacing-lg);
  background-color: var(--bg-secondary);
  font-style: italic;
  border-radius: 0 0.5rem 0.5rem 0;
}

/* ==================== IMAGES AND FIGURES ==================== */

img {
  max-width: 80%;
  width: auto;
  height: auto;
  border-radius: 0.5rem;
  box-shadow: var(--shadow);
  margin: var(--spacing-md) auto;
  display: block;
}

.imageblock {
  text-align: center;
  margin: var(--spacing-lg) 0;
}

.imageblock .title {
  font-style: italic;
  color: var(--text-secondary);
  margin-top: var(--spacing-sm);
}

/* ==================== RESPONSIVE DESIGN ==================== */

/* Mobile adjustments */
@media (max-width: 768px) {
  .container {
    padding: var(--spacing-sm);
  }
  
  #content {
    margin-right: var(--spacing-md);
    padding-right: var(--spacing-sm);
  }
  
  body.toc2.toc-left #content {
    margin-right: var(--spacing-md);
    padding-right: var(--spacing-sm);
  }
  
  h1 {
    font-size: 1.8rem;
    margin-right: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-sm);
  }
  
  h2 {
    font-size: 1.5rem;
    margin-right: var(--spacing-sm);
    margin-top: var(--spacing-xl);
    padding: var(--spacing-sm);
  }
  
  h3 {
    font-size: 1.3rem;
    margin-top: var(--spacing-lg);
    padding-left: var(--spacing-sm);
  }
  
  h4 {
    font-size: 1.1rem;
  }
  
  h1, h2, h3, h4, h5, h6 {
    margin-right: var(--spacing-sm);
  }
  
  p {
    margin-right: var(--spacing-sm);
  }
  
  pre {
    font-size: 0.8rem;
    padding: var(--spacing-sm);
    margin-right: var(--spacing-sm);
  }
  
  ul, ol {
    margin-right: var(--spacing-sm);
  }
  
  blockquote {
    margin-right: var(--spacing-sm);
  }
  
  table {
    font-size: 0.9rem;
    width: calc(100% - 2 * var(--spacing-sm));
    margin: var(--spacing-md) var(--spacing-sm);
  }
  
  th, td {
    padding: calc(var(--spacing-sm) * 0.5) calc(var(--spacing-sm) * 0.75);
  }
  
  #toc {
    margin-bottom: var(--spacing-md);
  }
  
  .admonitionblock {
    margin: var(--spacing-md) var(--spacing-sm);
  }
  
  .admonitionblock td.icon {
    display: none;
  }
  
  .admonitionblock td.content {
    padding: var(--spacing-sm);
    border: none;
  }
  
  .admonitionblock table {
    margin: 0;
    width: 100%;
  }
  
  /* Even more compact lists in table cells on mobile */
  td ul, td ol, th ul, th ol {
    margin: calc(var(--spacing-sm) * 0.5) 0;
    padding-left: var(--spacing-md);
  }
  
  td li, th li {
    margin: calc(var(--spacing-sm) * 0.125) 0;
  }
  
  td p, th p {
    margin-bottom: calc(var(--spacing-sm) * 0.25);
  }
}

/* Tablet adjustments */
@media (min-width: 769px) and (max-width: 1199px) {
  .container {
    padding: var(--spacing-md) var(--spacing-lg);
  }
}

/* ==================== PRINT STYLES ==================== */

@media print {
  :root {
    --bg-color: white;
    --text-color: black;
    --border-color: #ccc;
  }
  
  body {
    font-size: 12pt;
    line-height: 1.4;
  }
  
  #toc.toc2 {
    position: static;
    width: auto;
    height: auto;
    margin-bottom: var(--spacing-lg);
  }
  
  body.toc2.toc-left {
    padding-left: 0;
  }
  
  .admonitionblock {
    page-break-inside: avoid;
  }
  
  pre {
    page-break-inside: avoid;
  }
  
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
}

/* ==================== UTILITIES ==================== */

.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.mb-0 {
  margin-bottom: 0;
}

.mt-0 {
  margin-top: 0;
}

/* ==================== ACCESSIBILITY ==================== */

/* Focus indicators */
*:focus {
  outline: 2px solid var(--link-color);
  outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --border-color: #000000;
    --border-secondary: #000000;
    --text-secondary: var(--text-color);
  }
}

/* ==================== CUSTOM ENHANCEMENTS ==================== */

/* Note: This CSS includes scroll-spy functionality that works with CSS alone
 * For enhanced scroll-spy with JavaScript, include scroll-spy.js:
 * <script src="scroll-spy.js"></script>
 */

/* Better selection colors */
::selection {
  background-color: var(--link-color);
  color: white;
}

/* Loading state */
body {
  opacity: 0;
  animation: fadeIn 0.3s ease-in-out forwards;
}

@keyframes fadeIn {
  to {
    opacity: 1;
  }
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>SMB Administration Guide</h1>
<div class="details">
<span id="author" class="author">[[preface-1]]</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_documentation_support_and_training">1.1. Documentation, Support, and Training</a></li>
<li><a href="#_typographic_conventions">1.2. Typographic Conventions</a></li>
<li><a href="#shell-prompts-in-command-examples">1.3. Shell Prompts in Command Examples</a></li>
</ul>
</li>
<li><a href="#windows-interoperability-overview">2. Windows Interoperability (Overview)</a>
<ul class="sectlevel3">
<li><a href="#illumos-smb-client">2.1. illumos SMB Client</a></li>
<li><a href="#identity-mapping-service">2.2. Identity Mapping Service</a></li>
<li><a href="#managing-illumos-smb-configuration-properties">2.3. Managing illumos SMB Configuration Properties</a></li>
<li><a href="#configuring-the-illumos-smb-service-process-overview">2.4. Configuring the illumos SMB Service – Process Overview</a></li>
<li><a href="#utilities-and-files-associated-with-the-illumos-smb-server-and-client">2.5. Utilities and Files Associated With the illumos SMB Server and Client</a>
<ul class="sectlevel3">
<li><a href="#illumos-smb-utilities">2.5.1. illumos SMB Utilities</a></li>
<li><a href="#illumos-smb-service-daemon">2.5.2. illumos SMB Service Daemon</a></li>
<li><a href="#illumos-smb-files">2.5.3. illumos SMB Files</a></li>
</ul>
</li>
<li><a href="#authentication-directory-naming-and-time-services">2.6. Authentication, Directory, Naming, and Time Services</a></li>
<li><a href="#smb-shares">2.7. SMB Shares</a>
<ul class="sectlevel5">
<li><a href="#autohome-map-key-substitution">Autohome Map Key Substitution</a></li>
<li><a href="#wildcard-rule">Wildcard Rule</a></li>
</ul>
</li>
<li><a href="#local-smb-groups">2.8. Local SMB Groups</a></li>
</ul>
</li>
<li><a href="#identity-mapping-administration-tasks">3. Identity Mapping Administration (Tasks)</a>
<ul class="sectlevel2">
<li><a href="#identity-mapping-quick-start">3.1. Identity Mapping Quick Start</a></li>
<li><a href="#mapping-user-and-group-identities">3.2. Mapping User and Group Identities</a>
<ul class="sectlevel3">
<li><a href="#unix-users-and-groups">3.2.1. Unix Users and Groups</a></li>
<li><a href="#windows-users-and-groups">3.2.2. Windows Users and Groups</a></li>
</ul>
</li>
<li><a href="#creating-your-identity-mapping-strategy">3.3. Creating Your Identity Mapping Strategy</a></li>
<li><a href="#managing-rule-based-identity-mapping-for-users-and-groups-task-map">3.4. Managing Rule-Based Identity Mapping for Users and Groups (Task Map)</a>
<ul class="sectlevel3">
<li><a href="#how-to-configure-the-illumos-smb-service-in-workgroup-mode">3.4.1. How to Configure the illumos SMB Service in Workgroup Mode</a></li>
</ul>
</li>
<li><a href="#managing-smb-shares-task-map">3.5. Managing SMB Shares (Task Map)</a></li>
<li><a href="#managing-smb-groups-task-map">3.6. Managing SMB Groups (Task Map)</a></li>
<li><a href="#managing-smb-mounts-in-your-local-environment-task-map">3.7. Managing SMB Mounts in Your Local Environment (Task Map)</a>
<ul class="sectlevel3">
<li><a href="#samba-or-smb-service-cannot-bind-various-ports">3.7.1. Samba or SMB Service Cannot Bind Various Ports</a></li>
<li><a href="#invalid-password-errors-appear-when-mapping-a-drive-or-browsing-computers-in-the-workgroup">3.7.2. <code>invalid password</code> Errors Appear When Mapping a Drive or Browsing Computers in the Workgroup</a></li>
<li><a href="#access-control-list-inheritance-issues">3.7.3. Access Control List Inheritance Issues</a></li>
</ul>
</li>
<li><a href="#illumos-smb-client-troubleshooting">3.8. illumos SMB Client Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#viewing-illumos-smb-client-property-settings">3.8.1. Viewing illumos SMB Client Property Settings</a></li>
<li><a href="#access-denied-message-when-accessing-a-server">3.8.2. <code>Access Denied</code> Message When Accessing a Server</a></li>
<li><a href="#cannot-view-or-mount-smb-shares">3.8.3. Cannot View or Mount SMB Shares</a></li>
<li><a href="#cannot-mount-smb-shares-as-a-regular-user">3.8.4. Cannot Mount SMB Shares as a Regular User</a></li>
<li><a href="#tar-and-gtar-issues-file-changed-as-we-read-it-warnings">3.8.5. <code>tar</code> and <code>gtar</code> Issues <code>file changed as we read it</code> Warnings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The illumos SMB Administration Guide describes the illumos Server
Message Block (SMB) service. This book is intended for system
administrators and end users. Both illumos Operating System (illumos OS)
and Windows system administrators can use this information to configure
and integrate the illumos SMB service into a Windows environment. In
addition, system administrators can configure the identity mapping
service. Finally, the chapter about the illumos SMB client is primarily
intended for illumos users who would like to mount SMB shares. The
illumos SMB client chapter also includes tasks to be performed by a
system administrator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This illumos release supports systems that use the SPARC and x86
families of processor architectures: UltraSPARC, SPARC64, AMD64,
Pentium, and Xeon EM64T. The supported systems appear in the
<a href="http://www.illumos.org/hcl/">illumos Hardware Compatibility List</a>. This
document cites any implementation differences between the platform
types.</p>
</div>
<div class="paragraph">
<p>In this document the term “x86” refers to 64–bit and 32–bit systems
manufactured using processors compatible with the AMD64 or Intel
Xeon/Pentium product families. For supported systems, see the illumos
Hardware Compatibility List.</p>
</div>
<div class="paragraph">
<p>=== Related Third-Party Web Site References</p>
</div>
<div class="paragraph">
<p>Third-party URLs are referenced in this document and provide additional,
related information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sun is not responsible for the availability of third-party web sites
mentioned in this document. Sun does not endorse and is not responsible
or liable for any content, advertising, products, or other materials
that are available on or through such sites or resources. Sun will not
be responsible or liable for any actual or alleged damage or loss caused
or alleged to be caused by or in connection with use of or reliance on
any such content, goods, or services that are available on or through
such sites or resources.</p>
</div>
<div class="sect2">
<h3 id="_documentation_support_and_training"><a class="anchor" href="#_documentation_support_and_training"></a>1.1. Documentation, Support, and Training</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#">Documentation</a></p>
</li>
<li>
<p><a href="#">Support</a></p>
</li>
<li>
<p><a href="#">Training</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_typographic_conventions"><a class="anchor" href="#_typographic_conventions"></a>1.2. Typographic Conventions</h3>
<div class="paragraph">
<p>The following table describes the typographic conventions that are used
in this book.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Typographic Conventions</caption>
<colgroup>
<col style="width: 21%;">
<col style="width: 45%;">
<col style="width: 34%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Typeface</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AaBbCc123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The names of commands, files, and directories, and
onscreen computer output</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Edit your <code>.login</code> file.</p>
</div>
<div class="paragraph">
<p>Use <code>ls a</code> to list all files.</p>
</div>
<div class="paragraph">
<p><code>machine_name% you have mail.</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AaBbCc123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What you type, contrasted with onscreen computer output</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>machine_name%</code> <code>su</code></p>
</div>
<div class="paragraph">
<p><code>Password:</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;aabbcc123&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Placeholder: replace with a real name or value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command to remove a file is <code>rm</code> &lt;filename&gt;.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AaBbCc123</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Book titles, new terms, and terms to be emphasized</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Read Chapter 6 in the User&#8217;s Guide.</p>
</div>
<div class="paragraph">
<p>A <em>cache</em> is a copy that is stored locally.</p>
</div>
<div class="paragraph">
<p>Do <em>not</em> save the file.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Some emphasized items appear bold online.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="shell-prompts-in-command-examples"><a class="anchor" href="#shell-prompts-in-command-examples"></a>1.3. Shell Prompts in Command Examples</h3>
<div class="paragraph">
<p>The following table shows the default UNIX system prompt and superuser
prompt for the C shell, Bourne shell, and Korn shell.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Shell Prompts</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Shell</th>
<th class="tableblock halign-left valign-top">Prompt</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C shell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>machine_name%</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C shell for superuser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>machine_name#</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bourne shell and Korn shell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bourne shell and Korn shell for superuser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="windows-interoperability-overview"><a class="anchor" href="#windows-interoperability-overview"></a>2. Windows Interoperability (Overview)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This administration guide provides the information needed to integrate
an illumos Server Message Block (SMB) server into an existing Windows
environment and also describes the illumos SMB client, which enables you
to mount SMB shares on illumos systems.</p>
</div>
<div class="paragraph">
<p>Windows clients can access SMB shares from the illumos SMB service as if
they were made available from a Windows server. This guide focuses only
on the information required to integrate the illumos SMB service and how
to use the illumos SMB client. Windows topics are only covered when
those topics affect the integration of the illumos SMB service into the
Windows environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-illumos-smb-service">The illumos SMB Service</a></p>
</li>
<li>
<p><a href="#configuring-the-illumos-smb-service-process-overview">Configuring the illumos SMB Service – Process
Overview</a></p>
</li>
<li>
<p><a href="#utilities-and-files-associated-with-the-illumos-smb-server-and-client">Utilities and Files Associated With the
illumos SMB Server and Client</a></p>
</li>
<li>
<p><a href="#authentication-directory-naming-and-time-services">Authentication&#44; Directory&#44;
Naming&#44; and Time Services</a></p>
</li>
<li>
<p><a href="#smb-shares">SMB Shares</a></p>
</li>
<li>
<p><a href="#local-smb-groups">Local SMB Groups</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Server Message Block (SMB) protocol allows SMB clients to access
files and resources on SMB servers. SMB is the predominant file-sharing
protocol in Windows environments. In this docuemnt, the term SMB is used
to refer to all versions of the SMB protocol.</p>
</div>
<div id="the-illumos-smb-service" class="paragraph">
<p>=== The illumos SMB Service</p>
</div>
<div class="paragraph">
<p>The illumos Operating System (illumos OS) provides an integrated SMB
service. An illumos server can be an active participant in a Windows
active directory domain and provide ubiquitous, cross-protocol file
sharing through SMB and NFS to clients in their native dialect.</p>
</div>
<div class="paragraph">
<p>The illumos SMB service allows a native illumos system to serve files,
by means of SMB shares, to SMB enabled clients, such as Windows and Mac
OS systems. By virtue of the illumos SMB service, a Windows client (or
other SMB client) can interoperate with the illumos SMB service as it
would with a Windows server.</p>
</div>
<div class="paragraph">
<p>The illumos SMB service can operate in either workgroup mode or in
domain mode. In workgroup mode, the illumos SMB service is responsible
for authenticating users locally when access is requested to shared
resources. This authentication process is referred to as local login. In
domain mode, the illumos SMB service uses either Kerberos or
"pass-through" authentication. With pass-through authentication, the
server uses NetLOGON RPC to pass authentication requests through to a
domain controller.</p>
</div>
<div class="paragraph">
<p>When a user is successfully authenticated, the illumos SMB service
generates an access token using the security identifiers (SIDs) that
represent the user&#8217;s identity and the groups of which the user is a
member. When the user requests access to files or resources from the
service, the access token is used to determine access to files by
cross-checking the token with the access control list (ACL) or
permissions on files and resources. illumos OS credentials have been
enhanced to fully support Windows-style SIDs. In addition, file systems,
such as ZFS, support Windows-style ACLs and access checking.</p>
</div>
<div class="paragraph">
<p>The illumos OS is unique in that it can manage user identities
simultaneously by using both traditional Unix-style UIDs and GIDs and
Windows-style SIDs. When a user is authenticated through the SMB
service, the user&#8217;s Windows identity is mapped to the appropriate UNIX
identity by the <code>idmap</code> identity mapping service. If an existing UNIX
identity exists, that identity is used. Otherwise, a temporary identity
is generated using ephemeral UIDs and GIDs, as required. Ephemeral IDs
are valid only within each illumos OS instance and only until the system
is rebooted. These IDs are never stored on disk or transmitted over the
network. When an ACL is stored on disk through the SMB service, the SIDs
are used to generate the access control entries. Unix utilities, such as
<code>ls</code> and <code>chmod</code>, support ACL management.</p>
</div>
<div class="paragraph">
<p>For more information about how the illumos OS manages user identities,
see <a href="#identity-mapping-administration-tasks">Identity Mapping Administration (Tasks)</a>.</p>
</div>
<div class="paragraph">
<p>The following diagram shows how an illumos file server can operate
simultaneously with both Unix name services and Windows domains. The
Windows domain controller provides SMB authentication and naming
services for SMB clients and servers, while the Unix name servers
provide naming services for NFS clients and servers. Note that a Windows
domain controller can also act as a Unix name service.</p>
</div>
<div id="smbenvfigure" class="imageblock">
<div class="content">
<img src="figures/illumosSMBDiagram.png" alt="Diagram showing the components and interactions in an illumos SMB environment.">
</div>
<div class="title">Figure 1. illumos SMB Environment</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#illumos-smb-service">illumos SMB Service</a></p>
</li>
<li>
<p><a href="#illumos-smb-client">illumos SMB Client</a></p>
</li>
<li>
<p><a href="#identity-mapping-service">Identity Mapping Service</a></p>
</li>
</ul>
</div>
<div id="illumos-smb-service" class="paragraph">
<p>==== illumos SMB Service</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Samba and SMB services cannot be used simultaneously on a single
illumos system. The Samba service must be disabled in order to run the
illumos SMB service. For more information, see
<a href="#disablesambatask">task_title</a>.</p>
</div>
<div class="paragraph">
<p>For a high-level overview of configuring the illumos SMB service, see
<a href="#configuring-the-illumos-smb-service-process-overview">Configuring the illumos SMB Service – Process
Overview</a>. For information about configuring the service, see Chapter 3,
<a href="#illumos-smb-service-administration-tasks">illumos SMB Service Administration (Tasks)</a>. For
more information about the illumos SMB service, see the <code>smbadm(8)</code>,
<code>smbd(8)</code>, <code>smbstat(8)</code>, <code>smb(5)</code>, <code>smbautohome(5)</code>, and
<code>pam_smb_passwd(7)</code> man pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the file system supports the <code>archive</code>, <code>hidden</code>, <code>read-only</code>, and
<code>system</code> attributes, these attributes are made available as the DOS
attributes available on Windows systems. ZFS supports these attributes.</p>
</li>
<li>
<p>If the file system supports illumos extended attributes, they are made
available as NTFS alternate data streams (also known as "named
streams").</p>
</li>
<li>
<p>The case-sensitivity capabilities of the file system are made
available to SMB clients. To support both Windows-style access and POSIX
access, a file system should support mixed-mode, which is simultaneous
support for case-sensitive and case-insensitive name operations.</p>
<div class="paragraph">
<p>The illumos OS supports both the NFS and SMB protocols, which have
different expectations regarding case behavior. For instance, Windows
clients typically expect case-insensitive behavior while local
applications and NFS clients typically expect case-sensitive behavior.
The ZFS file system supports three case modes: case-sensitive,
case-insensitive, and mixed. The ZFS file system can indicate case
conflicts when in mixed mode. Mixed mode is recommended for maximum
multi-protocol compatibility.</p>
</div>
</li>
<li>
<p>To provide full Windows access control list (ACL) support, file
systems should be able to store SIDs and they should at least support
NFSv4 ACLs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the supported features of the UFS and ZFS file
systems, see the <code>ufs(4FS)</code> man page and the
<a href="https://www.illumos.org/books/zfs-admin">ZFS Administration Guide</a>,
respectively.</p>
</div>
<div class="paragraph">
<p>For information about how to access SMB shares from your client, refer
to the client documentation.</p>
</div>
<div class="sect3">
<h4 id="illumos-smb-client"><a class="anchor" href="#illumos-smb-client"></a>2.1. illumos SMB Client</h4>
<div class="paragraph">
<p>The SMB protocol is the native file-sharing protocol used by Windows and
Mac OS systems. Samba implements the SMB protocol for UNIX and Linux
systems. The illumos SMB client is a virtual file system that provides
access to files and directories from the SMB service.</p>
</div>
<div class="paragraph">
<p>By using the illumos SMB client, a user can mount remote SMB shares
(directories) on their illumos system to get read-write access to
previously inaccessible files. The illumos SMB client enables an
unprivileged user to mount and unmount shares on directories he owns.</p>
</div>
<div class="paragraph">
<p>For more information about how to use the illumos SMB client to access
shares, see Chapter 4, <a href="#illumos-smb-client-administration-tasks">illumos SMB Client
Administration (Tasks)</a>, and the <code>smbutil(1)</code>, <code>mount_smbfs(8)</code>,
<code>nsmbrc(5)</code>, and <code>pam_smbfs_login(7)</code> man pages.</p>
</div>
</div>
<div class="sect3">
<h4 id="identity-mapping-service"><a class="anchor" href="#identity-mapping-service"></a>2.2. Identity Mapping Service</h4>
<div class="paragraph">
<p>The illumos OS includes an identity mapping service that enables you to
map identities between Unix and Windows systems using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name-based mapping.</strong> Maps Windows and Unix users and groups by name
in the following ways:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Directory-based mapping.</strong> Uses name mapping information that is
stored in user or group objects in the Active Directory (AD) and/or the
native LDAP directory service to map users and groups.</p>
</li>
<li>
<p><strong>Rule-based mapping.</strong> An administrator uses rules to map Windows and
Unix users and groups by name.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Ephemeral ID mapping.</strong> A UID or GID is dynamically allocated as
needed for every SID that is not already mapped by name. Ephemeral ID
mapping is used by default.</p>
</li>
<li>
<p><strong>Local SID mapping.</strong> A non-ephemeral UID or GID is mapped to an
algorithmically generated local SID.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>idmap</code> utility can be used to create and manage the name-based
mappings and to monitor the mappings in effect.</p>
</div>
<div class="paragraph">
<p>For more information about mapping user and group identities, see
<a href="#mapping-user-and-group-identities">Mapping User and Group Identities</a>. For
information about how to determine your identity mapping strategy, see
<a href="#creating-your-identity-mapping-strategy">Creating Your Identity Mapping Strategy</a>.
For instructions on how to use the <code>idmap</code> command, see
<a href="#managing-directory-based-identity-mapping-for-users-and-groups-task-map">Managing Directory-Based Identity
Mapping for Users and Groups (Task Map)</a>,
<a href="#managing-rule-based-identity-mapping-for-users-and-groups-task-map">Managing Rule-Based Identity Mapping for
Users and Groups (Task Map)</a>, and the <code>idmap(8)</code> man page.</p>
</div>
</div>
<div class="sect3">
<h4 id="managing-illumos-smb-configuration-properties"><a class="anchor" href="#managing-illumos-smb-configuration-properties"></a>2.3. Managing illumos SMB Configuration Properties</h4>
<div class="paragraph">
<p>The illumos SMB service and the illumos SMB client use the <code>sharectl</code>
command to manage configuration properties. For descriptions of the
illumos SMB service properties, see the <code>sharectl(8)</code> and <code>smb(5)</code> man
pages. For descriptions of the illumos SMB client properties, see the
<code>nsmbrc(5)</code> man page.</p>
</div>
<div class="paragraph">
<p>The illumos SMB properties and their values are stored in the Service
Management Facility (SMF). For more information about SMF, see Chapter
15, Managing Services (Overview), in System Administration Guide: Basic
Administration.</p>
</div>
<div class="paragraph">
<p>The <code>sharectl</code> command is used throughout the configuration process to
set and view properties. This command and examples of its use are
described in Chapter 3, <a href="#illumos-smb-service-administration-tasks">illumos SMB Service
Administration (Tasks)</a>. The <code>sharectl</code> command is also used by the
illumos SMB client to configure the global environment. For more
information, see Chapter 4, <a href="#illumos-smb-client-administration-tasks">illumos SMB Client
Administration (Tasks)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-illumos-smb-service-process-overview"><a class="anchor" href="#configuring-the-illumos-smb-service-process-overview"></a>2.4. Configuring the illumos SMB Service – Process Overview</h3>
<div class="paragraph">
<p>This section describes the high-level process for configuring the
illumos SMB service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine your identity mapping strategy.</p>
<div class="paragraph">
<p>See <a href="#creating-your-identity-mapping-strategy">Creating Your Identity Mapping
Strategy</a>.</p>
</div>
</li>
<li>
<p>Configure the illumos SMB service as a client to the various services
that are used in your environment.</p>
<div class="paragraph">
<p>Your illumos system might need to be a client of other services that are
available in your environment.
* For DNS, see System Administration Guide: Naming and Directory
Services (DNS, NIS, and LDAP).
* For Kerberos, see Configuring Kerberos Clients (Task Map) in System
Administration Guide: Security Services.
* For LDAP, see Chapter 12, Setting Up LDAP Clients (Tasks), in System
Administration Guide: Naming and Directory Services (DNS, NIS, and
LDAP).
* For NIS, see Setting Up NIS Clients in System Administration Guide:
Naming and Directory Services (DNS, NIS, and LDAP).
* For NTP, see How to Set Up an NTP Client in System Administration
Guide: Network Services.</p>
</div>
</li>
<li>
<p>Determine whether you want the illumos SMB service to join an existing
Windows domain or a Windows workgroup.</p>
<div class="ulist">
<ul>
<li>
<p>To join a domain, see <a href="#how-to-configure-the-illumos-smb-service-in-domain-mode">How to Configure
the illumos SMB Service in Domain Mode</a>.</p>
</li>
<li>
<p>To join a workgroup, see <a href="#how-to-configure-the-illumos-smb-service-in-workgroup-mode">How to
Configure the illumos SMB Service in Workgroup Mode</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Define one or more SMB shares.</p>
<div class="paragraph">
<p>See <a href="#managing-smb-shares-task-map">Managing SMB Shares (Task Map)</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="utilities-and-files-associated-with-the-illumos-smb-server-and-client"><a class="anchor" href="#utilities-and-files-associated-with-the-illumos-smb-server-and-client"></a>2.5. Utilities and Files Associated With the illumos SMB Server and Client</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#illumos-smb-utilities">illumos SMB Utilities</a></p>
</li>
<li>
<p><a href="#illumos-smb-service-daemon">illumos SMB Service Daemon</a></p>
</li>
<li>
<p><a href="#illumos-smb-files">illumos SMB Files</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="illumos-smb-utilities"><a class="anchor" href="#illumos-smb-utilities"></a>2.5.1. illumos SMB Utilities</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#mount_smbfs-command"> Command</a></p>
</li>
<li>
<p><a href="#sharectl-command"> Command</a></p>
</li>
<li>
<p><a href="#sharemgr-command"> Command</a></p>
</li>
<li>
<p><a href="#smbadm-command"> Command</a></p>
</li>
<li>
<p><a href="#smbstat-command"> Command</a></p>
</li>
<li>
<p><a href="#smbutil-command"> Command</a></p>
</li>
<li>
<p><a href="#umount_smbfs-command"> Command</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="mount_smbfs-command"><a class="anchor" href="#mount_smbfs-command"></a><code>mount_smbfs</code> Command</h5>
<div class="paragraph">
<p>With this command, you can attach a named SMB share to a specified mount
point. The <code>mount_smbfs</code> command enables you to mount an SMB share
to a directory you own without having to become superuser.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mountsharetask">task_title</a></p>
</li>
<li>
<p><a href="#setupmultiusersharetask">task_title</a></p>
</li>
<li>
<p><a href="#automountsharetask">task_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, see the <code>mount_smbfs(8)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="sharectl-command"><a class="anchor" href="#sharectl-command"></a><code>sharectl</code> Command</h5>
<div class="ulist">
<ul>
<li>
<p>Set client and server operational properties</p>
</li>
<li>
<p>Display property values for a specific protocol</p>
</li>
<li>
<p>Obtain the status of a protocol</p>
</li>
<li>
<p><a href="#settingupsmbtask">???</a></p>
</li>
<li>
<p><a href="#customizeglobalenvtask">task_title</a></p>
</li>
<li>
<p><a href="#viewglobalenvtask">task_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, see the <code>sharectl(8)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="sharemgr-command"><a class="anchor" href="#sharemgr-command"></a><code>sharemgr</code> Command</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Share.</strong> One or more files or directories in a share group.</p>
</li>
<li>
<p><strong>Share group.</strong> A container of one or more shared files or directories.</p>
<div class="ulist">
<ul>
<li>
<p>Options for <code>sharemgr</code> are set to a share group, not to a specific
file or directory. All options apply to each file and directory in the
group.</p>
</li>
<li>
<p>A file or directory can only be assigned to one share group. However,
you can move a file or directory from one group to another.</p>
</li>
<li>
<p>A share group can be used by multiple file system types. For example,
the share group <code>my_group</code> could be used by NFS and ZFS and be
assigned one set of options for NFS and another set of options for ZFS.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a share is managed by ZFS, <code>sharemgr</code> identifies the share and
lists it in a <code>zfs</code> share group.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>sharemgr</code> utility provides a unique way of checking the validity of
a desired configuration. The <code>n</code> option allows you to test the validity
of the options and properties you want to use with a specific
subcommand. The test does not change your configuration. For example, if
you use the <code>n</code> option with the subcommand <code>create</code>, no share group is
created.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also use the ZFS <code>sharesmb</code> property to configure SMB sharing.
For more information, see
<a href="#createstaticsmbsharezfstask">task_title</a> and the <code>zfs(8)</code> and
<code>zpool(8)</code> man pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#createstaticsmbsharetask">task_title</a></p>
</li>
<li>
<p><a href="#modifysmbsharetask">task_title</a></p>
</li>
<li>
<p><a href="#removesmbsharetask">task_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, see the <code>sharemgr(8)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="smbadm-command"><a class="anchor" href="#smbadm-command"></a><code>smbadm</code> Command</h5>
<div class="paragraph">
<p>You can use the <code>smbadm</code> command to manage domain membership of the
illumos SMB service. For instance, you can have the illumos SMB service
use domain mode or workgroup mode. The <code>smbadm</code> command also enables you
to configure SMB local groups. SMB local groups can be used when Windows
accounts must be members of some local groups and when Windows-style
privileges must be granted. Unix local groups cannot provide these
functionalities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#how-to-configure-the-illumos-smb-service-in-domain-mode">How to Configure the illumos SMB Service
in Domain Mode</a></p>
</li>
<li>
<p><a href="#how-to-configure-the-illumos-smb-service-in-workgroup-mode">How to Configure the illumos SMB
Service in Workgroup Mode</a></p>
</li>
<li>
<p><a href="#createsmbgrouptask">task_title</a></p>
</li>
<li>
<p><a href="#addmembertosmbgrouptask">task_title</a></p>
</li>
<li>
<p><a href="#removememberfromsmbgrouptask">task_title</a></p>
</li>
<li>
<p><a href="#modifysmbgroupprivstask">task_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, see the <code>smbadm(8)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="smbstat-command"><a class="anchor" href="#smbstat-command"></a><code>smbstat</code> Command</h5>
<div class="paragraph">
<p>You can use the <code>smbstat</code> command to show statistical information about
the <code>smbd</code> server. By default, the <code>smbstat</code> command shows general
information about the SMB service as well as dispatched SMB request
counters. For more information, see the <code>smbstat(8)</code> man page.</p>
</div>
<div class="paragraph">
<p>The <code>kstat</code> command can be used to report on kernel SMB statistics on a
periodic basis and also to specify information about individual SMB
statistics. For more information, see the <code>kstat(8)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="smbutil-command"><a class="anchor" href="#smbutil-command"></a><code>smbutil</code> Command</h5>
<div class="ulist">
<ul>
<li>
<p>View the shares available for mounting from a particular SMB server</p>
</li>
<li>
<p>Print a file via a "print" share on an SMB server</p>
</li>
<li>
<p>Generate a hash of a password for storing in a file such as
<code>$HOME/.nsmbrc</code></p>
</li>
<li>
<p>Create or remove persistent passwords used to authenticate to SMB
servers</p>
</li>
<li>
<p>Resolve a name to an IP address for a server that uses SMB over
NetBIOS, not TCP</p>
</li>
<li>
<p>Resolve the specified server to the NetBIOS workgroup and system name</p>
</li>
<li>
<p><a href="#findsharestask">task_title</a></p>
</li>
<li>
<p><a href="#mountsharetask">task_title</a></p>
</li>
<li>
<p><a href="#storepasswordtask">task_title</a></p>
</li>
<li>
<p><a href="#pammoduletask">task_title</a></p>
</li>
<li>
<p><a href="#deletepasswordtask">task_title</a></p>
</li>
<li>
<p><a href="#setupmultiusersharetask">task_title</a></p>
</li>
<li>
<p><a href="#deleteallpasswordstask">task_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, see the <code>smbutil(1)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="umount_smbfs-command"><a class="anchor" href="#umount_smbfs-command"></a><code>umount_smbfs</code> Command</h5>
<div class="paragraph">
<p>With this command, you can remove a named SMB share from a mount point.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#unmountsharetask">task_title</a>, and
the <code>mount_smbfs(8)</code> man page.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="illumos-smb-service-daemon"><a class="anchor" href="#illumos-smb-service-daemon"></a>2.5.2. illumos SMB Service Daemon</h4>
<div class="paragraph">
<p>The <code>smbd</code> daemon supports SMB activities on illumos systems. The <code>smbd</code>
daemon provides the gateway to the various user space components that
support non-file I/O SMB services. Similar to the NFS kernel service,
the SMB kernel module provides SMB file I/O services directly between
the network interface and the virtual file system (VFS) within the
kernel. Whenever a non-file I/O request is received, such as a user
authentication or an MS-RPC named pipe request, it is passed to <code>smbd</code>
for processing in user space. Requests that require interaction with a
domain controller via SMB "named pipes" are passed to the SMB client,
which handles the outbound SMB connection management.</p>
</div>
<div class="paragraph">
<p>The <code>smbd</code> daemon depends on the <code>idmapd</code> daemon. For more information
about the identity mapping service, see Chapter 2,
<a href="#identity-mapping-administration-tasks">Identity Mapping Administration (Tasks)</a>, and the
<code>idmap(8)</code> and <code>idmapd(8)</code> man pages.</p>
</div>
<div class="paragraph">
<p><code>smbd</code> is part of the <code>svc:/network/smb/server:default</code> service.</p>
</div>
<div class="paragraph">
<p>For more information, see the <code>smbd(8)</code> man page.</p>
</div>
</div>
<div class="sect3">
<h4 id="illumos-smb-files"><a class="anchor" href="#illumos-smb-files"></a>2.5.3. illumos SMB Files</h4>
<div class="ulist">
<ul>
<li>
<p><code>/etc/auto_direct</code></p>
</li>
<li>
<p><code>/etc/smbautohome</code></p>
</li>
<li>
<p><code>$HOME/.nsmbrc</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="etcauto_direct-file"><a class="anchor" href="#etcauto_direct-file"></a><code>/etc/auto_direct</code> File</h5>
<div class="paragraph">
<p>Use the <code>/etc/auto_direct</code> file to automatically mount an SMB share
when a user accesses the mount point. To use the automount feature, you
must store a persistent password for authentication to mount the share.
See <a href="#storepasswordtask">task_title</a>.</p>
</div>
<div class="paragraph">
<p>For instructions and examples, see
<a href="#automountsharetask">task_title</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="etcsmbautohome-file"><a class="anchor" href="#etcsmbautohome-file"></a><code>/etc/smbautohome</code> File</h5>
<div class="paragraph">
<p>The <code>/etc/smbautohome</code> file is used to define the automatic sharing
rules to be applied when a user connects to the illumos SMB service. For
more information, see <a href="#autohome-shares">Autohome Shares</a> and the
<code>smbautohome(5)</code> man page.</p>
</div>
</div>
<div class="sect4">
<h5 id="homensmbrc-file"><a class="anchor" href="#homensmbrc-file"></a><code>$HOME/.nsmbrc</code> File</h5>
<div class="paragraph">
<p>You can use the <code>$HOME/.nsmbrc</code> file to override global behavior of the
illumos SMB client. Global values are set in the Service Management
Facility (SMF). The <code>.nsmbrc</code> file is used to customize the behavior of
the illumos SMB client on a per-user basis.</p>
</div>
<div class="paragraph">
<p>By default, settings in the <code>$HOME/.nsmbrc</code> file are used unless they
have security implications, in which case the stronger security setting
is used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#customizeenvtask">task_title</a></p>
</li>
<li>
<p><a href="#customizeglobalenvtask">task_title</a></p>
</li>
<li>
<p><a href="#viewglobalenvtask">task_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, see the <code>nsmbrc(5)</code> man page.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authentication-directory-naming-and-time-services"><a class="anchor" href="#authentication-directory-naming-and-time-services"></a>2.6. Authentication, Directory, Naming, and Time Services</h3>
<div class="paragraph">
<p>This section describes the various services that the illumos SMB service
interoperates with as a client.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Active Directory Service (AD).</strong> AD is a Windows directory service
that is integrated with the Domain Name System (DNS). AD runs only on
domain controllers. In addition to storing and making data available, AD
protects network objects from unauthorized access and replicates objects
across a network so that data is not lost if one domain controller
fails.</p>
</li>
<li>
<p><strong>Domain Name System (DNS).</strong> DNS resolves host names to Internet
Protocol (IP) addresses for the system. This service enables you to
identify a server by either its IP address or its name.</p>
</li>
<li>
<p><strong>Dynamic DNS (DDNS).</strong> DDNS is provided with AD and enables a client to
dynamically update its entries in the DNS database.</p>
</li>
<li>
<p><strong>Lightweight Data Access Protocol (LDAP).</strong> LDAP is a standard,
extensible directory access protocol that enables clients and servers
that use LDAP naming services to communicate with each other.</p>
</li>
<li>
<p><strong>Network Information Service (NIS).</strong> NIS is a naming service that
focuses on making network administration more manageable by providing
centralized control over a variety of network information. NIS stores
information about the network, machine names and addresses, users, and
network services.</p>
</li>
<li>
<p><strong>Network Time Protocol (NTP).</strong> NTP is a protocol that enables a client
to automatically synchronize its system clock with a time server. The
clock is synchronized each time the client is booted and any time it
contacts the time server.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="smb-shares"><a class="anchor" href="#smb-shares"></a>2.7. SMB Shares</h3>
<div class="paragraph">
<p>A shared resource, or share, is a local resource on a server that is
accessible to SMB clients on the network. For the illumos SMB service, a
share is typically a directory. Each share is identified by a name on
the network. An SMB client sees the share as a complete entity on the
SMB server, and does not see the local directory path to the share on
the server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A share and a directory are independent entities. Removing a share does
not affect the underlying directory.</p>
</div>
<div class="paragraph">
<p>Shares are commonly used to provide network access to home directories
on a network file server. Each user is assigned a home directory. A
share is persistent and remains defined regardless of whether users are
connected to the server.</p>
</div>
<div class="paragraph">
<p>The illumos SMB service provides a special kind of share called an
autohome SMB share. An autohome share is a transient share of a user&#8217;s
home directory that is created when a user logs in and removed when the
user logs out.</p>
</div>
<div class="paragraph">
<p>When a user browses the system, only statically defined shares and his
autohome share will be listed.</p>
</div>
<div id="autohome-shares" class="paragraph">
<p>==== Autohome Shares</p>
</div>
<div class="paragraph">
<p>The autohome share feature eliminates the administrative task of
defining and maintaining home directory shares for each user that
accesses the system through the SMB protocol. The system creates
autohome shares when a user logs in, and removes them when the user logs
out. This process reduces the administrative effort needed to maintain
user accounts, and increases the efficiency of service resources.</p>
</div>
<div class="paragraph">
<p>For example, if <code>/home</code> is a home directory that contains subdirectories
for users <code>bob</code> and <code>sally</code>, you can manually define the shares as
follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>bob</code></dt>
<dd>
<p><code>/home/bob</code></p>
</dd>
<dt class="hdlist1"><code>sally</code></dt>
<dd>
<p><code>/home/sally</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>However, defining and maintaining directory shares in this way for each
user is inconvenient. Instead, you can use the autohome feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The illumos SMB client does not support autohome shares.</p>
</div>
<div class="paragraph">
<p>To configure the autohome feature, you need to specify autohome share
rules. For example, if a user&#8217;s home directory is <code>/fort/sally</code>, the
autohome path is <code>/fort</code>. The temporary share is named <code>sally</code>. Note
that the user&#8217;s home directory name must be the same as the user&#8217;s login
name. See <a href="#createspecificautohomeshareruletask">task_title</a>.</p>
</div>
<div class="paragraph">
<p>When a user logs in, the illumos SMB service looks for a subdirectory
that matches the user&#8217;s name based on any rules that have been
specified. If the service finds a match and if that share does not
already exist, the subdirectory is added as a transient share. When the
user logs out, the service removes that transient share.</p>
</div>
<div class="paragraph">
<p>Some Windows clients log a user out after 15 minutes of inactivity,
which results in the autohome share disappearing from the list of
defined shares. This behavior is expected for SMB autohome shares. Even
after an SMB autohome share is removed, the share reappears when the
user attempts to access the system (for example, in an Explorer window).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All autohome shares are removed when the illumos SMB service is
restarted.</p>
</div>
<div id="autohome-entries" class="paragraph">
<p>===== Autohome Entries</p>
</div>
<div class="paragraph">
<p>The illumos SMB service can automatically share home directories when an
SMB client connects. The autohome map file, <code>/etc/smbautohome</code>, uses the
search options and rules to determine whether to share a home directory
when an SMB client connects to the service.</p>
</div>
<div class="paragraph">
<p>For example, the following entries specify the autohome rules for a
particular environment:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>+nsswitch        dn=ads,dn=sun,dn=com,ou=users
jane    /home/?/&amp;    dn=ads,dn=sun,dn=com,ou=users</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>nsswitch</code> autohome entry uses the naming service to match users to
home directories. The second autohome entry specifies that the home
directory for user <code>jane</code> is <code>/home/j/jane</code>.</p>
</div>
<div id="autohome-map-entry-format" class="paragraph">
<p>====== Autohome Map Entry Format</p>
</div>
<div class="paragraph">
<p>A map entry, also referred to as a mapping, uses the following format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>key location [ container ]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;key&gt; is a user name, &lt;location&gt; is the fully qualified
path for the user&#8217;s home directory, and &lt;container&gt; is an
optional AD container.</p>
</div>
<div class="paragraph">
<p>If you intend to publish the share in AD, you <em>must</em> specify an AD
container name, which is specified as a comma-separated list of
attribute name-value pairs. The attributes use the Lightweight Data
Access Protocol (LDAP) distinguished name (DN) or relative distinguished
name (RDN) format.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cn=</code> represents the common name</p>
</li>
<li>
<p><code>ou=</code> represents the organizational unit</p>
</li>
<li>
<p><code>dc=</code> represents the domain component</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The attribute type that is used to describe an object&#8217;s RDN is called a
<em>naming attribute</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cn</code> for the <code>user</code> object class</p>
</li>
<li>
<p><code>ou</code> for the <code>OU</code> (organizational unit) object class</p>
</li>
<li>
<p><code>dc</code> for the <code>domainDns</code> object class</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="autohome-map-key-substitution"><a class="anchor" href="#autohome-map-key-substitution"></a>Autohome Map Key Substitution</h6>
<div class="ulist">
<ul>
<li>
<p>The ampersand character (<code>&amp;</code>) is expanded to the value of the key
field for the entry in which it occurs. In the following example, <code>&amp;</code>
expands to <code>jane</code>:</p>
<div class="literalblock">
<div class="content">
<pre>jane /home/&amp;</pre>
</div>
</div>
</li>
<li>
<p>The question mark character (<code>?</code>) is expanded to the value of the
first character in the key field for the entry in which it occurs. In
the following example, the path is expanded to <code>/home/jj/jane</code>:</p>
<div class="literalblock">
<div class="content">
<pre>jane /home/??/&amp;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="wildcard-rule"><a class="anchor" href="#wildcard-rule"></a>Wildcard Rule</h6>
<div class="paragraph">
<p>When supplied in the key field, the asterisk character (<code>*</code>) is
recognized as the “catch-all” entry. Such an entry matches any key not
previously matched.</p>
</div>
<div class="paragraph">
<p>For example, the following entry would map any user to a home directory
in <code>/home</code> in which the home directory name was the same as the user
name:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>*    /home/&amp;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The wildcard rule is <em>only</em> applied if an appropriate rule is not
matched by another map entry.</p>
</div>
<div id="nsswitch-map" class="paragraph">
<p>====== <code>nsswitch</code> Map</p>
</div>
<div class="paragraph">
<p>The <code>nsswitch</code> map is used to request that the home directory be
obtained from a password database, such as the local, NIS, or LDAP
database. If an AD path is appended, it is used to publish shares.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>+nsswitch</pre>
</div>
</div>
<div class="paragraph">
<p>Like the “catch-all” entry, the <code>nsswitch</code> map is <em>only</em> searched if an
appropriate rule is not matched by another map entry.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The wildcard and <code>nsswitch</code> rules are mutually exclusive. Do not include
an <code>nsswitch</code> rule if a wildcard rule has already been defined.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="local-smb-groups"><a class="anchor" href="#local-smb-groups"></a>2.8. Local SMB Groups</h3>
<div class="paragraph">
<p>Local SMB groups can be created on the system that runs the illumos SMB
service. These SMB groups apply only to users that are connected through
SMB.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Administrators.</strong> Members of this group can fully administer files and
directories on the system.</p>
</li>
<li>
<p><strong>Backup Operators.</strong> Members of this group can bypass file security to
back up and restore files.</p>
</li>
<li>
<p><strong>Power Users.</strong> Members of this group can be assigned ownership of
files and directories on the system, and can back up and restore files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Local groups use privileges to provide a secure mechanism for assigning
task responsibility on a system-wide basis. Each privilege has a
well-defined role assigned by the system administrator to a user or a
group.</p>
</div>
<div class="paragraph">
<p>Unlike access rights (which are assigned as permissions on a per-object
basis through security descriptors), privileges are independent of
objects. Privileges bypass object-based access control lists to allow
the holder of the privilege to perform the role assigned. For example,
members of the Backup Operators group must be able to bypass normal
security checks to back up and restore files they would normally not be
able to access.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <em>access right</em> is explicitly granted or denied to a user or a
group. Access rights are assigned as permissions in a discretionary
access control list (DACL) on a per-object basis.</p>
</li>
<li>
<p>A <em>privilege</em> is a system-wide role that implicitly grants members of
a group the ability to perform predefined operations. Privileges
override or bypass object-level access rights.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can assign any of the privileges to any of the local groups. Because
you can make any domain user a member of the local groups, you can
assign these privileges to any domain user.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Back up files and directories.</strong> Perform backups without requiring
read access permission on the target files and folders.</p>
</li>
<li>
<p><strong>Restore files and directories.</strong> Restore files without requiring write
access permission on the target files and folders.</p>
</li>
<li>
<p><strong>Take ownership of files and folders.</strong> Take ownership of an object
without requiring take-ownership access permission. Ownership can only
be set to those values that the holder of the privilege may legitimately
assign to an object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, members of the local Administrators group can take ownership
of any file or folder, and members of the Backup Operators group can
perform backup and restore operations. Members of the Power Users group
do not have default privileges.</p>
</div>
<div class="paragraph">
<p>For information about managing SMB groups, see
<a href="#managing-smb-groups-task-map">Managing SMB Groups (Task Map)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="identity-mapping-administration-tasks"><a class="anchor" href="#identity-mapping-administration-tasks"></a>3. Identity Mapping Administration (Tasks)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the identity mapping service that maps Windows
security identifiers (SIDs) to Unix user identifiers (UIDs) and group
identifiers (GIDs). The chapter also includes instructions on how to
manage name-based mappings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#identity-mapping-quick-start">Identity Mapping Quick Start</a></p>
</li>
<li>
<p><a href="#mapping-user-and-group-identities">Mapping User and Group Identities</a></p>
</li>
<li>
<p><a href="#creating-your-identity-mapping-strategy">Creating Your Identity Mapping Strategy</a></p>
</li>
<li>
<p><a href="#managing-directory-based-identity-mapping-for-users-and-groups-task-map">Managing Directory-Based Identity
Mapping for Users and Groups (Task Map)</a></p>
</li>
<li>
<p><a href="#managing-rule-based-identity-mapping-for-users-and-groups-task-map">Managing Rule-Based Identity Mapping for
Users and Groups (Task Map)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>idmapd</code> service can run in the global zone or in non-global zones.
However, if the Trusted Extensions software is enabled, the <code>idmapd</code>
service <em>must</em> run in the global zone.</p>
</div>
<div class="paragraph">
<p>Many of the tasks in this section require that you:</p>
</div>
<div class="paragraph">
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</div>
<div class="paragraph">
<p>Roles contain authorizations and privileged commands. For more
information about roles, see Configuring RBAC (Task Map) in System
Administration Guide: Security Services. To configure a role with the
Primary Administrator profile, see Chapter 2, Working With the
Management Console (Tasks), in System Administration Guide: Basic
Administration.</p>
</div>
<div class="sect2">
<h3 id="identity-mapping-quick-start"><a class="anchor" href="#identity-mapping-quick-start"></a>3.1. Identity Mapping Quick Start</h3>
<div class="paragraph">
<p>Note that in the simple case where you have some SMB shares that are not
normally accessed via NFS or local Unix users, you <em>do not need to
configure anything</em> in <code>idmap</code>. The ZFS file system will store
Windows-style Security Identifiers (SIDs) and present them to local Unix
users as ephemeral UID or GID values.</p>
</div>
<div class="paragraph">
<p>If you <em>are</em> planning multi-procol access to some file system (eg. via
both SMB and NFS) then the main purpose of <code>idmap</code> configuration is to
let files created by SMB show "normal" looking UID and GID values when
accessed via NFS. By far the easiest and most popular way to accomplish
that is to use an AD server with "rfc2307bis" schema extensions, and
configure <code>idmap</code> to use <code>directory_based_mapping = idmu</code> as
described in <a href="#creating-your-identity-mapping-strategy">Creating Your Identity
Mapping Strategy</a> below.</p>
</div>
<div class="paragraph">
<p>For more advanced or customized <code>idmap</code> configurations, continue as
described in the remaining sections below.</p>
</div>
</div>
<div class="sect2">
<h3 id="mapping-user-and-group-identities"><a class="anchor" href="#mapping-user-and-group-identities"></a>3.2. Mapping User and Group Identities</h3>
<div class="paragraph">
<p>The illumos SMB service is designed to reside in a multiprotocol
environment and provide an integrated model for sharing data between
Windows and illumos systems. Although files can be accessed
simultaneously from both Windows and illumos systems, no
industry-standard mechanism is used to define a user in both Windows and
illumos environments. Objects can be created in either environment, but
traditionally the access control semantics for each environment are
vastly different. The illumos OS has adopted the Windows model of access
control lists (ACLs) by introducing ACLs in NFSv4 and ZFS, and by
providing the <code>idmapd</code> identity mapping service.</p>
</div>
<div class="paragraph">
<p>The illumos SMB service uses identity mapping to establish an
equivalence relationship between a Unix user or group and a Windows user
or group in which both the Unix and Windows identities are deemed to
have equivalent rights on the system.</p>
</div>
<div class="paragraph">
<p>The illumos SMB service determines the Windows user&#8217;s Unix credentials
by using the <code>idmapd</code> service to map the SIDs in the user&#8217;s Windows
access token to UIDs and GIDs, as appropriate. The service checks the
mappings and if a match for the Windows domain name and Windows entity
name is found, the Unix UID or GID is taken from the matching entry. If
no match is found, an ephemeral UID or GID is dynamically allocated. An
ephemeral ID is a dynamic UID or GID mapping for an SID that is not
already mapped by name. An ephemeral ID does not persist across illumos
system reboots. Ephemeral mappings enable the illumos SMB service to
work in a Windows environment without having to configure any name-based
mappings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name-based mapping.</strong> Maps Windows and Unix users and groups by name
in the following ways:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Directory-based mapping.</strong> If configured, <code>idmapd</code> first tries to use
name mapping information that is stored in user or group objects in the
Active Directory (AD), in the native LDAP directory service, or in both.
For instance, an AD object for a particular Windows user or group can be
augmented to include the corresponding Unix user or group name.
Similarly, the native LDAP object for a particular Unix user or group
can be augmented to include the corresponding Windows user or group
name.</p>
<div class="paragraph">
<p>You can configure <code>idmapd</code> to use AD and/or native LDAP directory-based
name mappings by setting the <code>idmap</code> service properties in SMF. See
Service Properties in the <code>idmap(8)</code> man page.</p>
</div>
<div class="paragraph">
<p>If directory-based name mapping is not configured or if it is configured
but not found, <code>idmapd</code> will process locally stored rule-based mappings.</p>
</div>
</li>
<li>
<p><strong>Rule-based mapping.</strong> An administrator maps Windows and Unix users
and groups by name.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Ephemeral ID mapping.</strong> A UID or GID is dynamically allocated for
every SID that is not mapped by name.</p>
</li>
<li>
<p><strong>Local SID mapping.</strong> A non-ephemeral UID or GID is mapped to an
algorithmically generated local SID if it is not mapped by name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the <code>idmap</code> command to create and manage the rule-based
mappings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bidirectional mapping.</strong> Map the specified Windows name to the
specified Unix name, and map the specified Unix name to the specified
Windows name. By default, rule-based mappings that you create are
bidirectional.</p>
<div class="paragraph">
<p>The following example shows a bidirectional mapping of the Windows user
<code>dana@example.com</code> to <code>danas</code>, the Unix user. Note that
<code>dana@example.com</code> maps to <code>danas</code>, and <code>danas</code> maps to
<code>dana@example.com</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dana@example.com == danas</pre>
</div>
</div>
</li>
<li>
<p><strong>Unidirectional mapping.</strong> Map the names only in the specified
direction.</p>
<div class="paragraph">
<p>The following example combines unidirectional and bidirectional mappings
to map between Windows users <code>dana@example.com</code> and
<code>danasan@example.com</code> and Unix user <code>danas</code>. The bidirectional rule maps
between Windows user <code>dana@example.com</code> and Unix user <code>danas</code>. The
unidirectional rule maps Windows user <code>danasan@example.com</code> to the Unix
user <code>danas</code>. When Unix user <code>danas</code> needs to map to the appropriate
Windows user, it maps to <code>dana@example.com</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dana@example.com == danas
danasan@example.com =&gt; danas</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>On Windows and illumos systems, files have an owner attribute and a
group attribute. A Unix file owner attribute must be a UID, and the
group attribute must be a GID. Unlike the illumos OS, Windows has no
such restrictions. Windows permits either a user SID or a group SID to
be a file owner or a file group. In fact, Windows uses the Administrator
Group as a file owner in many instances, and any Windows application can
set the file owner and group attributes to any SID.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Map a group SID to a UID when the group SID occurs in an owner field</p>
</li>
<li>
<p>Map a user SID to a GID when the user SID occurs in group field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are called diagonal mappings, which use naming rules to set up the
mappings.</p>
</div>
<div class="sect3">
<h4 id="unix-users-and-groups"><a class="anchor" href="#unix-users-and-groups"></a>3.2.1. Unix Users and Groups</h4>
<div class="paragraph">
<p>Unix users and groups can be defined in local files (<code>/etc/passwd</code> and
<code>/etc/group</code>) or in a naming or directory service, such as NIS and LDAP.
The naming services you configure are listed in the illumos naming
services switch file <code>/etc/nsswitch.conf</code>. For more information, see
Chapter 2, The Name Service Switch (Overview), in System Administration
Guide: Naming and Directory Services (DNS, NIS, and LDAP).</p>
</div>
<div class="paragraph">
<p>The illumos SMB service can be configured as a client of the various
distributed naming services, such as NIS and LDAP. For information about
configuring the illumos SMB service as a client for these naming
services, see System Administration Guide: Naming and Directory Services
(DNS, NIS, and LDAP).</p>
</div>
<div class="paragraph">
<p>Each user and group is assigned a 32-bit identifier known, respectively,
as a user ID (UID) and a group ID (GID). The illumos OS has extended the
<code>uid_t</code> and <code>gid_t</code> types from signed to unsigned 32-bit
integers. Now that the <code>uid_t</code> and <code>gid_t</code> types are unsigned,
the upper half of these namespaces is available for ephemeral dynamic ID
mapping. This mapping process enable IDs to be assigned dynamically and
ephemerally on demand. An <em>ephemeral mapping</em> is one that does not
survive an illumos system reboot. Typically, the UID or GID uniquely
identifies a user or group within a single Unix domain. However, these
values are not unique across domains.</p>
</div>
<div class="paragraph">
<p>Traditionally, UID zero and GID zero are assigned to the <code>root</code> user and
group, respectively. The <code>root</code> user is granted almost unlimited access
to system objects in order to perform administration tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="windows-users-and-groups"><a class="anchor" href="#windows-users-and-groups"></a>3.2.2. Windows Users and Groups</h4>
<div class="paragraph">
<p>Windows users and groups are defined in a Security Account Manager (SAM)
database, which is managed on a Windows domain controller. Each user and
group is identified by a security identifier (SID). A SID is a
variable-length structure that uniquely identifies a user or group both
within a host and a local domain, and across all possible Windows
domains.</p>
</div>
<div class="paragraph">
<p>The text form of an SID is represented as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>S-R-I-SA-SA-..-SA</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>S</code> <strong>–</strong> Identifies the string as an SID.</p>
</li>
<li>
<p>&lt;R&gt; <strong>–</strong> Identifies the revision number, which is currently 1.</p>
</li>
<li>
<p>&lt;I&gt; <strong>–</strong> Identifies the 48-bit identifier authority value,
which is the agent or namespace that issued the SID.</p>
</li>
<li>
<p>&lt;SA&gt; <strong>–</strong> Is one or more subauthorities, which are 32-bit
integers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is often convenient to split SIDs into a "domain part" (or "domain
SID" and a "relative ID" (RID). The last aubauthority is referred to as
the RID, and evertying before that is referred to as the "domain SID".</p>
</div>
<div class="paragraph">
<p>For example, the SID <code>S-1-5-32-500</code> has a domain SID of <code>S-1-5-32</code>
containing the version number of <code>1</code>, first identifier authority value
<code>5</code>, and subauthority <code>32</code>. The last subauthority value (<code>500</code>) is the
RID.</p>
</div>
<div class="paragraph">
<p>The <code>idmapd</code> service generates a unique SID for the host on which it
runs. This SID is used to represent both users and groups that cannot be
mapped by name to SIDs. This SID is stored in the equivalent of a local
SAM database. The illumos computer SID is generated randomly.</p>
</div>
<div class="paragraph">
<p>The <code>idmap</code> service generates a unique SID, &lt;machine-SID&gt;, for
the host on which it runs. This SID is used to generate local SIDs as
follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>local SID for user = machine-SID - 1000 + user's-UID
local SID for group = machine-SID - 2^31 + group's-GID</pre>
</div>
</div>
<div class="paragraph">
<p>For instance, the local SID for a user with a UID of <code>182048</code> and a
machine SID of <code>S-1-5-21-726303253-4128413635</code> is
<code>S-1-5-21-726303253-4128413635-183048</code>.</p>
</div>
<div class="paragraph">
<p>Local SIDs are used to represent Unix users or groups that have
non-ephemeral UIDs or GIDs and that cannot be mapped by name.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-your-identity-mapping-strategy"><a class="anchor" href="#creating-your-identity-mapping-strategy"></a>3.3. Creating Your Identity Mapping Strategy</h3>
<div class="paragraph">
<p>Windows SID to Unix UID and GID mapping is required when the illumos SMB
service is deployed to a Windows environment. The identity mapping
enables Windows clients to transparently access SMB shares and remote
services from the illumos SMB service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Using name-based mapping.</strong> If your Windows environment includes a
parallel Unix naming service infrastructure, such as NIS, you might want
to use name-based mappings to associate Windows users with Unix users,
and Windows groups with Unix groups.</p>
<div class="paragraph">
<p>Name-based mappings include directory-based mappings and rule-based
mappings. A directory-based mapping uses name mapping information that
is stored in user or group objects in the Active Directory (AD), in the
native LDAP directory service, or both to map users and groups. A
rule-based mapping uses rules to associate Windows users and groups with
equivalent Unix users and groups by name rather than by identifier.</p>
</div>
<div class="paragraph">
<p>To use name-based mapping, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choose a Windows domain that is the most natural counterpart to the
illumos naming service domain.</p>
</li>
<li>
<p>Determine whether to use directory-based or rule-based mappings.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Directory-based mappings.</strong> Are stored globally and each mapping is
configured individually. However, the setup is rather difficult and
time-consuming. This method is more suitable if many SMB servers are
being used in your environment.</p>
<div class="ulist">
<ul>
<li>
<p>If you have already deployed AD or native LDAP, use that naming
service.</p>
</li>
<li>
<p>If you want one-to-one mappings, choose either AD-only or native
LDAP-only modes as follows:</p>
<div class="ulist">
<ul>
<li>
<p>If you have few native LDAP domains and do most of your
administration in AD, choose AD-only mode</p>
</li>
<li>
<p>Otherwise, choose native LDAP-only mode</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you need more flexibility than one-to-one mappings offer, choose
mixed mode.</p>
<div class="paragraph">
<p>For example, to map Windows entities to one native LDAP user, group, or
both, use mixed mode. Similarly, use mixed mode to map multiple native
LDAP users or groups to one Windows entity.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can employ directory-based mapping <em>and</em> name-based
rules.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Rule-based mappings.</strong> Are easy to configure and can be configured
with a single wildcard rule. However, the mapping rules are only stored
on a particular computer rather than being global. This method is more
suitable if only one SMB server is being used in your environment.</p>
</li>
<li>
<p><strong>Using directory-based mapping.</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Extend the AD schema, the native LDAP schema, or both with new
attributes to represent a UNIX user name, a UNIX group name, or a
Windows name. Also, populate the AD or native LDAP user and group
objects, or both types of objects, with the appropriate attribute and
value. Many organizations have adopted
<a href="https://datatracker.ietf.org/doc/html/rfc2307">RFC 2307</a> or
<a href="https://datatracker.ietf.org/doc/html/draft-howard-rfc2307bis-01">rfc2307bis</a>
schema extensions, which <code>idmap</code> supports.</p>
<div class="paragraph">
<p>See <a href="#modifyaddirbasedmapping">task_title</a> and
<a href="#modifynldapdirbasedmapping">task_title</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not want to modify the schema and suitable attributes already
exist in either AD or native LDAP, use those attributes.
. Use the <code>svccfg</code> command to enable directory-based mapping on the
illumos system. Also, inform the <code>idmap</code> service about the new AD
attributes, the native LDAP attributes, or both types of attributes that
are used by the user and group objects. See
<a href="#configuredirbasedmapping">task_title</a>.</p>
</div>
<div class="paragraph">
<p>+
A simple and popular choice, where AD servers support rfc2307bis, is to
configure <code>idmap</code> for <code>IDMU</code> strategy, as follows:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svccfg -s idmap setprop config/directory_based_mapping = astring: idmu</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Using rule-based mapping.</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a bidirectional rule-based mapping to map all users in the
Windows domain to users of the same name in the Unix domain.</p>
<div class="literalblock">
<div class="content">
<pre># idmap add 'winuser:*@example.com' 'unixuser:*'
# idmap add 'wingroup:*@example.com' 'unixgroup:*'</pre>
</div>
</div>
<div class="paragraph">
<p>The previous commands map not only user names, but group names. For
instance, the first command would map the Windows user called
<code>pat@example.com</code> to the Unix user <code>pat</code>. The second command would map
the Windows group called <code>staff@example.com</code> to the Unix group <code>staff</code>.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can only have one bidirectional rule-based mapping to map all users
in a single Windows domain to all Unix users in the local Unix domain.</p>
</div>
</li>
<li>
<p>Create bidirectional rule-based mappings for users and groups whose
Windows names do not exactly match the Unix names.</p>
<div class="literalblock">
<div class="content">
<pre># idmap add winuser:terry@example.com unixuser:terrym</pre>
</div>
</div>
<div class="paragraph">
<p>The previous command would map a Windows user called <code>terry@example.com</code>
to the Unix user <code>terrym</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rule-based identity mappings can be used to map Windows users and groups
to, for example, the <code>nobody</code> Unix user and group. In some
circumstances, such a mapping can lock a user out of the SMB service.</p>
</div>
<div class="paragraph">
<p>The mapping works on both a per-user and a per-group basis and for
entire Windows domains. Successfully using this type of mapping to lock
out users depends on the rule-based mappings being in sync with the
actual names in the naming service, such as AD. As a result, this type
of mapping might not be a reliable way to lock users out of the SMB
service, and should not be used for that purpose.</p>
</div>
<div class="paragraph">
<p>This scheme <em>could</em> be used to lock out a user if the administrator who
maintains the user and group namespace is the <em>same</em> administrator who
maintains the identity mappings. If not, however, you could get into a
situation where one administrator creates the rule to lock the user out
and another administrator grants a request to change the user name. In
that case, the rule created to lock the user out only applies to his old
user name, not to the new name. Thus, the user is no longer locked out
of the SMB service as intended.</p>
</div>
<div class="paragraph">
<p>To ensure that a user is correctly locked out, lock out the user in the
naming services.</p>
</div>
<div class="paragraph">
<p>For example, creating a bidirectional mapping between the
<code>dana@example.com</code> and <code>nobody</code> users does not prevent user
<code>dana@example.com</code> from bypassing this attempt to deny him access to the
SMB service. He can simply have his user name changed to something else
so that the rule will no longer apply.
* <strong>Using ephemeral ID mapping.</strong> If your Windows environment does not
already include a parallel Unix naming service infrastructure, such as
NIS, you do not need to create rule-based identity mappings. Instead,
the default identity mapping configuration uses ephemeral IDs to map
between Windows SIDs and Unix UIDs and GIDs.</p>
</div>
<div id="managing-directory-based-identity-mapping-for-users-and-groups-task-map" class="paragraph">
<p>=== Managing Directory-Based Identity Mapping for Users and Groups (Task Map)</p>
</div>
<div class="paragraph">
<p>The following table points to the tasks that you can use to manage
directory-based identity mapping for the illumos SMB service in a
Windows environment.</p>
</div>
<div class="paragraph">
<p>These tasks use the <code>idmap(8)</code> command to manage identity mapping.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extend the Active Directory (AD) schema with user and group name
attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This procedure describes how to extend the AD schema and
populate the user and group objects with UNIX user and group name
information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modifyaddirbasedmapping">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extend the native LDAP schema with user and group name attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This procedure describes how to extend the native LDAP schema and
populate the user and group objects with Windows user and group name
information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modifynldapdirbasedmapping">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure directory-based name mapping.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to enable
directory-based mapping. This procedure also informs the <code>idmap</code> service
about the new AD schema attributes that are used by the user and group
objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuredirbasedmapping">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a directory-based name mapping to a user object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure to add a directory-based name mapping to a user object in AD
or native LDAP.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#adddirmappingusertask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a directory-based name mapping to a group object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure to add a directory-based name mapping to a group object in AD
or native LDAP.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#adddirmappinggrouptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a directory-based name mapping from a user object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure to remove a directory-based name mapping from a user object in
AD or native LDAP.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#removedirmappingusertask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a directory-based name mapping from a group object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure to remove a directory-based name mapping from a group object
in AD or native LDAP.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#removedirmappinggrouptask">task_title</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about user and group identities, see
<a href="#mapping-user-and-group-identities">Mapping User and Group Identities</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In a cluster configuration, changes made to user maps and to group maps
on one server are immediately propagated to the other server.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you can enable directory-based mapping on your illumos system,
you must extend the AD schema, the native LDAP schema, or both, and
populate the user and group objects with the associated Unix names. See
<a href="#modifyaddirbasedmapping">task_title</a> and
<a href="#modifynldapdirbasedmapping">task_title</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See appendix <a href="#appendix-a-extending-the-ad-schema">appendix_title</a> for more details.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable directory-based mapping.</p>
<div class="literalblock">
<div class="content">
<pre># svccfg -s svc:/system/idmap setprop config/ds_name_mapping_enabled=boolean: true</pre>
</div>
</div>
</li>
<li>
<p>Inform the <code>idmap</code> service about the new user and group attributes.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To fully enable directory-based mapping, you <em>must</em> specify values for
the following properties depending on the directory service or services
you plan to use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>config/ad_unixuser_attr</code></p>
</li>
<li>
<p><code>config/ad_unixgroup_attr</code></p>
</li>
<li>
<p><code>config/nldap_winname_attr</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These properties do not have default values. If the properties are not
set, directory-based mapping is effectively disabled for the
corresponding naming service.</p>
</div>
<div class="paragraph">
<p>+
In an environment that stores user and group name information in both
Active Directory and native LDAP, perform the steps for each naming
service.</p>
</div>
<div class="paragraph">
<p>+
For Active Directory, inform the <code>idmap</code> service about the new Active
Directory UNIX user and group attributes.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svccfg -s svc:/system/idmap setprop \
config/ad_unixuser_attr=astring: attribute-name
# svccfg -s svc:/system/idmap setprop \
config/ad_unixgroup_attr=astring: attribute-name</pre>
</div>
</div>
<div class="paragraph">
<p>+
&lt;attribute-name&gt; is the attribute name you choose for the UNIX
user or group name to be stored in AD.</p>
</div>
<div class="paragraph">
<p>+
For example, the following specifies the <code>unixGroupName</code> and
<code>unixUserName</code> attribute names for the UNIX group and user names,
respectively:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svccfg -s svc:/system/idmap setprop \
config/ad_unixgroup_attr=astring: unixGroupName
# svccfg -s svc:/system/idmap setprop \
config/ad_unixuser_attr=astring: unixUserName</pre>
</div>
</div>
<div class="paragraph">
<p>+
For native LDAP, inform the <code>idmap</code> service about the new native LDAP
Windows name attribute.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svccfg -s svc:/system/idmap setprop \
config/nldap_winname_attr=astring: attribute-name</pre>
</div>
</div>
<div class="paragraph">
<p>+
&lt;attribute-name&gt; is the attribute name you choose for the
Windows name to be stored in native LDAP.</p>
</div>
<div class="paragraph">
<p>+
For example, the following specifies the <code>winAccountName</code> attribute name
for the Windows name:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svccfg -s svc:/system/idmap setprop \
config/nldap_winname_attr=astring: winAccountName</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Map a Windows user to a Unix user by adding the Unix user name to the
AD object for the specified Windows user.</p>
</li>
<li>
<p>Map a Unix user to a Windows user by adding the Windows user name to
the native LDAP object for the specified Unix user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the <code>idmap set-namemap</code> command and its
options, see the <code>idmap(8)</code> man page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Determine whether to augment a user object in AD or in the native LDAP
service.</p>
<div class="paragraph">
<p>To augment the Windows user object in AD, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap winuser:username@domain-name unixuser:username</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command maps Windows user <code>danab@example.com</code>
to Unix user <code>dana</code> by adding the Unix name to the AD object for
<code>danab@example.com</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap winuser:danab@example.com unixuser:dana</pre>
</div>
</div>
<div class="paragraph">
<p>To augment the Unix user object in native LDAP, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap unixuser:username winuser:username@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command maps Unix user <code>dana</code> to Windows user
<code>danab@example.com</code> by adding the Windows name to the native LDAP object
for <code>dana</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap unixuser:dana winuser:danab@example.com</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Map a Windows group to a Unix group by adding the Unix group name to
the AD object for the specified Windows group.</p>
</li>
<li>
<p>Map a Unix group to a Windows group by adding the Windows group name
to the native LDAP object for the specified Unix group.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Determine whether to augment a group object in AD or in the native
LDAP service.</p>
<div class="paragraph">
<p>To augment the Windows group object in AD, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap wingroup:group-name@domain-name unixgroup:group-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command maps Windows group
<code>salesgrp@example.com</code> to Unix group <code>sales</code> by adding the Unix name to
the AD object for <code>salesgrp@example.com</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap wingroup:salesgrp@example.com unixgroup:sales</pre>
</div>
</div>
<div class="paragraph">
<p>To augment the Unix group object in native LDAP, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap unixgroup:group-name wingroup:group-name@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command maps Unix group <code>sales</code> to Windows
group <code>salesgrp@example.com</code> by adding the Windows name to the native
LDAP object for <code>sales</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap set-namemap unixgroup:sales wingroup:salesgrp@example.com</pre>
</div>
</div>
</li>
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>View the directory-based name mapping information for the specified
user.</p>
<div class="literalblock">
<div class="content">
<pre># idmap get-namemap username</pre>
</div>
</div>
</li>
<li>
<p>Remove the user name stored in the user object of AD or native LDAP.</p>
<div class="paragraph">
<p>Remove the Unix name from the AD object for the specified user.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap winuser:username@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command removes the Unix name from the AD
object for Windows user <code>danab@example.com</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap winuser:danab@example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Remove the Windows name from the native LDAP object for the specified
user.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap unixuser:username</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command removes the Windows name from the
native LDAP object for Unix user <code>dana</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap unixuser:dana</pre>
</div>
</div>
</li>
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>View the directory-based name mapping information for the specified
group.</p>
<div class="literalblock">
<div class="content">
<pre># idmap get-namemap group-name</pre>
</div>
</div>
</li>
<li>
<p>Remove the group name stored in the group object of AD or native LDAP.</p>
<div class="paragraph">
<p>Remove the Unix name from the AD object for the specified group.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap wingroup:group-name@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command removes the Unix name from the AD
object for Windows group <code>salesgrp@example.com</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap wingroup:salesgrp@example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Remove the Windows name from the native LDAP object for the specified
group.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap unixgroup:group-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command removes the Windows name from the
native LDAP object for Unix group <code>sales</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap unset-namemap unixgroup:sales</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="managing-rule-based-identity-mapping-for-users-and-groups-task-map"><a class="anchor" href="#managing-rule-based-identity-mapping-for-users-and-groups-task-map"></a>3.4. Managing Rule-Based Identity Mapping for Users and Groups (Task Map)</h3>
<div class="paragraph">
<p>Windows systems and Unix systems use different identity schemes to
determine who is permitted to access systems and system objects. When
the illumos SMB service is integrated into an existing Windows domain,
the Unix user IDs and group IDs must find equivalent Windows SIDs to use
for authorization and file access. The illumos SMB service uses identity
mapping software to perform these tasks.</p>
</div>
<div class="paragraph">
<p>By default, no rule-based mappings are configured. In this case,
non-ephemeral Unix UIDs and GIDs are mapped to local SIDs. Local SIDs
are composed of the server&#8217;s SID and an RID that is derived
algorithmically from the UID or GID. Similarly, domain user and group
SIDs are mapped to ephemerally, dynamically allocated UIDs and GIDs. A
system administrator can also create a set of rule-based mappings to map
users and groups by name. Such rule-based mapping requires that Windows
uses Active Directory and that the specified users and groups must
already exist.</p>
</div>
<div class="paragraph">
<p>The following table points to the tasks that you can use to manage
rule-based identity mapping for the illumos SMB service in a Windows
environment. These tasks use the <code>idmap(1M)</code> command to manage identity
mapping.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a user mapping rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use rules to create identity equivalents for
Windows users and Unix users based on the names in the naming services.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#addusermaptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a group mapping rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use rules to create identity equivalents for
Windows groups and Unix groups based on the names in the naming
services.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#addgroupmaptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import rule-based user mappings from the <code>usermap.cfg</code> file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure to add one or more user mappings from a <code>usermap.cfg</code> file
that specifies rule-based mappings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#importmappingstask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List all of the mappings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to review all mappings or
to find particular mappings for users and groups.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#listmappingtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the mapping for a particular identity.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to view
how a particular name or ID is mapped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#showmappingtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all the established mappings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to view the
mappings stored in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#dumpmappingtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a user mapping rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to remove a rule-based
mapping when a user is no longer part of the naming service in your
Windows domain.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#removeusermaptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a group mapping rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to remove a rule-based
mapping when a group is no longer part of the naming service in your
Windows domain.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#removegroupmaptask">task_title</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about user and group identities, see
<a href="#mapping-user-and-group-identities">Mapping User and Group Identities</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a cluster configuration, changes made to user maps and to group maps
on one server are immediately propagated to the other server.</p>
</div>
<div class="paragraph">
<p>The <code>idmap</code> command enables you to create rule-based mappings between
Windows users and Unix users. By default, the illumos SMB service uses
ephemeral identity mapping.</p>
</div>
<div class="paragraph">
<p>Shell special characters, such as the double quote character (<code>"</code>), the
asterisk character (<code>*</code>), and the backslash character (<code>\</code>),
must be quoted when used as user names and domain names.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Determine the user names that you want to map.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Determine the domain and name of the Windows user that you want to
map to a Unix user.</p>
<div class="ulist">
<ul>
<li>
<p><code>winuser:</code>&lt;username&gt;<code>@</code>&lt;domain-name&gt;</p>
</li>
<li>
<p><code>winuser:'</code>&lt;domain-name&gt;<code>\</code>&lt;username&gt;<code>'</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Determine the name of the Unix user that you want to map to the
Windows user.</p>
<div class="paragraph">
<p>The Unix user name must be specified by using the format
<code>unixuser:</code>&lt;username&gt;.</p>
</div>
<div class="paragraph">
<p>If &lt;username&gt; is the empty string (<code>""</code>), mapping is inhibited.
Only directional mappings can have an empty string as their target
identity. No mapping is created by the identity mapping service, and the
<code>nobody</code> ID is used for access control. Note that a user name of <code>""</code>
should not be used to preclude logins by unmapped Windows users.</p>
</div>
<div class="paragraph">
<p>If &lt;username&gt; uses the wildcard (<code>*</code>), it matches all user
names that are not matched by other mappings. Similarly, if
&lt;username&gt; is the wildcard Windows name (<code>*@*</code>), it
matches all user names in all domains that are not matched by other
mappings.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create the user mapping.</p>
<div class="paragraph">
<p>By default, identity mappings are bidirectional, which means that the
Windows name is mapped to the Unix name and the Unix name is mapped to
the Windows name. If you want the mapping to be unidirectional, specify
the <code>d</code> option.</p>
</div>
<div class="paragraph">
<p>If &lt;username&gt; uses the wildcard on both sides of the mapping,
the user name is the same for both Windows and Unix users. For example,
if the rule is <code>'*@example.com' == '*'</code>, the <code>jp@example.com</code>
Windows user name would match this rule and map to the <code>jp</code> Unix user
name.</p>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Be careful when creating rule-based mappings that use wildcards for the
user names. Windows user names are case insensitive, while Unix user
names are case sensitive. Note that the case of Windows names that
appear in <code>idmap</code> name rules and in <code>idmap show</code> commands is irrelevant.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Map the canonical Windows name, which uses the found in the directory
entry, to the matching Unix user name.</p>
</li>
<li>
<p>If no such Unix user name exists, fold the case of the canonical
Windows name to lower case and use it as the illumos SMB user name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result of this differing treatment of case, user names that appear
to be alike might not be recognized as matches. You must create rules to
handle such pairings of strings that differ only in case. For example,
to map Unix user <code>Kerry</code> to Windows user <code>kerry@example.com</code>, you must
create the following rule:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add winuser:'*@example.com' unixuser:'*'
# idmap add winuser:kerry@example.com unixuser:Kerry</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a bidirectional mapping between a Windows user name and a Unix
user name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add winuser:username@domain-name unixuser:username</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a unidirectional mapping between a Windows user name and a Unix
user name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add -d winuser:username@domain-name unixuser:username</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a unidirectional mapping between a Unix user name and a Windows
user name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add -d unixuser:username winuser:username@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>idmap</code> command enables you to create rule-based mappings between
Windows groups and Unix groups. By default, the illumos SMB service uses
ephemeral identity mapping.</p>
</div>
<div class="paragraph">
<p>You can also create diagonal mappings to maps between a Windows group
and a Unix user and between a Unix group and a Windows user. These
mappings are needed when Windows uses a group identity as a file owner
or a user identity as a file group.</p>
</div>
<div class="paragraph">
<p>Shell special characters, such as the double quote character (<code>"</code>), the
asterisk character (<code>*</code>), and the backslash character (<code>\</code>),
must be quoted when used as group names and domain names.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Determine the group names that you want to map.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Determine the domain and name of the Windows group that you want to
map to a Unix group.</p>
<div class="ulist">
<ul>
<li>
<p><code>wingroup:</code>&lt;group-name&gt;<code>@</code>&lt;domain-name&gt;</p>
</li>
<li>
<p><code>wingroup:'</code>&lt;domain-name&gt;<code>\</code>&lt;group-name&gt;<code>'</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Determine the name of the Unix user or group that you want to map to
the Windows group.</p>
<div class="paragraph">
<p>The Unix group name must be specified by using the format
<code>unixgroup:</code>&lt;group-name&gt;. The Unix user name must be specified
by using the format <code>unixuser:</code>&lt;username&gt;.</p>
</div>
<div class="paragraph">
<p>If &lt;group-name&gt; is the empty string (<code>""</code>), mapping is
inhibited.</p>
</div>
<div class="paragraph">
<p>If &lt;group-name&gt; uses the wildcard (<code>*</code>), it matches all
group names that are not matched by other mappings. Similarly, if
&lt;group-name&gt; is the wildcard Windows name (<code>*@*</code>), it
matches all group names in all domains that are not matched by other
mappings.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create the group mapping.</p>
<div class="paragraph">
<p>By default, identity mappings are bidirectional, which means that the
Windows group name is mapped to the Unix group name, and the Unix group
name is mapped to the Windows group name. If you want the mapping to be
unidirectional, specify the <code>d</code> option.</p>
</div>
<div class="paragraph">
<p>If &lt;group-name&gt; uses the wildcard on both sides of the mapping,
the group name is the same for both Windows groups and Unix groups. For
example, if the rule is <code>"*@example.com" == "*"</code>, the
<code>staff@example.com</code> Windows group name would match this rule and map to
the <code>staff</code> Unix group name.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be careful when creating rule-based mappings that use wildcards for the
group names. Windows group names are case insensitive, while Unix group
names are case sensitive. Note that the case of Windows names that
appear in <code>idmap</code> name rules and in <code>idmap show</code> commands is irrelevant.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Map the canonical Windows name, which uses the found in the directory
entry, to the matching Unix group name.</p>
</li>
<li>
<p>If no such Unix group name exists, fold the case of the canonical
Windows name to lower case and use it as the illumos SMB group name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result of this differing treatment of case, group names that appear
to be alike might not be recognized as matches. You must create rules to
handle such pairings of strings that differ only in case. For example,
to map Unix group <code>Sales</code> to Windows group <code>sales@example.com</code>, you must
create the following rule:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add wingroup:'*@example.com' unixgroup:'*'
# idmap add wingroup:sales@example.com unixgroup:Sales</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a bidirectional mapping between a Windows group name and a Unix
group name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add wingroup:group-name@domain-name unixgroup:group-name</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a unidirectional mapping between a Windows group name and a Unix
group name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add -d wingroup:group-name@domain-name unixgroup:group-name</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a unidirectional mapping between a Unix group name and a Windows
group name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add -d unixgroup:group-name wingroup:group-name@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a diagonal mapping between a Windows group name and a Unix user
name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add -d wingroup:group-name@domain-name unixuser:username</pre>
</div>
</div>
<div class="paragraph">
<p>+
Create a diagonal mapping between a Unix group name and a Windows user
name.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap add -d unixgroup:group-name winuser:username@domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>idmap import</code> command enables you to import a set of rule-based
user mappings that are stored in a file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The NetApp <code>usermap.cfg</code> rule-mapping format is as follows:</p>
<div class="literalblock">
<div class="content">
<pre>windows-username [direction] unix-username</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;windows-username&gt; is a Windows user name in either the
&lt;domain-name&gt;\&lt;username&gt; or
&lt;username&gt;<code>@</code>&lt;domain-name&gt; format.</p>
</div>
<div class="paragraph">
<p>&lt;unix-username&gt; is a Unix user name.
<strong> <code>==</code> means a bidirectional mapping, which is the default.
</strong> <code>=&gt;</code> or <code>&lt;=</code> means a unidirectional mapping.</p>
</div>
<div class="paragraph">
<p>+
The IP qualifier is not supported.</p>
</div>
</li>
<li>
<p>The Samba <code>smbusers</code> rule-mapping format is as follows:</p>
<div class="literalblock">
<div class="content">
<pre>unixname = winname1 winname2 ...</pre>
</div>
</div>
<div class="paragraph">
<p>The mappings are imported as unidirectional mappings from one or more
Windows names to a Unix name.</p>
</div>
<div class="paragraph">
<p>The format is based on the “username map” entry of the <code>smb.conf</code> man
page, which is available on the <code>samba.org</code> web site. The use of an
asterisk (<code>*</code>) for &lt;winname&gt; is supported. However, the
<code>@group</code> directive and the chaining of mappings are not supported.</p>
</div>
<div class="paragraph">
<p>By default, if no mapping entries are in the <code>smbusers</code> file, Samba maps
a &lt;winname&gt; to the equivalent &lt;unixname&gt;, if any. The
following <code>idmap</code> command shows this mapping:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>idmap add -d winuser:"*@*" unixuser:"*"</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Import the user mappings from standard input or from a file.</p>
<div class="literalblock">
<div class="content">
<pre># idmap import [-F] [-f file] format</pre>
</div>
</div>
<div class="paragraph">
<p>For example, suppose that you have a file called <code>myusermaps</code> that uses
the <code>usermap.cfg</code> format to specify the following user name mappings:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># cat myusermaps
dana@example.com == dana
danab@example.com =&gt; dana</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><code>#</code> <code>cat myusermaps | idmap import usermap.cfg</code></p>
</li>
<li>
<p><code>#</code> <code>idmap import -f myusermaps usermap.cfg</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>idmap list</code> command enables you to view all of the rule-based
identity mappings that you created for users and groups. You can also
find particular mappings for users and groups.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all of the mappings.</p>
<div class="literalblock">
<div class="content">
<pre>$ idmap list
add winuser:terry@example.com unixuser:terrym
add wingroup:members unixgroup:staff</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To optionally list only the user mappings, type:</p>
<div class="literalblock">
<div class="content">
<pre>$ idmap list | grep user
add winuser:terry@example.com unixuser:terrym</pre>
</div>
</div>
</li>
<li>
<p>To optionally list only the group mappings, type:</p>
<div class="literalblock">
<div class="content">
<pre>$ idmap list | grep group
add wingroup:members unixgroup:staff</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>idmap show</code> command enables you to view the particular name or ID
for a name or ID that you specify.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Show the equivalent identity for a particular name or ID.</p>
<div class="literalblock">
<div class="content">
<pre>$ idmap show [-c] [-v] identity [target-type]</pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>idmap show</code> command only shows mappings that have
already been established.</p>
</div>
<div class="paragraph">
<p>For example, to view the SID that is mapped to UID 50000, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ idmap show uid:50000 sid
S-1-5-21-726303253-4128413635-1168184439</pre>
</div>
</div>
<div class="paragraph">
<p>To view the Unix user name for the Windows user name
<code>terry@example.com</code>, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ idmap show terry@example.com</pre>
</div>
</div>
<div class="paragraph">
<p>If you specify the <code>c</code> option, <code>idmap show</code> forces the evaluation of
rule-based mapping configurations or the dynamic allocation of IDs. This
command also shows mapping information when an error occurs to help
diagnose mapping problems.</p>
</div>
<div class="paragraph">
<p>The <code>v</code> option includes additional information about how the identity
mapping was generated, which can help with troubleshooting. The
following example shows that the mapping is ephemeral and was retrieved
from the cache:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap show -v sid:S-1-5-21-2949573101-2750415176-3223191819-884217
sid:S-1-5-21-2949573101-2750415176-3223191819-884217 -&gt; uid:2175201213
Source: Cache
Method: Ephemeral</pre>
</div>
</div>
<div class="paragraph">
<p>For name-based mappings, the <code>idmap show -v</code> command shows either the
mapping rule or the directory distinguished name with the attribute and
value that created the mapping.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>idmap dump</code> command enables you to view all of the SID-to-UID and
SID-to-GID mappings that are stored in the cache.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all of the mappings in the cache.</p>
<div class="paragraph">
<p>By default, the <code>idmap dump</code> command only lists the mappings themselves.
The <code>v</code> option includes additional information about how the identity
mapping was generated, which can help with troubleshooting.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ idmap dump
sid:S-1-5-21-2949573101-2750415176-3223191800-2000    ==     uid:50000
sid:S-1-5-21-2949573101-2750415176-3223191800-2001    ==     uid:50001
sid:S-1-5-21-2949573101-2750415176-3223191800-2006    ==     uid:50010
sid:S-1-5-21-2949573101-2750415176-3223191900-3000    ==     uid:2147491840
sid:S-1-5-21-2949573101-2750415176-3223191900-3001    ==     gid:2147491342
sid:S-1-5-21-2949573101-2750415176-3223191700-4000    =&gt;     uid:60001
sid:S-1-5-21-2949573101-2750415176-3223191700-4001    =&gt;     gid:60001
sid:S-1-5-21-2949573101-2750415176-3223191800-5000    ==     gid:50000
sid:S-1-5-21-2949573101-2750415176-3223191800-5001    ==     gid:50001</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To optionally list only the user mappings, type:</p>
<div class="literalblock">
<div class="content">
<pre>$ idmap dump | grep uid
sid:S-1-5-21-2949573101-2750415176-3223191800-2000    ==     uid:50000
sid:S-1-5-21-2949573101-2750415176-3223191800-2001    ==     uid:50001
sid:S-1-5-21-2949573101-2750415176-3223191800-2006    ==     uid:50010
sid:S-1-5-21-2949573101-2750415176-3223191900-3000    ==     uid:2147491840
sid:S-1-5-21-2949573101-2750415176-3223191700-4000    =&gt;     uid:60001</pre>
</div>
</div>
</li>
<li>
<p>To optionally list only the group mappings, type:</p>
<div class="literalblock">
<div class="content">
<pre>$ idmap dump | grep gid
sid:S-1-5-21-2949573101-2750415176-3223191900-3001    ==     gid:2147491342
sid:S-1-5-21-2949573101-2750415176-3223191700-4001    =&gt;     gid:60001
sid:S-1-5-21-2949573101-2750415176-3223191800-5000    ==     gid:50000
sid:S-1-5-21-2949573101-2750415176-3223191800-5001    ==     gid:50001</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>idmap</code> command enables you to remove a rule-based mapping that you
created.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Find the user mapping that you want to remove.</p>
<div class="literalblock">
<div class="content">
<pre># idmap list</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to find all user mappings that map to the Unix user <code>pat</code>,
type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap list | grep pat</pre>
</div>
</div>
</li>
<li>
<p>Remove one or more user mappings.</p>
<div class="paragraph">
<p>Remove any rule-based mapping that involves the specified user name,
&lt;username&gt;.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap remove username</pre>
</div>
</div>
<div class="paragraph">
<p>Remove rule-based mappings between &lt;username1&gt; and
&lt;username2&gt;.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap remove username1 username2</pre>
</div>
</div>
<div class="paragraph">
<p>Remove all rule-based mappings.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap remove -a</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>idmap</code> command enables you to remove a rule-based mapping that you
created.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.admin.idmap.rules</code> RBAC authorization, or use the “Idmap
Service Management” RBAC profile.</p>
</li>
<li>
<p>Find the group mapping that you want to remove.</p>
<div class="literalblock">
<div class="content">
<pre># idmap list</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to find all unidirectional group mappings that map to the
Unix group <code>staff</code>, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap list | grep staff</pre>
</div>
</div>
</li>
<li>
<p>Remove one or more group mappings.</p>
<div class="paragraph">
<p>Remove any rule-based mapping that involves the specified group name,
&lt;group-name&gt;.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap remove group-name</pre>
</div>
</div>
<div class="paragraph">
<p>Remove rule-based mappings between &lt;group-name1&gt; and
&lt;group-name2&gt;.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap remove group-name1 group-name2</pre>
</div>
</div>
<div class="paragraph">
<p>Remove all rule-based mappings.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># idmap remove -a</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="illumos-smb-service-administration-tasks" class="paragraph">
<p>== illumos SMB Service Administration (Tasks)</p>
</div>
<div class="paragraph">
<p>This chapter provides instructions on how to configure the illumos SMB
service to run as a standalone server (workgroup mode) or in an existing
Windows environment (domain mode). This chapter also describes how to
manage SMB shares to be accessed by SMB clients.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-the-smb-service">Configuring the SMB Service</a></p>
</li>
<li>
<p><a href="#joining-a-domain-or-workgroup-task-map">Joining a Domain or Workgroup (Task
Map)</a></p>
</li>
<li>
<p><a href="#managing-smb-shares-task-map">Managing SMB Shares (Task Map)</a></p>
</li>
<li>
<p><a href="#managing-smb-groups-task-map">Managing SMB Groups (Task Map)</a></p>
</li>
<li>
<p><a href="#disabling-the-samba-service">Disabling the Samba Service</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a high-level overview of the illumos SMB service configuration
process, see <a href="#configuring-the-illumos-smb-service-process-overview">Configuring the illumos SMB Service –
Process Overview</a>.</p>
</div>
<div class="paragraph">
<p>Many of the tasks in this section require that you:</p>
</div>
<div class="paragraph">
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</div>
<div class="paragraph">
<p>Roles contain authorizations and privileged commands. For more
information about roles, see Configuring RBAC (Task Map) in System
Administration Guide: Security Services. To configure a role with the
Primary Administrator profile, see Chapter 2, Working With the
Management Console (Tasks), in System Administration Guide: Basic
Administration.</p>
</div>
<div id="configuring-the-smb-service" class="paragraph">
<p>=== Configuring the SMB Service</p>
</div>
<div class="paragraph">
<p>This section provides information about configuring the illumos SMB
service. Depending on the "operation mode" you plan to use ("domain
mode" or "workgroup mode") there are different configuration
requirements. For information about configuring other applicable
services, see <a href="#configuring-the-illumos-smb-service-process-overview">Configuring the illumos SMB Service
– Process Overview</a>.</p>
</div>
<div class="paragraph">
<p>If the Samba service is running on the illumos system, you must disable
it. Only one SMB service may run in a given zone. See
<a href="#disablesambatask">task_title</a>.</p>
</div>
<div class="paragraph">
<p>Enable the illumos SMB service.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svcadm enable -r smb/server</pre>
</div>
</div>
<div class="paragraph">
<p>This command enables the illumos SMB service and any service on which it
depends, such as the <code>idmap</code> service.</p>
</div>
<div class="paragraph">
<p>Edit the <code>/etc/pam.conf</code> file to support creation of an encrypted
version of local user passwords for SMB.</p>
</div>
<div class="paragraph">
<p>Add the following line after the other "password" lines:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>other  password required   pam_smb_passwd.so.1 nowarn</pre>
</div>
</div>
<div class="paragraph">
<p>See the <code>pam_smb_passwd(7)</code> man page.</p>
</div>
<div class="paragraph">
<p>Set the password for any local users who will connect via SMB.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># passwd username</pre>
</div>
</div>
<div class="paragraph">
<p>The illumos SMB service cannot use the Unix version of the local user&#8217;s
encrypted password for authentication. Therefore, you must generate an
SMB version of the local user&#8217;s password for the SMB service to use.
When the SMB PAM module is installed, the <code>passwd</code> command generates
such an encrypted version of the password.</p>
</div>
<div id="joining-a-domain-or-workgroup-task-map" class="paragraph">
<p>=== Joining a Domain or Workgroup (Task Map)</p>
</div>
<div class="paragraph">
<p>The following table points to the tasks that you can use to configure
the operation mode of the illumos SMB server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the illumos SMB service in domain mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the
<code>smbadm join -u username domain-name</code> command to join the domain.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#how-to-configure-the-illumos-smb-service-in-domain-mode">How to Configure the illumos SMB Service
in Domain Mode</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the illumos SMB service in workgroup mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the
<code>smbadm join -w workgroup-name</code> command to join the workgroup.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#how-to-configure-the-illumos-smb-service-in-workgroup-mode">How to Configure the illumos SMB
Service in Workgroup Mode</a></p></td>
</tr>
</tbody>
</table>
<div id="how-to-configure-the-illumos-smb-service-in-domain-mode" class="paragraph">
<p>==== How to Configure the illumos SMB Service in Domain Mode</p>
</div>
<div class="paragraph">
<p>This section describes how to join a domain. An Active Directory (AD)
environment is required for this task.</p>
</div>
<div class="paragraph">
<p>The Active Directory (AD) service is a Windows namespace that is
integrated with the Domain Name Service (DNS). AD runs only on domain
controllers. In addition to storing and making data available, AD
protects network objects from unauthorized access and replicates objects
across a network so that data is not lost if one domain controller
fails.</p>
</div>
<div class="paragraph">
<p>For the illumos SMB service to integrate seamlessly into a Windows AD
environment, the following must exist on the network:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Windows AD domain controller</p>
</li>
<li>
<p>An optional Active Directory DNS server that permits dynamic updates
to use the dynamic DNS (DDNS) capability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to participate in an AD domain, the system must be configured
to use DNS for host lookup. Ensure that the <code>/etc/nsswitch.conf</code> and
<code>/etc/resolv.conf</code> files are configured correctly for the appropriate AD
domain.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>To successfully complete the join process, ensure that the system
clock on the illumos system is within five minutes of the system clock
of the domain controller (DC).</p>
<div class="paragraph">
<p>You can accomplish this task in one of these ways:</p>
</div>
<div class="paragraph">
<p>Manually adjust the system clock on either the illumos system or the DC
to match the other.</p>
</div>
<div class="paragraph">
<p>Configure both the illumos system and the DC to use the same time source
(NTP server).</p>
</div>
<div class="paragraph">
<p>Synchronize the system clock on the illumos system with the system clock
of the DC by running the following command on the illumos system:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ntpdate DC-hostname</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to synchronize with the DC called
<code>dc.westsales.example.com</code>, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ntpdate dc.westsales.example.com</pre>
</div>
</div>
</li>
<li>
<p>Join the Windows domain.</p>
<div class="literalblock">
<div class="content">
<pre># smbadm join -u username domain-name</pre>
</div>
</div>
<div class="paragraph">
<p>where &lt;username&gt; is an AD user with sufficient rights to create
and/or update the machine account. The &lt;domain-name&gt; is a fully
qualified domain name of the AD domain in which this server will become
a member.</p>
</div>
</li>
</ol>
</div>
<div id="configuredomainmodeexample" class="paragraph">
<p>Configuring the illumos SMB Service in Domain Mode</p>
</div>
<div class="paragraph">
<p>This example shows the steps taken to configure the illumos SMB service
in domain mode. User <code>dana</code> has Domain Administrator privileges. The
name of the domain being joined is <code>westsales.example.com</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svcadm enable -r smb/server
# smbadm join -u dana westsales.example.com
Enter domain password:
Joining 'westsales.example.com' ... this may take a minute ...
Successfully joined domain 'westsales.example.com'</pre>
</div>
</div>
<div class="paragraph">
<p>After successfully joining an AD domain, you can enable the illumos SMB
service to publish SMB shares in the AD directory. To do so, create or
update SMB shares and specify the share container for each share that
you want to publish. To create SMB shares, see
<a href="#createstaticsmbsharezfstask">task_title</a> and
<a href="#createstaticsmbsharetask">task_title</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that many old copies of this document that can be found via web
searches, and most of those instruct you to edit the <code>krb5.conf</code> file as
part of joining a domain. The illumos SMB server no longer needs that
customization after <a href="http://illumos.org/issues/6352">illumos issue 6352</a>
was resolved in late 2015.</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="how-to-configure-the-illumos-smb-service-in-workgroup-mode"><a class="anchor" href="#how-to-configure-the-illumos-smb-service-in-workgroup-mode"></a>3.4.1. How to Configure the illumos SMB Service in Workgroup Mode</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>(Optional) Change the illumos SMB service to operate in a different
workgroup.</p>
<div class="paragraph">
<p>By default, the illumos SMB service operates in a workgroup called
<code>WORKGROUP</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm join -w workgroup-name</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="configureworkgroupmodeexample" class="paragraph">
<p>Configuring the illumos SMB Service in Workgroup Mode</p>
</div>
<div class="paragraph">
<p>This example shows how to configure the illumos SMB service in workgroup
mode. The name of the workgroup being joined is <code>myworkgroup</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svcadm enable -r smb/server
# smbadm join -w myworkgroup</pre>
</div>
</div>
<div class="paragraph">
<p>Then, use the <code>sharesmb</code> property to configure SMB sharing for an
existing ZFS dataset called <code>ztank/myfs</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs set sharesmb=on ztank/myfs</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, generate the SMB password for user <code>cal</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># passwd cal</pre>
</div>
</div>
<div class="paragraph">
<p>Now, you are ready to have SMB clients access the SMB shares on your
illumos SMB service.</p>
</div>
<div class="paragraph">
<p>After you join a workgroup, you can access SMB shares. To create SMB
shares, see <a href="#createstaticsmbsharezfstask">task_title</a> and
<a href="#createstaticsmbsharetask">task_title</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="managing-smb-shares-task-map"><a class="anchor" href="#managing-smb-shares-task-map"></a>3.5. Managing SMB Shares (Task Map)</h3>
<div class="paragraph">
<p>You can add, view, and update SMB shares. A directory must exist before
it can be shared. For more information about SMB shares, see
<a href="#smb-shares">SMB Shares</a>.</p>
</div>
<div class="paragraph">
<p>The following table points to the tasks that you can use to manage SMB
shares.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure cross-protocol locking.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the <code>mount</code> or the <code>zfs create</code>
command to configure cross-protocol locking. These commands enable this
locking by setting the <code>nbmand</code> option.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configurecrossprotocollockingtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an SMB share by using the ZFS <code>sharesmb</code> property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure if you want to make a file or directory available to clients.
You might use this procedure if you are familiar with the ZFS <code>sharenfs</code>
property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#createstaticsmbsharezfstask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an SMB share by using the <code>sharemgr</code> command.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this
procedure if you want to make a file or directory available to clients.
If you specify an AD container, <code>sharemgr</code> will attempt to publish those
shares in AD.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#createstaticsmbsharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modify the properties of an SMB share by using the <code>sharemgr</code> command.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure to change share property values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modifysmbsharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove an SMB share by using the <code>sharemgr</code> command.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When you remove a
share, it can no longer be accessed by a system. If you are connected to
the share when it is removed, the share is not removed until there are
no more connections to that share. At that time, the share is removed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#removesmbsharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an autohome share rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify custom share rules for autohome
shares.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#createspecificautohomeshareruletask">task_title</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The SMB protocol assumes mandatory locking, but UNIX traditionally uses
advisory locking. The illumos OS can be configured to use mandatory
locking on a per mount basis by using the non-blocking mandatory locking
(<code>nbmand</code>) mount option.</p>
</div>
<div class="paragraph">
<p>When set, the <code>nbmand</code> mount option enforces mandatory cross-protocol
share reservations and byte-range locking.</p>
</div>
<div class="paragraph">
<p>When the <code>nbmand</code> mount option is not set, the illumos SMB service will
enforce mandatory share reservations and byte-range locking internally
for all SMB clients. However, without <code>nbmand</code> set, there is only
limited coordination with NFS and local processes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser or assume an equivalent role.</p>
</li>
<li>
<p>Set the <code>nbmand</code> mount option for an existing file system by doing one
of the following:</p>
<div class="paragraph">
<p>Set the option by using the <code>mount</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mount -o nbmand=on fsname</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command sets the <code>nbmand</code> mount option for
the <code>ztank/myfs</code> file system:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mount -o nbmand ztank/myfs</pre>
</div>
</div>
<div class="paragraph">
<p>Set the option by using the <code>zfs create</code> command.</p>
</div>
<div class="paragraph">
<p>When using ZFS, you can also set the <code>nbmand</code> option when the file
system is created, so that the file system uses <code>nbmand</code> automatically:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs create -o nbmand=on fsname</pre>
</div>
</div>
<div class="paragraph">
<p>The following example combines the <code>nbmand</code> option with the mixed-case
sensitivity option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs create -o casesensitivity=mixed -o nbmand=on -o mountpoint=mntpt ztank/myfs</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure describes how to use the ZFS <code>sharesmb</code> property to
create shares on the illumos SMB service.</p>
</div>
<div class="paragraph">
<p>To create an autohome share, you must have defined autohome rules. For
more information, see
<a href="#createspecificautohomeshareruletask">task_title</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Create a ZFS pool and a mixed-case ZFS file system that supports
cross-protocol locking.</p>
<div class="literalblock">
<div class="content">
<pre># zpool create pool-name vdev
# zfs create -o casesensitivity=mixed -o nbmand=on fsname</pre>
</div>
</div>
</li>
<li>
<p>Enable SMB sharing for the ZFS file system.</p>
<div class="literalblock">
<div class="content">
<pre># zfs set sharesmb=on fsname</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The resource name for the share is automatically constructed by the
<code>zfs</code> command when the share is created. The resource name is based on
the dataset name, unless you specify a resource name. Any characters
that are illegal for resource names are replaced by an underscore
character (<code>_</code>).</p>
</div>
<div class="paragraph">
<p>+
To specify a resource name for the share, specify a name for the
<code>sharesmb</code> property, <code>sharesmb=name=</code>&lt;resource-name&gt;.
. Verify how the file system is shared.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr show -vp</pre>
</div>
</div>
<div id="zfssharesmbexample" class="paragraph">
<p>Using <code>sharesmb</code> to Manage SMB Shares</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Inherited SMB sharing for ZFS file systems in a pool.</strong> The following
commands create a pool and enable SMB sharing for that pool. When you
create the ZFS file systems in that pool, the file systems inherit the
SMB sharing as well as the resource name.</p>
<div class="literalblock">
<div class="content">
<pre># zpool create sandbox c0t3d0
# zfs set sharesmb=on sandbox
# zfs create -o casesensitivity=mixed -o nbmand=on sandbox/fs1
# zfs create -o casesensitivity=mixed -o nbmand=on sandbox/fs2</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>sharemgr show -vp</code> command shows how the top level file system has
a resource name of <code>sandbox</code>, but the children have the dataset name
added to the resource name.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr show -vp
default nfs=()
mygroup smb=()
zfs nfs=() smb=()
     zfs/sandbox smb=()
           sandbox=/sandbox
           sandbox_fs1=/sandbox/fs1       smb=()
           sandbox_fs2=/sandbox/fs2       smb=()</pre>
</div>
</div>
</li>
<li>
<p><strong>SMB sharing for a ZFS file system.</strong> The following commands create a
ZFS pool and a mixed-case file system that supports cross-protocol
locking:</p>
<div class="literalblock">
<div class="content">
<pre># zpool create sandbox c0t3d0
# zfs create -o casesensitivity=mixed -o nbmand=on sandbox/fs1</pre>
</div>
</div>
<div class="paragraph">
<p>Next, you can enable SMB sharing for the <code>sandbox/fs1</code> file system and
for any of its children by setting the <code>sharesmb</code> property to <code>on</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs set sharesmb=on sandbox/fs1</pre>
</div>
</div>
<div class="paragraph">
<p>Because SMB shares must have a resource name, ZFS constructs a resource
name from the dataset name. Any characters in the dataset name that are
illegal in resource names are replaced by the underscore character
(<code>_</code>). In this example, the resource name <code>sandbox_fs1</code> is based
on the dataset name <code>sandbox/fs1</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>sharemgr show -vp</code> command to verify how the file
system is shared.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr show -vp
default nfs=()
mygroup smb=()
zfs nfs=() smb=()
     zfs/sandbox/fs1 smb=()
           sandbox_fs1=/sandbox/fs1</pre>
</div>
</div>
<div class="paragraph">
<p>The following commands create another file system in the <code>sandbox</code> pool
called <code>fs2</code> and associate that file system with the <code>myshare</code> resource
name:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs create -o casesensitivity=mixed -o nbmand=on sandbox/fs2
# zfs set sharesmb=name=myshare sandbox/fs2</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>sharemgr show -vp</code> command to verify how the file systems are
shared.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr show -vp
default nfs=()
mygroup smb=()
zfs nfs=() smb=()
     zfs/sandbox/fs1 smb=()
           sandbox_fs1=/sandbox/fs1
     zfs/sandbox/fs2 smb=()
           myshare=/sandbox/fs2</pre>
</div>
</div>
<div class="paragraph">
<p>The following command creates a sub file system of <code>sandbox/fs2</code> called
<code>sandbox/fs2/fs2_sub1</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs create -o casesensitivity=mixed -o nbmand=on sandbox/fs2/fs2_sub1</pre>
</div>
</div>
<div class="paragraph">
<p>This new file system inherits part of its resource name from its parent
and also inherits sharing over SMB, if enabled. Because the resource
name for <code>sandbox/fs2</code> is <code>myshare</code>, the resource name for
<code>sandbox/fs2/fs2_sub1</code> is <code>myshare_fs2_sub1</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr show -vp
default nfs=()
mygroup smb=()
zfs nfs=() smb=()
     zfs/sandbox/fs1 smb=()
           sandbox_fs1=/sandbox/fs1
     zfs/sandbox/fs2 smb=()
           myshare=/sandbox/fs2
           myshare_fs2_sub1=/sandbox/fs2/fs2_sub1</pre>
</div>
</div>
<div class="paragraph">
<p>If you disable SMB sharing for <code>sandbox/fs2</code>, that file system and its
children are affected.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs set sharesmb=off sandbox/fs2
# sharemgr show -vp
default nfs=()
mygroup smb=()
zfs nfs=() smb=()
     zfs/sandbox/fs1 smb=()
           sandbox_fs1=/sandbox/fs1</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>sharemgr show -vp</code> output shows that the <code>sandbox/fs2</code> file system
and its children are no longer shared over SMB.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure describes how to create a share definition on the illumos
SMB service and make the share available to clients.</p>
</div>
<div class="paragraph">
<p>To create an autohome share, you must have defined autohome rules. For
more information, see
<a href="#createspecificautohomeshareruletask">task_title</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Define a share in the default share group or in another share group.</p>
<div class="paragraph">
<p>A share name can include any alphanumeric characters, but not the
characters listed here:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>" / \ [ ] : | + ; , ? * =</pre>
</div>
</div>
<div class="paragraph">
<p>Create a share group and add a share to that group.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr create -P smb group-name
# sharemgr add-share -r resource-name -s share-path group-name</pre>
</div>
</div>
</li>
<li>
<p>If AD is enabled, specify the AD container where the share will be
published.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The container must already exist for the share to be published in that
container. The system does not create container objects in the AD tree.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr set [-hnv] -P smb [-S option-set] [-p property=value … \
[-s share-path] group-name</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use this procedure to change properties on a share.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Modify the SMB share properties.</p>
<div class="paragraph">
<p>Modify properties for a single share.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr set-share [-r resource-name] [-d "description"] -s share-path group-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command changes the description for the
<code>/files/acme.sales.logs</code> share in the <code>nw-sales</code> group:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr set-share -d "Sales logs for Acme" -s /files/acme.sales.logs nw-sales</pre>
</div>
</div>
<div class="paragraph">
<p>Modify properties for a share group.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr set [-hnv] -P smb [-S option-set] [-p property=value] … \
[-s share-path] group-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, in domain mode you can configure shares to be published in
an AD container. The following command specifies that shares in the
<code>nw-sales</code> share group will be published in the default container. Note
that <code>filesvr</code> is the machine account of the system that is running the
illumos SMB service.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr set -P smb -p ad-container=cn=filesvr,cn=Computers nw-sales</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to publish shares to a non-default container, you must
modify the ACLs of that container to give the illumos SMB service
permission to publish and unpublish shares.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure describes how to remove an SMB share. When you remove an
SMB share, the definition of the share is removed from the server. You
can re-create such a share with the <code>sharemgr add-share</code> command.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Remove an SMB share.</p>
<div class="literalblock">
<div class="content">
<pre># sharemgr remove-share -s share-path group-name</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to remove share <code>/sales/share1</code> from share group
<code>mysharegroup</code>, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharemgr remove-share -s /sales/share1 mysharegroup</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The autohome share feature eliminates the administrative task of
defining and maintaining home directory shares for each user that
accesses the system through the SMB protocol. The system creates
autohome shares when a user logs in, and removes them when the user logs
out. This procedure describes how to configure autohome shares by adding
rules to a configuration file.</p>
</div>
<div class="paragraph">
<p>For information about the <code>smbautohome</code> format, see
<a href="#autohome-entries">Autohome Entries</a> and the <code>smbautohome(5)</code> man
page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Edit the <code>/etc/smbautohome</code> file.</p>
<div class="paragraph">
<p>An autohome entry must be on a single line in the following format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>key   location [container]</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify the user name in the key field.</p>
<div class="ulist">
<ul>
<li>
<p><code>&#43;nsswitch</code> <strong>–</strong> Uses the naming service to match users to home
directories if no rule matches.</p>
</li>
<li>
<p><strong>Asterisk (*) –</strong> Matches a user name to a home directory that uses
the same name.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Specify the location of the user&#8217;s home directory in the location
field.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Question mark (?) –</strong> Substitutes for the first character of the user
name.</p>
</li>
<li>
<p><strong>Ampersand (&amp;) –</strong> Substitutes for a complete user name.</p>
<div class="paragraph">
<p>For example, the following rule maps to <code>/home/a/amy</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>amy             /home/?/&amp;</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the path, see <a href="#autohome-shares">Autohome
Shares</a>.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="managing-smb-groups-task-map"><a class="anchor" href="#managing-smb-groups-task-map"></a>3.6. Managing SMB Groups (Task Map)</h3>
<div class="paragraph">
<p>This section describes how to manage SMB groups and privileges for the
illumos SMB service.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SMB groups apply only to users that are connected through SMB.</p>
</div>
<div class="paragraph">
<p>For information about SMB groups and local users, see
<a href="#local-smb-groups">Local SMB Groups</a>.</p>
</div>
<div class="paragraph">
<p>The following table points to the tasks that you can use to manage SMB
groups through the illumos SMB service.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an SMB group.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an SMB group to manage users.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#createsmbgrouptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a member to an SMB group.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a member to an SMB group by using
the <code>smbadm</code> command.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#addmembertosmbgrouptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a member from an SMB group.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a member from an SMB group
by using the <code>smbadm</code> command.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#removememberfromsmbgrouptask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modify SMB group properties.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>backup</code>. Permit group members to back up file system objects.</p>
</li>
<li>
<p><code>restore</code>. Permit group members to restore file system objects.</p>
</li>
<li>
<p><code>take-ownership</code>. Permit group members to take ownership of file
system objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify a description of the SMB group if you modify the value
of the <code>description</code> property.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modifysmbgroupprivstask">task_title</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You use the <code>smbadm(8)</code> command to manage SMB groups on the system that
runs the illumos SMB service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Choose the name of the group to create.</p>
<div class="paragraph">
<p>You might choose a name that reflects a common set of tasks that the
group can perform or the organization to which the group members belong.</p>
</div>
</li>
<li>
<p>Create the SMB group.</p>
<div class="literalblock">
<div class="content">
<pre># smbadm create [-d description] group-name</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>d</code> option is used to specify a textual description of the SMB
group.</p>
</div>
<div class="paragraph">
<p>For example, to create a group called <code>wsales</code>, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm create -d "Sales Force for the Western Region" wsales</pre>
</div>
</div>
<div class="paragraph">
<p>In order to provide proper identity mapping between SMB groups and Unix
groups, an SMB group must have a corresponding Unix group. This
requirement has two consequences. First, the group name must conform to
the intersection of the Windows and Unix group name rules. Thus, an SMB
group name can be up to eight (8) characters long and contain only
lowercase characters and numbers. Second, a Unix group has to be created
before an SMB group can be created. The Unix group is created by using
the <code>groupadd</code> command. See the <code>groupadd(8)</code> man page.</p>
</div>
</li>
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Add a user to the SMB group.</p>
<div class="literalblock">
<div class="content">
<pre># smbadm add-member -m member-name [[-m member-name] …] group-name</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;member-name&gt; can be specified as
[&lt;domain-name&gt;<code>\\</code>]&lt;username&gt; or
[&lt;domain-name&gt;<code>/</code>]&lt;username&gt;. The domain name is the
domain in which the user can be authenticated. By default, the domain
name is the name of the domain that you joined.</p>
</div>
<div class="paragraph">
<p>You must escape the backslash character (<code>\</code>) because it is a
special character in the most shell programs.</p>
</div>
<div class="paragraph">
<p>For example, to add user <code>terry</code> of the <code>sales</code> domain to the <code>wsales</code>
group, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm add-member -m sales\\terry wsales</pre>
</div>
</div>
<div class="paragraph">
<p>To add a local user to an SMB group, specify the illumos host name
rather than the domain name. For example, to add local user <code>terry</code> of
the <code>solarsystem</code> host to the <code>wsales</code> group, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm add-member -m solarsystem\\terry wsales</pre>
</div>
</div>
</li>
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Remove a user from the SMB group.</p>
<div class="literalblock">
<div class="content">
<pre># smbadm remove-member -m member-name [[-m member-name] …] group-name</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;member-name&gt; can be specified as
[&lt;domain-name&gt;<code>\\</code>]&lt;username&gt; or
[&lt;domain-name&gt;<code>/</code>]&lt;username&gt;. The domain name is the
domain in which the user can be authenticated. By default, the domain
name is the name of the domain that you joined.</p>
</div>
<div class="paragraph">
<p>For example, to remove user <code>terry</code> of the <code>sales</code> domain from the
<code>wsales</code> group, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm remove-member -m sales\\terry wsales</pre>
</div>
</div>
<div class="paragraph">
<p>To remove a local user from an SMB group, specify the illumos host name
rather than the domain name. For example, to remove local user <code>terry</code>
of the <code>solarsystem</code> host from the <code>wsales</code> group, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm remove-member -m solarsystem\\terry wsales</pre>
</div>
</div>
</li>
<li>
<p>Become superuser, assume an equivalent role, obtain the
<code>solaris.smf.value.smb</code> and <code>solaris.smf.manage.smb</code> RBAC
authorizations, or use the “SMB Management” RBAC profile, which is part
of the “File System Management” profile.</p>
</li>
<li>
<p>Modify one or more SMB group properties.</p>
<div class="literalblock">
<div class="content">
<pre># smbadm set -p property=value [[-p property=value] …] group-name</pre>
</div>
</div>
<div class="paragraph">
<p>You can specify one or more property-value pairs on the command line.
Each property-value pair must be preceded by the <code>p</code> option. Valid
values for privileges are <code>on</code> or <code>off</code>. The value of the <code>description</code>
property is an arbitrary text string.</p>
</div>
<div class="paragraph">
<p>For example, to grant the <code>backup</code> privilege and to modify the
description of the <code>wsales</code> group, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm set -p backup=on \
-p description="Sales force for the Western region" wsales</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="disabling-the-samba-service" class="paragraph">
<p>=== Disabling the Samba Service</p>
</div>
<div class="paragraph">
<p>The Samba and SMB services cannot be used simultaneously on a single
illumos system. If you want to run the illumos SMB service, you must
first ensure that any running Samba service is disabled.</p>
</div>
<div class="paragraph">
<p>If your illumos system is running the Samba service, disable it before
starting the illumos SMB service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser or assume an equivalent role.</p>
</li>
<li>
<p>Verify that the Samba service is running.</p>
<div class="literalblock">
<div class="content">
<pre># svcs | grep samba</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command shows that the Samba service is
running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># svcs | grep samba
legacy_run     Aug_03   lrc:/etc/rc3_d/S90samba</pre>
</div>
</div>
</li>
<li>
<p>Disable the Samba service.</p>
<div class="literalblock">
<div class="content">
<pre># svcadm disable svc:/network/samba
# svcadm disable svc:/network/wins</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="illumos-smb-client-administration-tasks" class="paragraph">
<p>== illumos SMB Client Administration (Tasks)</p>
</div>
<div class="paragraph">
<p>This chapter provides instructions on how to use the illumos SMB client
to access SMB shares from an SMB server in a Windows environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#managing-smb-mounts-in-your-local-environment-task-map">Managing SMB Mounts in Your Local
Environment (Task Map)</a></p>
</li>
<li>
<p><a href="#managing-smb-mounts-in-the-global-environment-task-map">Managing SMB Mounts in the Global
Environment (Task Map)</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SMB protocol allows SMB clients to access files and resources on SMB
servers.</p>
</div>
<div class="paragraph">
<p>Many of the tasks in this section require that you:</p>
</div>
<div class="paragraph">
<p>Become superuser, assume an equivalent role, or use the “SMBFS
Management” RBAC profile, which is part of the “File System Management”
profile.</p>
</div>
<div class="paragraph">
<p>Roles contain authorizations and privileged commands. For more
information about roles, see Configuring RBAC (Task Map) in System
Administration Guide: Security Services. To configure a role with the
Primary Administrator profile, see Chapter 2, Working With the
Management Console (Tasks), in System Administration Guide: Basic
Administration.</p>
</div>
</div>
<div class="sect2">
<h3 id="managing-smb-mounts-in-your-local-environment-task-map"><a class="anchor" href="#managing-smb-mounts-in-your-local-environment-task-map"></a>3.7. Managing SMB Mounts in Your Local Environment (Task Map)</h3>
<div class="paragraph">
<p>The following table points to the tasks that a regular user can perform
to manage SMB mounts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find the shares that are available on an SMB server in your domain.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">From a particular SMB server, view the shares that you can mount on a
directory that you own.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#findsharestask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount an SMB share on a directory that you own.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the <code>mount</code>
command to mount the share on a mount point that you own.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#mountsharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the list of SMB shares that are mounted on the system.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the
list of mounted SMB shares.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#viewmountedsharestask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unmount an SMB share from a directory that you own.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When you no longer
need access to an SMB share, you can unmount it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#unmountsharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store a persistent password to be used for authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When you
store a persistent password, you can bypass the manual authentication
required each time that you want to mount a share from the specified
server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#storepasswordtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a PAM module to store a persistent password to be used for
authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this optional functionality only in environments
that do not run Active Directory or Kerberos, but which synchronize
passwords between illumos clients and their SMB servers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pammoduletask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete a persistent password.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you no longer want to store a
persistent password, delete it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#deletepasswordtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customize your environment by using a <code>$HOME/.nsmbrc</code> file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can
customize your illumos SMB environment by specifying values for illumos
SMB client properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#customizeenvtask">task_title</a></p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine the server that you want to query about available shares.</p>
<div class="paragraph">
<p>If you are not familiar with the SMB file servers available in your
domain, contact your system administrator. You might be able to use
Network Neighborhood on Windows systems or the Sun Java Desktop System
file browser to browse for available SMB shares.</p>
</div>
</li>
<li>
<p>List the available SMB shares on a server.</p>
<div class="literalblock">
<div class="content">
<pre>$ smbutil view [-A | -U user] //[domain;][user[:password]@]server</pre>
</div>
</div>
<div class="paragraph">
<p><code>//</code>[&lt;domain&gt;<code>;</code>][&lt;user&gt;[<code>:</code>&lt;password&gt;]<code>@</code>]&lt;server&gt;
is a resource name. &lt;user&gt; is the user name with which you
connect to the SMB server, &lt;server&gt;. You can optionally specify
the domain name and the password of the user that you specified on the
command line.</p>
</div>
<div class="paragraph">
<p>The <code>A</code> option enables you to view shares anonymously, and you are not
prompted for a password. The <code>U</code> &lt;user&gt; option indicates the
user with which to authenticate on the specified server.</p>
</div>
</li>
<li>
<p>When prompted, enter the password for the user that you specified on
the SMB server.</p>
<div class="paragraph">
<p>If you specified the <code>A</code> option to view shares anonymously, you are not
prompted for a password.</p>
</div>
<div class="paragraph">
<p>If you did not specify a user, enter the password associated with your
user name.</p>
</div>
</li>
<li>
<p>View the list of available SMB shares.</p>
<div class="paragraph">
<p>The <code>smbutil view</code> output shows the name of the share, its type, and an
optional text description of the share.
* <code>IPC</code> <strong>–</strong> Represents an interprocess communication (IPC) device, such
as a pipe or a mailslot
* <code>printer</code> <strong>–</strong> Represents a printer queue
* <code>device</code> <strong>–</strong> Represents a communications device</p>
</div>
<div class="paragraph">
<p>+
For example, the following command shows how to view the shares on the
<code>solarsystem</code> server:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil view //cal@solarsystem
Password:
Share        Type       Comment
-------------------------------
netlogon     disk       Network Logon Service
ipc$         IPC        IPC Service (Samba Server)
tmp          disk       Temporary file space
public       disk       Public Stuff
ethereal     disk
root         disk       Home Directories

6 shares listed from 6 available</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The illumos SMB client does not support <code>device</code> shares.</p>
</div>
<div class="paragraph">
<p>+
The following command enables you to anonymously view the shares on the
<code>solarsystem</code> server:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil view -A //solarsystem</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you own the directory on which you want to mount a share, you can
perform the mount operation yourself. If you do not own the directory,
you must perform the mount operation as the owner of the directory or as
superuser.</p>
</div>
</li>
<li>
<p>Find the share that you want to mount from a server.</p>
<div class="literalblock">
<div class="content">
<pre>$ smbutil view //server</pre>
</div>
</div>
</li>
<li>
<p>Enter your password at the prompt.</p>
</li>
<li>
<p>Perform the mount on your directory.</p>
<div class="literalblock">
<div class="content">
<pre>$ mount -F smbfs //[workgroup;][user[:password]@]server/share mount-point</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to mount the <code>/tmp</code> share from the <code>solarsystem</code> server on
the <code>/mnt</code> mount point, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mount -F smbfs //solarsystem/tmp /mnt</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure shows how to list all of the SMB shares that are mounted
on your system. The resulting list includes your mounts, other users'
mounts, and multiuser mounts created by the system administrator.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all SMB mounts.</p>
<div class="paragraph">
<p>Use one of the following commands to list the mounted SMB shares:</p>
</div>
<div class="paragraph">
<p>Use the <code>mount</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mount -v | grep 'type smbfs'
//root@solarsystem/tmp on /mnt type smbfs read/write/setuid/devices/dev=5080000
  on Tue Feb 12 11:40:18 2008
//root@solarsystem/files on /files type smbfs read/write/setuid/devices/dev=4800000
  on Mon Feb 11 22:17:56 2008</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>df -k -F smbfs</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ df -k -F smbfs
//root@solarsystem/tmp      1871312   70864 1800448     4%    /mnt
//root@solarsystem/files    8067749    8017 7979055     1%    /files</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To successfully unmount a share, you must own the mount point on which
the share is mounted.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine the mount point of the share that you want to unmount.</p>
<div class="paragraph">
<p>Use one of the following commands to find shares that are mounted from
an SMB server:</p>
</div>
<div class="paragraph">
<p>Use the <code>mount</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mount -v | grep 'type smbfs'
//root@solarsystem/tmp on /mnt type smbfs read/write/setuid/devices/dev=5080000
  on Tue Feb 12 11:40:18 2008
//root@solarsystem/files on /files type smbfs read/write/setuid/devices/dev=4800000
  on Mon Feb 11 22:17:56 2008</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>df -k -F smbfs</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ df -k -F smbfs
//root@solarsystem/tmp      1871312   70864 1800448     4%    /mnt
//root@solarsystem/files    8067749    8017 7979055     1%    /files</pre>
</div>
</div>
</li>
<li>
<p>Unmount the share by specifying the name of the mount point, <code>/mnt</code> or
<code>/files</code> in the previous step.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ umount /mnt</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Interactions with an SMB file server require authentication. For
instance, when you view the shares available on a server or you try to
mount a share on your system, the transaction is authenticated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A persistent password is not needed when Kerberos is configured on the
client and server and you have a Kerberos ticket-granting ticket (TGT).
In such configurations, you can view and mount shares without specifying
a password.</p>
</div>
<div class="paragraph">
<p>You can supply the password each time that you make a connection to the
server, or you can store a persistent password to be automatically used
for these transactions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can store a persistent password for each user on the SMB server that
you use to access shares.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SMB client is rebooted.</p>
</li>
<li>
<p>The <code>smbutil logout</code> command is run for the user.</p>
</li>
<li>
<p>The <code>smbutil logoutall</code> command is run by superuser.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Store the persistent password for the SMB server.</p>
<div class="literalblock">
<div class="content">
<pre>$ smbutil login user
Password:</pre>
</div>
</div>
<div class="paragraph">
<p>The following command stores the persistent password for
<code>terry@solarsystem</code>. Each time Terry performs a transaction with
<code>solarsystem</code>, the persistent password is used to perform the
authentication.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil login terry@solarsystem
Password:</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When installed, the <code>pam_smbfs_login.so.1</code> module enables you to
store a persistent password the same as if you had run the
<code>smbutil login</code> command for <code>PAM_USER</code> in the user&#8217;s or system&#8217;s
default domain.</p>
</div>
<div class="paragraph">
<p>This optional functionality is meant to be used only in environments
that do not run Active Directory or Kerberos, but which synchronize
passwords between illumos clients and their SMB servers.</p>
</div>
<div class="paragraph">
<p>For more information, see the <code>pam_smbfs_login(7)</code> man page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use your login name and password to store a persistent password.</p>
<div class="paragraph">
<p>Add the following line to the <code>/etc/pam.conf</code> file after the other
<code>login</code> entries:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>login   auth optional           pam_smbfs_login.so.1</pre>
</div>
</div>
<div class="paragraph">
<p>This action adds a persistent password entry as if you had run the
<code>smbutil login</code> command.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The PAM module implements a privilege to permit it to run as superuser
to store your password.
. Verify that your persistent password is stored.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil login -c user</pre>
</div>
</div>
<div id="configuringpammodule" class="paragraph">
<p>Configuring the PAM Module to Store a Persistent Password</p>
</div>
<div class="paragraph">
<p>The following example shows how the domain is chosen. The system default
is <code>WORKGROUP</code>. The <code>WORKGROUP</code> domain is overridden by any default from
SMF, and finally by any default from the user&#8217;s <code>.nsmbrc</code> file.</p>
</div>
<div class="paragraph">
<p>This example shows a default domain in SMF and for user <code>terry</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharectl set -p section=default -p domain=AAA smbfs
# sharectl get smbfs
[default]
domain=AAA</pre>
</div>
</div>
<div class="paragraph">
<p>A <code>root</code> login uses the domain from SMF:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbutil login -c terry
Keychain entry exists for AAA/terry.</pre>
</div>
</div>
<div class="paragraph">
<p>A login as <code>terry</code> uses the domain from the <code>~terry/.nsmbrc</code> file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ls /.nsmbrc
/.nsmbrc: No such file or directory

$ cat ~/.nsmbrc
[default]
domain=MYDOMAIN
$ ls -l ~/.nsmbrc
-rw-r--r--   1 terry  staff         26 Feb 13 10:15 /home/terry/.nsmbrc
$ smbutil login terry
Keychain entry exists for MYDOMAIN/terry.</pre>
</div>
</div>
<div class="paragraph">
<p>If Terry puts a password in <code>~terry/.nsmbrc</code>, he must remove read
permission. Also, because Terry&#8217;s home directory is on an NFS server,
the PAM module running as <code>root</code> cannot access Terry&#8217;s file, so Terry
would see the following and use the SMF domain instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ chmod 400 .nsmbrc
$ logout

solarsystem console login: terry
Password:
Can't open /home/terry/.nsmbrc: Permission denied
$ su
Password:
# smbutil login -c terry
Keychain entry exists for AAA/terry.</pre>
</div>
</div>
<div class="paragraph">
<p>Use this procedure to delete persistent passwords that are stored by the
<code>smbutil login</code> command.</p>
</div>
<div class="paragraph">
<p>If you want to delete <em>all</em> persistent passwords, see
<a href="#deleteallpasswordstask">task_title</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete a persistent password for the specified server by doing one of
the following:</p>
<div class="paragraph">
<p>To delete the persistent password for a specified user, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil logout user@server</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command removes the persistent password for
<code>terry@solarsystem</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil logout terry@solarsystem</pre>
</div>
</div>
<div class="paragraph">
<p>After the password is deleted, Terry is prompted for his password each
time that he performs a transaction with <code>solarsystem</code>.</p>
</div>
<div class="paragraph">
<p>To delete the password for the user running the <code>smbutil logout</code>
command, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil logout server</pre>
</div>
</div>
<div class="paragraph">
<p>For example, when user <code>dana</code> runs the following command, he removes his
persistent password for <code>solarsystem</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ smbutil logout solarsystem</pre>
</div>
</div>
<div class="paragraph">
<p>After the password is deleted, Dana is prompted for his password each
time that he performs a transaction with <code>solarsystem</code>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can customize your illumos SMB environment by creating a <code>.nsmbrc</code>
configuration file in your home directory. For more information about
the <code>.nsmbrc</code> file format, see the <code>nsmbrc(5)</code> man page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a file called <code>.nsmbrc</code> file in your home directory.</p>
</li>
<li>
<p>Edit the <code>.nsmbrc</code> file to specify values for illumos SMB client
properties.</p>
<div class="paragraph">
<p>This example shows how user <code>terry</code> can configure the <code>example.com</code>
environment by placing this <code>.nsmbrc</code> configuration file in his home
directory.</p>
</div>
<div class="paragraph">
<p>The default section describes the default domain, which is called
<code>SALES</code>, and sets a default user of <code>MYUSER</code>. These default settings are
inherited by other sections unless property values are overridden.</p>
</div>
<div class="paragraph">
<p><code>FSERVER</code> is a server section that defines a server called
<code>fserv.example.com</code>. It is part of the <code>SALES</code> domain.</p>
</div>
<div class="paragraph">
<p><code>RSERVER</code> is a server section that defines a server called
<code>rserv.example.com</code> that belongs to a new domain called <code>REMGROUP</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Configuration file for example.com
# Specify the Windows account name to use everywhere.
[default]
domain=SALES
user=MYUSER

# The 'FSERVER' is server in our domain.
[FSERVER]
addr=fserv.example.com

# The 'RSERVER' is a server in another domain.
[RSERVER]
domain=REMGROUP
addr=rserv.example.com</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="managing-smb-mounts-in-the-global-environment-task-map" class="paragraph">
<p>=== Managing SMB Mounts in the Global Environment (Task Map)</p>
</div>
<div class="paragraph">
<p>The following table points to the tasks that superuser can perform to
manage SMB mounts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">For Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount a share on a public mount point, such as one in the root file
system, so that many users can access the share.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some shares include
files and directories that many people on a system might want to access,
such as a global set of files or programs. In such cases, instead of
each user mounting the share in his own directory, the system
administrator can mount the share in a public place so that all users
can access the share from the same location.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#setupmultiusersharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customize the global environment by using the <code>sharectl</code> command to set
illumos SMB properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-specified properties override global
properties with the exception of security settings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#customizeglobalenvtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the global illumos SMB property settings by using the <code>sharectl</code>
command.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If one property is set with different values in each section,
all values are shown.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#viewglobalenvtask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an SMB share to an automounter map.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure if you want
an SMB share to be automatically mounted at boot time.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#automountsharetask">task_title</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete all persistent passwords.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this procedure if you want to
clear all persistent passwords.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#deleteallpasswordstask">task_title</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you want to make a share available to one or more users on a system,
you can mount the share on a mount point anywhere on the system. When
you mount a share as superuser, you do not need to own the mount point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser or assume an equivalent role.</p>
</li>
<li>
<p>Find the share that you want to mount from a server.</p>
<div class="literalblock">
<div class="content">
<pre># smbutil view //server</pre>
</div>
</div>
</li>
<li>
<p>Specify the password at the prompt.</p>
</li>
<li>
<p>Determine the mount point that you want to use.</p>
<div class="paragraph">
<p>For example, you decide to mount shares on the <code>/sales-tools</code> mount
point.</p>
</div>
</li>
<li>
<p>Perform the mount.</p>
<div class="literalblock">
<div class="content">
<pre># mount -F smbfs //[workgroup;][user[:password]@]server/share mount-point</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to mount the <code>/tmp</code> share from the <code>solarsystem</code> server on
the <code>/sales-tools</code> mount point, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mount -F smbfs //solarsystem/tmp /sales-tools</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can customize the global illumos SMB environment by using the
<code>sharectl(1M)</code> command. With the exception of the <code>minauth</code> property,
globally set properties can be overridden by a value set in user&#8217;s
<code>.nsmbrc</code> file. The most secure value of the <code>minauth</code> property takes
precedence over a less secure value set by the user or set in the global
environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser, assume an equivalent role, or use the “SMBFS
Management” RBAC profile, which is part of the “File System Management”
profile.</p>
</li>
<li>
<p>Determine which properties you want to set.</p>
<div class="paragraph">
<p>For a description of the properties, see the <code>nsmbrc(5)</code> man page.</p>
</div>
</li>
<li>
<p>Set a property value for the global illumos SMB environment.</p>
<div class="literalblock">
<div class="content">
<pre># sharectl set [-h] [-p property=value] … smbfs</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to specify a default workgroup name of <code>SALES</code> for the
default section, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharectl set -p section=default -p workgroup=SALES smbfs</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the global illumos SMB environment property settings by
using the <code>sharectl(1M)</code> command.</p>
</div>
<div class="paragraph">
<p>If you set a value for the same property in more than one section, the
<code>sharectl get</code> output includes the section name, property name, and
value.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine which properties you want to view.</p>
<div class="paragraph">
<p>For a description of the properties, see the <code>nsmbrc(5)</code> man page.</p>
</div>
<div class="paragraph">
<p>To view the value for a specific property, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sharectl get [-p property] … smbfs</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to view the values for the <code>timeout</code> property, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sharectl get -p timeout smbfs
[SALES] timeout=5
[default] timeout=10</pre>
</div>
</div>
<div class="paragraph">
<p>To view all of the property settings, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sharectl get smbfs
[SALES]
password=$$178465324253e0c07
timeout=5

[default]
timeout=10</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can add an SMB share <code>/etc/auto_direct</code> file so that the share
will be automatically mounted when a user accesses the mount point. See
<a href="#storepasswordtask">task_title</a>.</p>
</div>
<div class="paragraph">
<p>To successfully use the automount feature, you must store a persistent
password for authentication to mount the share.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser or assume an equivalent role.</p>
</li>
<li>
<p>Edit the <code>/etc/auto_direct</code> file to add the mapping.</p>
<div class="paragraph">
<p>The following examples show the changes to the <code>/etc/auto_direct</code>
file to configure automount maps.
* To configure an automount of the <code>//solarsystem/public</code> share on the
<code>/PUBLIC</code> mount point, create the following entry in the
<code>/etc/auto_direct</code> file:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/PUBLIC -fstype=smbfs //solarsystem/public</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To configure an automount of a share and to specify the password to be
used for authentication, create the following entry in the
<code>/etc/auto_direct</code> file:</p>
<div class="literalblock">
<div class="content">
<pre>/PUBLIC -fstype=smbfs //guest:guest@solarsystem/public</pre>
</div>
</div>
<div class="paragraph">
<p>This entry specifies that all access to the <code>//solarsystem/public</code> share
is done as the user <code>guest</code> and uses the specified password, which in
this example is <code>guest</code>.</p>
</div>
</li>
<li>
<p>To configure an automount of a share that can be accessed anonymously,
which does not require a password, specify the <code>noprompt</code> option:</p>
<div class="literalblock">
<div class="content">
<pre>/PUBLIC -noprompt,fstype=smbfs //solarsystem/public</pre>
</div>
</div>
<div class="paragraph">
<p>When a user accesses the <code>/PUBLIC</code> directory, such as by using the <code>ls</code>
or <code>cd</code> command, the share is automounted.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ls /PUBLIC
bin docs</pre>
</div>
</div>
<div class="paragraph">
<p>After the SMB share is mounted, a user can use regular Unix commands to
access the files. Automounted shares are automatically unmounted after a
period of inactivity.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use this procedure to delete all of the persistent passwords that are
used to authenticate SMB transactions.</p>
</div>
<div class="paragraph">
<p>If you only want to delete the persistent passwords for a particular
user, see <a href="#deletepasswordtask">task_title</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Become superuser or assume an equivalent role.</p>
</li>
<li>
<p>Delete all of the persistent passwords.</p>
<div class="literalblock">
<div class="content">
<pre># smbutil logoutall</pre>
</div>
</div>
<div class="paragraph">
<p>After the persistent passwords are deleted, each time a user performs a
transaction with an SMB server, he is prompted for his password.</p>
</div>
</li>
</ol>
</div>
<div id="illumos-smb-troubleshooting" class="paragraph">
<p>== illumos SMB Troubleshooting</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#illumos-smb-service-troubleshooting">illumos SMB Service Troubleshooting</a></p>
</li>
<li>
<p><a href="#illumos-smb-client-troubleshooting">illumos SMB Client Troubleshooting</a></p>
</li>
<li>
<p><a href="#identity-mapping-troubleshooting">Identity Mapping Troubleshooting</a></p>
</li>
</ul>
</div>
<div id="illumos-smb-service-troubleshooting" class="paragraph">
<p>=== illumos SMB Service Troubleshooting</p>
</div>
<div class="paragraph">
<p>The following are troubleshooting topics for the illumos SMB service.</p>
</div>
<div id="file-name-case-sensitivity-issues" class="paragraph">
<p>==== File Name Case-Sensitivity Issues</p>
</div>
<div class="paragraph">
<p>Sometimes you might experience unexpected behavior when performing basic
file operations. This behavior might be related to the file system being
unable to handle case-insensitive operations.</p>
</div>
<div class="paragraph">
<p>SMB clients usually expect a case-insensitive file system for correct
operation. The use of a ZFS file system that has been created in
mixed-case or case-insensitive mode should allow you to circumvent these
problems.</p>
</div>
<div class="paragraph">
<p>To create such a ZFS file system, use the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zfs create -o casesensitivity=mixed fsname</pre>
</div>
</div>
<div id="cannot-join-a-windows-domain" class="paragraph">
<p>==== Cannot Join a Windows Domain</p>
</div>
<div class="paragraph">
<p>To authenticate users from a Windows domain, the illumos SMB service
must locate a domain controller, authenticate, and then add a computer
account to the domain.</p>
</div>
<div class="paragraph">
<p>Users from the domain are not able to establish a connection to the
illumos SMB service unless this process succeeds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#checking-the-dns-configuration">Checking the DNS Configuration</a></p>
</li>
<li>
<p><a href="#checking-time-synchronization">Checking Time Synchronization</a></p>
</li>
<li>
<p><a href="#ensuring-that-you-specify-the-correct-password-for-your-domain-user">Ensuring That You Specify the Correct Password for
Your Domain User</a></p>
</li>
<li>
<p><a href="#ensuring-that-your-domain-user-has-sufficient-administrative-privileges">Ensuring That Your Domain User Has
Sufficient Administrative Privileges</a></p>
</li>
</ul>
</div>
<div id="checking-the-dns-configuration" class="paragraph">
<p>===== Checking the DNS Configuration</p>
</div>
<div class="paragraph">
<p>The illumos SMB service must be running for the <code>smbadm join</code> command to
succeed.</p>
</div>
<div class="paragraph">
<p>If Active Directory (AD) is configured, the illumos SMB service attempts
to locate the domain controller by means of DNS. If the service cannot
locate the domain controller, configure DNS properly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Missing DNS server.</strong> Ensure that the IP address of at least one AD
DNS server is added as the name server in <code>/etc/resolv.conf</code>.</p>
<div class="paragraph">
<p>If your configuration is incorrect, you might see the
<code>failed to find any domain controllers</code> error when attempting to join
the domain.</p>
</div>
</li>
<li>
<p><strong>DNS host lookup not used.</strong> Ensure that DNS is used for host lookup in
the <code>/etc/nsswitch.conf</code> file.</p>
</li>
</ul>
</div>
<div id="checking-time-synchronization" class="paragraph">
<p>===== Checking Time Synchronization</p>
</div>
<div class="paragraph">
<p>You might see the following error messages, which indicate that the
system clock is too far out of synchronization with that of the domain
controller:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm join -y -u administrator@westsales.example.com
Enter domain password:
Joining westsales.example.com ... this may take a minute ...
failed to join domain westsales.example.com
Failed getting initial credentials. (Clock skew too great)
Please refer to the service log for more information.
#</pre>
</div>
</div>
<div class="paragraph">
<p>This problem can be corrected by ensuring that the configuration is
correct in one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure both the illumos system and the DC to use the same time
source (NTP server).</p>
<div class="paragraph">
<p>Synchronize the system clock on the illumos system with the system clock
of the DC by running the following command on the illumos system:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ntpdate DC-hostname</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to synchronize with the DC called
<code>dc.westsales.example.com</code>, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ntpdate dc.westsales.example.com</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="ensuring-that-you-specify-the-correct-password-for-your-domain-user" class="paragraph">
<p>===== Ensuring That You Specify the Correct Password for Your Domain User</p>
</div>
<div class="paragraph">
<p>The user that you specify on the <code>smbadm join</code> command line must have
the correct password and the authority to create computer accounts.
Typically, you must specify a user account that is a member of the
Domain Administrators global group.</p>
</div>
<div class="paragraph">
<p>The following error message only appears if you supply the wrong
password for the administrative user:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbadm join -y -u administrator@westsales.example.com
Enter domain password:
Joining westsales.example.com ... this may take a minute ...
failed to join domain westsales.example.com
Failed getting initial credentials. (Wrong password?)
Please refer to the service log for more information.
#</pre>
</div>
</div>
<div class="paragraph">
<p>If you attempt to join as a domain user who does not have administrative
privileges, the join fails with <code>insufficient access</code> error messages.</p>
</div>
<div id="ensuring-that-your-domain-user-has-sufficient-administrative-privileges" class="paragraph">
<p>===== Ensuring That Your Domain User Has Sufficient Administrative Privileges</p>
</div>
<div class="paragraph">
<p>The user that you specify on the <code>smbadm join</code> command line must be a
member of the Domain Administrators global group.</p>
</div>
<div class="paragraph">
<p>The following error message only appears if you attempt to join as a
domain user who does not have administrative privileges. The join fails
with <code>insufficient access</code> error messages.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>smbd: failed joining domain-name (UNSUCCESSFUL)</pre>
</div>
</div>
<div id="checking-intermittent-domain-connectivity" class="paragraph">
<p>==== Checking Intermittent Domain Connectivity</p>
</div>
<div id="checking-the-domain-controller-selection" class="paragraph">
<p>===== Checking the Domain Controller Selection</p>
</div>
<div class="paragraph">
<p>Sometimes the illumos SMB service might lose its connection to the
domain controller. In such a situation, Windows users are denied access
to the illumos SMB service.</p>
</div>
<div class="paragraph">
<p>The connection might be lost if the network experiences connectivity
problems or if the primary domain controller fails.</p>
</div>
<div class="paragraph">
<p>The solution to any of these problems is to rejoin the Windows domain.
See <a href="#how-to-configure-the-illumos-smb-service-in-domain-mode">How to Configure the illumos SMB
Service in Domain Mode</a>.</p>
</div>
<div id="idmapd-unable-to-contact-ad-when-in-workgroup-mode" class="paragraph">
<p>==== <code>idmapd</code> Unable to Contact AD When in Workgroup Mode</p>
</div>
<div class="paragraph">
<p>The <code>idmapd</code> server attempts to contact AD even if the illumos SMB
service is in workgroup mode. As a result, <code>idmapd</code> issues errors.</p>
</div>
<div class="paragraph">
<p>To work around this problem, remove all rule-based mappings and ignore
any errors from <code>idmapd</code> about its failure to contact AD.</p>
</div>
<div id="viewing-illumos-smb-service-property-settings" class="paragraph">
<p>==== Viewing illumos SMB Service Property Settings</p>
</div>
<div class="paragraph">
<p>Much of the illumos SMB service configuration uses the <code>sharectl(8)</code>
command to set properties. Before you change property values, you should
view the current property settings by running the <code>sharectl get smb</code>
command.</p>
</div>
<div id="changes-to-windows-group-membership-and-to-user-mapping-do-not-take-effect" class="paragraph">
<p>==== Changes to Windows Group Membership and to User Mapping Do Not Take Effect</p>
</div>
<div class="paragraph">
<p>Windows clients use an access token to assign user data and group
membership. This token is assigned when the client connects to the SMB
service. Any changes made to this token are not reflected until the next
time the user connects.</p>
</div>
<div class="paragraph">
<p>To force changes to take effect immediately, the user must disconnect
from the SMB service by logging out of all connected workstations.</p>
</div>
<div id="cannot-set-share-security-all-shares-inherit-the-security-of-the-directory-object" class="paragraph">
<p>==== Cannot Set Share Security, All Shares Inherit the Security of the Directory Object</p>
</div>
<div class="paragraph">
<p>The security implementation of the illumos SMB service only secures
files and directories. The effective security of an SMB share is
<em>always</em> the security of the directory to which it points.</p>
</div>
<div id="cannot-use-smb-to-map-drives" class="paragraph">
<p>==== Cannot Use SMB to Map Drives</p>
</div>
<div class="paragraph">
<p>To map a drive or to connect to a share, you must have read access to
the directory to which the share points.</p>
</div>
<div class="paragraph">
<p>If the illumos SMB service is in domain mode, you must also be logged in
to the domain.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the system that is running the illumos SMB service.</p>
</li>
<li>
<p>Become superuser.</p>
</li>
<li>
<p>Obtain the user name and group name of the owner.</p>
<div class="literalblock">
<div class="content">
<pre># ls -l pathname</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following output indicates that the share is a
directory with 750 permissions. The owner is <code>root</code> and the group is
<code>sys</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ls -ld /vol1/data
drwxr-x---  41 root     sys         1024 Jan  2 23:19 /vol1/data</pre>
</div>
</div>
</li>
<li>
<p>Determine the permissions necessary for the user to access the
directory.</p>
</li>
<li>
<p>Use the <code>chmod</code> command to change the permissions of the directory.</p>
</li>
</ol>
</div>
<div id="cannot-see-the-security-tab-from-windows-clients" class="paragraph">
<p>==== Cannot See the Security Tab From Windows Clients</p>
</div>
<div class="paragraph">
<p>Some Windows clients do not show the security tab unless you have
permission to view or change security.</p>
</div>
<div class="paragraph">
<p>For information about how to view and modify share permissions, see
<a href="#cannot-use-smb-to-map-drives">Cannot Use SMB to Map Drives</a>.</p>
</div>
<div id="microsoft-access-or-sql-server-sessions-time-out-after-a-period-of-inactivity" class="paragraph">
<p>==== Microsoft Access or SQL Server Sessions Time Out After a Period of Inactivity</p>
</div>
<div class="paragraph">
<p>Applications can send SMB echo requests periodically to keep idle
sessions open or to reconnect, as required, if a session times out due
to inactivity. If an application appears unable to deal with an idle
session timeout, the SMB service <code>keep_alive</code> property can be set to
0 to disable the session inactivity timer.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sharectl set -p keep_alive=0 smb</pre>
</div>
</div>
<div id="cannot-add-windows-local-groups-to-access-control-list" class="paragraph">
<p>==== Cannot Add Windows Local Groups to Access Control List</p>
</div>
<div class="paragraph">
<p>Windows local groups cannot be used to assign security on remote
systems. A local group can only be used on the individual computer on
which it is created. A local group is not stored in the domain SAM
database.</p>
</div>
<div class="paragraph">
<p>Windows domain controllers are an exception to this behavior. Domain
controllers share a set of local groups that can only be shared with
other domain controllers. To make security assignments to the illumos
SMB service, use global groups.</p>
</div>
<div class="paragraph">
<p>The illumos SMB service has its own set of local groups that are
provided for Windows compatibility purposes. These local groups permit a
limited set of privileges, and they can also be used for security
assignments to individual files and folders.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Windows domain local groups are not supported.</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="samba-or-smb-service-cannot-bind-various-ports"><a class="anchor" href="#samba-or-smb-service-cannot-bind-various-ports"></a>3.7.1. Samba or SMB Service Cannot Bind Various Ports</h4>
<div class="paragraph">
<p>You will see errors if you attempt to run both the Samba service,
<code>svc:/network/samba:default</code>, and the illumos SMB service,
<code>svc:/network/smb/server:default</code>, simultaneously.</p>
</div>
<div class="paragraph">
<p>The Samba and illumos SMB services are mutually exclusive because they
both attempt to listen on the same ports. Only one service should be
enabled at any time.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Disable the Samba service.</strong> Use the
<code>svcadm disable svc:/network/samba</code> command.</p>
</li>
<li>
<p><strong>Disable the illumos SMB service.</strong> Use the <code>svcadm disable smb/server</code>
command.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="invalid-password-errors-appear-when-mapping-a-drive-or-browsing-computers-in-the-workgroup"><a class="anchor" href="#invalid-password-errors-appear-when-mapping-a-drive-or-browsing-computers-in-the-workgroup"></a>3.7.2. <code>invalid password</code> Errors Appear When Mapping a Drive or Browsing Computers in the Workgroup</h4>
<div class="paragraph">
<p>When you map a drive or browse computers in your workgroup, you might
see <code>invalid password</code> errors. If you see these errors, check to see
that the <code>/var/smb/smbpasswd</code> file includes information for the
appropriate users.</p>
</div>
<div class="paragraph">
<p>Also, ensure that the <code>pam_smb_passwd.so.1</code> entry is in the
<code>/etc/pam.conf</code> file and that you use the <code>passwd</code> command to set your
password.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#how-to-configure-the-illumos-smb-service-in-workgroup-mode">How to
Configure the illumos SMB Service in Workgroup Mode</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="access-control-list-inheritance-issues"><a class="anchor" href="#access-control-list-inheritance-issues"></a>3.7.3. Access Control List Inheritance Issues</h4>
<div class="paragraph">
<p>Access control list (ACL) behavior differs between Windows systems and
ZFS on illumos systems. You might experience Windows ACL inheritance
problems because of the access control entry (ACE) ordering used by the
default ZFS ACL.</p>
</div>
<div class="paragraph">
<p>The default ZFS ACL is designed to comply with POSIX, which results in
the interleaving of <code>allow</code> and <code>deny</code> ACEs. Windows expects all <code>deny</code>
ACEs to precede all <code>allow</code> ACEs.</p>
</div>
<div class="paragraph">
<p>You can override the default ZFS behavior by changing the ACL on the
root directory to provide the equivalent of <code>Everyone:FullControl</code> as
follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># chmod 777 /pool-name
# chmod A=everyone@:rwxpdDaARWcCos:fd:allow /pool/fs-name</pre>
</div>
</div>
<div class="paragraph">
<p>For information about the <code>chmod</code> options, see the <code>chmod(1)</code> man page.</p>
</div>
<div class="paragraph">
<p>You can verify the ACL by viewing it on Windows or by running the
following command on an illumos system:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ls -V -d /pool-name/fs-name</pre>
</div>
</div>
<div class="paragraph">
<p>You can apply this ACL recursively to all subdirectories and files for
existing file systems from Windows or from the illumos OS.</p>
</div>
<div class="paragraph">
<p>If you apply the ACL when the file system is first created, the ACL will
be propagated according to the normal inheritance rules.</p>
</div>
<div class="paragraph">
<p>If a directory has a default ZFS ACL, when a file or folder is created
under this directory from Windows, it has two ACEs: one for the owner
and one for SYSTEM. To change this behavior, update the root directory&#8217;s
ACL by running the <code>chmod</code> commands shown previously.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="illumos-smb-client-troubleshooting"><a class="anchor" href="#illumos-smb-client-troubleshooting"></a>3.8. illumos SMB Client Troubleshooting</h3>
<div class="sect3">
<h4 id="viewing-illumos-smb-client-property-settings"><a class="anchor" href="#viewing-illumos-smb-client-property-settings"></a>3.8.1. Viewing illumos SMB Client Property Settings</h4>
<div class="paragraph">
<p>The illumos SMB client configuration uses the <code>sharectl</code> command to set
properties. Before you change property values, view the current property
settings by running the <code>sharectl get smbfs</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="access-denied-message-when-accessing-a-server"><a class="anchor" href="#access-denied-message-when-accessing-a-server"></a>3.8.2. <code>Access Denied</code> Message When Accessing a Server</h4>
<div class="paragraph">
<p>You get an <code>Access Denied</code> error when attempting to access or view SMB
shares from a server. This problem might occur because the password you
supplied is wrong or the SMB server is part of a domain.</p>
</div>
<div class="paragraph">
<p>If the SMB server is part of a domain, you must provide the domain name
for the <code>smbutil view</code> or <code>mount</code> command. Otherwise, the server assumes
that you are attempting to authenticate a local user, and the
authentication process fails.</p>
</div>
<div class="paragraph">
<p>For example, if the server <code>solarsystem</code> is in the <code>MYDOMAIN</code> domain,
the following commands would be appropriate to view and access SMB
shares as user <code>cal</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbutil view "//MYDOMAIN;cal@solarsystem"
# mount -F smbfs "//MYDOMAIN;cal@solarsystem/tmp" /mnt</pre>
</div>
</div>
<div class="paragraph">
<p>To obtain the domain name, use the <code>smbutil status server</code> command,
which sends a NetBIOS query to the specified server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># smbutil status solarsystem
Workgroup: MYDOMAIN
Server: SOLARSYSTEM</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cannot-view-or-mount-smb-shares"><a class="anchor" href="#cannot-view-or-mount-smb-shares"></a>3.8.3. Cannot View or Mount SMB Shares</h4>
<div class="paragraph">
<p>If you are unable to view or mount SMB shares, use the
<code>smbutil view -A //server</code> command. The <code>A</code> option gives anonymous
access to the server if the server permits such access.</p>
</div>
</div>
<div class="sect3">
<h4 id="cannot-mount-smb-shares-as-a-regular-user"><a class="anchor" href="#cannot-mount-smb-shares-as-a-regular-user"></a>3.8.4. Cannot Mount SMB Shares as a Regular User</h4>
<div class="paragraph">
<p>You might see the following error message when you attempt to mount an
SMB share as a regular user on a mount point that you own:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mount -F smbfs //username@server-name/share-name mount-point
mount: mount_smbfs: mount-point: Not owner</pre>
</div>
</div>
<div class="paragraph">
<p>Verify that you have the following entries in your
<code>/etc/security/exec_attr</code> file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Basic Solaris User:solaris:cmd:::/usr/lib/fs/smbfs/mount:privs=sys_mount
Basic Solaris User:solaris:cmd:::/usr/lib/fs/smbfs/umount:privs=sys_mount</pre>
</div>
</div>
<div class="paragraph">
<p>These entries in the <code>/etc/security/exec_attr</code> file enable you to
mount and unmount SMB shares on mount points that you own as a regular
user.</p>
</div>
</div>
<div class="sect3">
<h4 id="tar-and-gtar-issues-file-changed-as-we-read-it-warnings"><a class="anchor" href="#tar-and-gtar-issues-file-changed-as-we-read-it-warnings"></a>3.8.5. <code>tar</code> and <code>gtar</code> Issues <code>file changed as we read it</code> Warnings</h4>
<div class="ulist">
<ul>
<li>
<p>When you use the illumos SMB client to mount an SMB share, and use the
<code>gtar</code> utility to write the share to a tape</p>
</li>
<li>
<p>When you use the illumos SMB client to mount an SMB share, and use the
<code>tar</code> utility checks file attributes after setting them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other than these warnings, the <code>tar</code> and <code>gtar</code> operations succeed as
expected.</p>
</div>
<div class="paragraph">
<p>You can ignore these warnings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>smbfs</code> ignores calls to set any file or directory attributes, as those
have no direct representation in SMB. Also, <code>smbfs</code> does not support the
“UNIX extensions” that would permit the storing of attributes with some
servers.</p>
</div>
<div id="identity-mapping-troubleshooting" class="paragraph">
<p>=== Identity Mapping Troubleshooting</p>
</div>
<div id="viewing-identity-mapping-service-property-settings" class="paragraph">
<p>==== Viewing Identity Mapping Service Property Settings</p>
</div>
<div class="paragraph">
<p>The identity mapping service uses the <code>svccfg(8)</code> command to set
properties. Before you change property values, you should view the
current property settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code># svccfg -s idmap listprop "config/*"</code></p>
</li>
<li>
<p><code># svcprop -p config svc:/system/idmap</code></p>
</li>
<li>
<p><code># svccfg -s idmap listprop</code></p>
</li>
<li>
<p><code># svcprop svc:/system/idmap</code></p>
</li>
</ul>
</div>
<div id="saving-and-restoring-rule-based-mappings" class="paragraph">
<p>==== Saving and Restoring Rule-Based Mappings</p>
</div>
<div class="paragraph">
<p>You might need to back up and restore your rule-based mappings.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>idmap export</code>, <code>idmap import</code>, and
<code>idmap list</code> commands, see the <code>idmap(8)</code> man page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p></p>
<div class="ulist">
<ul>
<li>
<p>Export the mappings.</p>
<div class="literalblock">
<div class="content">
<pre># idmap export -f output-file format</pre>
</div>
</div>
</li>
<li>
<p>List the mappings.</p>
<div class="literalblock">
<div class="content">
<pre># idmap list &gt;output-file</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Disable the <code>idmap</code> service.</p>
<div class="literalblock">
<div class="content">
<pre># svcadm disable idmap</pre>
</div>
</div>
</li>
<li>
<p>Remove the <code>idmap.db</code> databases.</p>
<div class="literalblock">
<div class="content">
<pre># rm /var/idmap/idmap.db /var/run/idmap/idmap.db</pre>
</div>
</div>
</li>
<li>
<p>Reboot the system.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Use the</strong> <code>idmap import</code> <strong>command.</strong></p>
<div class="literalblock">
<div class="content">
<pre># idmap import -f input-file format</pre>
</div>
</div>
</li>
<li>
<p><strong>Use the</strong> <code>idmap list</code> <strong>command.</strong></p>
<div class="paragraph">
<p>Run &lt;output-file&gt; as a shell script.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sh ./output-file</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="viewing-details-about-mappings" class="paragraph">
<p>==== Viewing Details About Mappings</p>
</div>
<div class="paragraph">
<p>If you encounter unexpected mapping results, use the <code>idmap dump</code> and
<code>idmap show</code> commands to gather data. Each command has a <code>v</code> option that
produces detailed information about mappings.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#dumpmappingtask">task_title</a> and
<a href="#showmappingtask">task_title</a>.</p>
</div>
<div id="appendix-a-extending-the-ad-schema" class="paragraph">
<p>== Appendix A: Extending the AD Schema</p>
</div>
<div class="paragraph">
<p>This appendix describes methods to extend the Active Directory (AD) LDAP</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#modifyadschemaex">example_title</a></p>
</li>
<li>
<p><a href="#populateadusergroupobjectsex">example_title</a></p>
</li>
<li>
<p><a href="#modifynldapdirbasedmapping">task_title</a></p>
</li>
<li>
<p><a href="#modifynldapschemaex">example_title</a></p>
</li>
<li>
<p><a href="#populatenldapusergroupobjectsex">example_title</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure shows how to extend the AD schema and populate the user
and group objects with the associated Unix names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perform this task before enabling directory-based mapping on your
illumos system.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(Optional) Extend the AD schema to add the new UNIX user and group
attributes.</p>
<div class="paragraph">
<p>Many organizations have adopted
<a href="https://datatracker.ietf.org/doc/html/rfc2307">RFC 2307</a> or
<a href="https://datatracker.ietf.org/doc/html/draft-howard-rfc2307bis-01">rfc2307bis</a>
schema extensions, which <code>idmap</code> supports.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not want to extend the AD schema, you can use an existing AD
schema attribute to store UNIX user and group name information. For
instance, if you already have schema that is comparable to what is
described in <a href="#modifyadschemaex">example_title</a>, you can use the
existing attributes instead of creating new ones.
.. Create an LDAP Data Interchange Format (LDIF) file to describe the AD
schema changes.</p>
</div>
<div class="paragraph">
<p>+
For sample LDIF file contents, see
<a href="#modifyadschemaex">example_title</a>. Also see Extending Your
Active Directory Schema in Windows Server and Step-by-Step Guide to
Using Active Directory Schema and Display Specifiers on the
<a href="#">Microsoft technet web site</a>.
.. Use the <code>ldifde</code> tool to load the schema changes into AD from the
Windows server.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\&gt; ldifde -v -i -f input-file</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>ldapmodify</code> command to populate the AD user and group objects
with the new attributes and their values.</p>
<div class="paragraph">
<p>You can use the <code>idmap set-namemap</code> command to populate user and group
objects. See <a href="#adddirmappingusertask">task_title</a> and
<a href="#adddirmappinggrouptask">task_title</a>.</p>
</div>
<div class="paragraph">
<p>You can also use any of the Windows AD utilities to populate these
objects.
.. Create an LDIF file to record the updates to the AD user and group
objects.</p>
</div>
<div class="paragraph">
<p>+
See a sample LDIF file in
<a href="#populateadusergroupobjectsex">example_title</a>. For more
information about the LDIF file format, see <a href="#">RFC 2849</a>.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <code>kinit</code> command to obtain a Kerberos ticket-granting ticket
(TGT) for a privileged AD principal.</p>
<div class="paragraph">
<p>This principal will be used by the <code>ldapmodify</code> command to update the AD
objects described in the file you created in the previous substep.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kinit Administrator
Password for Administrator@EXAMPLE.COM:</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>ldapmodify</code> command to update the user objects on the AD
server.</p>
<div class="literalblock">
<div class="content">
<pre>$ ldapmodify -h AD-server-name -o mech=gssapi -o authzid='' -f input-file</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div id="modifyadschemaex" class="paragraph">
<p>Extending the AD Schema</p>
</div>
<div class="paragraph">
<p>The following LDIF example file, <code>ad_namemap_schema.ldif</code>,
describes the AD schema changes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dn: CN=unixUserName, CN=Schema, CN=Configuration, DC=example, DC=com
changetype: add
attributeID: 1.3.6.1.4.1.42.2.27.5.1.60
attributeSyntax: 2.5.5.3
isSingleValued: TRUE
searchFlags: 1
lDAPDisplayName: unixUserName
adminDescription: This attribute contains the object's UNIX username
objectClass: attributeSchema
oMSyntax: 27

dn: CN=unixGroupName, CN=Schema, CN=Configuration, DC=example, DC=com
changetype: add
attributeID: 1.3.6.1.4.1.42.2.27.5.1.61
attributeSyntax: 2.5.5.3
isSingleValued: TRUE
searchFlags: 1
lDAPDisplayName: unixGroupName
adminDescription: This attribute contains the object's UNIX groupname
objectClass: attributeSchema
oMSyntax: 27

dn:
changetype: modify
add: schemaUpdateNow
schemaUpdateNow: 1
-

dn: CN=unixNameInfo, CN=Schema, CN=Configuration, DC=example, DC=com
changetype: add
governsID: 1.3.6.1.4.1.42.2.27.5.2.15
lDAPDisplayName: unixNameInfo
adminDescription: Auxiliary class to store UNIX name info in AD
mayContain: unixUserName
mayContain: unixGroupName
objectClass: classSchema
objectClassCategory: 3
subClassOf: top</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>ldifde</code> tool to load the schema changes into AD from the
Windows server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\&gt; ldifde -v -i -f ad_namemap_schema.ldif</pre>
</div>
</div>
<div id="populateadusergroupobjectsex" class="paragraph">
<p>Populating AD User and Group Objects</p>
</div>
<div class="paragraph">
<p>The following example has Windows users <code>terry</code>, <code>cal</code>, and <code>dana</code>
stored in Active Directory. These Windows users are associated with the
Unix users <code>tmw</code>, <code>crj</code>, and <code>dab</code>, respectively.</p>
</div>
<div class="paragraph">
<p>This example shows how to add the Unix user names to the appropriate
user objects in AD by using the <code>ldapmodify</code> command.</p>
</div>
<div class="paragraph">
<p>First, create an input file, <code>updateUsers</code>, that associates the Windows
names with the Unix names:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cat updateUsers
dn: CN=Terry Walters,CN=Users,DC=example,DC=com
changetype: modify
add: unixUserName
unixUserName: tmw

dn: CN=Cal Jamieson,CN=Users,DC=example,DC=com
changetype: modify
add: unixUserName
unixUserName: crj

dn: CN=Dana Bloom,CN=Users,DC=example,DC=com
changetype: modify
add: unixUserName
unixUserName: dab
$</pre>
</div>
</div>
<div class="paragraph">
<p>Next, use the <code>kinit</code> command to obtain a TGT for a privileged
principal:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kinit Administrator
Password for Administrator@EXAMPLE.COM:</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, run the <code>ldapmodify</code> command to update the user objects on the
AD server, <code>saturn</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ldapmodify -h saturn -o mech=gssapi -o authzid='' -f updateUsers</pre>
</div>
</div>
<div class="paragraph">
<p>This procedure shows how to extend the native LDAP schema and populate
the user and group objects with the associated Windows names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perform this task before enabling directory-based mapping on your
illumos system.</p>
</div>
</li>
<li>
<p>(Optional) Extend the native LDAP schema to add the new Windows user
and group attributes.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not want to extend the native LDAP schema, you can use an
existing native LDAP schema attribute to store Windows user and group
name information. For instance, if you already have schema that is
comparable to what is described in
<a href="#modifynldapschemaex">example_title</a>, you can use your
attributes instead of creating new ones.
.. Create an LDAP Data Interchange Format (LDIF) file to describe the
native LDAP schema changes.</p>
</div>
<div class="paragraph">
<p>+
For sample LDIF file contents, see
<a href="#modifynldapschemaex">example_title</a>.
.. Use the <code>ldapmodify</code> tool to load the schema changes into native
LDAP.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ldapmodify -D cn=admin -w p -f input-file</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>ldapmodify</code> command to populate the native LDAP user and
group objects with the new attributes and their values.</p>
<div class="paragraph">
<p>You can use the <code>idmap set-namemap</code> command to populate user and group
objects. See <a href="#adddirmappingusertask">task_title</a> and
<a href="#adddirmappinggrouptask">task_title</a>.
.. Create an LDIF file to record the updates to the native LDAP user and
group objects.</p>
</div>
<div class="paragraph">
<p>+
See a sample LDIF file in
<a href="#populatenldapusergroupobjectsex">example_title</a>. For more
information about the LDIF file format, see <a href="#">RFC 2849</a>.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <code>ldapmodify</code> command to update the user objects on the native
LDAP server.</p>
<div class="literalblock">
<div class="content">
<pre>$ ldapmodify -h LDAP-server-name -o mech=gssapi -o authzid='' -f input-file</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div id="modifynldapschemaex" class="paragraph">
<p>Extending the Native LDAP Schema</p>
</div>
<div class="paragraph">
<p>The following LDIF example file, <code>nldap_namemap_schema.ldif</code>,
describes the native LDAP schema changes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dn: cn=schema
changetype: modify
add: attributeTypes
attributeTypes: ( 1.3.6.1.4.1.42.2.27.5.1.62
   NAME 'winAccountName'
   DESC 'Windows user or group name corresponding to a Unix user or group'
   EQUALITY caseIgnoreMatch
   SUBSTRINGS caseIgnoreSubstringsMatch
   ORDERING caseIgnoreOrderingMatch
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )
-
add: objectClasses
objectClasses: ( 1.3.6.1.4.1.42.2.27.5.2.16
   NAME 'winAccount'
   DESC 'Auxiliary class to store Windows name mappings in Unix user/group objects'
   SUP top
   MAY winAccountName )</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>ldapmodify</code> tool to load the schema changes into native LDAP:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ldapmodify -D cn=admin -w - -f f nldap_namemap_schema.ldif
Enter bind password:
modifying entry cn=schema</pre>
</div>
</div>
<div id="populatenldapusergroupobjectsex" class="paragraph">
<p>Populating Native LDAP User and Group Objects</p>
</div>
<div class="paragraph">
<p>The following example has Unix users <code>tmw</code>, <code>crj</code>, and <code>dab</code> stored in
native LDAP. These Unix users are associated with the Windows users
<code>terry</code>, <code>cal</code>, and <code>dana</code>, respectively.</p>
</div>
<div class="paragraph">
<p>This example shows how to add the Windows user names to the appropriate
user objects in native LDAP by using the <code>ldapmodify</code> command.</p>
</div>
<div class="paragraph">
<p>First, create an input file, <code>updateUsers</code>, that associates the Unix
names with the Windows names:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cat updateUsers
dn: uid=tmw,ou=passwd,dc=example,dc=com
changetype: modify
add: winAccountName
winAccountName: terry@example.com

dn: uid=crj,ou=passwd,dc=example,dc=com
changetype: modify
add: winAccountame
winAccountame: cal@example.com

dn: uid=dab,ou=passwd,dc=example,dc=com
changetype: modify
add: winAccountame
winAccountame: dana@example.com
$</pre>
</div>
</div>
<div class="paragraph">
<p>Then, run the <code>ldapmodify</code> command to update the user objects on the
native LDAP server, <code>neptune</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ldapmodify -h neptune -o mech=gssapi -o authzid='' -f updateUsers</pre>
</div>
</div>
<div class="paragraph">
<p>== Glossary</p>
</div>
<div class="paragraph">
<p>The following terms are used throughout this book.</p>
</div>
<div class="paragraph">
<p>access control list (ACL)</p>
</div>
<div class="paragraph">
<p>A list associated with a file that contains information about which
users or groups have permission to access or modify the file.</p>
</div>
<div class="paragraph">
<p>Active Directory (AD)</p>
</div>
<div class="paragraph">
<p>A Windows naming service that runs on a domain controller to protect
network objects from unauthorized access. This service also replicates
objects across a network so that data is not lost if one domain
controller fails.</p>
</div>
<div class="paragraph">
<p>autohome share</p>
</div>
<div class="paragraph">
<p>A transient share of a user&#8217;s home directory that is created when the
user logs in and is removed when the user logs out.</p>
</div>
<div class="paragraph">
<p>SMB client</p>
</div>
<div class="paragraph">
<p>Software that enables a system to access SMB shares from a
<a href="#glossarysmbserver">SMB server</a>.</p>
</div>
<div class="paragraph">
<p>SMB server</p>
</div>
<div class="paragraph">
<p>Software that enables a system to make SMB shares available to
<a href="#glossarysmbclient">SMB clients</a>.</p>
</div>
<div class="paragraph">
<p>Common Internet File System (CIFS)</p>
</div>
<div class="paragraph">
<p>A legacy name for what is now more commonly referred to as the
<a href="#glossarysmb">Server Message Block (SMB)</a> protocol.</p>
</div>
<div class="paragraph">
<p>diagonal mapping</p>
</div>
<div class="paragraph">
<p>A rule that maps between a Windows group and a Unix user and between a
Unix group and a Windows user. These mappings are needed when Windows
uses a group identity as a file owner, or a user identity as a file
group.</p>
</div>
<div class="paragraph">
<p>directory-based mappings</p>
</div>
<div class="paragraph">
<p>A way to use name mapping information that is stored in user or group
objects in the Active Directory (AD), in the native LDAP directory
service, or both to map users and groups.</p>
</div>
<div class="paragraph">
<p>Domain Name System (DNS)</p>
</div>
<div class="paragraph">
<p>A service that provides the naming policy and mechanisms for mapping
domain and machine names to addresses outside of the enterprise, such as
those on the Internet. DNS is the network information service used by
the Internet.</p>
</div>
<div class="paragraph">
<p>Dynamic DNS (DDNS)</p>
</div>
<div class="paragraph">
<p>A service that is provided with <a href="#glossaryad">AD</a> that enables a
client to dynamically update its entries in the DNS database.</p>
</div>
<div class="paragraph">
<p>ephemeral ID</p>
</div>
<div class="paragraph">
<p>A dynamic UID or GID mapping for an <a href="#glossarysid">SID</a> that is not
already mapped by name.</p>
</div>
<div class="paragraph">
<p>A forest can have one or more <a href="#glossarytree">trees</a> that do not form
a contiguous namespace.</p>
</div>
<div class="paragraph">
<p>forest-and-tree model</p>
</div>
<div class="paragraph">
<p>A logical structure that enables you to interconnect two or more Windows
domains by bringing them into bidirectional, chained trust
relationships. See also <a href="#glossarytree">tree</a> and
<a href="#glossaryforest">forest</a>.</p>
</div>
<div class="paragraph">
<p>Each tree in this model has a unique name, while a forest does not need
to be named. The trees in a forest form a hierarchy for the purposes of
the trust relationships. In this model, a single tree can constitute a
forest. Each tree within a forest can be independent of the others.</p>
</div>
<div class="paragraph">
<p>You might use this model to run multiple environments under separate DNS
namespaces.</p>
</div>
<div class="paragraph">
<p>group identifier (GID)</p>
</div>
<div class="paragraph">
<p>An unsigned 32-bit identifier that is associated with a Unix group.</p>
</div>
<div class="paragraph">
<p>identity mapping</p>
</div>
<div class="paragraph">
<p>A process that enables Windows clients to transparently access SMB
shares and remote services from the illumos <a href="#glossarysmbserver">SMB
server</a>.</p>
</div>
<div class="paragraph">
<p>Lightweight Data Access Protocol (LDAP)</p>
</div>
<div class="paragraph">
<p>A standard, extensible directory access protocol that enables clients
and servers that use LDAP naming services to communicate with each
other.</p>
</div>
<div class="paragraph">
<p>mount point</p>
</div>
<div class="paragraph">
<p>A directory to which you mount a file system or a share that exists on a
remote system.</p>
</div>
<div class="paragraph">
<p>name-based mappings</p>
</div>
<div class="paragraph">
<p>A way to associate Windows users and groups with equivalent Unix users
and groups by name rather than by identifier. A name-based mapping can
consist of <a href="#glossarydirbasedmapping">directory-based mappings</a> and
<a href="#glossaryrulebasedmapping">rule-based mappings</a>.</p>
</div>
<div class="paragraph">
<p>NetBIOS name</p>
</div>
<div class="paragraph">
<p>The name of a host or workgroup used by NetBIOS.</p>
</div>
<div class="paragraph">
<p>NetBIOS scope</p>
</div>
<div class="paragraph">
<p>A valid domain name as defined by <a href="#glossarydns">DNS</a>. You use a
NetBIOS scope identifier to identify logical NetBIOS networks that are
on the same physical network. When you specify a NetBIOS scope
identifier, the server will only be able to communicate with other
systems that have the same scope defined. The value is a text string
that represents a domain name and is limited to 16 characters. By
default, no value is set.</p>
</div>
<div class="paragraph">
<p>You might specify a NetBIOS scope if you want to divide a large Windows
workgroup into smaller groups. If you use a scope, the scope ID must
follow NetBIOS name conventions or domain name conventions. The ID is
limited to 16 characters.</p>
</div>
<div class="paragraph">
<p>Most environments do not require the use of the NetBIOS scope feature.
If you must use this feature, ensure that you track the scope identifier
assigned to each node.</p>
</div>
<div class="paragraph">
<p>Network Information Service (NIS) database</p>
</div>
<div class="paragraph">
<p>A distributed database that contains key information about the systems
and the users on the network. The NIS database is stored on the master
server and all the replica or slave servers.</p>
</div>
<div class="paragraph">
<p>Network Time Protocol (NTP)</p>
</div>
<div class="paragraph">
<p>A protocol that enables a client to automatically synchronize its system
clock with a time server. The clock is synchronized each time the client
is booted and any time it contacts the time server.</p>
</div>
<div class="paragraph">
<p>persistent password</p>
</div>
<div class="paragraph">
<p>A stored password that enables an illumos SMB client to mount SMB shares
without having to authenticate each mount action. This password remains
in storage until removed by the <code>smbutil logout</code> or <code>smbutil logoutall</code>
command.</p>
</div>
<div class="paragraph">
<p>relative identifier (RID)</p>
</div>
<div class="paragraph">
<p>A 32-bit identifier similar to a Unix <a href="#glossaryuid">user identifier
(UID)</a> or <a href="#glossarygid">group identifier (GID)</a> that identifies a
user, group, system, or domain.</p>
</div>
<div class="paragraph">
<p>rule-based mappings</p>
</div>
<div class="paragraph">
<p>A way to use rules to associate Windows users and groups with equivalent
Unix users and groups by name rather than by identifier.</p>
</div>
<div class="paragraph">
<p>An open source service that enables UNIX servers to provide SMB
file-sharing and printing services to SMB clients.</p>
</div>
<div class="paragraph">
<p>Security Accounts Manager (SAM) database</p>
</div>
<div class="paragraph">
<p>A database in which Windows users and groups are defined. The SAM
database is managed on a <a href="#glossarywindowsdomaincontroller">Windows
domain controller</a>.</p>
</div>
<div class="paragraph">
<p>security identifier (SID)</p>
</div>
<div class="paragraph">
<p>A variable length structure that uniquely identifies a user or group
both within the local domain and across all possible Windows domains.</p>
</div>
<div class="paragraph">
<p>A local resource on a server that is accessible to clients on the
network. On an illumos <a href="#glossarysmbserver">SMB server</a>, a share is
typically a directory. Each share is identified by a name on the
network. To clients on the network, the share does not expose the local
directory path directly above the root of the share.</p>
</div>
<div class="paragraph">
<p>Most shares have a type of <code>disk</code> because the shares are directories. A
share of type <code>pipe</code> represents a device, such as an IPC share or a
printer.</p>
</div>
<div class="paragraph">
<p>Server Message Block (SMB)</p>
</div>
<div class="paragraph">
<p>A protocol that enables clients to access files and to request services
of Windows-compatible servers on the network.</p>
</div>
<div class="paragraph">
<p>A named collection of domains that share the same network configuration,
schema, and global catalog.</p>
</div>
<div class="paragraph">
<p>user identifier (UID)</p>
</div>
<div class="paragraph">
<p>An unsigned 32-bit identifier that is associated with a Unix user.</p>
</div>
<div class="paragraph">
<p>Windows domain</p>
</div>
<div class="paragraph">
<p>A centrally administered group of computers and accounts that share a
common security and administration policy and database. Computer, user,
and group accounts are centrally managed by using servers known as
<a href="#glossarywindowsdomaincontroller">domain controller</a>s. In order to
participate in a Windows domain, a computer must join the domain and
become a domain member.</p>
</div>
<div class="paragraph">
<p>Windows domain controller</p>
</div>
<div class="paragraph">
<p>A Windows system that is used to provide authentication services for its
Windows domain.</p>
</div>
<div class="paragraph">
<p>Windows Internet Naming Service (WINS)</p>
</div>
<div class="paragraph">
<p>A service that resolves NetBIOS names to IP addresses.</p>
</div>
<div class="paragraph">
<p>Windows workgroup</p>
</div>
<div class="paragraph">
<p>A group of standalone computers that are independently administered.
Each computer has independent, local user and group accounts, and
security and policy database. In a Windows workgroup, computers
cooperate through the use of a common workgroup name but this is a
peer-to-peer model with no formal membership mechanism.</p>
</div>
<div id="document-license" class="paragraph">
<p>== Document License</p>
</div>
<div class="paragraph">
<p>=== Public Documentation License (PDL), Version 1.01</p>
</div>
<div class="paragraph">
<p><span class="first-word">1.0  DEFINITIONS.</span></p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>1.1.  “Commercial Use” means distribution or otherwise making the
Documentation available to a third party.</p>
</div>
<div class="paragraph">
<p>1.2.  “Contributor” means a person or entity who creates or contributes
to the creation of Modifications.</p>
</div>
<div class="paragraph">
<p>1.3.  “Documentation” means the Original Documentation or Modifications
or the combination of the Original Documentation and Modifications, in
each case including portions thereof.</p>
</div>
<div class="paragraph">
<p>1.4.  “Editable Form” means the preferred form of Documentation for
making Modifications to such documentation. The Documentation can be in
an electronic, compressed or archival form, provided the appropriate
decompression or de-archiving software is widely available for no
charge.</p>
</div>
<div class="paragraph">
<p>1.5.  “Electronic Distribution Mechanism” means a mechanism generally
accepted for the electronic transfer of data.</p>
</div>
<div class="paragraph">
<p>1.6.  “Initial Writer” means the individual or entity identified as the
Initial Writer in the notice required by the Appendix.</p>
</div>
<div class="paragraph">
<p>1.7.  “Larger Work” means a work which combines Documentation or
portions thereof with documentation or other writings not governed by
the terms of this License.</p>
</div>
<div class="paragraph">
<p>1.8.  “License” means this document.</p>
</div>
<div class="paragraph">
<p>1.9.  “Modifications” means any addition to or deletion from the
substance or structure of either the Original Documentation or any
previous Modifications, such as a translation, abridgment, condensation,
or any other form in which the Original Documentation or previous
Modifications may be recast, transformed or adapted. A work consisting
of editorial revisions, annotations, elaborations, and other
modifications which, as a whole represent an original work of
authorship, is a Modification. For example, when Documentation is
released as a series of documents, a Modification is:</p>
</div>
<div class="paragraph">
<p>A.  Any addition to or deletion from the contents of the Original
Documentation or previous Modifications.</p>
</div>
<div class="paragraph">
<p>B.  Any new documentation that contains any part of the Original
Documentation or previous Modifications.</p>
</div>
<div class="paragraph">
<p>1.10.  “Original Documentation” means documentation described as
Original Documentation in the notice required by the Appendix, and
which, at the time of its release under this License is not already
Documentation governed by this License.</p>
</div>
<div class="paragraph">
<p>1.11.  “You” (or “Your”) means an individual or a legal entity
exercising rights under, and complying with all of the terms of, this
License or a future version of this License issued under Section 5.0
(“Versions of the License”). For legal entities, “You” includes any
entity which controls, is controlled by, or is under common control with
You. For purposes of this definition, “control” means (a) the power,
direct or indirect, to cause the direction or management of such entity,
whether by contract or otherwise, or (b) ownership of more than fifty
percent (50%) of the outstanding shares or beneficial ownership of such
entity.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><span class="first-word">2.0  LICENSE GRANTS.</span></p>
</div>
<div class="paragraph">
<p><span class="first-word">2.1  Initial Writer Grant.</span></p>
</div>
<div class="paragraph">
<p>The Initial Writer hereby grants You a world-wide, royalty-free,
non-exclusive license to use, reproduce, prepare Modifications of,
compile, publicly perform, publicly display, demonstrate, market,
disclose and distribute the Documentation in any form, on any media or
via any Electronic Distribution Mechanism or other method now known or
later discovered, and to sublicense the foregoing rights to third
parties through multiple tiers of sublicensees in accordance with the
terms of this License.</p>
</div>
<div class="paragraph">
<p>The license rights granted in this Section 2.1 (“Initial Writer Grant”)
are effective on the date Initial Writer first distributes Original
Documentation under the terms of this License.</p>
</div>
<div class="paragraph">
<p><span class="first-word">2.2.  Contributor Grant.</span></p>
</div>
<div class="paragraph">
<p>Each Contributor hereby grants You a world-wide, royalty-free,
non-exclusive license to use, reproduce, prepare Modifications of,
compile, publicly perform, publicly display, demonstrate, market,
disclose and distribute the Documentation in any form, on any media or
via any Electronic Distribution Mechanism or other method now known or
later discovered, and to sublicense the foregoing rights to third
parties through multiple tiers of sublicensees in accordance with the
terms of this License.</p>
</div>
<div class="paragraph">
<p>The license rights granted in this Section 2.2 (“Contributor Grant”) are
effective on the date Contributor first makes Commercial Use of the
Documentation.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.0  DISTRIBUTION OBLIGATIONS.</span></p>
</div>
<div class="paragraph">
<p><span class="first-word">3.1.  Application of License.</span></p>
</div>
<div class="paragraph">
<p>The Modifications which You create or to which You contribute are
governed by the terms of this License, including without limitation
Section 2.2 (“Contributor Grant”). The Documentation may be distributed
only under the terms of this License or a future version of this License
released in accordance with Section 5.0 (“Versions of the License”), and
You must include a copy of this License with every copy of the
Documentation You distribute. You may not offer or impose any terms that
alter or restrict the applicable version of this License or the
recipients' rights hereunder. However, You may include an additional
document offering the additional rights described in Section 3.5
(“Required Notices”).</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.2.  Availability of Documentation.</span></p>
</div>
<div class="paragraph">
<p>Any Modification which You create or to which You contribute must be
made available publicly in Editable Form under the terms of this License
via a fixed medium or an accepted Electronic Distribution Mechanism.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.3.  Description of Modifications.</span></p>
</div>
<div class="paragraph">
<p>All Documentation to which You contribute must identify the changes You
made to create that Documentation and the date of any change. You must
include a prominent statement that the Modification is derived, directly
or indirectly, from Original Documentation provided by the Initial
Writer and include the name of the Initial Writer in the Documentation
or via an electronic link that describes the origin or ownership of the
Documentation. The foregoing change documentation may be created by
using an electronic program that automatically tracks changes to the
Documentation. You must make all such changes and required information
publicly available for at least five years following release of the
changed Documentation.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.4.  Intellectual Property Matters.</span></p>
</div>
<div class="paragraph">
<p>Contributor represents that Contributor believes that Contributor&#8217;s
Modifications are Contributor&#8217;s original creation(s), Contributor has
sufficient rights to grant the rights conveyed by this License, or both
of these statements are true.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.5.  Required Notices.</span></p>
</div>
<div class="paragraph">
<p>You must duplicate the notice in the Appendix in each file of the
Documentation. If it is not possible to put such notice in a particular
Documentation file due to its structure, then You must include such
notice in a location (such as a relevant directory) where a reader would
be likely to look for such a notice, for example, via a hyperlink in
each file of the Documentation that takes the reader to a page that
describes the origin and ownership of the Documentation. If You created
one or more Modification(s) You may add your name as a Contributor to
the notice described in the Appendix.</p>
</div>
<div class="paragraph">
<p>You must also duplicate this License in any Documentation file (or with
a hyperlink in each file of the Documentation) where You describe
recipients' rights or ownership rights.</p>
</div>
<div class="paragraph">
<p>You may choose to offer, and to charge a fee for, warranty, support,
indemnity or liability obligations to one or more recipients of
Documentation. However, You may do so only on Your own behalf, and not
on behalf of the Initial Writer or any Contributor. You must make it
absolutely clear than any such warranty, support, indemnity or liability
obligation is offered by You alone, and You hereby agree to indemnify
the Initial Writer and every Contributor for any liability incurred by
the Initial Writer or such Contributor as a result of warranty, support,
indemnity or liability terms You offer.</p>
</div>
<div class="paragraph">
<p><span class="first-word">3.6.  Larger Works.</span></p>
</div>
<div class="paragraph">
<p>You may create a Larger Work by combining Documentation with other
documents not governed by the terms of this License and distribute the
Larger Work as a single product. In such a case, You must make sure the
requirements of this License are fulfilled for the Documentation.</p>
</div>
<div class="paragraph">
<p><span class="first-word">4.0  APPLICATION OF THIS LICENSE.</span></p>
</div>
<div class="paragraph">
<p>This License applies to Documentation to which the Initial Writer has
attached this License and the notice in the Appendix.</p>
</div>
<div class="paragraph">
<p><span class="first-word">5.0  TRADEMARKS.</span></p>
</div>
<div class="paragraph">
<p>This license does not grant permission to use the trade names,
trademarks, service marks, logos, or product names of the Initial Writer
or any Contributor, except as required for reasonable and customary use
in describing the Origin of the Documentation and reproducing the
content of any of the notices described in the Appendix.</p>
</div>
<div class="paragraph">
<p><span class="first-word">6.0  VERSIONS OF THE LICENSE.</span></p>
</div>
<div class="paragraph">
<p><span class="first-word">6.1.  New Versions.</span></p>
</div>
<div class="paragraph">
<p>Initial Writer may publish revised or new versions of the License from
time to time. Each version will be given a distinguishing version
number.</p>
</div>
<div class="paragraph">
<p><span class="first-word">6.2.  Effect of New Versions.</span></p>
</div>
<div class="paragraph">
<p>Once Documentation has been published under a particular version of the
License, You may always continue to use it under the terms of that
version. You may also choose to use such Documentation under the terms
of any subsequent version of the License published by
__________________[Insert name of the foundation, company, Initial
Writer, or whoever may modify this License]. No one other than
_________________ [Insert name of the foundation, company,
Initial Writer, or whoever may modify this License] has the right to
modify the terms of this License. Filling in the name of the Initial
Writer, Original Documentation or Contributor in the notice described in
the Appendix shall not be deemed to be Modifications of this License.</p>
</div>
<div class="paragraph">
<p><span class="first-word">7.0  DISCLAIMER OF WARRANTY.</span></p>
</div>
<div class="paragraph">
<p>DOCUMENTATION IS PROVIDED UNDER THIS LICENSE ON AN “AS IS” BASIS,
WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
WITHOUT LIMITATION, WARRANTIES THAT THE DOCUMENTATION IS FREE OF
DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING.
THE ENTIRE RISK AS TO THE QUALITY, ACCURACY, AND PERFORMANCE OF THE
DOCUMENTATION IS WITH YOU. SHOULD ANY DOCUMENTATION PROVE DEFECTIVE IN
ANY RESPECT, YOU (NOT THE INITIAL WRITER OR ANY OTHER CONTRIBUTOR)
ASSUME THE COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. THIS
DISCLAIMER OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO
USE OF ANY DOCUMENTATION IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS
DISCLAIMER.</p>
</div>
<div class="paragraph">
<p><span class="first-word">8.0  TERMINATION.</span></p>
</div>
<div class="paragraph">
<p>This License and the rights granted hereunder will terminate
automatically if You fail to comply with terms herein and fail to cure
such breach within 30 days of becoming aware of the breach. All
sublicenses to the Documentation which are properly granted shall
survive any termination of this License. Provisions which, by their
nature, must remain in effect beyond the termination of this License
shall survive.</p>
</div>
<div class="paragraph">
<p><span class="first-word">9.0  LIMITATION OF LIABILITY.</span></p>
</div>
<div class="paragraph">
<p>UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER IN TORT
(INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL THE INITIAL
WRITER, ANY OTHER CONTRIBUTOR, OR ANY DISTRIBUTOR OF DOCUMENTATION, OR
ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY PERSON FOR ANY
DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY
CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL,
WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER
DAMAGES OR LOSSES ARISING OUT OF OR RELATING TO THE USE OF THE
DOCUMENTATION, EVEN IF SUCH PARTY SHALL HAVE BEEN INFORMED OF THE
POSSIBILITY OF SUCH DAMAGES.</p>
</div>
<div class="paragraph">
<p><span class="first-word">10.0  U.S. GOVERNMENT END USERS.</span></p>
</div>
<div class="paragraph">
<p>If Documentation is being acquired by or on behalf of the U.S.
Government or by a U.S. Government prime contractor or subcontractor (at
any tier), then the Government&#8217;s rights in Documentation will be only as
set forth in this Agreement; this is in accordance with 48 CFR 227.7201
through 227.7202-4 (for Department of Defense (DOD) acquisitions) and
with 48 CFR 2.101 and 12.212 (for non-DOD acquisitions).</p>
</div>
<div class="paragraph">
<p><span class="first-word">11.0  MISCELLANEOUS.</span></p>
</div>
<div class="paragraph">
<p>This License represents the complete agreement concerning the subject
matter hereof. If any provision of this License is held to be
unenforceable, such provision shall be reformed only to the extent
necessary to make it enforceable. This License shall be governed by
California law, excluding its conflict-of-law provisions. With respect
to disputes or any litigation relating to this License, the losing party
is responsible for costs, including without limitation, court costs and
reasonable attorneys' fees and expenses. The application of the United
Nations Convention on Contracts for the International Sale of Goods is
expressly excluded. Any law or regulation which provides that the
language of a contract shall be construed against the drafter shall not
apply to this License.</p>
</div>
<div class="paragraph">
<p>=== Public Documentation License Notice</p>
</div>
<div class="paragraph">
<p>The contents of this Documentation are subject to the Public
Documentation License Version 1.01 (the “License”); you may only use
this Documentation if you comply with the terms of this License. A copy
of the License is available at <a href="http://illumos.org/license/PDL" class="bare">http://illumos.org/license/PDL</a></p>
</div>
<div class="paragraph">
<p>The Original Documentation is the Solaris CIFS Administration Guide. The
Initial Writer of the Original Documentation is Sun Microsystems
Copyright &#169; 2008. All Rights Reserved. (Initial Writer contact(s):
<a href="http://sun.com" class="bare">http://sun.com</a>).</p>
</div>
<div class="paragraph">
<p>Contributor(s): RackTop Systems, Inc. are Copyright &#169; 2023.
(Contributor contact(s):
<a href="http://rackstopsystems.com">http://racktopsystems.com</a>).</p>
</div>
<div class="paragraph">
<p>This documentation was derived from the source at
<a href="https://github.com/illumos/illumos-docbooks">illumos docbooks</a>. For full
changes as required by the PDL, please see the above URL.</p>
</div>
<script src="scroll-spy.js"></script>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-07-15 04:27:39 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>